/* Font Hierarchy:
   - Display (Garamond): Fantasy headings, titles, word names
   - Sans (Gill Sans): UI text, tooltips, subtext, buttons
   - Mono: Numbers, AP values, multipliers, stats */
:root {
  --font-display: 'EB Garamond', serif;
  --font-sans: 'Gill Sans', 'Gill Sans MT', -apple-system, system-ui, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  /* 136 BPM Rhythmic Timing */
  --beat: 0.4412s;           /* 1/4 note */
  --half-beat: 0.2206s;      /* 1/8 note */
  --quarter-beat: 0.1103s;   /* 1/16 note */
  --eighth-beat: 0.0551s;    /* 1/32 note */
  --bar: 1.7647s;            /* 1 measure (4 beats) */
  /* UI Scale: 20% larger for better readability on smaller screens */
  --ui-scale: 1.2;
}

*{box-sizing:border-box;margin:0;padding:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
input,textarea{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}

/* Body: Black background, no centering needed with viewport-filling container */
body{font-family:var(--font-sans);background:#000;color:#e5e7eb;min-height:100vh;overflow:hidden;margin:0;padding:0}

/* Game Container: Viewport-filling flex layout */
#game-container {
  width: 100vw;
  height: 100vh;
  height: 100lvh; /* Modern viewport height with fallback */
  position: relative;
  overflow: hidden;
  background:radial-gradient(circle at 20% 20%,rgba(244,208,63,0.06),transparent 30%),linear-gradient(135deg,#0a0a0a,#080808 40%,#0c0c0c);
  background-blend-mode:overlay;

  /* Flexbox layout: header at top, battle+forge centered as unit */
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-bottom: 40px; /* Bottom padding */
}

/* FX Canvas: Matches viewport, positioned absolutely */
#fx-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10000; /* Above overlays for combat effects */
}

/* Visual Filters: Paper Grain + Ink Vignette (outside container, covers viewport) */
.screen-overlay {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
}

#paper-overlay {
  pointer-events: none;
}
#paper-overlay rect {
  mix-blend-mode: soft-light;
  opacity: 0.18;
  pointer-events: none;
}

#ink-vignette {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9000;
  background: radial-gradient(circle at center,
    transparent 0%,
    transparent 55%,
    rgba(12,12,12,0.08) 65%,
    rgba(10,10,10,0.18) 75%,
    rgba(8,8,8,0.28) 85%,
    rgba(5,5,5,0.45) 92%,
    rgba(0,0,0,0.6) 100%
  );
}

/* Anti-banding dither overlay - high-frequency noise to break up gradient steps */
#dither-overlay {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9001;
  opacity: 0.03;
  mix-blend-mode: overlay;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
}

/* Demo Footer */
#demo-footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  text-align: center;
  padding: 6px 16px;
  font-size: 9px;
  font-family: var(--font-mono);
  letter-spacing: 0.05em;
  color: #4b5563;
  background: linear-gradient(180deg, transparent, rgba(0,0,0,0.4) 40%);
  pointer-events: none;
  z-index: 8000;
}

/* Typography Overhaul - Yellow/gold headings use Garamond Bold */
/* Includes all hero/enemy name instances */
#title, .modal-title, #crate-reel-title,
.hero-name, .enemy-name, .crate-title,
.portrait-name, #victory-hero-name {
  text-transform: none !important;
  font-family: var(--font-display);
  text-shadow: 0 2px 4px rgba(0,0,0,0.8);
  font-weight: 700;
  letter-spacing: 0.02em;
}

/* Logo image styles */
.logo-img {
  display: block;
  height: auto;
  margin-top: -15%;
  margin-bottom: -15%;
  user-select: none;
  -webkit-user-drag: none;
  pointer-events: auto;
  cursor: pointer;
  transition: transform var(--quarter-beat) ease;
}
.logo-img:active {
  transform: scale(0.95);
}
.logo-img.logo-bounce {
  animation: logoBounce var(--beat) ease;
}
@keyframes logoBounce {
  0% { transform: scale(1); }
  30% { transform: scale(0.92); }
  60% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
#title {
  display: flex;
  align-items: center;
  justify-content: center;
}
#title .logo-img {
  width: 180px;
  margin-top: -12%;
  margin-bottom: -12%;
}
.logo-large {
  width: 350px;
}
.logo-menu {
  width: 280px;
  margin-left: auto;
  margin-right: auto;
}
.logo-pause {
  width: 200px;
  margin-left: auto;
  margin-right: auto;
}

/* Round/Chapter pill - Gill Sans for both shop and forge */
#round-pill, .shop-round-pill {
  font-family: var(--font-sans);
}

/* Talent modal headers - Gill Sans, ALL CAPS, less spacing */
#talent-overlay .modal-title {
  font-family: var(--font-sans);
  text-transform: uppercase;
  font-size: 16px;
  letter-spacing: 0.1em;
  margin-bottom: 8px;
}
#talent-overlay .modal > div:nth-child(2) {
  margin-bottom: 4px;
}
.talent-pick-counter {
  font-family: var(--font-sans);
  text-transform: uppercase;
  font-size: 14px;
  letter-spacing: 0.08em;
  margin-bottom: 12px;
}

/* Gold count - Gill Sans */
#gold, .gold-pill {
  font-family: var(--font-sans);
}

/* Dialogue intro ROUND label - ALL CAPS Garamond Bold */
.round-label {
  font-family: var(--font-display);
  text-transform: uppercase !important;
  letter-spacing: 0.1em;
  font-weight: 700;
}

/* Crate reel title - ALL CAPS Garamond Bold with letter spacing */
#crate-reel-title {
  text-transform: uppercase !important;
  letter-spacing: 0.15em;
  font-size: 24px;
  font-weight: 700;
}

/* Monospace uppercase subheadings - system/techy feel */
.mono-heading{font-family:var(--font-mono);text-transform:uppercase;letter-spacing:0.1em;font-weight:bold;font-size:10px}

/* Shop section titles - Gill Sans uppercase */
.shop-section-title{font-family:var(--font-sans);text-transform:uppercase;letter-spacing:0.1em;font-weight:bold;font-size:10px;color:#6b7280;opacity:1}

/* Shop Portraits */
.shop-portrait {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(26,29,36,0.6);
  border: 2px solid #374151;
  position: relative;
  overflow: hidden;
  box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}
.shop-portrait .portrait-frame {
  width: 100%; height: 100%;
  border-radius: 50%;
  border: none;
  margin: 0;
  overflow: hidden;
}
.shop-portrait .portrait-frame svg {
  width: 100%; height: 100%;
  display: block;
}

/* God Rays Effect */
.god-rays {
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: repeating-conic-gradient(
    from 0deg,
    rgba(244, 208, 63, 0.05) 0deg,
    rgba(244, 208, 63, 0.05) 10deg,
    transparent 10deg,
    transparent 20deg
  );
  animation: rotateRays calc(var(--bar) * 12) linear infinite; /* ~21.2s */
  pointer-events: none;
  z-index: 1;
}

@keyframes rotateRays {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Victory overlay - rainbow iridescent theme (flame bg handles the color) */
#victory-overlay .modal{overflow:hidden}
#victory-overlay .modal::after{content:"";position:absolute;top:-100%;left:-100%;width:300%;height:300%;background:conic-gradient(from 0deg,transparent,rgba(255,100,100,0.12),rgba(255,200,100,0.15),rgba(100,255,150,0.12),rgba(100,200,255,0.15),rgba(200,100,255,0.12),transparent);animation:victoryIridescent 6s linear infinite;pointer-events:none;z-index:0}
@keyframes victoryIridescent{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* Rainbow god rays for victory */
#victory-overlay .god-rays{background:repeating-conic-gradient(from 0deg,rgba(255,100,100,0.06) 0deg,transparent 5deg,rgba(255,200,100,0.06) 10deg,transparent 15deg,rgba(100,255,150,0.06) 20deg,transparent 25deg,rgba(100,200,255,0.06) 30deg,transparent 35deg,rgba(200,100,255,0.06) 40deg,transparent 45deg);animation:rotateRays 15s linear infinite}

/* Rainbow god rays for chapter overlay run completion (adds .rainbow class) */
#chapter-overlay .god-rays.rainbow{width:150vmax;height:150vmax;background:radial-gradient(ellipse at center,rgba(255,200,255,0.1) 0%,transparent 40%),repeating-conic-gradient(from 0deg,rgba(255,100,100,0.08) 0deg,transparent 5deg,rgba(255,200,100,0.1) 10deg,transparent 15deg,rgba(100,255,150,0.08) 20deg,transparent 25deg,rgba(100,200,255,0.1) 30deg,transparent 35deg,rgba(200,100,255,0.08) 40deg,transparent 45deg);animation:chapterRays 12s linear infinite;opacity:1}

/* Rainbow effect handled by god-rays.rainbow - no ::after needed */

/* Z-Index Logic Fixes */
.slot-container {
  z-index: 10; /* Slots sit above the preview panel */
}

#damage-preview-text {
  z-index: 1; /* Preview panel sits behind slots */
  /* backdrop-filter here creates the stacking context trap */
}

/* This targets the new Portal Tooltip we will create in JS.
   It lives on <body>, so it ignores the preview panel's low z-index.
*/
#damage-preview-text-tooltip-portal {
  position: fixed !important;
  z-index: 100001 !important;
  pointer-events: none;

  /* FORCE DYNAMIC SIZING */
  width: auto !important;
  min-width: 300px;
  max-width: 450px !important;
  height: auto;

  /* Text handling */
  white-space: normal !important;
  overflow-wrap: break-word;

  /* Manual styling in case JS cssText fails */
  background: #1a1d24;
  border: 1px solid #4b5563;
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.9);

  transition: opacity var(--quarter-beat) ease;
}
#flame-bg{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;background:black;--flame-opacity:0.3;--flame-scale:1;--mouse-x:0%;--mouse-y:0%;transition:--flame-opacity .5s ease,--flame-scale .5s ease;overflow:hidden}
#flame-bg::before,#flame-bg::after{content:'';position:absolute;border-radius:50%;opacity:var(--flame-opacity);transition:opacity var(--beat) ease,transform var(--half-beat) ease,background calc(var(--beat) * 2) ease;left:50%;top:50%;transform-origin:center;will-change:transform,opacity}
/* Orange/yellow glow - pre-baked soft gradient (no blur filter needed) */
/* Larger size + gradual fade simulates the blur effect */
#flame-bg::after{width:180vw;height:110vh;background:radial-gradient(ellipse,hsl(25,95%,55%) 0%,hsl(25,94%,53%) 5%,hsl(24,93%,50%) 10%,hsl(23,91%,47%) 15%,hsl(22,88%,43%) 20%,hsl(20,85%,38%) 25%,hsl(18,80%,32%) 30%,hsl(16,70%,25%) 35%,hsl(14,55%,18%) 40%,hsl(12,40%,12%) 45%,rgba(0,0,0,0) 55%);transform:translate(calc(-50% + var(--mouse-x) * 0.3),calc(-50% + var(--mouse-y) * 0.3)) scale(var(--flame-scale));animation:flame-drift-outer 18s ease-in-out infinite;z-index:1}
/* Red core - pre-baked soft gradient (no blur filter needed) */
#flame-bg::before{width:110vw;height:80vh;background:radial-gradient(ellipse,hsl(0,90%,50%) 0%,hsl(1,89%,48%) 5%,hsl(2,87%,45%) 10%,hsl(3,85%,42%) 15%,hsl(4,82%,38%) 20%,hsl(5,78%,33%) 25%,hsl(6,70%,27%) 30%,hsl(7,58%,20%) 35%,hsl(8,45%,14%) 40%,hsl(9,30%,9%) 45%,rgba(0,0,0,0) 55%);transform:translate(calc(-50% + var(--mouse-x) * -0.2),calc(-50% + var(--mouse-y) * -0.2)) scale(var(--flame-scale));animation:flame-drift-core 12s ease-in-out infinite;z-index:2}
/* Purple flame for pre-boss shop - pre-baked soft gradient */
#flame-bg.boss-shop-mode::after{background:radial-gradient(ellipse,hsl(280,85%,55%) 0%,hsl(278,82%,50%) 10%,hsl(275,78%,44%) 20%,hsl(272,72%,36%) 30%,hsl(270,60%,26%) 40%,hsl(268,45%,16%) 48%,rgba(0,0,0,0) 55%)}
#flame-bg.boss-shop-mode::before{background:radial-gradient(ellipse,hsl(290,90%,50%) 0%,hsl(288,87%,46%) 10%,hsl(286,82%,40%) 20%,hsl(284,75%,33%) 30%,hsl(282,62%,24%) 40%,hsl(280,45%,15%) 48%,rgba(0,0,0,0) 55%)}
/* Purple pulse for boss dialogue */
#flame-bg.boss-dialogue-mode::after{background:radial-gradient(ellipse,hsl(280,85%,55%) 0%,hsl(278,82%,50%) 10%,hsl(275,78%,44%) 20%,hsl(272,72%,36%) 30%,hsl(270,60%,26%) 40%,hsl(268,45%,16%) 48%,rgba(0,0,0,0) 55%);animation:flame-drift-outer 18s ease-in-out infinite, boss-pulse var(--bar) ease-in-out infinite}
#flame-bg.boss-dialogue-mode::before{background:radial-gradient(ellipse,hsl(290,90%,50%) 0%,hsl(288,87%,46%) 10%,hsl(286,82%,40%) 20%,hsl(284,75%,33%) 30%,hsl(282,62%,24%) 40%,hsl(280,45%,15%) 48%,rgba(0,0,0,0) 55%);animation:flame-drift-core 12s ease-in-out infinite, boss-pulse var(--bar) ease-in-out infinite 0.5s}
@keyframes boss-pulse{0%,100%{opacity:var(--flame-opacity)}50%{opacity:calc(var(--flame-opacity) * 1.6)}}
/* Purple flame for chapter boss battle (no pulse) */
#flame-bg.boss-battle-mode::after{background:radial-gradient(ellipse,hsl(280,85%,55%) 0%,hsl(278,82%,50%) 10%,hsl(275,78%,44%) 20%,hsl(272,72%,36%) 30%,hsl(270,60%,26%) 40%,hsl(268,45%,16%) 48%,rgba(0,0,0,0) 55%)}
#flame-bg.boss-battle-mode::before{background:radial-gradient(ellipse,hsl(290,90%,50%) 0%,hsl(288,87%,46%) 10%,hsl(286,82%,40%) 20%,hsl(284,75%,33%) 30%,hsl(282,62%,24%) 40%,hsl(280,45%,15%) 48%,rgba(0,0,0,0) 55%)}
/* Blue flame for shop mode - pre-baked soft gradient */
#flame-bg.shop-mode::after{background:radial-gradient(ellipse,hsl(200,90%,55%) 0%,hsl(203,87%,50%) 10%,hsl(206,82%,44%) 20%,hsl(208,75%,36%) 30%,hsl(210,62%,26%) 40%,hsl(212,45%,16%) 48%,rgba(0,0,0,0) 55%)}
#flame-bg.shop-mode::before{background:radial-gradient(ellipse,hsl(220,95%,60%) 0%,hsl(223,92%,54%) 10%,hsl(226,87%,47%) 20%,hsl(228,78%,38%) 30%,hsl(230,65%,28%) 40%,hsl(232,48%,18%) 48%,rgba(0,0,0,0) 55%)}
/* Flame texture scroll animation */
@keyframes flame-scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
/* Core drifts one direction */
@keyframes flame-drift-core{0%,100%{transform:translate(calc(-50% + var(--mouse-x) * -0.2),calc(-50% + var(--mouse-y) * -0.2)) scale(var(--flame-scale))}50%{transform:translate(calc(-50% + 30px + var(--mouse-x) * -0.2),calc(-50% - 20px + var(--mouse-y) * -0.2)) scale(calc(var(--flame-scale) * 1.08))}}
/* Outer drifts opposite direction for parallax */
@keyframes flame-drift-outer{0%,100%{transform:translate(calc(-50% + var(--mouse-x) * 0.3),calc(-50% + var(--mouse-y) * 0.3)) scale(var(--flame-scale))}50%{transform:translate(calc(-50% - 40px + var(--mouse-x) * 0.3),calc(-50% + 25px + var(--mouse-y) * 0.3)) scale(calc(var(--flame-scale) * 1.12))}}
.gold{color:#f4d03f;text-shadow:0 1px 3px rgba(244,208,63,0.3)}.hero-c{color:#4ade80}.enemy-c{color:#f87171}.dim{color:#6b7280}
/* Custom SVG Icons */
.icon{width:1em;height:1em;display:inline-block;vertical-align:-0.125em;fill:currentColor}
.icon.lg{width:1.5em;height:1.5em}
.icon.xl{width:2em;height:2em}
button{background:#1f2937;color:#e5e7eb;border:1px solid var(--border-soft);padding:10px 20px;border-radius:6px;cursor:pointer;font-size:14px;transition:all var(--quarter-beat);font-family:var(--font-sans)}
button:hover:not(:disabled){background:#374151;border-color:#4b5563;transform:translateY(-1px)}
button:disabled{opacity:.5;cursor:not-allowed}

/* Difficulty selector buttons */
.diff-btn{padding:8px 16px;font-size:12px;background:#1f2937;border:1px solid #374151;border-radius:6px;color:#9ca3af;transition:all var(--quarter-beat)}
.diff-btn:hover:not(:disabled){background:#374151;color:#e5e7eb}
.diff-btn.selected{background:linear-gradient(135deg,#1e3a5f,#1e293b);border-color:#3b82f6;color:#60a5fa;box-shadow:0 0 12px rgba(59,130,246,0.3)}
.diff-btn[data-diff="1"].selected{background:linear-gradient(135deg,#5c2d0f,#1e293b);border-color:#f97316;color:#fb923c;box-shadow:0 0 12px rgba(249,115,22,0.3)}
.diff-btn[data-diff="2"].selected{background:linear-gradient(135deg,#5c1f1f,#1e293b);border-color:#ef4444;color:#f87171;box-shadow:0 0 12px rgba(239,68,68,0.3)}
.diff-btn.locked{opacity:0.4;cursor:not-allowed}

#view-talents-btn:hover:not(:disabled){background:linear-gradient(135deg,#a855f7,#7e22ce);box-shadow:0 4px 12px rgba(168,85,247,0.4);transform:translateY(-2px)}
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;margin:2px;background:#1a1d24;border:1px solid var(--border-soft)}
.tag.str{color:#4ade80;border-color:#4ade8055}.tag.weak{color:#f87171;border-color:#f8717155}.tag.prof{color:#60a5fa;border-color:#60a5fa55}.tag.neutral{color:#9ca3af;border-color:#9ca3af55}.tag.ability{color:#d8b4fe;border-color:#a855f7;background:rgba(168,85,247,0.15)}
.tag.irony{color:#e879f9;border-color:#d946ef;background:rgba(217,70,239,0.15)}.irony-badge{display:inline-block;background:linear-gradient(135deg,#d946ef,#a855f7);color:#fff;font-size:9px;padding:1px 5px;border-radius:3px;margin-left:4px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
#header{
  flex-shrink:0; /* Don't shrink */
  width:100%;
  max-width:min(1100px, 95vw);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 24px;
  position:relative;
  z-index:100
}
/* Hide header when main menu is showing (game hasn't started) */
body.menu-active #header{display:none}
/* Hide header during victory celebration */
body:has(#victory-overlay.show) #header{display:none}
/* Hide header when pause menu is open */
body:has(#pause-menu.show) #header{display:none}
/* Hide header when achievements/stats overlay is open */
body:has(#achievements-overlay.show) #header{display:none}
/* Hide header when shop is open (shop has its own controls) */
body:has(#shop-overlay.show) #header{display:none}
#title{font-size:24px;font-weight:bold;position:absolute;left:50%;transform:translateX(-50%);text-transform:uppercase;letter-spacing:0.2em}
#stats-pills{display:flex;gap:8px;z-index:1}
.stat-pill{padding:4px 10px;border-radius:999px;background:linear-gradient(135deg,#111827,#0b1220);border:1px solid var(--border-soft);font-size:11px;box-shadow:0 3px 10px #0007,inset 0 0 0 1px #1f2937;color:#e5e7eb;font-family:var(--font-sans)}
.stat-pill span{color:#fbbf24;font-weight:600;font-family:var(--font-mono)}
.gold-pill{background:linear-gradient(135deg,#422006,#1c1917);border:1px solid #ca8a04;cursor:pointer;position:relative}
.gold-pill:hover{border-color:#eab308;box-shadow:0 0 8px rgba(234,179,8,0.3)}
.shop-pill.gold-pill{background:linear-gradient(135deg,#422006,#1c1917);border:1px solid #ca8a04;cursor:pointer}
.shop-pill.gold-pill:hover{border-color:#eab308;box-shadow:0 0 8px rgba(234,179,8,0.3)}
#header-controls{display:flex;gap:8px;z-index:10;position:relative}
#header-controls button{font-size:12px;padding:6px 12px;background:linear-gradient(135deg,#1f2937,#111827);border:1px solid var(--border-soft);border-radius:6px;color:#e5e7eb;cursor:pointer;transition:all var(--half-beat)}
#header-controls button:hover{background:linear-gradient(135deg,#374151,#1f2937);border-color:#4b5563}
#sound-btn{font-size:14px;padding:6px 10px}

/* Sound Control Panel */
#sound-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#1f2937,#111827);border:1px solid var(--border-soft);border-radius:12px;padding:16px;min-width:220px;box-shadow:0 8px 32px #000a;z-index:10500}
#sound-panel.hidden{display:none}
.sound-panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #374151}
.sound-panel-header span{font-size:13px;font-weight:600;color:#e5e7eb}
.sound-panel-header button{background:none;border:none;color:#9ca3af;cursor:pointer;font-size:14px;padding:2px 6px}
.sound-panel-header button:hover{color:#e5e7eb}
.sound-slider-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.sound-slider-row label{font-size:11px;color:#9ca3af;width:45px}
.sound-slider-row input[type="range"]{flex:1;height:4px;-webkit-appearance:none;background:#374151;border-radius:2px;cursor:pointer}
.sound-slider-row input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:#fbbf24;border-radius:50%;cursor:pointer;box-shadow:0 2px 6px #0005}
.sound-slider-row .vol-value{font-size:10px;color:#6b7280;width:30px;text-align:right}

/* ======================================
   TOAST NOTIFICATION SYSTEM - "EMBER NOTICE"
   Complete redesign: Clean, modern dark fantasy
   Focused on readability and subtle forge aesthetics
   ====================================== */

/* Toast container - positioned top-right inside game-container */
#toast-container {
  position: absolute;
  top: 80px;
  right: 24px;
  z-index: 99999;
  display: flex;
  flex-direction: column;
  gap: 10px;
  pointer-events: none;
  max-width: 380px;
}

/* Individual toast notification - clean elevated card */
.toast {
  position: relative;
  background: linear-gradient(145deg,
    rgba(24, 28, 36, 0.97),
    rgba(16, 20, 28, 0.98));
  backdrop-filter: blur(16px) saturate(120%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 14px 16px;
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.5),
    0 1px 4px rgba(0, 0, 0, 0.3),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.08);
  pointer-events: auto;
  cursor: pointer;
  font-family: var(--font-sans);
  overflow: hidden;

  /* Entrance animation state - fade only, no slide (avoids overflow clipping) */
  opacity: 0;
  transform: scale(0.95);
  transition:
    opacity 0.3s ease-out,
    transform 0.3s ease-out,
    box-shadow var(--quarter-beat) ease,
    border-color var(--quarter-beat) ease;
}

/* Subtle inner glow accent */
.toast::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(
    circle at top right,
    rgba(251, 191, 36, 0.04),
    transparent 60%
  );
  pointer-events: none;
  border-radius: 12px;
  opacity: 0;
  transition: opacity var(--half-beat) ease;
}

.toast:hover::before {
  opacity: 1;
}

/* Toast entrance animation - fade in and scale up */
.toast.show {
  opacity: 1;
  transform: scale(1);
}

/* Icon entrance - gentle pop */
.toast.show .toast-icon {
  animation: toastIconPop calc(var(--beat) * 1.2) cubic-bezier(0.34, 1.56, 0.64, 1) var(--quarter-beat);
  animation-fill-mode: backwards;
}

@keyframes toastIconPop {
  0% {
    transform: scale(0.4);
    opacity: 0;
  }
  60% {
    transform: scale(1.08);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

/* Toast exit animation - quick fade out */
.toast.hiding {
  opacity: 0;
  transform: scale(0.95);
  transition:
    opacity 0.2s ease-out,
    transform 0.2s ease-out;
}

/* Toast content layout */
.toast-content {
  position: relative;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  z-index: 1;
}

/* Toast icon - modern minimal badge */
.toast-icon {
  flex-shrink: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(251, 191, 36, 0.12);
  border-radius: 8px;
  border: 1px solid rgba(251, 191, 36, 0.2);
  position: relative;
  transition:
    transform var(--quarter-beat) ease,
    background var(--quarter-beat) ease,
    border-color var(--quarter-beat) ease;
}

.toast-icon svg {
  width: 18px;
  height: 18px;
  color: #fbbf24;
  fill: #fbbf24;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
  transition: transform var(--quarter-beat) ease;
}

.toast:hover .toast-icon {
  transform: scale(1.05);
  background: rgba(251, 191, 36, 0.18);
  border-color: rgba(251, 191, 36, 0.3);
}

.toast:hover .toast-icon svg {
  transform: scale(1.05);
}

/* Toast text area */
.toast-body {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.toast-title {
  font-family: var(--font-display);
  font-size: 15px;
  font-weight: 700;
  line-height: 1.3;
  color: #f8fafc;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
  letter-spacing: 0.01em;
}

.toast-msg {
  font-size: 12.5px;
  line-height: 1.45;
  color: #cbd5e1;
  max-width: 100%;
  word-wrap: break-word;
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.4);
}

/* Toast button - clean modern style */
.toast-btn {
  margin-top: 10px;
  width: 100%;
  padding: 9px 16px;
  background: linear-gradient(135deg,
    rgba(251, 191, 36, 0.15),
    rgba(245, 158, 11, 0.15));
  border: 1px solid rgba(251, 191, 36, 0.3);
  border-radius: 8px;
  color: #fbbf24;
  font-family: var(--font-sans);
  font-size: 11.5px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  cursor: pointer;
  transition: all var(--quarter-beat) ease;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
  box-shadow:
    0 1px 3px rgba(0, 0, 0, 0.3),
    inset 0 0.5px 0 rgba(251, 191, 36, 0.2);
}

.toast-btn:hover {
  background: linear-gradient(135deg,
    rgba(251, 191, 36, 0.24),
    rgba(245, 158, 11, 0.24));
  border-color: rgba(251, 191, 36, 0.5);
  transform: translateY(-1px);
  box-shadow:
    0 2px 8px rgba(251, 191, 36, 0.15),
    0 1px 3px rgba(0, 0, 0, 0.4),
    inset 0 0.5px 0 rgba(251, 191, 36, 0.3);
}

.toast-btn:active {
  transform: translateY(0);
  box-shadow:
    0 1px 2px rgba(0, 0, 0, 0.4),
    inset 0 1px 2px rgba(0, 0, 0, 0.3);
}

/* Type-specific accent colors - left border and icon styling */

/* Success variant - green */
.toast.success {
  border-left: 3px solid #4ade80;
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.5),
    0 1px 4px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(74, 222, 128, 0.08),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.08);
}

.toast.success .toast-icon {
  background: rgba(74, 222, 128, 0.12);
  border-color: rgba(74, 222, 128, 0.25);
}

.toast.success .toast-icon svg {
  color: #4ade80;
  fill: #4ade80;
}

.toast.success:hover .toast-icon {
  background: rgba(74, 222, 128, 0.18);
  border-color: rgba(74, 222, 128, 0.35);
}

/* Error variant - red */
.toast.error {
  border-left: 3px solid #f87171;
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.5),
    0 1px 4px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(248, 113, 113, 0.08),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.08);
}

.toast.error .toast-icon {
  background: rgba(248, 113, 113, 0.12);
  border-color: rgba(248, 113, 113, 0.25);
}

.toast.error .toast-icon svg {
  color: #f87171;
  fill: #f87171;
}

.toast.error:hover .toast-icon {
  background: rgba(248, 113, 113, 0.18);
  border-color: rgba(248, 113, 113, 0.35);
}

/* Warning variant - amber/gold */
.toast.warning {
  border-left: 3px solid #fbbf24;
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.5),
    0 1px 4px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(251, 191, 36, 0.08),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.08);
}

.toast.warning .toast-icon {
  background: rgba(251, 191, 36, 0.12);
  border-color: rgba(251, 191, 36, 0.25);
}

.toast.warning .toast-icon svg {
  color: #fbbf24;
  fill: #fbbf24;
}

.toast.warning:hover .toast-icon {
  background: rgba(251, 191, 36, 0.18);
  border-color: rgba(251, 191, 36, 0.35);
}

/* Info variant - blue */
.toast.info {
  border-left: 3px solid #60a5fa;
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.5),
    0 1px 4px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(96, 165, 250, 0.08),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.08);
}

.toast.info .toast-icon {
  background: rgba(96, 165, 250, 0.12);
  border-color: rgba(96, 165, 250, 0.25);
}

.toast.info .toast-icon svg {
  color: #60a5fa;
  fill: #60a5fa;
}

.toast.info:hover .toast-icon {
  background: rgba(96, 165, 250, 0.18);
  border-color: rgba(96, 165, 250, 0.35);
}

/* Hover effect - subtle lift and glow */
.toast:hover {
  border-color: rgba(255, 255, 255, 0.15);
  transform: translateY(-2px);
  box-shadow:
    0 6px 24px rgba(0, 0, 0, 0.6),
    0 2px 8px rgba(0, 0, 0, 0.4),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.12);
}

/* Type-specific hover enhancements */
.toast.success:hover {
  box-shadow:
    0 6px 24px rgba(0, 0, 0, 0.6),
    0 0 20px rgba(74, 222, 128, 0.08),
    0 0 0 1px rgba(74, 222, 128, 0.12),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.12);
}

.toast.error:hover {
  box-shadow:
    0 6px 24px rgba(0, 0, 0, 0.6),
    0 0 20px rgba(248, 113, 113, 0.08),
    0 0 0 1px rgba(248, 113, 113, 0.12),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.12);
}

.toast.warning:hover {
  box-shadow:
    0 6px 24px rgba(0, 0, 0, 0.6),
    0 0 20px rgba(251, 191, 36, 0.08),
    0 0 0 1px rgba(251, 191, 36, 0.12),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.12);
}

.toast.info:hover {
  box-shadow:
    0 6px 24px rgba(0, 0, 0, 0.6),
    0 0 20px rgba(96, 165, 250, 0.08),
    0 0 0 1px rgba(96, 165, 250, 0.12),
    inset 0 0.5px 0 rgba(255, 255, 255, 0.12);
}

/* Progress bar - clean minimal design */
.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 2px;
  background: linear-gradient(90deg,
    #fbbf24 0%,
    #f59e0b 100%);
  border-radius: 0 0 12px 12px;
  transition: width linear;
  box-shadow: 0 0 8px rgba(251, 191, 36, 0.4);
  z-index: 2;
}

/* Type-specific progress bars */
.toast.success .toast-progress {
  background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
  box-shadow: 0 0 8px rgba(74, 222, 128, 0.4);
}

.toast.error .toast-progress {
  background: linear-gradient(90deg, #f87171 0%, #ef4444 100%);
  box-shadow: 0 0 8px rgba(248, 113, 113, 0.4);
}

.toast.info .toast-progress {
  background: linear-gradient(90deg, #60a5fa 0%, #3b82f6 100%);
  box-shadow: 0 0 8px rgba(96, 165, 250, 0.4);
}

/* Legacy support - keep old ID for backward compatibility */
#game-toast {
  display: none;
}

/* Fallback styles for browsers without backdrop-filter */
@supports not (backdrop-filter: blur(1px)) {
  .toast {
    background: linear-gradient(145deg,
      rgba(24, 28, 36, 1),
      rgba(16, 20, 28, 1)) !important;
  }
}
#battle-view{
  flex-shrink:0; /* Don't shrink */
  margin-top:auto; /* Push down, centering with forge */
  display:flex;
  gap:clamp(20px, 4vw, 60px);
  width:100%;
  max-width:min(1200px, 95vw);
  padding:16px;
  align-items:center;
  justify-content:center;
  position:relative;
  z-index:5
}
.portrait-container{flex:0 1 clamp(200px, 25vw, 320px)}
.portrait{background:#0d1117;border-radius:12px;padding:16px;border:2px solid #2a2f38;position:relative;overflow:hidden;cursor:pointer;transition:border-color var(--half-beat) ease,box-shadow var(--half-beat) ease}
.hero-portrait{border-color:#4ade8044}.enemy-portrait{border-color:#f8717144}
.hero-portrait:hover{border-color:#4ade8088;box-shadow:0 0 12px rgba(74,222,128,0.15)}
.enemy-portrait:hover{border-color:#f8717188;box-shadow:0 0 12px rgba(248,113,113,0.15)}
.portrait-frame{width:80px;height:80px;border-radius:50%;background:#1a1d24;border:3px solid;margin:0 auto 12px;position:relative;overflow:hidden}
.portrait.speaking .portrait-frame{animation:portraitTalk var(--quarter-beat) ease-in-out infinite}
@keyframes portraitTalk{0%,100%{transform:rotate(-1.5deg) scale(1.01)}50%{transform:rotate(1.5deg) scale(1.01)}}
.portrait-frame svg{width:100%;height:100%;display:block}
.hero-portrait .portrait-frame{border-color:#4ade80;background:linear-gradient(135deg,#22543d,#1a1d24)}
.enemy-portrait .portrait-frame{border-color:#f87171;background:linear-gradient(135deg,#7f1d1d,#1a1d24)}
.portrait-info{text-align:center}
.portrait-name{font-size:16px;font-weight:bold;margin-bottom:8px}
/* Hide the details toggle container as the panels are now triggered by hovering on the portraits */
.portrait-details{display:none}
.health-bar-container{margin-bottom:8px}
.health-bar{height:24px;background:#1a1d24;border-radius:4px;overflow:hidden;position:relative;border:1px solid var(--border-soft)}
.health-fill{height:100%;transition:width var(--half-beat) ease-out;position:absolute;top:0;left:0}
.hero-fill{background:linear-gradient(90deg,#22c55e,#4ade80)}
.enemy-fill{background:linear-gradient(90deg,#f59e0b,#fbbf24);transition:width var(--quarter-beat) ease-out,background var(--half-beat) ease-out}
/* HP color stages - transitions as enemy takes damage */
.enemy-fill.hp-high{background:linear-gradient(90deg,#f59e0b,#fbbf24)} /* Orange - 100%-60% */
.enemy-fill.hp-mid{background:linear-gradient(90deg,#ea580c,#f97316)} /* Darker orange - 60%-30% */
.enemy-fill.hp-low{background:linear-gradient(90deg,#dc2626,#ef4444)} /* Red - 30%-10% */
.enemy-fill.hp-critical{background:linear-gradient(90deg,#991b1b,#dc2626);animation:criticalPulse var(--beat) ease-in-out infinite} /* Dark red + pulse - <10% */
@keyframes criticalPulse{0%,100%{opacity:1;filter:brightness(1)}50%{opacity:0.7;filter:brightness(1.3)}}
/* Shake effect when taking heavy damage */
@keyframes hpShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-3px)}40%{transform:translateX(3px)}60%{transform:translateX(-2px)}80%{transform:translateX(2px)}}
.health-bar.shake{animation:hpShake 0.3s ease-out}
.health-preview{position:absolute;top:0;height:100%;opacity:0.5;transition:all var(--half-beat)}
.damage-preview{background:#dc2626;right:0}

/* Blink animation for damage preview on the health bar */
@keyframes blink {
  /* Slow down the blink and make it linger longer at the low opacity. */
  0%, 80%, 100% { opacity: 1; }
  40% { opacity: 0.3; }
}
/*
 * Apply an infinite blink animation to the damage preview bar so that
 * predicted damage continues to pulse until the player forges the weapon.
 */
.blink {
  animation: blink 1.2s ease-in-out infinite;
}
.element-badges{display:flex;gap:4px;justify-content:center;margin:6px 0;flex-wrap:wrap}
.elem-badge{font-size:9px;padding:2px 6px;border-radius:3px;border:1px solid var(--border-soft);opacity:0.9}
.elem-badge.strong{background:#22543d33;color:#4ade80;border-color:#4ade8055}
.elem-badge.weak{background:#7f1d1d33;color:#f87171;border-color:#f8717155}
.health-text{font-size:12px;color:#9ca3af;margin-top:4px}
.details-toggle{font-size:10px;padding:4px 12px;background:#1a1d24;border:1px solid var(--border-soft);border-radius:4px;cursor:pointer;color:#9ca3af}
.details-toggle:hover{background:#374151;color:#e5e7eb}
.details-panel{width:100%;max-width:950px;background:#0d1117;border-radius:12px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.09);outline:1px solid rgba(0,0,0,0.7);position:relative;overflow:hidden}
.details-panel::before{content:"";position:absolute;inset:0;border-radius:inherit;border:1px solid rgba(245,193,92,0.2);pointer-events:none;mask:radial-gradient(20px 20px at 0 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 0 100%,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 100%,#000 95%,transparent 100%);opacity:.6}
.details-panel{background:linear-gradient(135deg,rgba(255,255,255,0.05),rgba(0,0,0,0.5)),radial-gradient(circle at 25% 25%,rgba(255,255,255,0.03),transparent 35%),radial-gradient(circle at 80% 30%,rgba(255,255,255,0.02),transparent 40%);background-blend-mode:overlay;box-shadow:0 0 0 1px rgba(0,0,0,0.8),0 12px 30px rgba(0,0,0,0.45)}
.details-panel.hidden{display:none}
.details-content{font-size:12px}
#vs-center{flex:0 0 200px;display:flex;flex-direction:column;align-items:center;gap:16px;position:relative;z-index:10!important}
#weapon-display{text-align:center;overflow:visible!important;position:relative;z-index:1}
#weapon-aura{position:absolute;top:50%;left:50%;width:400px;height:400px;transform:translate(-50%, -50%);z-index:-1;border-radius:50%;opacity:0.6;pointer-events:none;transition:background var(--beat) ease}
.weapon-canvas{position:relative;transition:transform var(--half-beat),filter var(--half-beat);filter:drop-shadow(0 6px 14px rgba(0,0,0,0.35));perspective:800px;overflow:visible!important;transform:translateY(-3px)}
.weapon-layered{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform var(--half-beat) ease,filter var(--half-beat) ease;--tilt-x:0deg;--tilt-y:0deg;transform:rotateX(var(--tilt-x)) rotateY(var(--tilt-y));will-change:transform;backface-visibility:hidden}
.weapon-layered[data-parallax-enabled="false"]{transform:none}
.weapon-layered:hover{filter:drop-shadow(0 10px 24px rgba(0,0,0,0.55));}
.weapon-layer{position:absolute;inset:0;pointer-events:none;width:100%;height:100%;}
.weapon-layer.slam-in{animation:weaponPartSlam 0.35s cubic-bezier(0.34,1.56,0.64,1)}

@keyframes weaponPartSlam{
  0%{opacity:0;transform:scale(1.6);filter:blur(3px) brightness(1.5)}
  20%{opacity:1;transform:scale(1.08) translate(-2px,0);filter:blur(0) brightness(1.3)}
  40%{transform:scale(0.96) translate(2px,-1px);filter:brightness(1.2)}
  60%{transform:scale(1.02) translate(-1px,1px);filter:brightness(1.1)}
  80%{transform:scale(0.99) translate(1px,0);filter:brightness(1.05)}
  100%{transform:scale(1) translate(0,0);filter:brightness(1)}
}

.weapon-canvas.fly-out{animation:weaponFlyOut 0.3s ease-in forwards}

@keyframes weaponFlyOut{
  0%{opacity:1;transform:scale(1) translateY(0);filter:brightness(1)}
  50%{opacity:0.8;transform:scale(1.1) translateY(-10px);filter:brightness(1.3)}
  100%{opacity:0;transform:scale(0.3) translateY(-40px);filter:brightness(1.5) blur(4px)}
}
.weapon-shadow{position:absolute;inset:-15px;opacity:0.25;transform:translateZ(-20px);background:radial-gradient(circle at 50% 10%, rgba(0,0,0,0.35), transparent 65%);}
/* .weapon-glow removed - now using #weapon-aura for background glow */
#weapon-display .weapon-canvas{width:120px;height:150px;margin:0 auto;}
#weapon-name{font-size:12px;color:#f4d03f;margin-top:8px;min-height:20px;text-shadow:0 1px 3px rgba(244,208,63,0.3)}
#damage-preview-text{display:flex;flex-direction:column;align-items:center;gap:6px;background:linear-gradient(135deg,rgba(20,25,35,0.95),rgba(10,13,20,0.95));border-radius:12px;padding:12px 16px;border:1px solid rgba(255,255,255,0.09);outline:1px solid rgba(0,0,0,0.7);position:relative;overflow:visible;box-shadow:0 0 0 1px rgba(0,0,0,0.7),0 12px 24px rgba(0,0,0,0.55);z-index:1;min-width:90px;width:auto;max-width:280px}
#damage-preview-text::before{content:"";position:absolute;inset:0;border-radius:inherit;border:1px solid rgba(245,193,92,0.2);pointer-events:none;mask:radial-gradient(20px 20px at 0 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 0 100%,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 100%,#000 95%,transparent 100%);opacity:.6}
#preview-tooltip-hint{opacity:0.85;display:flex;align-items:center;gap:8px}
.icon-button{width:20px;height:20px;border-radius:50%;border:1px solid #4b5563;background:#1f2937;color:#e5e7eb;font-size:12px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;line-height:1;padding:0}
.icon-button:hover{cursor:pointer}
.icon-button:hover:not(:disabled){background:#374151;border-color:#6b7280}
.icon-button:focus-visible{outline:2px solid #f4d03f;outline-offset:2px}
.damage-number{font-size:24px;font-weight:700;min-width:60px;text-align:center;text-shadow:0 2px 6px rgba(0,0,0,0.6)}
.damage-number.hero-damage{color:#4ade80;text-shadow:0 2px 8px rgba(74,222,128,0.4)}
.damage-number.enemy-damage{color:#f87171;text-shadow:0 2px 8px rgba(248,113,113,0.4)}
/* Smaller, muted text for displaying calculations under the primary damage number */
.ap-number{font-size:14px;margin-top:4px}
.math-subtext{font-size:12px;color:#9ca3af;font-style:italic;opacity:0.9;letter-spacing:0.03em}
/* Bonus badges container under damage preview */
#preview-bonus-badges{display:flex;flex-wrap:wrap;justify-content:center;gap:4px 6px;margin-top:4px;width:100%}
#preview-bonus-badges:empty{display:none}
#preview-bonus-badges .mod-badge{font-size:9px;padding:2px 5px;white-space:nowrap}
/* Highlight preview panel when hero damage meets or exceeds enemy HP */
#damage-preview-text.goal-achieved{border-color:#4ade80;box-shadow:0 0 6px #4ade8066}
/* Highlight selected word in the bank */
.chip.selected{border-color:#f4d03f;box-shadow:0 0 8px rgba(244,208,63,0.45)}
/* Hide entire slot containers when the hidden class is applied. Without this rule
   only the inner .slot element would be hidden, leaving spacing in place. */
.slot-container.hidden{display:none}
/* Hide hero health bar and preview elements since hero HP is not used */
.health-bar.hero-bar{display:none}
#hero-health-text{display:none}
#hero-damage-preview{display:none}

/* Hide hero-specific damage and HP in combat overlay since hero does not take damage */
#combat-dmg .combat-block:first-child,
#combat-bars .bar-block:first-child{
  display:none;
}
#combat-dmg{
  /* Hide the entire strikes display since enemy strikes are no longer relevant */
  display:none !important;
}
.card{background:#0d1117;border-radius:12px;padding:16px;border:1px solid;flex:1;position:relative;overflow:visible}
#forge,.modal,.details-panel,#damage-preview-text{
  outline:none;
  border-color:#52525b;
}
.chip.selected{
  border-color:#f4d03f!important;
  box-shadow:0 0 0 1px #f4d03f,0 0 15px rgba(244,208,63,0.4)!important;
}
.chip:active, .chip.active-press{
  border-color:#f4d03f!important;
  transform:scale(0.94)!important;
  box-shadow:0 0 0 1px #f4d03f,0 0 15px rgba(244,208,63,0.7),0 0 25px rgba(244,208,63,0.3)!important;
}
#damage-preview-text.goal-achieved{
  border-color:#4ade80;
  box-shadow:0 0 0 1px #4ade80,0 0 15px rgba(74,222,128,0.4);
}
.card-surface{
  position:relative;
  overflow:visible;
  border-radius:12px;
}
.weapon-tile{
  position:relative;
  background:linear-gradient(145deg,rgba(40,50,70,0.5),rgba(18,24,36,0.8));
  border:1px solid rgba(75,85,99,0.5);
}
.weapon-tile::before{content:none}
.weapon-tile::after{content:none}
.card.hero{border-color:#4ade8044}.card.enemy{border-color:#f8717144}
.card-header{display:flex;justify-content:space-between;margin-bottom:6px;font-size:13px}
.card-name{font-size:18px;margin-bottom:4px;font-family:var(--font-display);font-weight:700}
.card-desc{font-size:11px;color:#9ca3af;margin-bottom:8px;font-style:italic;line-height:1.4;letter-spacing:0.03em}
.card-dialogue{background:#1a1d24;border-radius:8px;padding:10px;margin-bottom:10px;font-size:12px;color:#d1d5db;border-left:3px solid #4ade80;line-height:1.4}
.card.enemy .card-dialogue{border-left-color:#f87171}
.card-stats{font-size:12px;margin-bottom:6px}
.card-section{margin-bottom:6px}
.card-section-title{font-size:10px;color:#6b7280;margin-bottom:2px}

/* Dialogue line displayed directly under hero and enemy portraits */
.portrait-dialogue{
  font-size:12px;
  color:#d1d5db;
  font-style:italic;
  margin-top:4px;
  margin-bottom:4px;
  letter-spacing:0.03em;
}
#forge{
  flex-shrink:0; /* Don't shrink */
  margin-bottom:auto; /* Push up, centering with battle-view */
  background:#12151a;
  border-radius:12px;
  padding:12px 20px;
  width:100%;
  max-width:min(1100px, 95vw);
  border:1px solid #2a2f38;
  position:relative;
  z-index:20!important;
  transition:transform var(--half-beat) ease, opacity var(--half-beat) ease
}
#forge.shop-hidden{transform:scale(0.95);opacity:0.5;pointer-events:none}
#sentence{display:flex;justify-content:center;align-items:flex-start;gap:8px;margin-bottom:10px;flex-wrap:wrap}
.slot-container{display:flex!important;flex-direction:column;align-items:center;position:relative;z-index:10;transition:opacity var(--beat) ease,transform var(--beat) cubic-bezier(0.34,1.56,0.64,1),max-width var(--beat) ease,margin var(--beat) ease;opacity:1;transform:scale(1);max-width:140px;margin:0 4px;overflow:visible}
.slot-container.hidden{display:flex!important;opacity:0;transform:scale(0);max-width:0;margin:0;pointer-events:none}
.slot-mult{font-size:10px;height:18px;font-family:var(--font-mono);margin-bottom:4px;display:flex;gap:4px;justify-content:center;align-items:center;padding:0 4px}
.slot{min-width:95px;height:50px;background:#1a1d24;border:2px dashed #374151;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#6b7280;transition:all var(--quarter-beat);padding:0 10px;cursor:pointer;overflow:visible;z-index:100;will-change:transform}
.slot{
  /* Make slots relative containers so that tooltips can be positioned relative to them */
  position:relative;
}
.slot:hover{border-color:#4b5563}.slot.over{border-color:#f4d03f;background:#1f2419}.slot.filled{border-style:solid;border-color:#4b5563}

/* Element accent gradient top border for filled slots - layered over existing border */
.slot.filled::after{content:"";position:absolute;top:-2px;left:-2px;right:-2px;height:4px;background:linear-gradient(90deg,transparent 5%,var(--slot-elem-color,#4b5563) 50%,transparent 95%);opacity:1;pointer-events:none;border-radius:8px 8px 0 0;z-index:10}
.slot.elem-physical{--slot-elem-color:#9ca3af}
.slot.elem-poison{--slot-elem-color:#4ade80}
.slot.elem-fire{--slot-elem-color:#f97316}
.slot.elem-water{--slot-elem-color:#60a5fa}
.slot.elem-light{--slot-elem-color:#fde047}
.slot.elem-dark{--slot-elem-color:#a78bfa}
.slot.elem-earth{--slot-elem-color:#a8896c}
.slot.elem-lightning{--slot-elem-color:#22d3ee}
.slot[data-slot="noun1"]:not(.filled){background:radial-gradient(circle at 50% 30%,#374151 0%,#111827 80%);border:2px dashed #6b7280;box-shadow:inset 0 0 20px rgba(255,255,255,0.05),0 0 10px rgba(0,0,0,0.5);position:relative;overflow:hidden;color:#9ca3af}
.slot[data-slot="noun1"]:not(.filled)::before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,100,100,0.08) 0%,rgba(255,200,100,0.08) 25%,rgba(100,255,150,0.08) 50%,rgba(100,150,255,0.08) 75%,rgba(200,100,255,0.08) 100%);opacity:0.6;pointer-events:none}
.slot[data-slot="noun1"]:not(.filled)::after{content:"";position:absolute;top:-100%;left:-100%;width:300%;height:300%;background:conic-gradient(from 0deg,transparent,rgba(255,255,255,0.1),rgba(255,200,150,0.15),rgba(150,255,200,0.1),rgba(150,200,255,0.15),rgba(255,150,255,0.1),transparent);animation:iridescent 4s linear infinite;pointer-events:none}
.slot.gem-slot-filled{border-color:var(--glow-color);border-left-width:2px;box-shadow:inset 0 0 15px color-mix(in srgb, var(--glow-color) 20%, transparent), 0 0 15px color-mix(in srgb, var(--glow-color) 40%, transparent);background:radial-gradient(circle at 50% 30%, color-mix(in srgb, var(--glow-color) 13%, transparent) 0%, #111827 90%)}
.chip.dragging{transform:scale(0.7);opacity:0.6;cursor:grabbing!important}
body.is-dragging .tooltip{display:none!important}
body.is-dragging #bank .chip{pointer-events:none}
@keyframes expand-in{from{transform:scale(0.7)}to{transform:scale(1)}}
@keyframes slotPopIn{0%{opacity:0;transform:scale(0.8) translateY(-10px)}100%{opacity:1;transform:scale(1) translateY(0)}}
@keyframes chipPopOut{0%{transform:scale(1);opacity:1}100%{transform:scale(0.7);opacity:0}}
@keyframes chipPopIn{0%{transform:scale(0.7);opacity:0}60%{transform:scale(1.08);opacity:1}100%{transform:scale(1);opacity:1}}
.chip.popping-out{animation:chipPopOut 0.15s ease-in forwards;pointer-events:none}
.slot-content.popping-in{animation:chipPopIn 0.2s ease-out forwards}
@keyframes iridescent{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
/* Signature Style: Iridescent weapon slot when proficient weapon equipped */
.slot[data-slot="item"].signature-style-active{position:relative;overflow:hidden;border:2px solid #9966cc;box-shadow:inset 0 0 20px rgba(153,102,204,0.15),0 0 15px rgba(153,102,204,0.3)}
.slot[data-slot="item"].signature-style-active::before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,100,100,0.1) 0%,rgba(255,200,100,0.1) 25%,rgba(100,255,150,0.1) 50%,rgba(100,150,255,0.1) 75%,rgba(200,100,255,0.1) 100%);opacity:0.7;pointer-events:none;z-index:0}
.slot[data-slot="item"].signature-style-active::after{content:"";position:absolute;top:-100%;left:-100%;width:300%;height:300%;background:conic-gradient(from 0deg,transparent,rgba(255,255,255,0.12),rgba(255,200,150,0.18),rgba(150,255,200,0.12),rgba(150,200,255,0.18),rgba(255,150,255,0.12),transparent);animation:iridescent 4s linear infinite;pointer-events:none;z-index:0}
.slot[data-slot="item"].signature-style-active .slot-content{position:relative;z-index:1}
.slot-content{cursor:grab}
.slot-content:active{cursor:grabbing}
.chip:active{cursor:grabbing!important}
.slot-content.just-dropped{animation:expand-in 0.2s ease-out}
@keyframes wordPlaced{0%{transform:scale(1);box-shadow:0 0 0 rgba(74,222,128,0)}50%{transform:scale(1.1);box-shadow:0 0 20px rgba(74,222,128,0.6)}100%{transform:scale(1);box-shadow:0 0 0 rgba(74,222,128,0)}}
.breakdown-pill::before,.chip::before,#damage-preview-text::before,.details-panel::before,.card::before,.modal::before{transition:opacity var(--half-beat)}
@keyframes shine {
  from { transform: translateX(-80%); opacity: 0; }
  40% { opacity: 0.45; }
  to   { transform: translateX(120%); opacity: 0; }
}
.slot.word-placed{animation:wordPlaced 0.3s ease-out;border-color:#4ade80}
.slot.hidden{display:none}
/* Red Aktins REDACTED slot overlay */
.slot.redacted-slot{position:relative;pointer-events:none;border-color:#6b21a8!important;background:#1a0a2e!important}
.slot.redacted-slot::before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(107,33,168,0.3) 0%,rgba(139,92,246,0.15) 50%,rgba(107,33,168,0.3) 100%);border-radius:6px;z-index:1}
.redacted-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Courier New',monospace;font-size:11px;font-weight:bold;letter-spacing:3px;color:#9966cc;text-shadow:0 0 10px #6b21a8,0 0 20px #6b21a8;z-index:2;background:repeating-linear-gradient(45deg,transparent 0px,transparent 4px,rgba(107,33,168,0.1) 4px,rgba(107,33,168,0.1) 8px)}
.slot-calc{font-size:10px;color:#9ca3af;margin-top:4px;min-height:16px;font-family:var(--font-mono);text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;line-height:1.2}
.slot-calc.positive{color:#4ade80;background:#4ade8022;padding:2px 6px;border-radius:3px;font-weight:bold}
.slot-calc.negative{color:#f87171;background:#f8717122;padding:2px 6px;border-radius:3px;font-weight:bold}
.slot-calc .mod-badge.word{margin-right:4px}
#of-label{font-size:16px;color:#6b7280;align-self:center;padding:0 8px;flex-shrink:0}
#of-label.hidden{display:none}
.connector-phrase,.italic{font-style:italic;font-family:var(--font-display);letter-spacing:0.03em}
#preview{display:flex;justify-content:center;align-items:center;gap:30px;background:#080a0d;border-radius:8px;padding:12px;margin-bottom:14px}
.preview-block{text-align:center}
.preview-label{font-size:9px;color:#6b7280;margin-bottom:2px}
.preview-value{font-size:28px;font-weight:bold}
#backup-weapon{text-align:center;font-size:10px;color:#f59e0b;margin-bottom:8px;display:none}
#bank-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:10px;padding:0 8px}
#bank-controls #inv-counter{transition:background var(--quarter-beat)}
#bank-controls #inv-counter:hover{background:#374151}
.info-icon{opacity:0.5;font-size:10px;margin-left:2px}
.shop-pill:hover .info-icon{opacity:0.8}
#sort-btns button{padding:4px 10px;font-size:10px}
#sort-btns button.active{background:#374151;border-color:#4b5563}
#sort-dir-btn-forge,#sort-dir-btn{
  /* Ensure the sort direction arrow remains visible and aligned with other sort buttons.  
     Increase the font size so the arrow character isnt mistaken for other symbols. */
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:4px 10px;
  font-size:16px;
  line-height:1;
}
#bank{
  display:grid;
  grid-template-columns:repeat(10, 1fr);
  grid-template-rows:repeat(3, minmax(52px, auto));
  gap:4px;
  padding:8px;
  background:#0d1017;
  border-radius:8px;
  position:relative;
  transition:background var(--quarter-beat),border var(--quarter-beat);
  justify-items:center;
  align-items:start;
  overflow:visible
}
#bank .chip{font-size:10px;padding:8px 6px;min-width:0;width:100%;text-align:center;white-space:nowrap;min-height:52px}
#bank .chip .chip-name{overflow:hidden;text-overflow:ellipsis}
#bank .chip:hover{z-index:100000}
#bank .chip .tooltip{z-index:100005!important}
#bank .chip:hover{z-index:100004!important}
#bank.over{background:#1f2419;border:2px solid #4ade8044}
.chip{background:linear-gradient(135deg,#121926,#0c111b);border:1px solid #2d333b;border-radius:10px;padding:8px 12px;cursor:grab;text-align:center;min-width:80px;min-height:42px;transition:all var(--quarter-beat);user-select:none;position:relative;overflow:visible;z-index:10}
.chip:hover:not(.disabled){border-color:#4b5563;transform:translateY(-2px);box-shadow:0 4px 12px #0005;z-index:50}
.chip:active{cursor:grabbing}
.chip.disabled{opacity:.25;cursor:not-allowed;transform:none!important;filter:grayscale(0.8)}
.chip.disabled:hover .tooltip,.consumable-item.disabled:hover .tooltip{opacity:1!important;transform:translateX(-50%) scale(1)!important}
.chip.rusty{border-color:#92400e55;background:#1a1510}
/* Card-style chip layout */
/* Word name uses display font (storybook feel), subtext uses sans */
.chip-name{font-size:12px;text-align:center;font-family:var(--font-display);font-weight:700}
.chip-info{font-size:8px;color:#6b7280;text-align:center;font-family:var(--font-sans)}
.chip-elem{font-size:8px;margin-top:2px;text-align:center;font-family:var(--font-sans)}
.chip-tier{position:absolute;top:2px;right:3px;font-size:6px;font-weight:700;padding:1px 3px;border-radius:2px;letter-spacing:0.2px;line-height:1;font-family:var(--font-mono)}
.chip-tier.tier-1{background:#9ca3af;color:#000}.chip-tier.tier-2{background:#60a5fa;color:#000}.chip-tier.tier-3{background:#f4d03f;color:#000}

/* Element color tabs */
.chip-tab{position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:10px 0 0 10px;pointer-events:none;z-index:1}
.chip-tab.elem-phys{background:#a0a0a0}
.chip-tab.elem-poison{background:#7ee04d}
.chip-tab.elem-fire{background:#f97316}
.chip-tab.elem-water{background:#3b82f6}
.chip-tab.elem-light{background:#fef08a}
.chip-tab.elem-dark{background:#6b21a8}
.chip-tab.elem-earth{background:#a67c52}
.chip-tab.elem-lightning{background:#facc15}

/* Tier intensity gradient wash from tab side */
.chip.tier-wash-2::after{content:'';position:absolute;left:0;top:0;bottom:0;width:55%;background:linear-gradient(90deg,var(--wash-color,rgba(255,255,255,0.12)),transparent);pointer-events:none;border-radius:10px 0 0 10px}
.chip.tier-wash-3::after{content:'';position:absolute;left:0;top:0;bottom:0;width:95%;background:linear-gradient(90deg,var(--wash-color,rgba(255,255,255,0.22)) 0%,var(--wash-color,rgba(255,255,255,0.10)) 50%,transparent 100%);pointer-events:none;border-radius:10px 0 0 10px}

/* Element-specific wash colors - T2 uses stronger base */
.chip.elem-wash-phys{--wash-color:rgba(160,160,160,0.18)}
.chip.elem-wash-poison{--wash-color:rgba(126,224,77,0.18)}
.chip.elem-wash-fire{--wash-color:rgba(249,115,22,0.18)}
.chip.elem-wash-water{--wash-color:rgba(59,130,246,0.18)}
.chip.elem-wash-light{--wash-color:rgba(254,240,138,0.15)}
.chip.elem-wash-dark{--wash-color:rgba(107,33,168,0.20)}
.chip.elem-wash-earth{--wash-color:rgba(166,124,82,0.20)}
.chip.elem-wash-lightning{--wash-color:rgba(250,204,21,0.15)}
/* T3 intensified wash colors */
.chip.tier-wash-3.elem-wash-phys{--wash-color:rgba(180,180,180,0.30)}
.chip.tier-wash-3.elem-wash-poison{--wash-color:rgba(126,224,77,0.32)}
.chip.tier-wash-3.elem-wash-fire{--wash-color:rgba(249,115,22,0.32)}
.chip.tier-wash-3.elem-wash-water{--wash-color:rgba(59,130,246,0.32)}
.chip.tier-wash-3.elem-wash-light{--wash-color:rgba(254,240,138,0.26)}
.chip.tier-wash-3.elem-wash-dark{--wash-color:rgba(107,33,168,0.36)}
.chip.tier-wash-3.elem-wash-earth{--wash-color:rgba(166,124,82,0.34)}
.chip.tier-wash-3.elem-wash-lightning{--wash-color:rgba(250,204,21,0.26)}

/* T3 words golden glow effect (not weapons) */
.chip.tier-wash-3:not(.weapon-tile){
  box-shadow:0 0 12px rgba(244,208,63,0.25),0 0 20px rgba(244,208,63,0.15),inset 0 0 0 1px rgba(244,208,63,0.12);
}
.chip.tier-wash-3:not(.weapon-tile)::before{
  content:"";
  position:absolute;
  inset:3px;
  border-radius:9px;
  background:linear-gradient(120deg,rgba(255,255,255,0.12),rgba(255,255,255,0.02));
  filter:blur(4px);
  pointer-events:none;
}

/* Rarity words - subtle persistent inner glow */
.chip.rarity-word{overflow:visible;box-shadow:inset 0 0 12px rgba(255,255,255,0.03)}
.chip.rarity-word.rarity-t1{background:linear-gradient(135deg,#1a1d24 0%,#22262f 50%,#1a1d24 100%);box-shadow:inset 0 0 15px rgba(192,192,192,0.06),inset 0 1px 0 rgba(255,255,255,0.04)}
.chip.rarity-word.rarity-t2{background:linear-gradient(135deg,#1a1d28 0%,#1e2535 50%,#1a1d28 100%);box-shadow:inset 0 0 18px rgba(96,165,250,0.12),inset 0 1px 0 rgba(96,165,250,0.08)}
.chip.rarity-word.rarity-t3{background:linear-gradient(135deg,#1f1d1a 0%,#2a2620 50%,#1f1d1a 100%);box-shadow:0 0 12px rgba(244,208,63,0.25),0 0 20px rgba(244,208,63,0.15),inset 0 0 20px rgba(252,211,77,0.12),inset 0 1px 0 rgba(252,211,77,0.10)}
.mult-pill{display:inline-block;padding:1px 6px;border-radius:999px;background:linear-gradient(135deg,#1e3a5f,#0f2744);border:1px solid #3b82f6;font-size:8px;color:#60a5fa;margin-top:2px;font-weight:600}
.word-pill{display:inline-block;padding:1px 6px;border-radius:999px;background:linear-gradient(135deg,#1e3a5f,#0f2744);border:1px solid #60a5fa;font-size:inherit;color:#60a5fa;font-weight:500}
.tier-0{color:#b45309}.tier-1{color:#9ca3af}.tier-2{color:#60a5fa}.tier-3{color:#f4d03f}
.tooltip{position:absolute;bottom:100%;left:50%;transform:translateX(-50%) scale(0.98);background:#1a1d24;border:1px solid #4b5563;border-radius:8px;padding:10px;font-size:11px;width:260px;max-height:60vh;overflow-y:auto;text-align:left;z-index:100000!important;pointer-events:none;opacity:0;transition:opacity var(--quarter-beat) ease,transform var(--quarter-beat) ease;margin-bottom:8px;box-shadow:0 4px 20px #000a}
.chip:hover .tooltip{opacity:1;transform:translateX(-50%) scale(1)}
/* Inventory breakdown tooltip */
.inv-tooltip{width:320px;padding:12px}
.inv-tooltip .inv-section{margin-bottom:10px}
.inv-tooltip .inv-section:last-child{margin-bottom:0}
.inv-tooltip .inv-section-title{font-size:10px;color:#6b7280;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px;border-bottom:1px solid #374151;padding-bottom:4px}
.inv-tooltip .inv-row{display:flex;flex-wrap:wrap;gap:4px;align-items:center}
.inv-tooltip .inv-elem{display:inline-flex;align-items:center;gap:3px;padding:2px 6px;border-radius:4px;font-size:10px;background:#1f2937}
.inv-tooltip .inv-elem.missing{opacity:0.3}
.inv-tooltip .inv-elem-count{font-family:var(--font-mono);font-weight:bold}
#inv-counter{position:relative;z-index:1000}
#inv-counter .tooltip{z-index:100001}
#inv-counter:hover .tooltip,#inv-counter:focus .tooltip{opacity:1;transform:translateX(-50%) scale(1)}
.shop-pill.has-tooltip:hover .tooltip{opacity:1;transform:translateX(-50%) scale(1)}
/* Allow tooltips on slots to appear when hovering */
.slot .tooltip{z-index:100000;pointer-events:none}
.slot:hover .tooltip{opacity:1;transform:translateX(-50%) scale(1)}
.has-tooltip .tooltip.modal-tooltip{z-index:100000}
/* Tooltips use sans-serif for clean readability */
.tooltip,.tooltip-title,.tooltip-type,.tooltip-line,.inv-tooltip{font-family:var(--font-sans)}
.tooltip-title{font-size:13px;font-weight:bold;margin-bottom:4px}
.tooltip-type{font-size:10px;color:#6b7280;margin-bottom:6px}
.tooltip-line{margin:4px 0;color:#d1d5db}
.tooltip-line.positive{color:#4ade80}
.tooltip-line.negative{color:#f87171}
.tooltip-line.dim{color:#6b7280;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;margin-top:8px}
/* Talent bonuses section in chip tooltips */
.tooltip-talents{margin-top:8px;padding-top:8px;border-top:1px solid #374151}
.tooltip-talent-row{display:flex;align-items:center;justify-content:space-between;gap:8px;margin:4px 0;font-size:11px}
.talent-name-badge{background:#4ade8022;color:#4ade80;padding:2px 6px;border-radius:3px;font-size:10px;font-weight:500}
/* Two-column breakdown layout */
.breakdown-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:10px 0}
.breakdown-col{display:flex;flex-direction:column;gap:6px}
.breakdown-row{display:flex;justify-content:space-between;align-items:center;gap:8px}
.breakdown-row .label{color:#9ca3af;font-size:10px}
.breakdown-row .value{font-weight:600;font-family:var(--font-mono)}
.breakdown-section{margin:10px 0;padding:10px;background:rgba(0,0,0,0.2);border-radius:6px}
.breakdown-section-title{font-size:10px;color:#6b7280;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;border-bottom:1px solid #374151;padding-bottom:4px}
.breakdown-total{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:rgba(74,222,128,0.1);border-radius:4px;margin-top:6px;border:1px solid rgba(74,222,128,0.2)}
.breakdown-total .label{font-weight:600;color:#4ade80}
.breakdown-mult-row{grid-column:1/-1;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:8px}
.breakdown-total .value{font-weight:bold;color:#4ade80;font-size:13px;display:flex;justify-content:center;align-items:center}
.breakdown-reread{color:#fb923c;font-size:10px;font-weight:600}
/* Formula row with separate total box */
.breakdown-formula-row{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:10px}
.breakdown-formula{text-align:center;padding:8px 12px;background:rgba(96,165,250,0.1);border-radius:4px;font-family:var(--font-mono);font-size:11px;color:#60a5fa;border:1px solid rgba(96,165,250,0.2)}
.breakdown-formula-equals{font-size:14px;color:#9ca3af;font-weight:bold}
.breakdown-formula-total{padding:8px 14px;background:rgba(74,222,128,0.15);border-radius:4px;font-family:var(--font-mono);font-size:16px;font-weight:bold;color:#4ade80;border:1px solid rgba(74,222,128,0.3);min-width:50px;text-align:center}
.tooltip{max-width:520px;word-break:normal;overflow-wrap:break-word}
.tooltip.modal-tooltip{max-height:70vh;overflow-y:auto}
.tooltip.modal-tooltip.breakdown-tooltip{max-height:none;overflow:visible;width:min(780px,95vw)}
.breakdown-col .tooltip-line{white-space:normal}
.tooltip-elem{display:inline-block;padding:2px 6px;border-radius:3px;font-size:9px;margin-top:4px}
.mod-badge{display:inline-block;padding:2px 6px;border-radius:3px;font-size:10px;font-weight:bold;font-family:var(--font-mono)}
.mod-badge.add{background:#4ade8033;color:#4ade80}
.mod-badge.word{background:#60a5fa33;color:#60a5fa}
.mod-badge.mult{background:#60a5fa33;color:#60a5fa}
.mod-badge.scale{background:#f472b633;color:#f472b6}
.mod-badge.neg{background:#f8717133;color:#f87171}
.mod-badge.penalty{background:#ef444433;color:#ef4444}
.mod-badge.neutral{background:#6b728033;color:#9ca3af}
.mod-badge.stalemate{background:#22d3ee33;color:#22d3ee}
.mod-badge.strong{background:#fbbf2433;color:#fbbf24;text-shadow:0 0 8px rgba(251,191,36,0.6)}
.mod-badge.reread,.reread-badge{background:#fb923c33;color:#fb923c;display:inline-block;padding:2px 6px;border-radius:3px;font-size:10px;font-weight:bold;font-family:var(--font-mono)}
.mod-badge.threshold{background:#a855f733;color:#a855f7;display:inline-block;padding:2px 6px;border-radius:3px;font-size:10px;font-weight:bold;font-family:var(--font-mono);text-shadow:0 0 8px rgba(168,85,247,0.5)}
.mod-badge.ultimate{background:linear-gradient(135deg,#fbbf24,#f97316,#ef4444);color:#000;display:inline-block;padding:4px 10px;border-radius:4px;font-size:12px;font-weight:bold;font-family:var(--font-mono);text-shadow:0 0 2px rgba(255,255,255,0.5);animation:ultimate-pulse 0.5s ease-in-out infinite alternate}
@keyframes ultimate-pulse{0%{box-shadow:0 0 10px #fbbf24,0 0 20px #f97316}100%{box-shadow:0 0 20px #fbbf24,0 0 40px #f97316,0 0 60px #ef4444}}
#buttons{display:flex;justify-content:center;gap:10px;margin-top:14px;align-items:center}
#forfeit-btn{position:absolute;bottom:12px;right:20px;padding:6px 14px;font-size:11px;background:linear-gradient(135deg,#7f1d1d,#450a0a);border:1px solid #dc262655;border-radius:6px;color:#fca5a5;cursor:pointer;opacity:0.7;transition:all 0.2s ease;letter-spacing:0.05em}
#forfeit-btn:hover{opacity:1;background:linear-gradient(135deg,#991b1b,#7f1d1d);border-color:#dc2626;box-shadow:0 0 8px rgba(220,38,38,0.3)}
#forfeit-btn:active{transform:scale(0.96)}
#forge-btn, #hero-select-btn, #combat-continue, #exit-shop-btn, #start-game-btn, #victory-endless-btn, #pause-new{
  background:linear-gradient(135deg,#22543d,#1a3328);
  border-color:#4ade8055;
  color:#ecfdf3;
  box-shadow:0 0 6px rgba(52,211,153,0.2),0 4px 12px rgba(22,163,74,0.15);
  font-size:15px;
  padding:12px 28px;
  position:relative;
  overflow:hidden;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  letter-spacing:0.1em;
}
#forge-btn:hover:not(:disabled), #hero-select-btn:hover:not(:disabled), #combat-continue:hover:not(:disabled), #exit-shop-btn:hover:not(:disabled), #start-game-btn:hover:not(:disabled), #victory-endless-btn:hover:not(:disabled), #pause-new:hover:not(:disabled){
  background:linear-gradient(135deg,#2d6b4f,#22543d);
  border-color:#4ade8088;
  box-shadow:0 0 8px rgba(52,211,153,0.3),0 6px 14px rgba(22,163,74,0.25);
  transform:scale(1.02)
}
#forge-btn:active:not(:disabled), #hero-select-btn:active:not(:disabled), #combat-continue:active:not(:disabled), #exit-shop-btn:active:not(:disabled), #start-game-btn:active:not(:disabled), #victory-endless-btn:active:not(:disabled), #pause-new:active:not(:disabled){transform:scale(0.98)}

/* Disabled state for buttons - greyed out */
.btn-disabled,
#exit-shop-btn:disabled{
  background:linear-gradient(135deg,#374151,#1f2937) !important;
  border-color:#4b5563 !important;
  color:#6b7280 !important;
  box-shadow:none !important;
  cursor:not-allowed;
  pointer-events:none;
  opacity:0.6;
}

#forge-btn .emoji-compact{
  font-size:1.05em;
  transform:scale(0.82);
}

.emoji-compact{
  display:inline-block;
  line-height:1;
  transform:scale(0.9);
  transform-origin:center;
}

.crate-icon{
  font-size:22px;
  margin-bottom:4px;
  display:flex;
  align-items:center;
  justify-content:center;
  transform:scale(0.85);
  transform-origin:center;
}
.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.7) 120%);display:none;align-items:center;justify-content:center;z-index:102;opacity:0;pointer-events:none;visibility:hidden;transition:opacity var(--half-beat) ease-out,visibility var(--half-beat) ease-out}
.overlay.closing{display:flex;opacity:0;pointer-events:none;visibility:hidden}
.overlay.closing .modal{transform:scale(0.95);opacity:0}
.overlay .modal{transform:scale(0.95);opacity:0;transition:transform var(--half-beat) cubic-bezier(0.34,1.56,0.64,1),opacity var(--half-beat) ease-out}
.overlay.show .modal{transform:scale(1);opacity:1}

/* Talent overlay - darker, less transparent like combat result */
#talent-overlay{background:rgba(8,10,15,0.95)}
#talent-overlay .modal{background:rgba(8,10,15,0.98);border:1px solid var(--border-soft);backdrop-filter:none;-webkit-backdrop-filter:none}

/* Talent viewer overlay - same darker tint for consistency */
#talent-viewer-overlay{background:rgba(8,10,15,0.95)}
#talent-viewer-overlay .modal{background:rgba(8,10,15,0.98);border:1px solid var(--border-soft);backdrop-filter:none;-webkit-backdrop-filter:none}

/* Spotlight tint - dark overlay behind focused modals (combat result, crate opening) */
#spotlight-tint{position:fixed;inset:0;background:rgba(0,0,0,0.78);z-index:101;opacity:0;visibility:hidden;pointer-events:none;backdrop-filter:blur(2px) saturate(0.7);-webkit-backdrop-filter:blur(2px) saturate(0.7);transition:opacity var(--beat) ease,visibility var(--beat) ease,background-color var(--beat) ease}
#spotlight-tint.show{opacity:1;visibility:visible}
#spotlight-tint.full{background:rgba(0,0,0,1)}
#spotlight-tint.crate{opacity:1;visibility:visible;z-index:103;backdrop-filter:blur(2px) saturate(0.7);-webkit-backdrop-filter:blur(2px) saturate(0.7);transition:opacity var(--beat) ease,visibility var(--beat) ease}

/* Chapter complete overlay - fullscreen solid background */
#chapter-overlay{background:rgba(8,10,15,0.98);z-index:150;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;pointer-events:none;transition:opacity var(--beat) ease,visibility 0s var(--beat)}
#chapter-overlay.show{opacity:1;visibility:visible;pointer-events:auto;transition:opacity var(--beat) ease,visibility 0s 0s}

/* Chapter modal container */
.chapter-modal{position:relative;z-index:2;background:linear-gradient(145deg,rgba(20,24,32,0.95),rgba(12,14,20,0.98));border:1px solid rgba(251,191,36,0.25);border-radius:16px;padding:48px 64px;max-width:480px;text-align:center;box-shadow:0 0 60px rgba(251,191,36,0.15),0 0 120px rgba(251,191,36,0.08),0 25px 50px rgba(0,0,0,0.5),inset 0 1px 0 rgba(255,255,255,0.05);transform:scale(0.9);opacity:0;transition:transform var(--beat) cubic-bezier(0.34,1.56,0.64,1),opacity var(--beat) ease;overflow:hidden}
#chapter-overlay.show .chapter-modal{transform:scale(1);opacity:1}
.chapter-modal.rainbow{border-color:rgba(255,150,200,0.3);box-shadow:0 0 80px rgba(255,100,150,0.2),0 0 120px rgba(100,200,255,0.15),0 25px 50px rgba(0,0,0,0.5),inset 0 1px 0 rgba(255,255,255,0.08)}

/* Chapter god-rays - rotating conic gradient */
#chapter-overlay .god-rays{position:absolute;top:50%;left:50%;width:120vmax;height:120vmax;transform:translate(-50%,-50%);pointer-events:none;z-index:1;background:radial-gradient(ellipse at center,rgba(251,191,36,0.12) 0%,transparent 50%),repeating-conic-gradient(from 0deg,rgba(251,191,36,0.04) 0deg,transparent 3deg,rgba(251,191,36,0.06) 6deg,transparent 9deg);animation:chapterRays 20s linear infinite;opacity:0.7}
@keyframes chapterRays{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}

/* Chapter typography */
.chapter-title{font-size:36px;font-weight:bold;letter-spacing:0.12em;margin:0 0 8px 0;text-shadow:0 0 30px rgba(251,191,36,0.4)}
.chapter-portrait{width:100px;height:100px;margin:0 auto 16px auto;border-radius:50%;overflow:hidden;border:3px solid rgba(251,191,36,0.5);background:rgba(0,0,0,0.3);display:none}
.chapter-portrait.show{display:block}
.chapter-hero-name{font-size:14px;color:#9ca3af;margin-bottom:12px;display:none}
.chapter-hero-name.show{display:block}
.chapter-dialogue{font-size:15px;color:#d1d5db;font-style:italic;margin:0 0 24px 0;max-width:360px;line-height:1.5}

/* Chapter rewards */
.chapter-rewards{display:flex;justify-content:center;gap:16px;margin-bottom:32px}
.chapter-reward-badge{background:linear-gradient(135deg,rgba(113,63,18,0.9),rgba(69,26,3,0.95));border:1px solid rgba(251,191,36,0.5);border-radius:12px;padding:16px 32px;display:flex;flex-direction:column;align-items:center;box-shadow:0 0 20px rgba(251,191,36,0.2),0 4px 12px rgba(0,0,0,0.3)}
.reward-label{font-size:11px;color:#9ca3af;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px}
.reward-value{font-size:28px;font-weight:bold;color:#fbbf24;text-shadow:0 0 15px rgba(251,191,36,0.5)}

/* Chapter buttons */
.chapter-buttons{display:flex;flex-direction:column;gap:12px;align-items:center}
.btn-chapter-continue{padding:14px 52px;font-size:16px;font-family:inherit;background:linear-gradient(135deg,#22543d,#1a3328);border:1px solid rgba(74,222,128,0.4);border-radius:8px;cursor:pointer;color:#ecfdf3;box-shadow:0 0 20px rgba(52,211,153,0.25),0 4px 12px rgba(22,163,74,0.2);transition:transform var(--quarter-beat) ease,box-shadow var(--quarter-beat) ease}
.btn-chapter-continue:hover{transform:translateY(-2px);box-shadow:0 0 30px rgba(52,211,153,0.35),0 6px 16px rgba(22,163,74,0.25)}
.btn-chapter-secondary{padding:10px 36px;font-size:14px;font-family:inherit;border-radius:8px;background:rgba(17,24,39,0.8);border:1px solid #374151;cursor:pointer;color:#9ca3af;display:none;transition:border-color var(--quarter-beat) ease,color var(--quarter-beat) ease}
.btn-chapter-secondary.show{display:block}
.btn-chapter-secondary:hover{border-color:#4b5563;color:#d1d5db}

/* Loss overlay - fullscreen solid background */
#loss-overlay{background:rgba(8,10,15,1);z-index:150;display:flex;opacity:0;visibility:hidden;pointer-events:none}
#loss-overlay.show{opacity:1;visibility:visible;pointer-events:auto}
#loss-overlay .loss-content{position:relative;z-index:2;transform:scale(0.9);opacity:0;visibility:hidden;transition:transform var(--beat) cubic-bezier(0.34,1.56,0.64,1),opacity var(--half-beat) ease-out,visibility 0s var(--half-beat)}
#loss-overlay.show .loss-content{transform:scale(1);opacity:1;visibility:visible;transition:transform var(--beat) cubic-bezier(0.34,1.56,0.64,1),opacity var(--half-beat) ease-out,visibility 0s 0s}

/* Skill points notification badge */
.skill-badge{position:absolute;top:-4px;right:-4px;width:10px;height:10px;background:#ef4444;border-radius:50%;border:2px solid #0f172a;animation:badgePulse 2s ease-in-out infinite}
@keyframes badgePulse{0%,100%{transform:scale(1);box-shadow:0 0 0 0 rgba(239,68,68,0.4)}50%{transform:scale(1.1);box-shadow:0 0 8px 2px rgba(239,68,68,0.3)}}

/* Splash Screen - Click to Enter */
#splash-screen{
  z-index:10000;
  background:transparent;
}
/* Black cover that fades out to reveal content */
#splash-screen::before{
  content:"";
  position:absolute;
  inset:0;
  background:#000;
  z-index:-1;
  animation:splashReveal calc(var(--beat) * 3) ease-out var(--half-beat) forwards;
}
@keyframes splashReveal{
  from{opacity:1}
  to{opacity:0}
}
/* Dissolving state for exit */
#splash-screen.dissolving{
  opacity:0;
  pointer-events:none;
  transition:opacity calc(var(--beat) * 2) ease-out;
}
#splash-screen.dissolving .splash-content{
  transform:scale(1.03);
  filter:blur(6px);
  transition:transform calc(var(--beat) * 2) ease-out, filter calc(var(--beat) * 2) ease-out;
}
/* Logo with pulsing glow */
#splash-screen .logo-img{
  filter:drop-shadow(0 0 20px rgba(251,191,36,0.4)) drop-shadow(0 0 40px rgba(251,191,36,0.2));
  animation:logoGlow 3s ease-in-out calc(var(--beat) * 4) infinite;
}
@keyframes logoGlow{
  0%,100%{filter:drop-shadow(0 0 20px rgba(251,191,36,0.4)) drop-shadow(0 0 40px rgba(251,191,36,0.2))}
  50%{filter:drop-shadow(0 0 30px rgba(251,191,36,0.6)) drop-shadow(0 0 60px rgba(251,191,36,0.3))}
}
/* Button appears after content settles */
@keyframes splashBtnAppear{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}

/* Main Menu crossfade transition */
#main-menu{
  transition:none;
}
#main-menu.crossfade{
  transition:opacity calc(var(--beat) * 2) ease-out;
}
#main-menu.fading-in{
  opacity:0;
}

.splash-content{
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:40px;
  opacity:0;
  animation:splashContentIn calc(var(--beat) * 3) ease-out var(--half-beat) forwards;
}
@keyframes splashContentIn{
  from{opacity:0;transform:scale(0.95)}
  to{opacity:1;transform:scale(1)}
}
.splash-btn{
  padding:12px 44px;
  font-size:16px;
  font-family:var(--font-sans);
  font-weight:600;
  letter-spacing:0.12em;
  text-transform:uppercase;
  background:linear-gradient(135deg,#1a2332,#0f1419);
  border:1px solid rgba(245,193,92,0.4);
  border-radius:8px;
  color:#f5c15c;
  cursor:pointer;
  box-shadow:0 0 20px rgba(245,193,92,0.15), 0 4px 16px rgba(0,0,0,0.4);
  transition:all var(--half-beat) ease;
  opacity:0;
  animation:splashBtnAppear var(--beat) ease-out calc(var(--beat) * 3) forwards;
}
.splash-btn:hover{
  background:linear-gradient(135deg,#243044,#1a2332);
  border-color:rgba(245,193,92,0.6);
  box-shadow:0 0 30px rgba(245,193,92,0.25), 0 6px 20px rgba(0,0,0,0.5);
  transform:translateY(-2px);
}
.splash-btn:active{
  transform:translateY(0);
  box-shadow:0 0 15px rgba(245,193,92,0.2), 0 2px 8px rgba(0,0,0,0.4);
}

/* Loading indicator on splash screen */
.splash-loading{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  opacity:1;
}
.loading-spinner{
  width:24px;
  height:24px;
  border:2px solid rgba(245,193,92,0.2);
  border-top-color:#f5c15c;
  border-radius:50%;
  animation:spin 0.8s linear infinite;
}
@keyframes spin{
  to{transform:rotate(360deg)}
}
.loading-text{
  font-size:12px;
  color:#9ca3af;
  letter-spacing:0.15em;
  text-transform:uppercase;
}

/* Main Menu Title - Glowing expanding effect */
.main-menu-title{
  font-family:var(--font-display);
  font-size:42px;
  font-weight:700;
  margin-bottom:16px;
  color:#fbbf24;
  text-transform:uppercase;
  letter-spacing:0.3em;
  text-shadow:
    0 0 10px rgba(251,191,36,0.6),
    0 0 20px rgba(251,191,36,0.4),
    0 0 40px rgba(251,191,36,0.3),
    0 0 60px rgba(244,208,63,0.2);
  animation:titleGlow 3s ease-in-out infinite, titleExpand 4s ease-in-out infinite;
}

@keyframes titleGlow{
  0%,100%{
    text-shadow:
      0 0 10px rgba(251,191,36,0.6),
      0 0 20px rgba(251,191,36,0.4),
      0 0 40px rgba(251,191,36,0.3),
      0 0 60px rgba(244,208,63,0.2);
    filter:brightness(1);
  }
  50%{
    text-shadow:
      0 0 15px rgba(251,191,36,0.8),
      0 0 30px rgba(251,191,36,0.6),
      0 0 50px rgba(251,191,36,0.4),
      0 0 80px rgba(244,208,63,0.3);
    filter:brightness(1.1);
  }
}

@keyframes titleExpand{
  0%,100%{letter-spacing:0.3em}
  50%{letter-spacing:0.4em}
}

/* Hide forge/battle when non-combat overlays are shown (menus, shop, hero select, splash) */
body:has(#splash-screen.show) #forge,body:has(#splash-screen.show) #battle-view,
body:has(#main-menu.show) #forge,body:has(#main-menu.show) #battle-view,
body:has(#hero-select-overlay.show) #forge,body:has(#hero-select-overlay.show) #battle-view,
body:has(#shop-overlay.show) #forge,body:has(#shop-overlay.show) #battle-view,
body:has(#pause-menu.show) #forge,body:has(#pause-menu.show) #battle-view,
body:has(#victory-overlay.show) #forge,body:has(#victory-overlay.show) #battle-view,
body:has(#achievements-overlay.show) #forge,body:has(#achievements-overlay.show) #battle-view{display:none!important}
/* Blue flame for shop - pre-baked soft gradient */
body:has(#shop-overlay.show) #flame-bg::after{background:radial-gradient(ellipse,hsl(200,90%,55%) 0%,hsl(203,87%,50%) 10%,hsl(206,82%,44%) 20%,hsl(208,75%,36%) 30%,hsl(210,62%,26%) 40%,hsl(212,45%,16%) 48%,rgba(0,0,0,0) 55%)}
body:has(#shop-overlay.show) #flame-bg::before{background:radial-gradient(ellipse,hsl(220,95%,60%) 0%,hsl(223,92%,54%) 10%,hsl(226,87%,47%) 20%,hsl(228,78%,38%) 30%,hsl(230,65%,28%) 40%,hsl(232,48%,18%) 48%,rgba(0,0,0,0) 55%)}

/* Rainbow iridescent flame for victory - pre-baked soft gradient, hue-rotate is cheap */
body:has(#victory-overlay.show) #flame-bg::after{background:radial-gradient(ellipse,hsl(320,80%,60%) 0%,hsl(310,75%,52%) 10%,hsl(300,68%,44%) 20%,hsl(290,58%,34%) 30%,hsl(280,45%,24%) 40%,hsl(275,32%,15%) 48%,rgba(0,0,0,0) 55%);animation:victoryFlameHue 4s ease-in-out infinite, victoryDriftOuter 18s ease-in-out infinite;transform:translate(-50%,-50%) scale(var(--flame-scale))}
body:has(#victory-overlay.show) #flame-bg::before{background:radial-gradient(ellipse,hsl(40,90%,60%) 0%,hsl(35,87%,54%) 10%,hsl(30,82%,46%) 20%,hsl(25,74%,37%) 30%,hsl(20,62%,27%) 40%,hsl(15,45%,17%) 48%,rgba(0,0,0,0) 55%);animation:victoryFlameHue2 4s ease-in-out infinite, victoryDriftCore 12s ease-in-out infinite;transform:translate(-50%,-50%) scale(var(--flame-scale))}
@keyframes victoryDriftCore{0%,100%{transform:translate(-50%,-50%) scale(var(--flame-scale))}50%{transform:translate(calc(-50% + 30px),calc(-50% - 20px)) scale(calc(var(--flame-scale) * 1.08))}}
@keyframes victoryDriftOuter{0%,100%{transform:translate(-50%,-50%) scale(var(--flame-scale))}50%{transform:translate(calc(-50% - 40px),calc(-50% + 25px)) scale(calc(var(--flame-scale) * 1.12))}}
@keyframes victoryFlameHue{0%,100%{filter:hue-rotate(0deg)}50%{filter:hue-rotate(60deg)}}
@keyframes victoryFlameHue2{0%,100%{filter:hue-rotate(0deg)}50%{filter:hue-rotate(-60deg)}}
#pause-menu{z-index:200}
.overlay.show{display:flex;opacity:1;pointer-events:auto;visibility:visible}
.modal{background:linear-gradient(135deg,rgba(18,22,32,0.9),rgba(10,14,22,0.92));border-radius:16px;padding:24px;border:1px solid var(--border-soft);min-width:400px;max-width:90vw;box-shadow:0 0 0 1px rgba(0,0,0,0.75),0 18px 36px rgba(0,0,0,0.55);position:relative;overflow:visible;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}
.modal::before{content:"";position:absolute;inset:0;border-radius:inherit;border:1px solid rgba(245,193,92,0.25);pointer-events:none;mask:radial-gradient(20px 20px at 0 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 0 100%,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 100%,#000 95%,transparent 100%);opacity:.5}
.modal::after{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--section-color,#f4d03f),transparent);opacity:0.7;pointer-events:none;border-radius:inherit}

/* Accent colors per overlay */
#shop-overlay .modal{--section-color:#4d99ff}
#main-menu .modal{--section-color:#ff6633}
#hero-select-overlay{z-index:200}
#talent-overlay .modal{--section-color:#9966cc}
#crate-reel-overlay{z-index:104}
#crate-reel-overlay .modal{--section-color:#4d99ff;transform:scale(0.85);opacity:0;transition:transform var(--beat) cubic-bezier(0.34,1.56,0.64,1),opacity var(--half-beat) ease-out}
#crate-reel-overlay.show .modal{transform:scale(1);opacity:1}
#crate-reel-overlay.closing .modal{transform:scale(0.85);opacity:0}
#skill-tree-overlay .modal{--section-color:var(--hero-accent, #f5c15c)}
/* Combat popup - dark translucent with warm tint */
#combat-overlay .modal{
  background:
    radial-gradient(circle at top, rgba(248,214,120,0.06), transparent 60%),
    rgba(15,17,25,0.96);
  border:1px solid rgba(248,214,120,0.35);
  backdrop-filter:blur(4px);
  -webkit-backdrop-filter:blur(4px);
  box-shadow:0 20px 50px rgba(0,0,0,0.75);
  transform:scale(0.88);
  opacity:0;
  transition:transform .5s cubic-bezier(0.22,1,0.36,1),opacity .4s ease-out;
}
#combat-overlay.show .modal{transform:scale(1);opacity:1}

/* Combat choreography - staggered element reveal */
#combat-container,#combat-dmg,#combat-bars{opacity:0;transform:translateY(10px);transition:opacity var(--half-beat) ease,transform var(--half-beat) ease}
#combat-overlay.combat-reveal #combat-container{opacity:1;transform:translateY(0);transition-delay:var(--quarter-beat)}
#combat-overlay.combat-reveal #combat-dmg{opacity:1;transform:translateY(0);transition-delay:var(--half-beat)}
#combat-overlay.combat-reveal #combat-bars{opacity:1;transform:translateY(0);transition-delay:var(--half-beat)}
#combat-overlay.combat-exit .modal{
  transform:scale(0.97);
  opacity:0;
  transition:transform var(--half-beat) ease,opacity var(--half-beat) ease;
}
#combat-overlay.combat-exit #combat-result,
#combat-overlay.combat-exit #combat-continue{
  opacity:0;
  transform:translateY(6px);
  transition:opacity var(--half-beat) ease,transform var(--half-beat) ease;
}
#combat-overlay.combat-result #combat-bars{
  display:none;
}
.modal-title{text-align:center;font-size:18px;margin-bottom:16px;letter-spacing:0.15em}
.modal-title.gold{text-shadow:0 2px 8px rgba(0,0,0,0.9),0 4px 16px rgba(0,0,0,0.7)}

/* Stats & Achievements Modal */
.stats-modal{min-width:600px;max-width:800px;width:90vw;max-height:85vh;overflow:hidden}
.stats-modal .modal-title{position:sticky;top:0;background:inherit;z-index:2;padding-bottom:8px;margin-bottom:12px}
.stats-modal .stats-grid{max-height:65vh;overflow-y:auto;padding-right:6px}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.stats-section{background:linear-gradient(135deg,rgba(255,255,255,0.03),rgba(0,0,0,0.3));border:1px solid var(--border-soft);border-radius:12px;padding:16px;position:relative;overflow:hidden}
.stats-section::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--section-color,#f4d03f),transparent);opacity:0.6}
.stats-section-title{font-size:11px;text-transform:uppercase;letter-spacing:0.15em;color:var(--section-color,#f4d03f);margin-bottom:12px;font-weight:600}
.stat-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.stat-row:last-child{border-bottom:none}
.stat-label{color:#9ca3af;font-size:12px}
.stat-value{color:#e5e7eb;font-size:14px;font-weight:600}
.stat-value.gold{color:#fbbf24}
.stat-value.highlight{color:#4ade80}

/* Achievement Cards */
.achievement-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
.achievement-card{background:linear-gradient(135deg,rgba(0,0,0,0.3),rgba(0,0,0,0.5));border:1px solid var(--border-soft);border-radius:8px;padding:10px 12px;display:flex;align-items:center;gap:10px;transition:all var(--half-beat)}
.achievement-card.unlocked{background:linear-gradient(135deg,rgba(74,222,128,0.08),rgba(0,0,0,0.3));border-color:rgba(74,222,128,0.25)}
.achievement-card.locked{opacity:0.5}
.achievement-icon{width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:16px;background:linear-gradient(135deg,rgba(255,255,255,0.05),rgba(0,0,0,0.2));border:1px solid var(--border-soft)}
.achievement-card.unlocked .achievement-icon{background:linear-gradient(135deg,rgba(74,222,128,0.2),rgba(74,222,128,0.05));border-color:rgba(74,222,128,0.3)}
.achievement-info{flex:1;min-width:0}
.achievement-name{font-size:11px;font-weight:600;color:#e5e7eb;margin-bottom:2px}
.achievement-desc{font-size:9px;color:#6b7280}
.achievement-card.unlocked .achievement-name{color:#4ade80}
.achievement-progress{font-size:9px;color:#6b7280;margin-top:2px}

/* Hero Clear Badges */
.hero-clears{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.hero-clear-badge{padding:4px 10px;border-radius:4px;font-size:10px;font-weight:600;background:linear-gradient(135deg,rgba(74,222,128,0.15),rgba(74,222,128,0.05));border:1px solid rgba(74,222,128,0.3);color:#4ade80}
.hero-clear-badge.locked{background:linear-gradient(135deg,rgba(255,255,255,0.03),rgba(0,0,0,0.2));border-color:var(--border-soft);color:#4b5563}

/* Best Weapon Display */
.best-weapon-display{margin-top:8px;padding:10px;background:linear-gradient(135deg,rgba(244,208,63,0.08),rgba(0,0,0,0.3));border:1px solid rgba(244,208,63,0.2);border-radius:8px;text-align:center}
.best-weapon-name{font-size:13px;font-weight:600;color:#fbbf24;margin-bottom:4px;word-break:break-word}
.best-weapon-damage{font-size:20px;font-weight:bold;color:#f4d03f}

/* Danger Button */
.btn-danger{background:linear-gradient(135deg,rgba(239,68,68,0.2),rgba(127,29,29,0.3))!important;border-color:rgba(239,68,68,0.4)!important;color:#fca5a5!important}
.btn-danger:hover{background:linear-gradient(135deg,rgba(239,68,68,0.3),rgba(127,29,29,0.4))!important;border-color:rgba(239,68,68,0.6)!important}

@media(max-width:700px){
  .stats-modal{min-width:unset;max-height:80vh}
  .stats-grid{grid-template-columns:1fr}
  .achievement-grid{grid-template-columns:1fr}
}
#combat-container{position:relative;overflow:visible!important}
#combat-flames{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;opacity:0;transition:opacity var(--half-beat)}
#combat-weapon-container{position:relative;width:140px;height:180px;margin:0 auto 16px;z-index:1;overflow:visible!important}
#combat-weapon-aura{position:absolute;top:50%;left:50%;width:400px;height:400px;transform:translate(-50%, -50%);z-index:-1;border-radius:50%;opacity:0.6;pointer-events:none;transition:background var(--beat) ease}
#combat-weapon-container .weapon-canvas{width:100%;height:100%;}
#combat-words{display:flex;justify-content:center;align-items:center;gap:8px;min-height:60px;margin-bottom:16px;flex-wrap:wrap}
.combat-word{display:flex;flex-direction:column;align-items:center;padding:8px 14px;border-radius:8px;background:#1a1d24;font-size:15px;opacity:0;transform:scale(1.8);transition:none}
.combat-word.show{opacity:1;transform:scale(1);animation:wordSlam 0.35s cubic-bezier(0.34,1.56,0.64,1)}
.combat-word.impact{animation:wordImpact .4s ease-out}

@keyframes wordSlam{
  0%{opacity:0;transform:scale(1.8);filter:blur(4px) brightness(1.5)}
  20%{opacity:1;transform:scale(1.1) translate(-2px,0);filter:blur(0) brightness(1.3)}
  40%{transform:scale(0.95) translate(2px,-1px);filter:brightness(1.2)}
  60%{transform:scale(1.02) translate(-1px,1px);filter:brightness(1.1)}
  80%{transform:scale(0.98) translate(1px,0);filter:brightness(1.05)}
  100%{transform:scale(1) translate(0,0);filter:brightness(1)}
}
.combat-word.retrigger{background:linear-gradient(135deg,#ff663320,#ff330020);border:1px solid #ff663366;box-shadow:0 0 12px #ff663344}
.combat-word-name{font-weight:bold}
.combat-word-retrigger{font-size:10px;color:#ff6633;margin-top:2px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.combat-word-value{font-size:20px;font-weight:bold;margin-top:4px}

/* Combat Intro Dialogue */
#combat-intro-dialogue{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.85);
  z-index:1000;
  cursor:pointer;
}
.intro-dialogue-box{
  max-width:500px;
  padding:30px 40px;
  background:linear-gradient(135deg,#1a1d24,#0c0f15);
  border:2px solid #374151;
  border-radius:16px;
  text-align:center;
  box-shadow:0 0 60px rgba(0,0,0,0.8),0 0 30px rgba(244,208,63,0.1);
  animation:dialogueFadeIn 0.4s ease-out;
}
@keyframes dialogueFadeIn{from{opacity:0;transform:scale(0.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.intro-dialogue-portrait{
  width:100px;
  height:100px;
  margin:0 auto 16px;
  border-radius:50%;
  overflow:hidden;
}
.intro-dialogue-portrait svg{width:100%;height:100%;display:block}
.intro-dialogue-portrait.speaking{animation:portraitWiggle 0.15s ease-in-out infinite}
@keyframes portraitWiggle{
  0%,100%{transform:rotate(-2deg) scale(1.02)}
  50%{transform:rotate(2deg) scale(1.02)}
}
.intro-dialogue-speaker{
  font-size:14px;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:2px;
  margin-bottom:12px;
  opacity:0.7;
}
.intro-dialogue-speaker.hero{color:#4ade80}
.intro-dialogue-speaker.enemy{color:#f87171}
.intro-dialogue-text{
  font-size:22px;
  font-style:italic;
  line-height:1.5;
  color:#e5e7eb;
  min-height:60px;
  letter-spacing:0.03em;
}
.intro-dialogue-skip{
  margin-top:20px;
  font-size:11px;
  color:#6b7280;
  opacity:0.6;
}

@keyframes wordImpact{0%{transform:scale(1)}20%{transform:scale(1.4)}40%{transform:scale(0.9)}60%{transform:scale(1.1)}100%{transform:scale(1)}}
@keyframes weaponShake{0%,100%{transform:rotate(15deg)}25%{transform:rotate(10deg) scale(1.1)}75%{transform:rotate(20deg) scale(1.1)}}
@keyframes screenShake{0%,100%{transform:translate(0)}25%{transform:translate(-4px,2px)}50%{transform:translate(4px,-2px)}75%{transform:translate(-2px,4px)}}
.shake{animation:screenShake .15s ease-out}
@keyframes auraFlight{0%{opacity:1;transform:translate(0,0) scale(1)}100%{opacity:0;transform:translate(var(--dx),var(--dy)) scale(0.3)}}
.aura-particle{position:absolute;width:20px;height:20px;border-radius:50%;pointer-events:none;z-index:1000;animation:auraFlight 0.8s ease-out forwards;will-change:transform,opacity}
#combat-total{text-align:center;font-size:48px;font-weight:bold;margin:16px 0;opacity:0;transform:scale(0.5)}
#combat-total.show{opacity:1;transform:scale(1);transition:all var(--beat) cubic-bezier(0.175,0.885,0.32,1.275)}
#combat-dmg{display:flex;justify-content:center;gap:30px;margin-bottom:10px}
.combat-block{text-align:center}
.combat-label{font-size:10px;color:#6b7280}
.combat-value{font-size:32px;font-weight:bold}
#combat-bars{display:flex;gap:16px;margin-bottom:14px}
.bar-block{flex:1}
.bar-label{text-align:center;font-size:10px;color:#6b7280;margin-bottom:3px}
.bar-outer{height:18px;background:#1a1d24;border-radius:4px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.25);outline:1px solid rgba(0,0,0,0.6);box-shadow:inset 0 0 0 1px rgba(0,0,0,0.6)}
.bar-inner{position:absolute;left:0;top:0;z-index:1;height:100%;transition:width var(--quarter-beat) ease-out,background var(--half-beat) ease-out}
.bar-inner.hero{background:linear-gradient(90deg,#22c55e,#4ade80)}
.bar-inner.enemy{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
/* Combat HP color stages */
.bar-inner.enemy.hp-high{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
.bar-inner.enemy.hp-mid{background:linear-gradient(90deg,#ea580c,#f97316)}
.bar-inner.enemy.hp-low{background:linear-gradient(90deg,#dc2626,#ef4444)}
.bar-inner.enemy.hp-critical{background:linear-gradient(90deg,#991b1b,#dc2626);animation:criticalPulse 0.4s ease-in-out infinite}
.bar-outer.shake{animation:hpShake 0.3s ease-out}
/* Combat preview bar - overlays damage during tally (bright orange for visibility) */
.bar-preview{position:absolute;right:0;top:0;z-index:2;height:100%;background:linear-gradient(90deg,#f97316,#fb923c);opacity:0.95;width:0;transition:width var(--quarter-beat) ease-out;box-shadow:0 0 8px rgba(251,146,60,0.6)}
.bar-preview.active{box-shadow:0 0 12px rgba(251,146,60,0.8), inset 0 0 4px rgba(255,255,255,0.3)}
/* Health bar shatter effect */
.health-shard{position:fixed;background:var(--shard-color,linear-gradient(90deg,#f59e0b,#fbbf24));border-radius:2px;pointer-events:none;z-index:10001}
@keyframes shardFall{0%{opacity:1;transform:translateY(0) rotate(0deg)}100%{opacity:0;transform:translateY(80px) rotate(var(--shard-rot,45deg))}}
.bar-text{text-align:center;font-size:11px;margin-top:3px}
#combat-result{text-align:center;padding:14px;border-radius:12px;margin-bottom:12px;display:none;border:1px solid rgba(255,255,255,0.08);outline:1px solid rgba(0,0,0,0.7);position:relative;overflow:visible}
#combat-result::before{content:"";position:absolute;inset:0;border-radius:inherit;border:1px solid rgba(245,193,92,0.2);pointer-events:none;mask:radial-gradient(20px 20px at 0 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 0,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 0 100%,#000 95%,transparent 100%) subtract,radial-gradient(20px 20px at 100% 100%,#000 95%,transparent 100%);opacity:.6}
#combat-result.win{background:linear-gradient(180deg,#22543d 0%,#166534 50%,#22543d 100%);border-color:#4ade8055}
#combat-result.lose{background:linear-gradient(180deg,#7f1d1d 0%,#991b1b 50%,#7f1d1d 100%);border-color:#f8717155}
#combat-result-title{font-size:22px;margin-bottom:3px;font-weight:bold;text-shadow:0 2px 4px rgba(0,0,0,0.9)}
#combat-result.win #combat-result-title{color:#6ee7a0;text-shadow:0 2px 4px rgba(0,0,0,0.9),0 0 8px rgba(74,222,128,0.3)}
#combat-result.lose #combat-result-title{color:#fca5a5;text-shadow:0 2px 4px rgba(0,0,0,0.9),0 0 8px rgba(248,113,113,0.3)}
#combat-result-detail{font-size:12px;color:#9ca3af}
.result-detail-line{margin:4px 0}
.result-detail-line.gold-reward{font-size:14px;font-weight:bold}
.result-detail-line.gold-reward .gold{color:#fbbf24;text-shadow:0 1px 4px rgba(251,191,36,0.4)}
.result-detail-line.boss-loot-label{color:#ffffff;font-weight:500;margin-top:8px}
.result-detail-line.dim{color:#6b7280;font-size:11px}
.result-loot-chips{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:12px 0 6px;padding-top:8px}
.result-loot-chips .chip{font-size:10px;padding:4px 8px;pointer-events:auto;opacity:1;position:relative}
.result-loot-chips .chip.disabled{opacity:1;filter:none}
.result-loot-chips .chip:hover{z-index:100004}
.result-loot-chips .chip .tooltip{z-index:100005!important}
.has-tooltip{position:relative;z-index:1}
.has-tooltip:hover{cursor:pointer}
.tooltip.modal-tooltip{bottom:100%;top:auto;margin-bottom:8px;margin-top:0}
.shop-modal{width:90vw;max-width:1180px;min-width:600px;padding:14px 20px}
.shop-content{display:flex;flex-direction:column;gap:8px;max-width:1140px;margin:0 auto;width:100%}
.shop-row{display:grid;gap:8px;width:100%}
.shop-row-top{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.shop-row-middle{grid-template-columns:200px 1fr 180px;align-items:stretch;gap:12px}
.shop-talent-btn{font-size:10px;padding:4px 10px;background:linear-gradient(135deg,#7c3aed,#5b21b6);border:1px solid #a78bfa;border-radius:4px;color:#fff;cursor:pointer}
.shop-talent-btn:hover{background:linear-gradient(135deg,#8b5cf6,#6d28d9)}
.shop-column-tools{max-height:100%}
.shop-column-tools .shop-section{justify-content:flex-start;height:100%}
.shop-column-tools .consumable-row{display:flex;flex-direction:column;gap:6px;padding:6px;background:linear-gradient(180deg,rgba(15,19,27,0.6),rgba(10,13,23,0.6));border-radius:6px;min-height:60px}
.shop-row-actions{grid-template-columns:1fr;margin-top:12px}
.shop-card{padding:10px;border-radius:10px}
.shop-section{padding:10px;border-radius:10px;overflow:visible;border:1px solid rgba(55,65,81,0.5)}
.shop-section-title{margin-bottom:6px;text-align:left}
.shop-section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;gap:6px}
.shop-consumable-cap{font-size:10px}
.shop-sort-btns{display:flex;gap:3px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
.shop-sort-btns button{padding:3px 8px;font-size:9px}
.shop-info-block{font-size:10px;color:#d1d5db;line-height:1.3}
.shop-column{display:flex;flex-direction:column;gap:6px}
.shop-column>.shop-section{flex:1;display:flex;flex-direction:column}
.shop-column-inventory .shop-section{min-height:200px}
.shop-column-inventory .shop-word-bank{flex:1}
.shop-column-actions{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px;padding:0}
.shop-action-btn{font-size:11px;padding:8px 20px;background:#1f2937;border:1px solid #374151;border-radius:6px;color:#9ca3af;cursor:pointer;transition:all var(--quarter-beat);min-width:100px;text-align:center}
.shop-action-btn:hover:not(:disabled){background:#374151;color:#e5e7eb}
.shop-action-btn:disabled{opacity:0.4;cursor:not-allowed}
#sell-word-btn:not(:disabled){background:linear-gradient(135deg,#854d0e,#713f12);border-color:#ca8a04;color:#fef08a;box-shadow:0 0 8px rgba(202,138,4,0.3)}
#reroll-btn.highlight:not(:disabled){background:linear-gradient(135deg,#854d0e,#713f12);border-color:#ca8a04;color:#fef08a;box-shadow:0 0 8px rgba(202,138,4,0.3)}
.shop-word-bank{display:grid;grid-template-columns:repeat(6,1fr);gap:5px;padding:8px;background:linear-gradient(180deg,rgba(15,19,27,0.6),rgba(10,13,23,0.6));border-radius:6px;min-height:140px;align-content:start}
.shop-word-bank .chip{font-size:9px;padding:4px 3px;min-width:0;width:100%;text-align:center;white-space:nowrap}
.shop-word-bank .chip .chip-name{overflow:hidden;text-overflow:ellipsis}
.shop-actions{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;padding:8px;border-radius:10px}
.hidden-section{display:none}
.modal-topbar{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;margin-bottom:12px}
.shop-top-left,.shop-top-right{display:flex;align-items:center;gap:8px;justify-content:flex-start}
.shop-top-right{justify-content:flex-end}
.shop-pill{padding:4px 8px;border-radius:999px;background:linear-gradient(135deg,#111827,#0b1220);border:1px solid #2f3542;font-size:11px;box-shadow:0 3px 10px #0007,inset 0 0 0 1px #1f2937}
.topbar-btn{padding:6px 12px;font-size:12px}
#shop-items{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.shop-item{background:#1a1d24;border-radius:8px;padding:10px 8px;text-align:center;width:100%;overflow:visible;font-size:10px;line-height:1.3;position:relative}
.shop-item.crate-clickable{transition:transform var(--quarter-beat) ease,box-shadow var(--quarter-beat) ease,border-color var(--quarter-beat) ease;border:1px solid rgba(255,255,255,0.1);overflow:hidden}
.shop-item.crate-clickable:hover:not(.crate-disabled){transform:translateY(-2px) scale(1.02);box-shadow:0 8px 24px rgba(0,0,0,0.4),0 0 0 1px rgba(255,215,0,0.3);border-color:rgba(255,215,0,0.4)}
.shop-item.crate-clickable:active:not(.crate-disabled){transform:translateY(0) scale(0.98)}
.shop-item.crate-disabled{opacity:0.5;cursor:not-allowed}
/* Crate iridescent effects + animated accent bar */
.shop-item.crate-clickable::before{content:'';position:absolute;top:-100%;left:-100%;width:300%;height:300%;pointer-events:none;opacity:0.8;z-index:0}
.shop-item.crate-clickable>*{position:relative;z-index:1}
.shop-item.crate-earth-sky::before{background:conic-gradient(from 45deg,transparent,rgba(249,115,22,0.25),rgba(59,130,246,0.25),rgba(166,124,82,0.25),rgba(250,204,21,0.25),transparent)}
.shop-item.crate-body-soul::before{background:conic-gradient(from 45deg,transparent,rgba(160,160,160,0.22),rgba(168,85,247,0.25),rgba(254,240,138,0.20),rgba(107,33,168,0.28),transparent)}
.shop-price{font-size:9px;margin:3px 0}
.shop-grid{display:flex;flex-direction:column;gap:8px;padding:6px;flex:1}
.shop-consumable-stack{display:flex;flex-direction:column;gap:6px}
.shop-consumables-card{position:relative;z-index:1}
.shop-consumables-card:hover{z-index:100}
.shop-section:has(#shop-word-bank){position:relative;z-index:1}
.shop-consumables-card .consumable-row{background:linear-gradient(180deg,#0f131b,#0a0d17)}
/* Ensure tooltips are always on top of everything - elevate entire column when hovering chips */
.shop-column-inventory:has(.chip:hover){z-index:1000}
.shop-word-bank .chip:hover,.shop-consumables-card:hover{z-index:100000}
.shop-word-bank .chip .tooltip,.shop-consumables-card .tooltip{z-index:100005!important}
.shop-word-bank .chip:hover{z-index:100004!important}
.consumable-item:hover .tooltip{opacity:1;transform:translateX(-50%) scale(1)}
.consumable-item:hover{z-index:100000}
.shop-subtitle{font-size:9px;color:#6b7280;text-align:left;margin:10px 0 4px;text-transform:uppercase;letter-spacing:0.05em}
.shop-column-tools .consumable-row .chip{font-size:9px;padding:4px 3px;min-width:0;width:100%;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.shop-btn{padding:5px 14px;font-size:11px}
.modal-buttons{display:flex;justify-content:center;gap:10px;margin-top:14px}
#combat-breakdown-row{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:6px;position:relative}
.breakdown-pill{padding:8px 14px;font-size:12px;border-radius:999px;background:rgba(20,26,40,0.75);border:1px solid rgba(255,255,255,0.15);box-shadow:0 0 0 1px rgba(0,0,0,0.8),0 12px 24px rgba(0,0,0,0.55);cursor:pointer;position:relative;overflow:visible;transition:background var(--quarter-beat),border-color var(--quarter-beat)}
.breakdown-pill:hover{background:rgba(30,40,60,0.85);border-color:rgba(255,255,255,0.25)}
.breakdown-pill.active{background:rgba(99,102,241,0.3);border-color:rgba(99,102,241,0.6)}
.breakdown-pill::before{content:none}
/* Combat breakdown tooltip needs position:fixed to escape modal stacking context */
#combat-breakdown-tooltip{min-width:320px;width:min(560px,92vw);max-width:min(560px,92vw);max-height:82vh;overflow:auto;position:fixed !important;left:50% !important;top:50% !important;transform:translate(-50%, -50%) scale(0.98) !important;transform-origin:center center;z-index:100002 !important;bottom:auto !important;padding:12px 16px;will-change:transform;box-sizing:border-box;pointer-events:none;opacity:0;transition:opacity var(--quarter-beat) ease,transform var(--quarter-beat) ease}
#combat-breakdown-tooltip.show{opacity:1;transform:translate(-50%, -50%) scale(1) !important;pointer-events:auto}
#inv-list{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;max-height:350px;overflow-y:auto;padding:8px}
.flame-particle{position:absolute;width:20px;height:20px;background:radial-gradient(circle,#ff6600,#ff3300,transparent);border-radius:50%;pointer-events:none;animation:flameRise 1s ease-out forwards;will-change:transform,opacity}
@keyframes flameRise{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-100px) scale(0)}}

/* Talent tags displayed near the hero portrait */
.hero-talents{margin-top:4px;display:flex;justify-content:center;flex-wrap:wrap;gap:4px;font-size:10px}
.tag.talent{color:#a855f7;border-color:#a855f755}

/* Dialogue lines beneath the portraits */
.portrait-dialogue{
  font-size:11px;
  color:#9ca3af;
  margin-top:4px;
  font-style:italic;
  text-align:center;
}

/* Consumables bar styling - OLD (hidden) */
#consumables-bar{display:none}

/* Inline consumables in bank-controls */
#consumables-inline{display:flex;gap:6px;align-items:center;position:relative;z-index:1}
#consumables-inline:has(.consumable-pill:hover){z-index:100001}
.consumable-pill{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;font-size:10px;background:linear-gradient(135deg,#1f1d1a,#2a2620);border:1px solid #fbbf2455;border-radius:6px;color:#fbbf24;cursor:pointer;transition:all var(--quarter-beat);position:relative;white-space:nowrap}
.consumable-pill:hover{background:#374151;transform:translateY(-1px)}
.consumable-pill.has-tooltip:hover .tooltip{opacity:1;transform:translateX(-50%) scale(1)}
.consumable-pill .tooltip{z-index:100000}
.consumable-pill.empty{color:#6b7280;border-color:#6b728055;border-style:dashed;cursor:default;padding:4px 8px}
.consumable-pill.empty:hover{background:transparent;transform:none}
.at-limit{color:#f87171}

/* Responsive layout adjustments */
@media (max-width:768px){
  #battle-view{flex-direction:column;gap:20px}
  .portrait-container{flex:1 1 auto;width:100%}
  #vs-center{width:100%;margin-bottom:20px}
  #forge{width:100%;max-width:100%;padding:10px}
  /* #bank uses auto-fill, no fixed columns needed */
}
@media (max-width:640px){
  .modal-topbar{grid-template-columns:1fr;justify-items:center;text-align:center}
  .shop-top-left,.shop-top-right{justify-content:center}
  .shop-section-header{flex-direction:column;align-items:flex-start}
  .shop-sell-buttons{flex-direction:column;width:100%}
  .shop-pill{width:100%;text-align:center}
  .shop-actions{align-items:flex-start}
  .shop-reroll{width:100%;justify-content:space-between}
  .shop-modal{min-width:0}
}
@media (max-width:900px){
  .shop-row-middle{grid-template-columns:1fr}
}

/* Card Flip System for Talent Selection */
#talent-choices{
  display:flex;
  flex-direction:column;
  gap:20px;
  justify-content:center;
  align-items:center;
  padding:20px 0;
}

.talent-cards-row{
  display:flex;
  flex-direction:row;
  gap:12px;
  justify-content:center;
  align-items:center;
  perspective:1200px;
  flex-wrap:wrap;
}

.talent-card{
  width:150px;
  height:280px;
  position:relative;
  transform-style:preserve-3d;
  transition:transform var(--half-beat) ease;
  cursor:not-allowed;
}

.talent-card.flipped{
  cursor:pointer;
}

.talent-card:not(.flipped):hover{
  transform:translateY(-5px);
}

.talent-card.flipped .talent-card-inner{
  transform:rotateY(180deg);
}

.talent-card-inner{
  position:relative;
  width:100%;
  height:100%;
  transform-style:preserve-3d;
  transition:transform calc(var(--beat) * 2) cubic-bezier(0.4, 0.2, 0.2, 1);
}

.talent-card-face{
  position:absolute;
  width:100%;
  height:100%;
  backface-visibility:hidden;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 8px 20px rgba(0,0,0,0.4);
}

.talent-card-front{
  background:linear-gradient(135deg,#1a1f2e 0%,#0f1419 100%);
  border:2px solid #3a4556;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}

.talent-card-front-content{
  text-align:center;
  padding:20px;
}

.talent-card-front-symbol{
  font-size:60px;
  margin-bottom:12px;
  opacity:0.8;
}

.talent-card-front-text{
  font-size:16px;
  color:#8b92a0;
  font-weight:600;
  letter-spacing:2px;
}

.talent-card-back{
  background:linear-gradient(135deg,#1e2836 0%,#151921 100%);
  transform:rotateY(180deg);
  border:2px solid;
  padding:12px;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  position:relative;
  overflow:hidden;
}

.talent-card-back::before{
  content:'';
  position:absolute;
  top:-50%;
  left:-50%;
  width:200%;
  height:200%;
  background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);
  opacity:0;
  transition:opacity var(--half-beat);
}

.talent-card:hover .talent-card-back::before{
  opacity:1;
}

.talent-card-icon{
  width:60px;
  height:78px;
  margin:0 auto 8px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.talent-card-icon svg{
  width:100%;
  height:100%;
}

.talent-card-header{
  margin-bottom:12px;
}

.talent-card-name{
  font-size:13px;
  font-weight:bold;
  margin-bottom:6px;
  line-height:1.2;
}

.talent-card-rarity-badge{
  font-size:9px;
  padding:2px 6px;
  border-radius:4px;
  display:inline-block;
  font-weight:600;
  letter-spacing:0.5px;
}

.talent-card-desc{
  font-size:11px;
  line-height:1.4;
  color:#d1d5db;
  flex-grow:1;
}

.talent-card-flavor{
  font-size:9px;
  line-height:1.3;
  color:#9ca3af;
  margin-top:6px;
  padding-top:6px;
  border-top:1px solid rgba(255,255,255,0.1);
  font-style:italic;
  letter-spacing:0.03em;
}

/* Tier-specific styling (T1=grey, T2=blue, T3=gold) */
.talent-card-back.tier-1{
  border-color:#9ca3af;
  box-shadow:0 8px 20px rgba(156,163,175,0.2);
}

.talent-card-back.tier-1 .talent-card-name{
  color:#9ca3af;
}

.talent-card-back.tier-1 .talent-card-rarity-badge{
  background:#9ca3af;
  color:#000;
}

.talent-card-back.tier-2{
  border-color:#4d99ff;
  box-shadow:0 8px 20px rgba(77,153,255,0.2);
}

.talent-card-back.tier-2 .talent-card-name{
  color:#4d99ff;
}

.talent-card-back.tier-2 .talent-card-rarity-badge{
  background:#4d99ff;
  color:#000;
}

.talent-card-back.tier-3{
  border-color:#f4d03f;
  box-shadow:0 8px 20px rgba(244,208,63,0.3);
}

.talent-card-back.tier-3 .talent-card-name{
  color:#f4d03f;
}

.talent-card-back.tier-3 .talent-card-rarity-badge{
  background:#f4d03f;
  color:#000;
}

/* Card flip animation */
@keyframes cardFlipIn{
  0%{
    transform:rotateY(0deg) scale(0.8);
    opacity:0;
  }
  100%{
    transform:rotateY(0deg) scale(1);
    opacity:1;
  }
}

.talent-card.animating-in{
  animation:cardFlipIn 0.6s ease-out forwards;
}

/* Selection animation - spin and fade */
@keyframes talentSpinFade{
  0%{transform:scale(1) rotateY(0deg);opacity:1}
  100%{transform:scale(0.8) rotateY(360deg);opacity:0}
}

.talent-card.selecting{
  animation:talentSpinFade 0.6s ease-out forwards;
}

.talent-card.selected .talent-card-back{
  border-width:3px;
  box-shadow:0 0 30px currentColor;
}

/* Sparkle effect on selection */
@keyframes sparkle{
  0%{
    transform:scale(0) rotate(0deg);
    opacity:1;
  }
  100%{
    transform:scale(2) rotate(180deg);
    opacity:0;
  }
}

.talent-card-sparkle{
  position:absolute;
  width:20px;
  height:20px;
  pointer-events:none;
  animation:sparkle 0.8s ease-out forwards;
}

.talent-card-sparkle::before,
.talent-card-sparkle::after{
  content:'';
  position:absolute;
  font-size:20px;
  color:currentColor;
}

/* Talent Reroll Button */
.talent-reroll-container{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:20px;
  width:100%;
}

.talent-pick-counter{
  color:#fbbf24;
  text-align:center;
  font-weight:bold;
}

.talent-reroll-btn{
  background:linear-gradient(135deg,#1e293b,#334155);
  border:2px solid #4a5568;
  border-radius:8px;
  color:#e2e8f0;
  font-family:var(--font-sans);
  font-size:16px;
  padding:10px 24px;
  cursor:pointer;
  transition:all var(--half-beat) ease;
  display:flex;
  align-items:center;
  gap:8px;
}

.talent-reroll-btn:hover:not(:disabled){
  background:linear-gradient(135deg,#334155,#475569);
  border-color:#60a5fa;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(96,165,250,0.3);
}

.talent-reroll-btn:active:not(:disabled){
  transform:translateY(0);
}

.talent-reroll-btn:disabled,
.talent-reroll-btn.used{
  background:linear-gradient(135deg,#1a1f2e,#252d3d);
  border-color:#374151;
  color:#6b7280;
  cursor:not-allowed;
  opacity:0.7;
}

.talent-reroll-btn .reroll-icon{
  font-size:18px;
}

.talent-skip-btn{
  background:linear-gradient(135deg,#2d1f1a,#3d2a20);
  border:2px solid #6b5344;
  border-radius:8px;
  color:#d4a574;
  font-family:var(--font-sans);
  font-size:16px;
  padding:10px 24px;
  cursor:pointer;
  transition:all var(--half-beat) ease;
}

.talent-skip-btn:hover{
  background:linear-gradient(135deg,#3d2a20,#4d3a30);
  border-color:#d4a574;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(212,165,116,0.25);
}

.talent-skip-btn:active{
  transform:translateY(0);
}

/* Upgrade button styling - lowkey to match forge/exit shop */
.talent-upgrade-btn{
  background:linear-gradient(135deg,#22543d,#1a3328) !important;
  border:1px solid #4ade8055 !important;
  color:#ecfdf3 !important;
  font-weight:500;
  box-shadow:0 0 6px rgba(52,211,153,0.2),0 4px 12px rgba(22,163,74,0.15);
}

.talent-upgrade-btn:hover{
  background:linear-gradient(135deg,#2d6b4f,#22543d) !important;
  border-color:#4ade8088 !important;
  color:#ecfdf3 !important;
  box-shadow:0 0 8px rgba(52,211,153,0.3),0 6px 14px rgba(22,163,74,0.25);
  transform:translateY(-2px);
}

/* Back button in upgrade modal */
.talent-upgrade-back-btn{
  background:linear-gradient(135deg,#374151,#1f2937);
  border:1px solid #4b5563;
  color:#9ca3af;
  padding:8px 16px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
  margin-top:12px;
  transition:all var(--half-beat) ease;
}

.talent-upgrade-back-btn:hover{
  background:linear-gradient(135deg,#4b5563,#374151);
  border-color:#6b7280;
  color:#d1d5db;
}

/* Upgrade header text */
.upgrade-header-text{
  color:#88eebb;
  font-size:1.2em;
  text-shadow:0 0 10px rgba(68,187,119,0.5);
}

/* Talent shuffle row */
.talent-shuffle-row{
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
}

.talent-shuffle-card{
  transform:scale(0.75);
  transition:all var(--half-beat) ease;
}

/* Shuffling animation - cards wobble randomly */
.talent-shuffle-card.shuffling{
  animation:shuffle-wobble 0.15s ease-in-out infinite;
}

@keyframes shuffle-wobble{
  0%{ transform:scale(0.75) rotate(-3deg) translateX(-2px); }
  25%{ transform:scale(0.75) rotate(2deg) translateY(-2px); }
  50%{ transform:scale(0.75) rotate(-2deg) translateX(2px); }
  75%{ transform:scale(0.75) rotate(3deg) translateY(2px); }
  100%{ transform:scale(0.75) rotate(-3deg) translateX(-2px); }
}

/* Non-selected cards dim out */
.talent-shuffle-card.not-selected{
  opacity:0.3;
  transform:scale(0.65);
  filter:grayscale(0.5);
}

/* Winner card highlight */
.talent-shuffle-card.upgrade-winner,
.talent-card.upgrade-winner{
  transform:scale(1.05);
  box-shadow:0 0 30px rgba(68,187,119,0.6);
  z-index:10;
}

/* Selectable talent cards for upgrade */
.talent-upgrade-selectable{
  transition:transform var(--half-beat) ease, box-shadow var(--half-beat) ease;
}

.talent-upgrade-selectable.upgrade-hover{
  transform:scale(1.05) translateY(-5px);
  box-shadow:0 8px 25px rgba(68,187,119,0.4);
}

.talent-upgrade-select-row{
  flex-wrap:wrap;
  justify-content:center;
  gap:16px;
}

/* Level preview styling */
.talent-level-preview{
  color:#4ade80 !important;
  font-weight:bold;
}

/* Upgrade value preview styling (old  new) */
.upgrade-old{
  color:#9ca3af;
  text-decoration:line-through;
  opacity:0.7;
}
.upgrade-arrow{
  color:#6b7280;
  margin:0 2px;
  font-size:0.9em;
}
.upgrade-new{
  color:#4ade80;
  font-weight:bold;
  text-shadow:0 0 4px rgba(74,222,128,0.4);
}

/* Winner wiggle before upgrade */
.talent-shuffle-card.upgrade-wiggle,
.talent-card.upgrade-wiggle{
  animation:upgrade-wiggle 0.1s ease-in-out infinite;
}

@keyframes upgrade-wiggle{
  0%, 100%{ transform:scale(1.05) rotate(-2deg); }
  50%{ transform:scale(1.05) rotate(2deg); }
}

/* Winner pop on upgrade */
.talent-shuffle-card.upgrade-pop,
.talent-card.upgrade-pop{
  animation:upgrade-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes upgrade-pop{
  0%{ transform:scale(1.05); }
  50%{ transform:scale(1.15); }
  100%{ transform:scale(1.1); box-shadow:0 0 50px rgba(68,187,119,0.8); }
}

/* Level display on card */
.talent-level-display{
  font-family:var(--font-sans);
  font-size:14px;
  color:#aaa;
  text-align:center;
  margin:4px 0;
  padding:4px 8px;
  background:rgba(0,0,0,0.3);
  border-radius:4px;
}

/* Level upgraded animation */
.talent-level-display.level-upgraded{
  animation:level-flash 0.5s ease-out;
}

@keyframes level-flash{
  0%{ background:rgba(68,187,119,0.6); transform:scale(1.1); }
  100%{ background:rgba(0,0,0,0.3); transform:scale(1); }
}

.talent-level-display .level-old{
  color:#888;
  text-decoration:line-through;
}

.talent-level-display .level-new{
  color:#88eebb;
  font-weight:bold;
  font-size:1.2em;
  text-shadow:0 0 10px rgba(68,187,119,0.8);
}

/* Description upgrade animation */
.talent-card-desc.desc-upgraded{
  animation:desc-flash 0.6s ease-out;
}

@keyframes desc-flash{
  0%{ color:#88eebb; text-shadow:0 0 10px rgba(68,187,119,0.8); transform:scale(1.05); }
  100%{ color:inherit; text-shadow:none; transform:scale(1); }
}

/* Talent level display in chip */
.talent-level{
  color:#88eebb;
  font-size:0.85em;
  font-weight:bold;
  margin-left:4px;
}

/* Talent swap mode */
.talent-swap-row{
  flex-wrap:wrap;
  gap:12px;
}

.talent-swap-card{
  transform:scale(0.85);
  cursor:pointer;
  transition:transform var(--half-beat) ease, box-shadow var(--half-beat) ease;
}

.talent-swap-card:hover{
  transform:scale(0.9);
  box-shadow:0 0 20px rgba(239,68,68,0.4);
}

.talent-swap-card.selecting{
  transform:scale(0.8);
  opacity:0.5;
}

/* Result box slide-in animation */
#combat-result{
  opacity:0;
  transform:translateY(8px) scale(0.94);
  filter:blur(2px);
  transition:opacity var(--half-beat) ease, transform var(--half-beat) cubic-bezier(0.22,1,0.36,1), filter var(--half-beat) ease;
}
#combat-result.show{
  opacity:1;
  transform:translateY(0) scale(1);
  filter:blur(0);
}

/* Continue button fade-in */
#combat-continue{
  opacity:0;
  transform:translateY(10px);
  transition:opacity var(--half-beat) ease var(--quarter-beat), transform var(--half-beat) ease var(--quarter-beat);
}
#combat-continue.show{
  opacity:1;
  transform:translateY(0);
}

/* Screen shake animation */
@keyframes screenShake{
  0%,100%{transform:translate(0,0)}
  10%{transform:translate(-3px,-1px)}
  20%{transform:translate(3px,1px)}
  30%{transform:translate(-2px,1px)}
  40%{transform:translate(2px,-1px)}
  50%{transform:translate(-1px,1px)}
  60%{transform:translate(1px,-1px)}
  70%{transform:translate(-1px,0)}
  80%{transform:translate(1px,0)}
}
html.screen-shake{
  overflow:hidden;
}
.screen-shake{
  animation:screenShake 0.25s ease-out;
}

/* Round Intro Animation */
#round-intro-overlay{
  position:fixed;
  inset:0;
  z-index:9000;
  background:rgba(0,0,0,0.85);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity var(--half-beat) ease;
}

#round-intro-overlay.show{
  opacity:1;
  pointer-events:auto;
}

.intro-content{
  text-align:center;
  width:100%;
  max-width:900px;
  padding:20px;
}

.intro-round-label{
  font-family:var(--font-display);
  font-size:24px;
  font-weight:700;
  color:#9ca3af;
  margin-bottom:30px;
  letter-spacing:0.1em;
  text-transform:uppercase;
}

.intro-round-label.boss{
  color:#f87171;
  text-shadow:0 0 20px rgba(248,113,113,0.5);
  animation:bossPulse 1s ease-in-out infinite;
}

@keyframes bossPulse{
  0%,100%{opacity:1;transform:scale(1)}
  50%{opacity:0.8;transform:scale(1.05)}
}

.intro-versus{
  display:flex;
  align-items:flex-start;
  justify-content:center;
  gap:40px;
}

.intro-combatant{
  flex:1;
  max-width:300px;
  opacity:0;
  text-align:center;
  transition:opacity var(--beat) ease, transform var(--beat) cubic-bezier(0.34, 1.56, 0.64, 1);
}

.intro-hero{
  transform:translateX(-100px);
}

.intro-enemy{
  transform:translateX(100px);
}

.intro-combatant.entered{
  opacity:1;
  transform:translateX(0);
}

.intro-portrait{
  width:100px;
  height:100px;
  margin:0 auto 15px;
  border-radius:50%;
  position:relative;
}

.intro-portrait-frame{
  width:100%;
  height:100%;
  border-radius:50%;
  border:4px solid;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

.intro-portrait-frame svg{
  width:100%;
  height:100%;
  display:block;
}

.intro-portrait.hero-side .intro-portrait-frame{
  border-color:#4ade80;
  background:linear-gradient(135deg,#22543d,#1a1d24);
  box-shadow:0 0 20px rgba(74,222,128,0.4);
}

.intro-portrait.enemy-side .intro-portrait-frame{
  border-color:#f87171;
  background:linear-gradient(135deg,#7f1d1d,#1a1d24);
  box-shadow:0 0 20px rgba(248,113,113,0.4);
}

.intro-name{
  font-size:18px;
  font-weight:700;
  font-family:var(--font-display);
  color:#f4f4f5;
  margin-bottom:10px;
}

.intro-dialogue{
  font-size:14px;
  font-style:italic;
  color:#9ca3af;
  line-height:1.4;
  min-height:40px;
  letter-spacing:0.03em;
}

.intro-vs{
  font-size:36px;
  font-weight:bold;
  color:#fbbf24;
  text-shadow:0 0 15px rgba(251,191,36,0.5);
  opacity:0;
  transform:scale(0.5);
  transition:opacity var(--half-beat) ease, transform var(--beat) cubic-bezier(0.34, 1.56, 0.64, 1);
}

.intro-vs.entered{
  opacity:1;
  transform:scale(1);
}

.intro-hint{
  margin-top:40px;
  font-size:12px;
  color:#6b7280;
  animation:hintPulse 2s ease-in-out infinite;
}

@keyframes hintPulse{
  0%,100%{opacity:0.5}
  50%{opacity:1}
}

/* Chapter Boss Ability Display (talent-purple styling) */
.intro-ability{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  padding:12px 16px;
  margin:8px 0;
  background:linear-gradient(135deg, rgba(147,51,234,0.2), rgba(168,85,247,0.1));
  border:2px solid #a855f7;
  border-radius:8px;
  box-shadow:0 0 15px rgba(168,85,247,0.3);
  animation:abilityPulse 2s ease-in-out infinite;
}

@keyframes abilityPulse{
  0%,100%{box-shadow:0 0 15px rgba(168,85,247,0.3)}
  50%{box-shadow:0 0 25px rgba(168,85,247,0.5)}
}

.intro-ability .ability-name{
  font-size:16px;
  font-weight:bold;
  color:#d8b4fe;
  text-transform:uppercase;
  letter-spacing:1px;
}

.intro-ability .ability-desc{
  font-size:13px;
  color:#c4b5fd;
  text-align:center;
  line-height:1.3;
}

/* Chapter Boss round label */
.intro-round-label.boss{
  color:#f87171;
  text-shadow:0 0 15px rgba(248,113,113,0.5);
}


/* Crate Opening Reel Animation */
.crate-reel{
  width:120px;
  height:180px;
  background:linear-gradient(135deg,#0f1419,#1a1f2e);
  border:3px solid #3a4556;
  border-radius:12px;
  overflow:hidden;
  position:relative;
  box-shadow:inset 0 0 20px rgba(0,0,0,0.5), 0 8px 20px rgba(0,0,0,0.4);
  transition:transform var(--quarter-beat) ease, border-color var(--quarter-beat) ease, box-shadow var(--quarter-beat) ease;
}
.crate-reel.spinning:hover{
  transform:scale(1.05);
  border-color:#fbbf24;
  box-shadow:inset 0 0 20px rgba(0,0,0,0.5), 0 8px 20px rgba(0,0,0,0.4), 0 0 15px rgba(251,191,36,0.3);
}
.crate-reel.revealed{
  cursor:default !important;
}

.crate-reel-window{
  position:absolute;
  top:50%;
  left:0;
  right:0;
  height:60px;
  transform:translateY(-50%);
  border-top:2px solid #fbbf24;
  border-bottom:2px solid #fbbf24;
  background:rgba(251,191,36,0.05);
  pointer-events:none;
  z-index:2;
}
/* Dimming overlays for top and bottom rows */
.crate-reel::before,.crate-reel::after{
  content:'';
  position:absolute;
  left:0;
  right:0;
  height:60px;
  pointer-events:none;
  z-index:3;
}
.crate-reel::before{
  top:0;
  background:linear-gradient(180deg,rgba(15,20,25,0.85) 0%,rgba(15,20,25,0.6) 50%,transparent 100%);
}
.crate-reel::after{
  bottom:0;
  background:linear-gradient(0deg,rgba(15,20,25,0.85) 0%,rgba(15,20,25,0.6) 50%,transparent 100%);
}

.crate-reel-strip{
  position:absolute;
  top:0;
  left:0;
  right:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  will-change:transform;
}

.crate-reel-item{
  width:100%;
  height:60px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-size:14px;
  font-weight:bold;
  text-align:center;
  padding:4px 8px;
  line-height:1.2;
  border-bottom:1px solid #2a2f38;
  position:relative;
}
.reel-name{font-size:13px;font-weight:bold;font-family:var(--font-display)}
.reel-detail{font-size:10px;color:#9ca3af;margin-top:2px;font-weight:normal;font-family:var(--font-sans)}
.reel-tier{color:#6b7280;font-weight:600}
.reel-mult{color:#60a5fa;font-weight:600}
/* Reel content wrapper with tier badge */
.reel-content{display:flex;flex-direction:column;align-items:center;width:100%;height:100%;justify-content:center;position:relative}
.reel-content .chip-tier{position:absolute;top:4px;right:6px}
.reel-content .chip-tab{left:0;top:0;bottom:0;border-radius:0}
.reel-content.rarity-word{background:linear-gradient(135deg,#1a1f2e 0%,#252b3d 50%,#1a1f2e 100%);overflow:hidden}
.reel-content.rarity-word::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.04),transparent);animation:metallicSheen 4s ease-in-out infinite;pointer-events:none}
.reel-content.rarity-t1::before{background:linear-gradient(90deg,transparent,rgba(192,192,192,0.06),transparent)}
.reel-content.rarity-t2::before{background:linear-gradient(90deg,transparent,rgba(96,165,250,0.08),transparent)}
.reel-content.rarity-t3::before{background:linear-gradient(90deg,transparent,rgba(252,211,77,0.10),transparent)}
/* Tier wash effects in reel */
.reel-content.tier-wash-2::after{content:'';position:absolute;left:0;top:0;bottom:0;width:35%;background:linear-gradient(90deg,var(--wash-color,rgba(255,255,255,0.06)),transparent);pointer-events:none}
.reel-content.tier-wash-3::after{content:'';position:absolute;left:0;top:0;bottom:0;width:50%;background:linear-gradient(90deg,var(--wash-color,rgba(255,255,255,0.12)),transparent);pointer-events:none}
.reel-content.tier-wash-3{overflow:hidden}
.reel-content.tier-wash-3::before{content:'';position:absolute;top:-50%;left:-50%;width:50%;height:200%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.12),transparent);animation:tierShimmer 2.5s ease-in-out infinite;pointer-events:none;transform:rotate(25deg)}

.crate-reel.spinning .crate-reel-strip{
  animation:reelSpin 0.1s linear infinite;
  filter: url(#vertical-blur);
}
.crate-reel.stopping .crate-reel-strip,
.crate-reel.revealed .crate-reel-strip{
  filter: none;
}

@keyframes reelSpin{
  from{
    transform:translateY(0);
  }
  to{
    transform:translateY(-60px);
  }
}

.crate-reel.stopping .crate-reel-strip{
  animation:none;
  transition:transform calc(var(--beat) * 2) cubic-bezier(0.25, 0.1, 0.25, 1);
}

.crate-reel.revealed{
  border-color:#fbbf24;
  box-shadow:inset 0 0 20px rgba(251,191,36,0.2), 0 0 30px rgba(251,191,36,0.4);
  animation:reelPulse 0.5s ease-out;
}

@keyframes reelPulse{
  0%, 100%{
    transform:scale(1);
  }
  50%{
    transform:scale(1.05);
  }
}


/* ============================================
   ONBOARDING SYSTEM STYLES
   Full-screen centered dialogue for first run
   ============================================ */

#onboarding-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--beat) ease;
}

#onboarding-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

#onboarding-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding: 40px 60px;
  max-width: 500px;
  text-align: center;
}

#onboarding-portrait {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  border: 3px solid #fbbf24;
  overflow: hidden;
  box-shadow: 0 0 30px rgba(251,191,36,0.3);
}

#onboarding-portrait svg {
  width: 100%;
  height: 100%;
}

#onboarding-name {
  font-size: 16px;
  font-weight: 600;
  color: #fbbf24;
  text-transform: uppercase;
  letter-spacing: 0.15em;
}

#onboarding-text {
  font-size: 18px;
  color: #e5e7eb;
  line-height: 1.7;
}

#onboarding-text .highlight {
  color: #fbbf24;
  font-weight: bold;
}

#onboarding-example {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
  margin-top: 16px;
}

#onboarding-example .chip.onboarding-chip {
  transform: scale(0.9);
  cursor: default;
}

#onboarding-continue {
  font-size: 12px;
  color: #6b7280;
  margin-top: 12px;
  animation: hintPulse 2s ease-in-out infinite;
}

/* Onboarding completion celebration overlay */
#onboarding-celebration {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.92);
  z-index: 10001;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--beat) ease;
}

#onboarding-celebration.visible {
  opacity: 1;
  pointer-events: auto;
}

#onboarding-celebration-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  padding: 50px 70px;
  max-width: 550px;
  text-align: center;
  background: linear-gradient(135deg, rgba(251,191,36,0.1), rgba(0,0,0,0.5));
  border: 2px solid #fbbf2444;
  border-radius: 16px;
  box-shadow: 0 0 60px rgba(251,191,36,0.2);
}

/* Custom Scrollbar */
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:rgba(0,0,0,0.2);border-radius:4px}
::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#4b5563,#374151);border-radius:4px;border:1px solid rgba(255,255,255,0.1)}
::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,#6b7280,#4b5563)}
/* Metallic blacksmith-style scrollbar for talent viewer */
#talent-viewer-content::-webkit-scrollbar{width:12px}
#talent-viewer-content::-webkit-scrollbar-track{background:linear-gradient(90deg,#1a1a1a,#2d2d2d,#1a1a1a);border-radius:6px;border:1px solid #0a0a0a;box-shadow:inset 0 0 6px rgba(0,0,0,0.5)}
#talent-viewer-content::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#8b8b8b 0%,#5a5a5a 20%,#707070 40%,#4a4a4a 60%,#606060 80%,#3a3a3a 100%);border-radius:6px;border:1px solid #2a2a2a;box-shadow:inset 0 1px 0 rgba(255,255,255,0.2),inset 0 -1px 0 rgba(0,0,0,0.3),0 2px 4px rgba(0,0,0,0.4)}
#talent-viewer-content::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,#9a9a9a 0%,#6a6a6a 20%,#808080 40%,#5a5a5a 60%,#707070 80%,#4a4a4a 100%);box-shadow:inset 0 1px 0 rgba(255,255,255,0.3),inset 0 -1px 0 rgba(0,0,0,0.3),0 2px 6px rgba(0,0,0,0.5)}

/* Word-specific chromatic aberration effects */
.chip.chromatic-word{
  position:relative;
  z-index:10;
}
.chip.chromatic-word::before{
  content:'';
  position:absolute;
  inset:-2px;
  border-radius:12px;
  pointer-events:none;
  opacity:0;
  z-index:-1;
}

/* Generate effect - gold/cyan split for new T3 word */
.chip.chromatic-generate{
  animation:chromaticPulse 0.8s ease-out;
}
.chip.chromatic-generate::before{
  background:linear-gradient(135deg,rgba(252,211,77,0.4) 0%,transparent 40%,transparent 60%,rgba(78,205,196,0.3) 100%);
  animation:chromaticGlow 0.8s ease-out;
}

/* Upgrade effect - purple/gold ascending */
.chip.chromatic-upgrade{
  animation:chromaticUpgrade 0.8s ease-out;
}
.chip.chromatic-upgrade::before{
  background:linear-gradient(180deg,rgba(168,85,247,0.4) 0%,rgba(252,211,77,0.3) 100%);
  animation:chromaticGlow 0.8s ease-out;
}

/* Transform effect - red/cyan horizontal split */
.chip.chromatic-transform{
  animation:chromaticTransform 0.8s ease-out;
}
.chip.chromatic-transform::before{
  background:linear-gradient(90deg,rgba(255,107,107,0.4) 0%,transparent 45%,transparent 55%,rgba(78,205,196,0.4) 100%);
  animation:chromaticGlow 0.8s ease-out;
}

/* Copy effect - blue duplicate shimmer (for the new copy) */
.chip.chromatic-copy{
  animation:chromaticCopy 0.8s ease-out;
}
.chip.chromatic-copy::before{
  background:linear-gradient(135deg,rgba(96,165,250,0.5) 0%,rgba(147,197,253,0.3) 50%,rgba(96,165,250,0.5) 100%);
  animation:chromaticGlow 0.8s ease-out;
}

/* Copy source effect - chromatic aberration shake on original word */
.chip.chromatic-copy-source{
  animation:chromaticCopyShake 0.6s ease-out;
}
.chip.chromatic-copy-source::before{
  background:linear-gradient(90deg,rgba(255,50,50,0.5) 0%,transparent 30%,transparent 70%,rgba(50,200,255,0.5) 100%);
  animation:chromaticGlow 0.6s ease-out;
}
.chip.chromatic-copy-source::after{
  content:'';
  position:absolute;
  inset:0;
  border-radius:10px;
  box-shadow:
    -3px 0 0 rgba(255,50,50,0.4),
    3px 0 0 rgba(50,200,255,0.4),
    -2px -1px 0 rgba(255,50,50,0.3),
    2px 1px 0 rgba(50,200,255,0.3);
  animation:chromaticAberration 0.6s ease-out;
  pointer-events:none;
}

@keyframes chromaticPulse{
  0%{transform:scale(1);filter:brightness(1) saturate(1)}
  20%{transform:scale(1.08);filter:brightness(1.3) saturate(1.2)}
  50%{transform:scale(1.02);filter:brightness(1.15) saturate(1.1)}
  100%{transform:scale(1);filter:brightness(1) saturate(1)}
}

@keyframes chromaticUpgrade{
  0%{transform:scale(1) translateY(0);filter:brightness(1)}
  30%{transform:scale(1.1) translateY(-4px);filter:brightness(1.4)}
  60%{transform:scale(1.05) translateY(-2px);filter:brightness(1.2)}
  100%{transform:scale(1) translateY(0);filter:brightness(1)}
}

@keyframes chromaticTransform{
  0%{transform:scale(1) rotateY(0);filter:brightness(1) hue-rotate(0deg)}
  25%{transform:scale(1.05) rotateY(10deg);filter:brightness(1.2) hue-rotate(20deg)}
  50%{transform:scale(1.08) rotateY(0);filter:brightness(1.3) hue-rotate(-20deg)}
  75%{transform:scale(1.05) rotateY(-10deg);filter:brightness(1.2) hue-rotate(10deg)}
  100%{transform:scale(1) rotateY(0);filter:brightness(1) hue-rotate(0deg)}
}

@keyframes chromaticCopy{
  0%{transform:scale(1);filter:brightness(1);box-shadow:0 0 0 rgba(96,165,250,0)}
  30%{transform:scale(1.1);filter:brightness(1.3);box-shadow:0 0 20px rgba(96,165,250,0.5)}
  100%{transform:scale(1);filter:brightness(1);box-shadow:0 0 0 rgba(96,165,250,0)}
}

@keyframes chromaticGlow{
  0%{opacity:0}
  20%{opacity:1}
  80%{opacity:0.6}
  100%{opacity:0}
}

@keyframes chromaticCopyShake{
  0%{transform:translate(0,0) scale(1);filter:brightness(1)}
  10%{transform:translate(-3px,0) scale(1.02);filter:brightness(1.2)}
  20%{transform:translate(3px,-1px) scale(1.04);filter:brightness(1.3)}
  30%{transform:translate(-2px,1px) scale(1.05);filter:brightness(1.4)}
  40%{transform:translate(2px,0) scale(1.04);filter:brightness(1.3)}
  50%{transform:translate(-1px,-1px) scale(1.03);filter:brightness(1.25)}
  60%{transform:translate(1px,1px) scale(1.02);filter:brightness(1.2)}
  70%{transform:translate(-1px,0) scale(1.01);filter:brightness(1.15)}
  80%{transform:translate(1px,0) scale(1);filter:brightness(1.1)}
  100%{transform:translate(0,0) scale(1);filter:brightness(1)}
}

@keyframes chromaticAberration{
  0%{opacity:0;transform:scale(1)}
  20%{opacity:1;transform:scale(1.05)}
  60%{opacity:0.8;transform:scale(1.02)}
  100%{opacity:0;transform:scale(1)}
}
:root{
  --border-soft: rgba(255,255,255,0.08);
  --border-strong: rgba(255,255,255,0.12);
}
/* Apply soft border color globally for a cohesive frame style */
*{border-color:var(--border-soft);}

/* === SKILL TREE OVERLAY === */
#skill-tree-overlay{z-index:500}
.skill-tree-modal{
  --hero-accent:#f5c15c;
  --hero-accent-dark:#d4a84a;
  min-width:580px;
  max-width:650px;
  padding:12px 16px;
  max-height:90vh;
  overflow-y:auto;
  overflow-x:hidden;
  position:relative;
}
/* Hero portrait background */
.skill-tree-bg{
  position:absolute;
  top:0;
  left:0;
  right:0;
  bottom:0;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0.12;
  pointer-events:none;
  z-index:0;
  overflow:hidden;
}
.skill-tree-bg::after{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(ellipse at center, transparent 20%, rgba(10,14,22,0.85) 70%, rgba(10,14,22,1) 100%);
  pointer-events:none;
}
.skill-tree-bg svg{
  width:150%;
  height:150%;
  min-width:500px;
  min-height:500px;
}
.skill-tree-modal > *:not(.skill-tree-bg){
  position:relative;
  z-index:1;
}
.skill-tree-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:8px;
}
.skill-tree-hero-info{
  text-align:center;
  flex:1;
}
.skill-tree-hero-name{
  font-family:var(--font-display);
  font-size:18px;
  font-style:italic;
  color:#f5c15c;
  margin-bottom:2px;
}
.skill-tree-hero-level{
  font-family:var(--font-sans);
  font-size:11px;
  color:#9ca3af;
  text-transform:uppercase;
  letter-spacing:0.1em;
}
.skill-tree-nav-btn{
  padding:8px 16px;
  border-radius:6px;
  background:#1f2937;
  border:1px solid #374151;
  color:#e5e7eb;
  font-size:24px;
  cursor:pointer;
  transition:all var(--half-beat);
}
.skill-tree-nav-btn:hover{
  background:#374151;
  border-color:#4b5563;
}
.skill-tree-xp-bar{
  position:relative;
  height:16px;
  background:#1f2937;
  border-radius:8px;
  overflow:hidden;
  margin-bottom:6px;
  border:1px solid #374151;
}
.skill-tree-xp-fill{
  position:absolute;
  left:0;top:0;bottom:0;
  background:linear-gradient(90deg,var(--hero-accent),var(--hero-accent-dark));
  border-radius:8px;
  transition:width var(--half-beat) ease;
}
.skill-tree-xp-text{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  font-family:var(--font-sans);
  color:#e5e7eb;
  text-shadow:0 1px 2px rgba(0,0,0,0.5);
}
.skill-tree-points{
  text-align:center;
  font-family:var(--font-sans);
  font-size:12px;
  color:#fbbf24;
  margin-bottom:8px;
  font-weight:600;
}
.skill-tree-container{
  position:relative;
  min-height:320px;
  background:rgba(0,0,0,0.2);
  border-radius:8px;
  padding:16px 20px;
  margin-bottom:10px;
  border:1px solid #374151;
}
/* Zoom controls */
.skill-tree-zoom-controls{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:4px;
  margin-bottom:8px;
  position:relative;
  z-index:10;
}
.skill-tree-zoom-btn{
  width:24px;
  height:24px;
  border-radius:4px;
  border:1px solid #4b5563;
  background:linear-gradient(135deg, #374151, #1f2937);
  color:#e5e7eb;
  font-size:14px;
  font-weight:bold;
  cursor:pointer;
  transition:all var(--quarter-beat);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 1px 3px rgba(0,0,0,0.3);
}
.skill-tree-zoom-btn:hover{
  background:linear-gradient(135deg, #4b5563, #374151);
  border-color:#6b7280;
  transform:scale(1.05);
}
.skill-tree-zoom-btn:active{
  transform:scale(0.95);
}
.skill-tree-zoom-level{
  font-family:var(--font-mono);
  font-size:10px;
  color:#9ca3af;
  min-width:36px;
  text-align:center;
  background:rgba(0,0,0,0.3);
  padding:4px 6px;
  border-radius:4px;
  border:1px solid #374151;
}
.skill-tree-zoom-reset{
  font-size:9px;
  padding:4px 8px;
  margin-left:8px;
  border-radius:4px;
  border:1px solid #374151;
  background:rgba(55,65,81,0.4);
  color:#9ca3af;
  cursor:pointer;
  transition:all var(--quarter-beat);
}
.skill-tree-zoom-reset:hover{
  background:rgba(75,85,99,0.5);
  color:#d1d5db;
}
/* Viewport for scrolling/panning */
.skill-tree-viewport{
  overflow:hidden;
  max-height:420px;
  border-radius:6px;
  position:relative;
  cursor:grab;
  background:rgba(0,0,0,0.15);
  border:1px solid rgba(55,65,81,0.5);
}
.skill-tree-viewport:active{
  cursor:grabbing;
}
.skill-tree-viewport.dragging{
  cursor:grabbing;
  user-select:none;
}
.skill-tree-grid{
  display:grid;
  grid-template-columns:repeat(5, 60px);
  gap:8px 12px;
  position:relative;
  padding:10px;
  justify-content:center;
  min-width:max-content;
  transition:transform var(--quarter-beat) ease-out;
}
.skill-tree-row{
  display:contents;
}
/* Connection lines - SVG drawn dynamically */
.skill-tree-lines{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
}
.skill-tree-lines svg{
  width:100%;
  height:100%;
}
.skill-tree-line{
  stroke:#374151;
  stroke-width:2;
  fill:none;
  transition:stroke var(--half-beat);
}
.skill-tree-line.active{
  stroke:var(--hero-accent);
}
/* Skill nodes - circular */
.skill-node{
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  width:50px;
  height:50px;
  margin:0 auto;
  border-radius:50%;
  background:#1f2937;
  border:2px solid #374151;
  cursor:pointer;
  transition:all var(--half-beat);
  z-index:1;
}
.skill-node-empty{
  width:50px;
  height:50px;
  margin:0 auto;
}
.skill-node:hover{
  border-color:#6b7280;
  transform:translateY(-2px);
}
.skill-node.locked{
  opacity:0.4;
  cursor:not-allowed;
}
.skill-node.locked:hover{
  transform:none;
  border-color:#374151;
}
.skill-node.allocated{
  border-color:var(--hero-accent);
  background:linear-gradient(135deg,rgba(255,255,255,0.08),rgba(255,255,255,0.03));
}
.skill-node.maxed{
  border-color:var(--hero-accent);
  background:linear-gradient(135deg,rgba(255,255,255,0.12),rgba(255,255,255,0.06));
  box-shadow:0 0 12px color-mix(in srgb, var(--hero-accent) 40%, transparent);
}
.skill-node.major{
  border-width:3px;
}
.skill-node.capstone{
  border-width:3px;
  border-color:#a855f7;
  background:linear-gradient(135deg,#2e1a47,#1f1233);
}
.skill-node.capstone.allocated{
  border-color:#c084fc;
  background:linear-gradient(135deg,#4c2a80,#3b2066);
}
.skill-node-icon{
  width:20px;
  height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#9ca3af;
}
.skill-node-icon svg{
  width:100%;
  height:100%;
}
.skill-node.allocated .skill-node-icon{
  color:#f5c15c;
}
.skill-node.maxed .skill-node-icon{
  color:#4ade80;
}
.skill-node.capstone .skill-node-icon{
  color:#c084fc;
}
.skill-node.capstone.allocated .skill-node-icon{
  color:#e879f9;
}
.skill-node-name{
  font-family:var(--font-sans);
  font-size:8px;
  font-weight:600;
  color:#e5e7eb;
  text-align:center;
  line-height:1.1;
  max-width:50px;
  overflow:hidden;
}
.skill-node-points{
  font-family:var(--font-mono);
  font-size:8px;
  color:#9ca3af;
}
.skill-node.allocated .skill-node-points{
  color:var(--hero-accent);
}
.skill-node.maxed .skill-node-points{
  color:var(--hero-accent);
}
/* Skill node tooltip */
.skill-node .tooltip{
  bottom:100%;
  margin-bottom:8px;
  width:220px;
  z-index:1000;
}
.skill-node:hover .tooltip{
  opacity:1;
}
/* Allow tooltips to escape modal overflow */
.skill-tree-modal{
  overflow:visible !important;
}
.skill-tree-modal > .skill-tree-container{
  max-height:60vh;
  overflow-y:auto;
  overflow-x:hidden;
}
.skill-tree-footer{
  display:flex;
  justify-content:center;
  gap:8px;
}
.skill-tree-btn{
  padding:8px 18px;
  font-size:12px;
  font-family:var(--font-sans);
  border-radius:6px;
  background:#1f2937;
  border:1px solid #374151;
  color:#e5e7eb;
  cursor:pointer;
  transition:all var(--half-beat);
}
.skill-tree-btn:hover{
  background:#374151;
}
.skill-tree-btn.primary{
  background:linear-gradient(135deg,#22543d,#1a3328);
  border-color:rgba(74,222,128,0.4);
  color:#ecfdf3;
}
.skill-tree-btn.primary:hover{
  background:linear-gradient(135deg,#2d6a4f,#22543d);
}

/* ========================================
   GPU & PERFORMANCE OPTIMIZATIONS
   ======================================== */

/* Promote animated elements to GPU layers */
#flame-bg,
#flame-bg::before,
#flame-bg::after,
.weapon-canvas,
.weapon-layered,
.god-rays,
#fx-canvas {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Reduce paint areas for frequently animated elements */
.health-preview,
.enemy-fill,
.portrait.speaking .portrait-frame {
  will-change: transform, opacity;
  contain: layout style paint;
}

/* Contain layout recalculations */
.chip,
.slot,
.card,
.modal {
  contain: layout style;
}

/* Optimize compositing for overlays */
.overlay {
  contain: strict;
}

/* Reduce motion for users who prefer it AND as a performance setting */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  #flame-bg::before,
  #flame-bg::after {
    animation: none !important;
  }

  .god-rays {
    animation: none !important;
  }

  .weapon-canvas {
    animation: none !important;
  }

  .slot[data-slot="noun1"]::after,
  .slot[data-slot="item"].signature-style-active::after {
    animation: none !important;
  }
}

/* Low FX mode class - disables expensive GPU animations */
body.low-fx #flame-bg::before,
body.low-fx #flame-bg::after {
  animation: none !important;
  /* No blur filter needed - gradients are pre-baked with soft edges */
  transform: translate(-50%, -50%) scale(var(--flame-scale)) !important; /* Center without mouse offset */
}

body.low-fx #dither-overlay {
  display: none; /* SVG noise filter is expensive */
}

body.low-fx .god-rays {
  animation: none !important;
  opacity: 0.3 !important;
}

body.low-fx .weapon-canvas {
  animation: none !important;
}

body.low-fx .slot[data-slot="noun1"]::after,
body.low-fx .slot[data-slot="item"].signature-style-active::after {
  animation: none !important;
}

body.low-fx .modal {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

body.low-fx #paper-overlay {
  display: none !important;
}

/* Crate reel optimizations for low FX mode */
body.low-fx .reel-content.tier-wash-3::before {
  animation: none !important;
}

body.low-fx .crate-reel.spinning .crate-reel-strip {
  animation-duration: 0.2s !important; /* Slower spin in low FX mode */
}

/* Optimize infinite animations - use transform instead of filter where possible */
@keyframes flame-drift-core-optimized {
  0%, 100% { transform: translate(calc(-50% + var(--mouse-x) * -0.2), calc(-50% + var(--mouse-y) * -0.2)) scale(var(--flame-scale)) translateZ(0); }
  50% { transform: translate(calc(-50% + 30px + var(--mouse-x) * -0.2), calc(-50% - 20px + var(--mouse-y) * -0.2)) scale(calc(var(--flame-scale) * 1.08)) translateZ(0); }
}

@keyframes flame-drift-outer-optimized {
  0%, 100% { transform: translate(calc(-50% + var(--mouse-x) * 0.3), calc(-50% + var(--mouse-y) * 0.3)) scale(var(--flame-scale)) translateZ(0); }
  50% { transform: translate(calc(-50% - 40px + var(--mouse-x) * 0.3), calc(-50% + 25px + var(--mouse-y) * 0.3)) scale(calc(var(--flame-scale) * 1.12)) translateZ(0); }
}

/* ========================================
   BACKDROP-FILTER FALLBACK FOR WINDOWS
   When backdrop-filter isn't supported, use solid backgrounds
   ======================================== */
@supports not (backdrop-filter: blur(1px)) {
  .modal {
    background: linear-gradient(135deg, rgba(18,22,32,0.98), rgba(10,14,22,0.99)) !important;
  }
  #combat-overlay .modal {
    background: radial-gradient(circle at top, rgba(248,214,120,0.08), transparent 60%),
                rgba(15,17,25,0.99) !important;
  }
  #game-toast {
    background: linear-gradient(135deg, #1f2937, #111827) !important;
  }
}

/* ========================================
   DEBUG PERFORMANCE OVERLAY (F3 to toggle)
   ======================================== */
#debug-overlay {
  position: fixed;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.85);
  border: 1px solid #4ade80;
  border-radius: 8px;
  padding: 10px 14px;
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 11px;
  color: #e5e7eb;
  z-index: 999999;
  min-width: 180px;
  pointer-events: auto;
}
#debug-overlay.hidden {
  display: none;
}
#debug-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  padding-bottom: 6px;
  border-bottom: 1px solid #374151;
}
#debug-header span {
  color: #4ade80;
  font-weight: bold;
  font-size: 10px;
  letter-spacing: 0.1em;
}
#debug-copy-log {
  padding: 2px 8px;
  font-size: 9px;
  background: #1f2937;
  border: 1px solid #4ade80;
  border-radius: 4px;
  color: #4ade80;
  cursor: pointer;
  transition: all 0.15s;
}
#debug-copy-log:hover {
  background: #4ade80;
  color: #000;
}
.debug-row {
  display: flex;
  justify-content: space-between;
  gap: 12px;
  line-height: 1.6;
}
.debug-row span:first-child {
  color: #9ca3af;
}
.debug-row span:last-child {
  color: #fff;
  font-weight: 500;
}
#debug-fps { color: #4ade80 !important; }
#debug-frame-time { color: #fbbf24 !important; }
#debug-log-status {
  margin-top: 8px;
  padding-top: 6px;
  border-top: 1px solid #374151;
  font-size: 9px;
  color: #6b7280;
  text-align: center;
}
/* Color coding for performance issues */
.debug-warn { color: #fbbf24 !important; }
.debug-bad { color: #ef4444 !important; }
