const IS_DEMO=!1,GAME_WIDTH=1920,GAME_HEIGHT=1080,IS_ELECTRON="undefined"!=typeof process&&process.versions&&process.versions.electron,RHYTHM={BEAT:441.2,HALF:220.6,QUARTER:110.3,EIGHTH:55.1,BAR:1764.7},ERROR_LOG=[],MAX_ERROR_LOG=20;function getGameStateSnapshot(){try{return{roundIndex:S?.roundIndex,heroId:S?.heroId,gold:S?.gold,difficulty:S?.difficulty,talents:S?.talents?.slice(0,10),invCount:S?.inv?.length,selectedSlots:S?.sel?Object.keys(S.sel).filter(e=>S.sel[e]):[],enemyId:S?.enemy?.id,enemyHP:S?.enemy?.hp,chapterBoss:S?.chapterBoss?.id,isMiniboss:S?.isMiniboss,version:"1.0.0-beta"}}catch(e){return{error:"Could not capture game state"}}}function showBugReportPrompt(e){if(document.getElementById("bug-report-modal"))return;const t=document.createElement("div");t.id="bug-report-modal",t.style.cssText="\n    position: fixed; top: 0; left: 0; right: 0; bottom: 0;\n    background: rgba(0,0,0,0.85); z-index: 99999;\n    display: flex; align-items: center; justify-content: center;\n    font-family: 'EB Garamond', serif;\n  ";const o=generateBugReport(e);t.innerHTML=`\n    <div style="background: #1f2937; border: 2px solid #ef4444; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">\n      <h2 style="color: #ef4444; margin: 0 0 12px 0; font-size: 20px;">Something went wrong!</h2>\n      <p style="color: #9ca3af; margin: 0 0 16px 0; font-size: 14px;">\n        An error occurred. Help us fix it by sending a bug report.\n      </p>\n      <div style="background: #111827; border-radius: 8px; padding: 12px; margin-bottom: 16px; font-family: monospace; font-size: 11px; color: #f87171; max-height: 150px; overflow-y: auto; word-break: break-all;">\n        ${e.message}\n      </div>\n      <textarea id="bug-report-text" readonly style="width: 100%; height: 120px; background: #111827; border: 1px solid #374151; border-radius: 8px; padding: 8px; color: #d1d5db; font-family: monospace; font-size: 10px; resize: none; margin-bottom: 12px;">${o}</textarea>\n      <div style="display: flex; gap: 8px; flex-wrap: wrap;">\n        <button id="bug-copy-btn" style="flex: 1; min-width: 100px; padding: 10px 16px; background: #3b82f6; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 14px;">Copy Report</button>\n        <button id="bug-discord-btn" style="flex: 1; min-width: 100px; padding: 10px 16px; background: #5865f2; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 14px;">Discord</button>\n        <button id="bug-x-btn" style="flex: 1; min-width: 100px; padding: 10px 16px; background: #000; border: 1px solid #333; border-radius: 6px; color: white; cursor: pointer; font-size: 14px;">ùïè</button>\n        <button id="bug-dismiss-btn" style="flex: 1; min-width: 100px; padding: 10px 16px; background: #374151; border: none; border-radius: 6px; color: #9ca3af; cursor: pointer; font-size: 14px;">Dismiss</button>\n      </div>\n      <p style="color: #6b7280; margin: 12px 0 0 0; font-size: 11px; text-align: center;">\n        No data is sent automatically. Copy the report and share it with us if you'd like help.\n      </p>\n    </div>\n  `,document.body.appendChild(t),document.getElementById("bug-copy-btn").onclick=()=>{navigator.clipboard.writeText(o).then(()=>{document.getElementById("bug-copy-btn").textContent="Copied!",setTimeout(()=>{const e=document.getElementById("bug-copy-btn");e&&(e.textContent="Copy Report")},2e3)})},document.getElementById("bug-discord-btn").onclick=()=>{window.open("https://discord.gg/Nn73SWvgQK","_blank")},document.getElementById("bug-x-btn").onclick=()=>{window.open("https://x.com/wordyweapon","_blank")},document.getElementById("bug-dismiss-btn").onclick=()=>{t.remove()},t.onclick=e=>{e.target===t&&t.remove()}}function generateBugReport(e){return["=== WORDY WEAPON BUG REPORT ===",`Time: ${e.timestamp}`,`Type: ${e.type}`,`Error: ${e.message}`,e.source?`File: ${e.source}:${e.line}:${e.col}`:"","","--- GAME STATE ---",`Round: ${e.gameState?.roundIndex||"N/A"}`,`Hero: ${e.gameState?.heroId||"N/A"}`,`Difficulty: ${["Apprentice","Adept","Master"][e.gameState?.difficulty]||"N/A"}`,`Gold: ${e.gameState?.gold??"N/A"}`,`Enemy: ${e.gameState?.enemyId||"N/A"} (HP: ${e.gameState?.enemyHP||"N/A"})`,`Boss: ${e.gameState?.chapterBoss||"None"}`,`Slots: ${e.gameState?.selectedSlots?.join(", ")||"None"}`,`Talents: ${e.gameState?.talents?.length||0}`,`Inventory: ${e.gameState?.invCount||0} words`,"","--- STACK TRACE ---",e.stack||"No stack trace available","","--- BROWSER ---",navigator.userAgent].filter(e=>void 0!==e).join("\n")}function openBugReport(){showBugReportPrompt({type:"manual",message:"User-initiated bug report",timestamp:(new Date).toISOString(),gameState:getGameStateSnapshot()})}window.onerror=function(e,t,o,n,s){const a={type:"error",message:e,source:t?t.split("/").pop():"unknown",line:o,col:n,stack:s?.stack||"No stack trace",timestamp:(new Date).toISOString(),gameState:getGameStateSnapshot()};return ERROR_LOG.push(a),ERROR_LOG.length>20&&ERROR_LOG.shift(),showBugReportPrompt(a),!1},window.onunhandledrejection=function(e){const t={type:"promise",message:e.reason?.message||String(e.reason),stack:e.reason?.stack||"No stack trace",timestamp:(new Date).toISOString(),gameState:getGameStateSnapshot()};ERROR_LOG.push(t),ERROR_LOG.length>20&&ERROR_LOG.shift(),showBugReportPrompt(t)};const DEMO_ROUND_LIMIT=18,DEMO_HERO_LIMIT=2,STEAM_WISHLIST_URL="https://store.steampowered.com/app/4248130",DISCORD_URL="https://discord.gg/wordyweapon",E={PHYS:0,POISON:1,FIRE:2,WATER:3,LIGHT:4,DARK:5,EARTH:6,LIGHTNING:7},EN=["Physical","Poison","Fire","Water","Light","Dark","Earth","Lightning"],EC=["#a0a0a0","#7ee04d","#ff6633","#4d99ff","#ffffa0","#9966cc","#996633","#ffff4d"],T={T0:0,T1:1,T2:2,T3:3},TN=["T0","T1","T2","T3"],TC=["tier-0","tier-1","tier-2","tier-3"],TYPE_ORDER={weapon:0,elemental:1,rarity:2};function icon(e,t=""){return`<svg class="icon${t?` ${t}`:""}"><use href="#icon-${e}"/></svg>`}const INV_LIMIT=24,CONSUMABLE_LIMIT=2,INTEREST_CAP=30,GOLD_INTEREST_CAP=6,GOLD_PER_INTEREST=10;function calculateInterest(){const e=S.inv?S.inv.filter(e=>!e.hiddenInBank).length:0,t=Math.max(0,24-e),o=Math.min(6,Math.floor((S.gold||0)/10)),n=t,s=Math.min(30,o+n),a=DIFF_INTEREST_MULT[S.difficulty||0];return{goldInterest:o,slotInterest:n,totalInterest:Math.floor(s*a),emptySlots:t,interestMult:a}}const BASE_HP_BLOCK0=20,BLOCK_GROWTH=4,ROUND_MULTS=[1,1.5,2],DIFFICULTY={APPRENTICE:0,ADEPT:1,MASTER:2},DIFF_NAMES=["Apprentice","Adept","Master"],DIFF_HP_MULT=[1,1.5,2],DIFF_SKILL_MULT=[1,1,1],DIFF_INTEREST_MULT=[1,1,1],DIFF_PRICE_MULT=[1,1.25,1.5];function enemyHp(e){const t=Math.floor((e-1)/3),o=(e-1)%3,n=20*Math.pow(4,t),s=DIFF_HP_MULT[S.difficulty||0];return Math.floor(n*ROUND_MULTS[o]*s)}function getElementSparkColors(e){if(!e||void 0===e.elem)return["#ff9933","#ffcc00","#ffaa44"];return{[E.PHYS]:["#a0a0a0","#cccccc","#888888"],[E.FIRE]:["#ff6633","#ff9933","#ffcc00"],[E.WATER]:["#4d99ff","#66b3ff","#99ccff"],[E.LIGHTNING]:["#ffff4d","#ffffff","#ffffaa"],[E.EARTH]:["#996633","#cc9966","#aa7744"],[E.POISON]:["#7ee04d","#99ff66","#66cc33"],[E.LIGHT]:["#ffffa0","#ffffff","#ffffcc"],[E.DARK]:["#9966cc","#bb88ee","#7744aa"]}[e.elem]||["#ff9933","#ffcc00","#ffaa44"]}function fmtBig(e){return Math.floor(e).toLocaleString()}const fxCanvas=document.getElementById("fx-canvas"),fxCtx=fxCanvas?fxCanvas.getContext("2d"):null;let fxWidth=1920,fxHeight=1080;function resizeFxCanvas(){fxCanvas&&fxCtx&&(fxWidth=window.innerWidth,fxHeight=window.innerHeight,fxCanvas.width=fxWidth,fxCanvas.height=fxHeight,fxCtx.setTransform(1,0,0,1,0,0))}window.addEventListener("resize",resizeFxCanvas),fxCanvas&&resizeFxCanvas();let fxAnimations=[],fxLoopRunning=!1;function fxLoop(){fxCtx?(fxCtx.clearRect(0,0,fxWidth,fxHeight),fxAnimations=fxAnimations.filter(e=>e.update(fxCtx)),0!==fxAnimations.length?requestAnimationFrame(fxLoop):fxLoopRunning=!1):fxLoopRunning=!1}function startFxLoop(){fxLoopRunning||(fxLoopRunning=!0,requestAnimationFrame(fxLoop))}function addFxAnimation(e){fxAnimations.push(e),startFxLoop()}class LightningBolt{constructor(e,t,o,n,s){this.segments=[],this.color=s||"#ffffff",this.life=1,this.decay=.05,this.generate(e,t,o,n,80)}generate(e,t,o,n,s){if(s<5)this.segments.push({x1:e,y1:t,x2:o,y2:n});else{let a=(e+o)/2,i=(t+n)/2;a+=(Math.random()-.5)*s,i+=(Math.random()-.5)*s,this.generate(e,t,a,i,s/2),this.generate(a,i,o,n,s/2)}}update(e){return!(this.life<=0)&&(e.globalCompositeOperation="lighter",e.globalAlpha=this.life*(.8+.2*Math.random()),gfxSettings.lowFx||(e.shadowBlur=8,e.shadowColor=this.color),e.beginPath(),this.segments.forEach(t=>{e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2)}),e.strokeStyle=this.color,e.lineWidth=2+2*Math.random(),e.stroke(),e.shadowBlur=0,e.globalCompositeOperation="source-over",e.globalAlpha=1,this.life-=this.decay,!0)}}class MetalClash{constructor(e,t,o,n,s){this.x1=e,this.y1=t,this.x2=o,this.y2=n,this.color=s,this.progress=0,this.speed=.12,this.sparks=[],this.rings=[],this.impacted=!1}update(e){if(this.progress+=this.speed,this.progress<1){const t=this.x1+(this.x2-this.x1)*this.progress,o=this.y1+(this.y2-this.y1)*this.progress,n=this.x1+(this.x2-this.x1)*Math.max(0,this.progress-.15),s=this.y1+(this.y2-this.y1)*Math.max(0,this.progress-.15);e.beginPath(),e.moveTo(n,s),e.lineTo(t,o),e.strokeStyle="#ffffff",e.lineWidth=3,e.globalAlpha=.9,e.stroke(),e.beginPath(),e.moveTo(n,s),e.lineTo(t,o),e.strokeStyle=this.color,e.lineWidth=1.5,e.stroke(),e.globalAlpha=1}if(this.progress>=1&&!this.impacted){this.impacted=!0;for(let e=0;e<12;e++){const t=e/12*Math.PI*2+.3*Math.random(),o=3+4*Math.random();this.sparks.push({x:this.x2,y:this.y2,vx:Math.cos(t)*o,vy:Math.sin(t)*o,life:1,size:2+2*Math.random()})}for(let e=0;e<2;e++)this.rings.push({x:this.x2,y:this.y2,radius:5,maxRadius:40+20*e,life:1,speed:3+e})}return e.fillStyle="#cccccc",this.sparks.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.vx*=.92,t.vy*=.92,t.vy+=.1,t.life-=.04;const o=Math.max(0,t.size*t.life);o>0&&(e.globalAlpha=Math.max(0,t.life),e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.x,t.y,.5*o,0,2*Math.PI),e.fill(),e.fillStyle="#cccccc")}),this.rings.forEach(t=>{t.radius+=t.speed,t.life=1-t.radius/t.maxRadius,t.life>0&&(e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI),e.strokeStyle="#ffffff",e.lineWidth=2*t.life,e.globalAlpha=.6*t.life,e.stroke())}),e.globalAlpha=1,this.sparks=this.sparks.filter(e=>e.life>0),this.rings=this.rings.filter(e=>e.life>0),this.sparks.length>0||this.rings.length>0||this.progress<1}}class ParticleTrail{constructor(e,t,o,n,s,a){this.x=e,this.y=t,this.targetX=o,this.targetY=n,this.type=s,this.color=a,this.speed=.08,this.progress=0,this.particles=[]}update(e){this.progress+=this.speed;const t=this.x+(this.targetX-this.x)*this.progress,o=this.y+(this.targetY-this.y)*this.progress;if(this.progress<1)for(let e=0;e<3;e++)this.particles.push({x:t+10*(Math.random()-.5),y:o+10*(Math.random()-.5),vx:2*(Math.random()-.5),vy:2*(Math.random()-.5),life:1,size:4*Math.random()+2});return e.fillStyle=this.color,this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.life-=.04,"fire"===this.type&&(t.y-=1,t.size*=.95),"water"===this.type&&(t.y+=.5),"light"!==this.type||gfxSettings.lowFx||(e.shadowBlur=10,e.shadowColor="#fff"),e.globalAlpha=Math.max(0,t.life),e.beginPath(),e.arc(t.x,t.y,t.size,0,2*Math.PI),e.fill()}),e.globalAlpha=1,e.shadowBlur=0,this.particles=this.particles.filter(e=>e.life>0),this.particles.length>0||this.progress<1}}class EnergyBeam{constructor(e,t,o,n,s,a=!1){this.x1=e,this.y1=t,this.x2=o,this.y2=n,this.color=s,this.isDark=a,this.progress=0,this.speed=.025,this.phase="in",this.sustainTime=0,this.maxSustain=20,this.opacity=0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}update(e){if("in"===this.phase)this.progress+=this.speed,this.opacity=this.easeInOutCubic(Math.min(1,this.progress)),this.progress>=1&&(this.phase="sustain",this.progress=1,this.opacity=1);else if("sustain"===this.phase)this.sustainTime++,this.sustainTime>=this.maxSustain&&(this.phase="out",this.progress=1);else if("out"===this.phase&&(this.progress-=this.speed,this.opacity=this.easeInOutCubic(Math.max(0,this.progress)),this.progress<=0))return!1;const t=this.x2-this.x1,o=this.y2-this.y1,n=Math.sqrt(t*t+o*o),s=Math.atan2(o,t),a=50*this.easeInOutCubic(Math.min(1,"in"===this.phase?this.progress:1));e.save(),e.translate(this.x1,this.y1),e.rotate(s);const i=e.createLinearGradient(0,0,n*this.easeInOutCubic(Math.min(1,"in"===this.phase?this.progress:1)),0);this.isDark?(i.addColorStop(0,"rgba(60,20,80,0.6)"),i.addColorStop(.5,this.color),i.addColorStop(1,"rgba(20,0,40,0.3)")):(i.addColorStop(0,"rgba(255,255,200,0.6)"),i.addColorStop(.5,this.color),i.addColorStop(1,"rgba(255,255,255,0.3)")),e.globalAlpha=.7*this.opacity,e.globalCompositeOperation="lighter",gfxSettings.lowFx||(e.shadowBlur=40,e.shadowColor=this.color);const r=n*this.easeInOutCubic(Math.min(1,"in"===this.phase?this.progress:1));return e.beginPath(),e.moveTo(0,-6),e.lineTo(r,-a/2),e.lineTo(r,a/2),e.lineTo(0,6),e.closePath(),e.fillStyle=i,e.fill(),gfxSettings.lowFx||(e.shadowBlur=60,e.globalAlpha=.4*this.opacity,e.fill()),e.restore(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.shadowBlur=0,!0}}class WaterStream{constructor(e,t,o,n,s){this.x1=e,this.y1=t,this.x2=o,this.y2=n,this.color=s,this.progress=0,this.speed=.06,this.particles=[],this.time=0}update(e){this.progress+=this.speed,this.time+=.1;const t=15*Math.sin(3*this.time),o=this.x1+(this.x2-this.x1)*Math.min(this.progress,1),n=this.y1+(this.y2-this.y1)*Math.min(this.progress,1)+t;if(this.progress<1)for(let e=0;e<4;e++)this.particles.push({x:o+12*(Math.random()-.5),y:n+12*(Math.random()-.5),vx:1.5*(Math.random()-.5),vy:1.5*(Math.random()-.5),life:1,size:6*Math.random()+3,stretch:1.2+.5*Math.random()});return e.fillStyle=this.color,this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.vy+=.1,t.life-=.035,e.globalAlpha=Math.max(0,.8*t.life),e.beginPath(),e.ellipse(t.x,t.y,.6*t.size,t.size*t.stretch,Math.PI/4,0,2*Math.PI),e.fill()}),gfxSettings.lowFx||(e.shadowBlur=8,e.shadowColor="#88ccff",this.particles.slice(-5).forEach(t=>{e.globalAlpha=Math.max(0,.3*t.life),e.beginPath(),e.arc(t.x,t.y,.4*t.size,0,2*Math.PI),e.fill()})),e.globalAlpha=1,e.shadowBlur=0,this.particles=this.particles.filter(e=>e.life>0),this.particles.length>0||this.progress<1}}class RockThrow{constructor(e,t,o,n,s){this.x1=e,this.y1=t,this.x2=o,this.y2=n,this.color=s,this.progress=0,this.speed=.04,this.rocks=[],this.spawned=!1}createRock(){const e=[],t=3+Math.floor(3*Math.random());for(let o=0;o<t;o++){const n=o/t*Math.PI*2,s=8+6*Math.random();e.push({x:Math.cos(n)*s,y:Math.sin(n)*s})}return{vertices:e,rotation:0,rotationSpeed:.3*(Math.random()-.5),offsetX:30*(Math.random()-.5),offsetY:20*(Math.random()-.5),scale:.7+.6*Math.random()}}update(e){if(!this.spawned){for(let e=0;e<3;e++)this.rocks.push(this.createRock());this.spawned=!0}if(this.progress+=this.speed,this.progress>=1)return!1;const t=this.progress,o=-100*Math.sin(t*Math.PI),n=this.x1+(this.x2-this.x1)*t,s=this.y1+(this.y2-this.y1)*t+o;e.fillStyle=this.color,e.strokeStyle="#5a4020",e.lineWidth=2,this.rocks.forEach(t=>{t.rotation+=t.rotationSpeed;const o=n+t.offsetX,a=s+t.offsetY;e.save(),e.translate(o,a),e.rotate(t.rotation),e.scale(t.scale,t.scale),e.beginPath(),e.moveTo(t.vertices[0].x,t.vertices[0].y);for(let o=1;o<t.vertices.length;o++)e.lineTo(t.vertices[o].x,t.vertices[o].y);e.closePath(),e.fill(),e.stroke(),e.restore()}),e.globalAlpha=.4;for(let t=0;t<3;t++){const t=n+20*(Math.random()-.5),o=s+10+10*Math.random();e.beginPath(),e.arc(t,o,2+3*Math.random(),0,2*Math.PI),e.fillStyle="#8b7355",e.fill()}return e.globalAlpha=1,!0}}class PhysicalSlash{constructor(e,t,o,n,s){this.x1=e,this.y1=t,this.x2=o,this.y2=n,this.color=s,this.progress=0,this.speed=.25,this.speedLines=[]}update(e){this.progress+=this.speed;const t=this.x2-this.x1,o=this.y2-this.y1,n=Math.atan2(o,t),s=(Math.sqrt(t*t+o*o),Math.min(this.progress,1)),a=this.x1+t*s,i=this.y1+o*s;if(this.progress<1&&this.speedLines.push({x:a-20*Math.cos(n),y:i-20*Math.sin(n),length:30+20*Math.random(),offset:30*(Math.random()-.5),life:1}),e.save(),e.strokeStyle=this.color,e.lineWidth=2,this.speedLines.forEach(t=>{t.life-=.1,e.globalAlpha=Math.max(0,.6*t.life),e.beginPath();const o=-Math.sin(n)*t.offset,s=Math.cos(n)*t.offset;e.moveTo(t.x+o,t.y+s),e.lineTo(t.x+o-Math.cos(n)*t.length,t.y+s-Math.sin(n)*t.length),e.stroke()}),this.progress<1.2){const t=this.progress>1?5*(1.2-this.progress):1;e.globalAlpha=t,e.translate(a,i),e.rotate(n+Math.PI/4),e.beginPath(),e.arc(0,0,25,.3*-Math.PI,.3*Math.PI),e.lineWidth=4,e.strokeStyle="#ffffff",e.stroke(),e.beginPath(),e.arc(0,0,25,.3*-Math.PI,.3*Math.PI),e.lineWidth=8,e.strokeStyle=this.color,e.globalAlpha=.5*t,e.stroke()}return e.restore(),e.globalAlpha=1,this.speedLines=this.speedLines.filter(e=>e.life>0),this.progress<1.2||this.speedLines.length>0}}class WindGust{constructor(e,t,o,n,s){this.x1=e,this.y1=t,this.x2=o,this.y2=n,this.color=s,this.streaks=[],this.spawned=!1,this.time=0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}update(e){if(this.time++,!this.spawned){for(let e=0;e<10;e++)this.streaks.push({delay:4*e,progress:0,yOffset:10*(e-4.5),opacity:.3+.2*Math.random(),width:4+4*Math.random()});this.spawned=!0}const t=this.x2-this.x1,o=this.y2-this.y1,n=Math.atan2(o,t);e.save(),e.strokeStyle=this.color,e.lineCap="round",gfxSettings.lowFx||(e.shadowBlur=30,e.shadowColor=this.color);let s=!0;return this.streaks.forEach(a=>{if(this.time<a.delay)return void(s=!1);a.progress+=.03,a.progress<1.5&&(s=!1);const i=Math.min(a.progress,1),r=this.easeInOutCubic(i);let l;l=a.progress<.3?this.easeInOutCubic(a.progress/.3):a.progress>1?this.easeInOutCubic(Math.max(0,(1.5-a.progress)/.5)):1,e.globalAlpha=a.opacity*l,e.lineWidth=a.width;const c=-Math.sin(n)*a.yOffset,d=Math.cos(n)*a.yOffset,p=this.x1+c+t*(r-.15),f=this.y1+d+o*(r-.15),u=this.x1+c+t*r,h=this.y1+d+o*r;e.beginPath(),e.moveTo(p,f),e.lineTo(u,h),e.stroke()}),e.restore(),e.globalAlpha=1,!s}}function playElementalEffect(e,t,o){if(!fxCtx||!e||!t)return;const n=e.getBoundingClientRect(),s=t.getBoundingClientRect(),a=n.left+n.width/2,i=n.top+n.height/2,r=s.left+s.width/2,l=s.top+s.height/2;let c="physical",d="#a0a0a0";if(o&&void 0!==o.elem){const e={[E.FIRE]:{type:"fire",color:"#ff6633"},[E.WATER]:{type:"water",color:"#4d99ff"},[E.LIGHTNING]:{type:"lightning",color:"#ffff4d"},[E.EARTH]:{type:"earth",color:"#996633"},[E.POISON]:{type:"poison",color:"#7ee04d"},[E.LIGHT]:{type:"light",color:"#ffffa0"},[E.DARK]:{type:"dark",color:"#9966cc"},[E.PHYS]:{type:"physical",color:"#a0a0a0"}};e[o.elem]&&(c=e[o.elem].type,d=e[o.elem].color)}switch(c){case"lightning":addFxAnimation(new LightningBolt(a,i,r,l,"#ffffff")),setTimeout(()=>addFxAnimation(new LightningBolt(a,i,r,l,d)),RHYTHM.EIGHTH);break;case"light":addFxAnimation(new EnergyBeam(a,i,r,l,d,!1));break;case"dark":addFxAnimation(new EnergyBeam(a,i,r,l,d,!0));break;case"water":addFxAnimation(new WaterStream(a,i,r,l,d));break;case"earth":addFxAnimation(new RockThrow(a,i,r,l,d));break;case"poison":addFxAnimation(new WindGust(a,i,r,l,d));break;case"fire":addFxAnimation(new ParticleTrail(a,i,r,l,c,d));break;case"physical":addFxAnimation(new MetalClash(a,i,r,l,d))}}const HERO_XP_THRESHOLDS=[0,100,250,450,700,1e3,1400,1900,2500,3200,4e3,5e3,6200,7600,9200,11e3,13e3,15500,18500,22e3,26e3,30500,35500,41e3,47e3,53500,60500,68e3,76e3,84500,93500,103e3,113e3,123500,134500,146e3,158e3,170500,183500,197e3,211e3,225500,240500,256e3,272e3,288500,305500,323e3,341e3,359500],HERO_MAX_LEVEL=HERO_XP_THRESHOLDS.length;function calcRunXP(e,t){return 10+15*e+(t?50:0)}function getHeroLevel(e){if(!PStats.heroXP)return 1;const t=PStats.heroXP[e]||0;for(let e=HERO_XP_THRESHOLDS.length-1;e>=0;e--)if(t>=HERO_XP_THRESHOLDS[e])return e+1;return 1}function getXPForNextLevel(e){const t=getHeroLevel(e);return t>=HERO_MAX_LEVEL?null:HERO_XP_THRESHOLDS[t]}function getXPProgress(e){if(!PStats.heroXP)return 0;const t=PStats.heroXP[e]||0,o=getHeroLevel(e);if(o>=HERO_MAX_LEVEL)return 1;const n=HERO_XP_THRESHOLDS[o-1];return(t-n)/(HERO_XP_THRESHOLDS[o]-n)}function awardHeroXP(e,t){PStats.heroXP||(PStats.heroXP={}),PStats.heroSkillPoints||(PStats.heroSkillPoints={}),PStats.heroLevel||(PStats.heroLevel={});const o=getHeroLevel(e);PStats.heroXP[e]=(PStats.heroXP[e]||0)+t;const n=getHeroLevel(e),s=n-o;return s>0&&(PStats.heroSkillPoints[e]=(PStats.heroSkillPoints[e]||0)+s),PStats.heroLevel[e]=n,saveStats(),{oldLevel:o,newLevel:n,levelsGained:s,totalXP:PStats.heroXP[e]}}function initHeroSkills(e){PStats.heroSkills||(PStats.heroSkills={}),PStats.heroXP||(PStats.heroXP={}),PStats.heroLevel||(PStats.heroLevel={}),PStats.heroSkillPoints||(PStats.heroSkillPoints={}),PStats.heroSkills[e]||(PStats.heroSkills[e]={}),PStats.heroXP[e]||(PStats.heroXP[e]=0),PStats.heroLevel[e]||(PStats.heroLevel[e]=1),PStats.heroSkillPoints[e]||(PStats.heroSkillPoints[e]=0)}function getSkillPoints(e,t){return initHeroSkills(e),PStats.heroSkills[e][t]||0}function isSkillUnlocked(e,t){const o=SKILL_TREES[e];if(!o)return!1;const n=o.nodes.find(e=>e.id===t);if(!n)return!1;if(n.requires)for(const t of n.requires){if(getSkillPoints(e,t.id)<t.points)return!1}return!0}function allocateSkillPoint(e,t){initHeroSkills(e);const o=SKILL_TREES[e];if(!o)return!1;const n=o.nodes.find(e=>e.id===t);if(!n)return!1;const s=getSkillPoints(e,t),a=PStats.heroSkillPoints[e]||0;return!(a<=0)&&(!(s>=n.maxPoints)&&(!!isSkillUnlocked(e,t)&&(PStats.heroSkills[e][t]=s+1,PStats.heroSkillPoints[e]=a-1,saveStats(),updateSkillBadges(),!0)))}function respecHeroSkills(e){initHeroSkills(e);let t=0;for(const o in PStats.heroSkills[e])t+=PStats.heroSkills[e][o];return PStats.heroSkills[e]={},PStats.heroSkillPoints[e]=(PStats.heroSkillPoints[e]||0)+t,saveStats(),updateSkillBadges(),t}function hasUnspentSkillPoints(){if(!PStats.heroSkillPoints)return!1;const e=["Graham Moor","Quivera","Belle Lettres","Alexandria Constanza","Caesura","Reed"];for(const t of e){if((PStats.heroSkillPoints[t]||0)>0)return!0}return!1}function updateSkillBadges(){const e=hasUnspentSkillPoints(),t=document.getElementById("skill-points-badge"),o=document.getElementById("skill-points-badge-select");t&&(t.style.display=e?"block":"none"),o&&(o.style.display=e?"block":"none")}function getSkillBonus(e,t){const o=SKILL_TREES[e];if(!o)return 0;const n=o.nodes.find(e=>e.id===t);if(!n)return 0;const s=getSkillPoints(e,t);return 0===s?0:n.bonusPerPoint*s}function getTotalSkillBonus(e,t,o=null){const n=SKILL_TREES[e];if(!n)return 0;let s=0;for(const a of n.nodes)if(a.bonusType===t){if(null!==o&&void 0!==a.element&&a.element!==o)continue;const t=getSkillPoints(e,a.id);t>0&&(s+=a.bonusPerPoint*t)}return s}function getHeroSkillBonuses(e){const t=SKILL_TREES[e];if(!t)return{};const o=DIFF_SKILL_MULT[S.difficulty||0],n={};for(const s of t.nodes){const t=getSkillPoints(e,s.id);if(t>0){const e=void 0!==s.element?`${s.bonusType}_${s.element}`:s.bonusType,a=s.bonusPerPoint*t,i="capstone"===s.type?a:a*o;n[e]=(n[e]||0)+i}}return n}function hasCapstone(e){const t={"Graham Moor":"gm",Quivera:"qv","Belle Lettres":"bl","Alexandria Constanza":"ac",Caesura:"cs",Reed:"rd"}[e];return!!t&&getSkillPoints(e,`${t}_capstone`)>=1}function createGrahamTree(){const e="gm";return{capstone:{id:"cross_the_ts",name:"Cross the T's",desc:"Slash weapons: REREAD √ó1"},nodes:[{id:`${e}_recruit`,name:"Weapon Training",type:"minor",maxPoints:1,row:0,col:2,desc:"+1 AP to Weapon slot",bonusPerPoint:1,bonusType:"weaponAP",requires:[]},{id:`${e}_aggression`,name:"Strength I",type:"minor",maxPoints:3,row:1,col:1,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_recruit`,points:1}]},{id:`${e}_fortitude`,name:"Endurance I",type:"minor",maxPoints:3,row:1,col:3,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_recruit`,points:1}]},{id:`${e}_fury1`,name:"Strength II",type:"minor",maxPoints:3,row:2,col:0,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_aggression`,points:2}]},{id:`${e}_precision`,name:"Precision I",type:"minor",maxPoints:3,row:2,col:2,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_aggression`,points:2},{id:`${e}_fortitude`,points:2}]},{id:`${e}_stone1`,name:"Endurance II",type:"minor",maxPoints:3,row:2,col:4,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_fortitude`,points:2}]},{id:`${e}_battlecry`,name:"Boss Slayer",type:"major",maxPoints:2,row:3,col:0,desc:"+3 AP vs Boss enemies per point",bonusPerPoint:3,bonusType:"bossAP",requires:[{id:`${e}_fury1`,points:2}]},{id:`${e}_veteran`,name:"Veteran",type:"minor",maxPoints:3,row:3,col:2,desc:"+3 Starting Gold per point",bonusPerPoint:3,bonusType:"startGold",requires:[{id:`${e}_precision`,points:2}]},{id:`${e}_earthshaker`,name:"Earth Mastery",type:"major",maxPoints:2,row:3,col:4,desc:"+2 AP per Earth word per point",bonusPerPoint:2,bonusType:"earthAP",requires:[{id:`${e}_stone1`,points:2}]},{id:`${e}_fury2`,name:"Strength III",type:"minor",maxPoints:3,row:4,col:0,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_battlecry`,points:1}]},{id:`${e}_edge1`,name:"Precision II",type:"minor",maxPoints:3,row:4,col:1,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_battlecry`,points:1}]},{id:`${e}_gilded`,name:"Gilded",type:"minor",maxPoints:3,row:4,col:2,desc:"+5 Starting Gold per point",bonusPerPoint:5,bonusType:"startGold",requires:[{id:`${e}_veteran`,points:2}]},{id:`${e}_edge2`,name:"Precision III",type:"minor",maxPoints:3,row:4,col:3,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_earthshaker`,points:1}]},{id:`${e}_stone2`,name:"Endurance III",type:"minor",maxPoints:3,row:4,col:4,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_earthshaker`,points:1}]},{id:`${e}_wrath`,name:"Gem Focus I",type:"minor",maxPoints:3,row:5,col:0,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_fury2`,points:2}]},{id:`${e}_sharp`,name:"Strength IV",type:"minor",maxPoints:3,row:5,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_gilded`,points:2}]},{id:`${e}_mountain`,name:"Gem Focus II",type:"minor",maxPoints:3,row:5,col:4,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_stone2`,points:2}]},{id:`${e}_bladework`,name:"Slash Mastery",type:"major",maxPoints:1,row:6,col:1,desc:"+3 AP with Slash weapons",bonusPerPoint:3,bonusType:"slashAP",requires:[{id:`${e}_wrath`,points:2},{id:`${e}_sharp`,points:2}]},{id:`${e}_titan`,name:"Physical Mastery",type:"major",maxPoints:1,row:6,col:3,desc:"+3 AP with Physical words",bonusPerPoint:3,bonusType:"physAP",requires:[{id:`${e}_sharp`,points:2},{id:`${e}_mountain`,points:2}]},{id:`${e}_capstone`,name:"Duty Bound",type:"capstone",maxPoints:1,row:7,col:2,desc:"Slash weapons: REREAD √ó1",bonusPerPoint:1,bonusType:"capstone",requires:[{id:`${e}_bladework`,points:1},{id:`${e}_titan`,points:1}]}]}}function createQuiveraTree(){const e="qv";return{capstone:{id:"last_arrow",name:"Last Arrow",desc:"Last word in forge triggers twice"},nodes:[{id:`${e}_scout`,name:"Tracking",type:"minor",maxPoints:1,row:0,col:2,desc:"+1 AP to Noun slot",bonusPerPoint:1,bonusType:"nounAP",requires:[]},{id:`${e}_charge`,name:"Agility I",type:"minor",maxPoints:3,row:1,col:1,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_scout`,points:1}]},{id:`${e}_grounded`,name:"Focus I",type:"minor",maxPoints:3,row:1,col:3,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_scout`,points:1}]},{id:`${e}_volt1`,name:"Agility II",type:"minor",maxPoints:3,row:2,col:0,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_charge`,points:2}]},{id:`${e}_focus`,name:"Aim I",type:"minor",maxPoints:3,row:2,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_charge`,points:2},{id:`${e}_grounded`,points:2}]},{id:`${e}_stone1`,name:"Focus II",type:"minor",maxPoints:3,row:2,col:4,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_grounded`,points:2}]},{id:`${e}_stormshot`,name:"Lightning Mastery",type:"major",maxPoints:2,row:3,col:0,desc:"+2 AP per Lightning word per point",bonusPerPoint:2,bonusType:"lightningAP",requires:[{id:`${e}_volt1`,points:2}]},{id:`${e}_huntress`,name:"Resourceful",type:"minor",maxPoints:3,row:3,col:2,desc:"+3 Starting Gold per point",bonusPerPoint:3,bonusType:"startGold",requires:[{id:`${e}_focus`,points:2}]},{id:`${e}_terraform`,name:"Earth Mastery",type:"major",maxPoints:2,row:3,col:4,desc:"+2 AP per Earth word per point",bonusPerPoint:2,bonusType:"earthAP",requires:[{id:`${e}_stone1`,points:2}]},{id:`${e}_volt2`,name:"Agility III",type:"minor",maxPoints:3,row:4,col:0,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_stormshot`,points:1}]},{id:`${e}_aim1`,name:"Aim II",type:"minor",maxPoints:3,row:4,col:1,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_stormshot`,points:1}]},{id:`${e}_gilded`,name:"Gilded",type:"minor",maxPoints:3,row:4,col:2,desc:"+5 Starting Gold per point",bonusPerPoint:5,bonusType:"startGold",requires:[{id:`${e}_huntress`,points:2}]},{id:`${e}_aim2`,name:"Aim III",type:"minor",maxPoints:3,row:4,col:3,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_terraform`,points:1}]},{id:`${e}_stone2`,name:"Focus III",type:"minor",maxPoints:3,row:4,col:4,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_terraform`,points:1}]},{id:`${e}_thunder`,name:"Gem Focus I",type:"minor",maxPoints:3,row:5,col:0,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_volt2`,points:2}]},{id:`${e}_precise`,name:"Aim IV",type:"minor",maxPoints:3,row:5,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_gilded`,points:2}]},{id:`${e}_mountain`,name:"Gem Focus II",type:"minor",maxPoints:3,row:5,col:4,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_stone2`,points:2}]},{id:`${e}_marksman`,name:"Pierce Mastery",type:"major",maxPoints:1,row:6,col:1,desc:"+3 AP with Pierce weapons",bonusPerPoint:3,bonusType:"pierceAP",requires:[{id:`${e}_thunder`,points:2},{id:`${e}_precise`,points:2}]},{id:`${e}_trapper`,name:"Weakness Exploit",type:"major",maxPoints:1,row:6,col:3,desc:"+3 AP when hitting weakness",bonusPerPoint:3,bonusType:"weaknessAP",requires:[{id:`${e}_precise`,points:2},{id:`${e}_mountain`,points:2}]},{id:`${e}_capstone`,name:"Last Arrow",type:"capstone",maxPoints:1,row:7,col:2,desc:"Last word triggers twice",bonusPerPoint:1,bonusType:"capstone",requires:[{id:`${e}_marksman`,points:1},{id:`${e}_trapper`,points:1}]}]}}function createBelleTree(){const e="bl";return{capstone:{id:"knowledge_eternal",name:"Knowledge Eternal",desc:"All words: REREAD √ó1"},nodes:[{id:`${e}_student`,name:"Bookworm",type:"minor",maxPoints:1,row:0,col:2,desc:"+1 AP to Adjective slot",bonusPerPoint:1,bonusType:"adjAP",requires:[]},{id:`${e}_radiant`,name:"Insight I",type:"minor",maxPoints:3,row:1,col:1,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_student`,points:1}]},{id:`${e}_shadow`,name:"Wisdom I",type:"minor",maxPoints:3,row:1,col:3,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_student`,points:1}]},{id:`${e}_glow1`,name:"Insight II",type:"minor",maxPoints:3,row:2,col:0,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_radiant`,points:2}]},{id:`${e}_channel`,name:"Spell I",type:"minor",maxPoints:3,row:2,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_radiant`,points:2},{id:`${e}_shadow`,points:2}]},{id:`${e}_shade1`,name:"Wisdom II",type:"minor",maxPoints:3,row:2,col:4,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_shadow`,points:2}]},{id:`${e}_lightmaster`,name:"Light Mastery",type:"major",maxPoints:2,row:3,col:0,desc:"+2 AP per Light word per point",bonusPerPoint:2,bonusType:"lightAP",requires:[{id:`${e}_glow1`,points:2}]},{id:`${e}_scholar`,name:"Scholar",type:"minor",maxPoints:3,row:3,col:2,desc:"+3 Starting Gold per point",bonusPerPoint:3,bonusType:"startGold",requires:[{id:`${e}_channel`,points:2}]},{id:`${e}_darkmaster`,name:"Dark Mastery",type:"major",maxPoints:2,row:3,col:4,desc:"+2 AP per Dark word per point",bonusPerPoint:2,bonusType:"darkAP",requires:[{id:`${e}_shade1`,points:2}]},{id:`${e}_glow2`,name:"Insight III",type:"minor",maxPoints:3,row:4,col:0,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_lightmaster`,points:1}]},{id:`${e}_spell1`,name:"Spell II",type:"minor",maxPoints:3,row:4,col:1,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_lightmaster`,points:1}]},{id:`${e}_gilded`,name:"Gilded",type:"minor",maxPoints:3,row:4,col:2,desc:"+5 Starting Gold per point",bonusPerPoint:5,bonusType:"startGold",requires:[{id:`${e}_scholar`,points:2}]},{id:`${e}_spell2`,name:"Spell III",type:"minor",maxPoints:3,row:4,col:3,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_darkmaster`,points:1}]},{id:`${e}_shade2`,name:"Wisdom III",type:"minor",maxPoints:3,row:4,col:4,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_darkmaster`,points:1}]},{id:`${e}_luminous`,name:"Gem Focus I",type:"minor",maxPoints:3,row:5,col:0,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_glow2`,points:2}]},{id:`${e}_arcane`,name:"Spell IV",type:"minor",maxPoints:3,row:5,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_gilded`,points:2}]},{id:`${e}_void`,name:"Gem Focus II",type:"minor",maxPoints:3,row:5,col:4,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_shade2`,points:2}]},{id:`${e}_arcana`,name:"Magic Mastery",type:"major",maxPoints:1,row:6,col:1,desc:"+3 AP with Magic weapons",bonusPerPoint:3,bonusType:"magicAP",requires:[{id:`${e}_luminous`,points:2},{id:`${e}_arcane`,points:2}]},{id:`${e}_duality`,name:"Light/Dark Duality",type:"major",maxPoints:1,row:6,col:3,desc:"+3 AP if both Light and Dark",bonusPerPoint:3,bonusType:"lightDarkDualAP",requires:[{id:`${e}_arcane`,points:2},{id:`${e}_void`,points:2}]},{id:`${e}_capstone`,name:"Knowledge Eternal",type:"capstone",maxPoints:1,row:7,col:2,desc:"All words: REREAD √ó1",bonusPerPoint:1,bonusType:"capstone",requires:[{id:`${e}_arcana`,points:1},{id:`${e}_duality`,points:1}]}]}}function createAlexandriaTree(){const e="ac";return{capstone:{id:"sacred_flame",name:"Sacred Flame",desc:"Fire/Light are interchangeable elements"},nodes:[{id:`${e}_oath`,name:"Devotion",type:"minor",maxPoints:1,row:0,col:2,desc:"+1 AP to Noun slot",bonusPerPoint:1,bonusType:"nounAP",requires:[]},{id:`${e}_blessed`,name:"Faith I",type:"minor",maxPoints:3,row:1,col:1,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_oath`,points:1}]},{id:`${e}_valiant`,name:"Valor I",type:"minor",maxPoints:3,row:1,col:3,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_oath`,points:1}]},{id:`${e}_halo1`,name:"Faith II",type:"minor",maxPoints:3,row:2,col:0,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_blessed`,points:2}]},{id:`${e}_judgment`,name:"Zeal I",type:"minor",maxPoints:3,row:2,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_blessed`,points:2},{id:`${e}_valiant`,points:2}]},{id:`${e}_might1`,name:"Valor II",type:"minor",maxPoints:3,row:2,col:4,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_valiant`,points:2}]},{id:`${e}_holylight`,name:"Light Mastery",type:"major",maxPoints:2,row:3,col:0,desc:"+2 AP per Light word per point",bonusPerPoint:2,bonusType:"lightAP",requires:[{id:`${e}_halo1`,points:2}]},{id:`${e}_devout`,name:"Devout",type:"minor",maxPoints:3,row:3,col:2,desc:"+3 Starting Gold per point",bonusPerPoint:3,bonusType:"startGold",requires:[{id:`${e}_judgment`,points:2}]},{id:`${e}_righteous`,name:"Physical Mastery",type:"major",maxPoints:2,row:3,col:4,desc:"+2 AP per Physical word per point",bonusPerPoint:2,bonusType:"physAP",requires:[{id:`${e}_might1`,points:2}]},{id:`${e}_halo2`,name:"Faith III",type:"minor",maxPoints:3,row:4,col:0,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_holylight`,points:1}]},{id:`${e}_smite1`,name:"Zeal II",type:"minor",maxPoints:3,row:4,col:1,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_holylight`,points:1}]},{id:`${e}_gilded`,name:"Gilded",type:"minor",maxPoints:3,row:4,col:2,desc:"+5 Starting Gold per point",bonusPerPoint:5,bonusType:"startGold",requires:[{id:`${e}_devout`,points:2}]},{id:`${e}_smite2`,name:"Zeal III",type:"minor",maxPoints:3,row:4,col:3,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_righteous`,points:1}]},{id:`${e}_might2`,name:"Valor III",type:"minor",maxPoints:3,row:4,col:4,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_righteous`,points:1}]},{id:`${e}_divine`,name:"Gem Focus I",type:"minor",maxPoints:3,row:5,col:0,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_halo2`,points:2}]},{id:`${e}_zeal`,name:"Zeal IV",type:"minor",maxPoints:3,row:5,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_gilded`,points:2}]},{id:`${e}_fervor`,name:"Gem Focus II",type:"minor",maxPoints:3,row:5,col:4,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_might2`,points:2}]},{id:`${e}_crusader`,name:"Blunt Mastery",type:"major",maxPoints:1,row:6,col:1,desc:"+3 AP with Blunt weapons",bonusPerPoint:3,bonusType:"bluntAP",requires:[{id:`${e}_divine`,points:2},{id:`${e}_zeal`,points:2}]},{id:`${e}_sermon`,name:"Weakness Exploit",type:"major",maxPoints:1,row:6,col:3,desc:"+2 AP per weakness hit",bonusPerPoint:2,bonusType:"weaknessAP",requires:[{id:`${e}_zeal`,points:2},{id:`${e}_fervor`,points:2}]},{id:`${e}_capstone`,name:"Sacred Flame",type:"capstone",maxPoints:1,row:7,col:2,desc:"Fire/Light interchangeable",bonusPerPoint:1,bonusType:"capstone",requires:[{id:`${e}_crusader`,points:1},{id:`${e}_sermon`,points:1}]}]}}function createCaesuraTree(){const e="cs";return{capstone:{id:"final_silence",name:"Final Silence",desc:"Words after an empty slot: √ó2"},nodes:[{id:`${e}_whisper`,name:"Stealth",type:"minor",maxPoints:1,row:0,col:2,desc:"+1 AP to Adjective slot",bonusPerPoint:1,bonusType:"adjAP",requires:[]},{id:`${e}_shadow`,name:"Cunning I",type:"minor",maxPoints:3,row:1,col:1,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_whisper`,points:1}]},{id:`${e}_corrupt`,name:"Malice I",type:"minor",maxPoints:3,row:1,col:3,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_whisper`,points:1}]},{id:`${e}_shade1`,name:"Cunning II",type:"minor",maxPoints:3,row:2,col:0,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_shadow`,points:2}]},{id:`${e}_lethal`,name:"Lethality I",type:"minor",maxPoints:3,row:2,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_shadow`,points:2},{id:`${e}_corrupt`,points:2}]},{id:`${e}_toxin1`,name:"Malice II",type:"minor",maxPoints:3,row:2,col:4,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_corrupt`,points:2}]},{id:`${e}_nightshade`,name:"Dark Mastery",type:"major",maxPoints:2,row:3,col:0,desc:"+2 AP per Dark word per point",bonusPerPoint:2,bonusType:"darkAP",requires:[{id:`${e}_shade1`,points:2}]},{id:`${e}_silence`,name:"Silent",type:"minor",maxPoints:3,row:3,col:2,desc:"+3 Starting Gold per point",bonusPerPoint:3,bonusType:"startGold",requires:[{id:`${e}_lethal`,points:2}]},{id:`${e}_venom`,name:"Poison Mastery",type:"major",maxPoints:2,row:3,col:4,desc:"+2 AP per Poison word per point",bonusPerPoint:2,bonusType:"poisonAP",requires:[{id:`${e}_toxin1`,points:2}]},{id:`${e}_shade2`,name:"Cunning III",type:"minor",maxPoints:3,row:4,col:0,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_nightshade`,points:1}]},{id:`${e}_stab1`,name:"Lethality II",type:"minor",maxPoints:3,row:4,col:1,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_nightshade`,points:1}]},{id:`${e}_gilded`,name:"Gilded",type:"minor",maxPoints:3,row:4,col:2,desc:"+5 Starting Gold per point",bonusPerPoint:5,bonusType:"startGold",requires:[{id:`${e}_silence`,points:2}]},{id:`${e}_stab2`,name:"Lethality III",type:"minor",maxPoints:3,row:4,col:3,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_venom`,points:1}]},{id:`${e}_toxin2`,name:"Malice III",type:"minor",maxPoints:3,row:4,col:4,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_venom`,points:1}]},{id:`${e}_void`,name:"Gem Focus I",type:"minor",maxPoints:3,row:5,col:0,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_shade2`,points:2}]},{id:`${e}_precise`,name:"Lethality IV",type:"minor",maxPoints:3,row:5,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_gilded`,points:2}]},{id:`${e}_blight`,name:"Gem Focus II",type:"minor",maxPoints:3,row:5,col:4,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_toxin2`,points:2}]},{id:`${e}_assassinate`,name:"Pierce Mastery",type:"major",maxPoints:1,row:6,col:1,desc:"+3 AP with Pierce weapons",bonusPerPoint:3,bonusType:"pierceAP",requires:[{id:`${e}_void`,points:2},{id:`${e}_precise`,points:2}]},{id:`${e}_execute`,name:"Execute",type:"major",maxPoints:1,row:6,col:3,desc:"+5 AP vs low HP enemies",bonusPerPoint:5,bonusType:"executeAP",requires:[{id:`${e}_precise`,points:2},{id:`${e}_blight`,points:2}]},{id:`${e}_capstone`,name:"Final Silence",type:"capstone",maxPoints:1,row:7,col:2,desc:"Words after empty slot: √ó2",bonusPerPoint:1,bonusType:"capstone",requires:[{id:`${e}_assassinate`,points:1},{id:`${e}_execute`,points:1}]}]}}function createReedTree(){const e="rd";return{capstone:{id:"one_with_nature",name:"One With Nature",desc:"Earth words buff Water +50%, vice versa"},nodes:[{id:`${e}_seedling`,name:"Growth",type:"minor",maxPoints:1,row:0,col:2,desc:"+1 AP to Noun slot",bonusPerPoint:1,bonusType:"nounAP",requires:[]},{id:`${e}_ancient`,name:"Nature I",type:"minor",maxPoints:3,row:1,col:1,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_seedling`,points:1}]},{id:`${e}_flowing`,name:"Flow I",type:"minor",maxPoints:3,row:1,col:3,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_seedling`,points:1}]},{id:`${e}_root1`,name:"Nature II",type:"minor",maxPoints:3,row:2,col:0,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_ancient`,points:2}]},{id:`${e}_primal`,name:"Primal I",type:"minor",maxPoints:3,row:2,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_ancient`,points:2},{id:`${e}_flowing`,points:2}]},{id:`${e}_tide1`,name:"Flow II",type:"minor",maxPoints:3,row:2,col:4,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_flowing`,points:2}]},{id:`${e}_terraform`,name:"Earth Mastery",type:"major",maxPoints:2,row:3,col:0,desc:"+2 AP per Earth word per point",bonusPerPoint:2,bonusType:"earthAP",requires:[{id:`${e}_root1`,points:2}]},{id:`${e}_guardian`,name:"Guardian",type:"minor",maxPoints:3,row:3,col:2,desc:"+3 Starting Gold per point",bonusPerPoint:3,bonusType:"startGold",requires:[{id:`${e}_primal`,points:2}]},{id:`${e}_deluge`,name:"Water Mastery",type:"major",maxPoints:2,row:3,col:4,desc:"+2 AP per Water word per point",bonusPerPoint:2,bonusType:"waterAP",requires:[{id:`${e}_tide1`,points:2}]},{id:`${e}_root2`,name:"Nature III",type:"minor",maxPoints:3,row:4,col:0,desc:"+0.5 AP to Noun slot per point",bonusPerPoint:.5,bonusType:"nounAP",requires:[{id:`${e}_terraform`,points:1}]},{id:`${e}_thorn1`,name:"Primal II",type:"minor",maxPoints:3,row:4,col:1,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_terraform`,points:1}]},{id:`${e}_gilded`,name:"Gilded",type:"minor",maxPoints:3,row:4,col:2,desc:"+5 Starting Gold per point",bonusPerPoint:5,bonusType:"startGold",requires:[{id:`${e}_guardian`,points:2}]},{id:`${e}_thorn2`,name:"Primal III",type:"minor",maxPoints:3,row:4,col:3,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_deluge`,points:1}]},{id:`${e}_tide2`,name:"Flow III",type:"minor",maxPoints:3,row:4,col:4,desc:"+0.5 AP to Adjective slot per point",bonusPerPoint:.5,bonusType:"adjAP",requires:[{id:`${e}_deluge`,points:1}]},{id:`${e}_mountain`,name:"Gem Focus I",type:"minor",maxPoints:3,row:5,col:0,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_root2`,points:2}]},{id:`${e}_wild`,name:"Primal IV",type:"minor",maxPoints:3,row:5,col:2,desc:"+0.5 AP to Weapon slot per point",bonusPerPoint:.5,bonusType:"weaponAP",requires:[{id:`${e}_gilded`,points:2}]},{id:`${e}_ocean`,name:"Gem Focus II",type:"minor",maxPoints:3,row:5,col:4,desc:"+0.5 AP to Gem slot per point",bonusPerPoint:.5,bonusType:"gemAP",requires:[{id:`${e}_tide2`,points:2}]},{id:`${e}_wildgrowth`,name:"Blunt Mastery",type:"major",maxPoints:1,row:6,col:1,desc:"+3 AP with Blunt weapons",bonusPerPoint:3,bonusType:"bluntAP",requires:[{id:`${e}_mountain`,points:2},{id:`${e}_wild`,points:2}]},{id:`${e}_harmony`,name:"Earth/Water Duality",type:"major",maxPoints:1,row:6,col:3,desc:"+3 AP if both Earth and Water",bonusPerPoint:3,bonusType:"dualAP",requires:[{id:`${e}_wild`,points:2},{id:`${e}_ocean`,points:2}]},{id:`${e}_capstone`,name:"One With Nature",type:"capstone",maxPoints:1,row:7,col:2,desc:"Earth/Water buff each other +50%",bonusPerPoint:1,bonusType:"capstone",requires:[{id:`${e}_wildgrowth`,points:1},{id:`${e}_harmony`,points:1}]}]}}const SKILL_TREES={"Graham Moor":createGrahamTree(),Quivera:createQuiveraTree(),"Belle Lettres":createBelleTree(),"Alexandria Constanza":createAlexandriaTree(),Caesura:createCaesuraTree(),Reed:createReedTree()},HEROES=[{id:"warrior",name:"Graham Moor",str:[E.PHYS,E.EARTH],weak:[E.POISON,E.DARK],good:"slash",bad:"magic",desc:"Captain of the Guard. Professional, precise. You've armed him for years‚Äîhe trusts your craft.",dialogue:["Wordsmith. You know the drill.","Sloppy grammar gets soldiers killed."],victoryDialogue:"Job's done. Same as always. Reliable.",defeatDialogue:"I failed them. I failed... everyone.",runStartDialogue:"Wordsmith. Let's write some wrongs.",chapterDialogue:"One chapter down. But the book isn't finished.",shopDialogue:["Restock. Regroup. We move at dawn.","Gold well spent is lives saved.","Don't waste my time. Or the kingdom's coin.","The armory awaits. Choose wisely.","Every tool has a purpose. Find yours.","...Your selection. Not mine.","The Guard trained me to prepare. So prepare.","I've seen soldiers fall for want of a decent blade.","Quivera always said I shop like I fight. Efficiently."],passive:{name:"Intimidating",desc:"Enemy's HP decreased by 20%",phase:"ENEMY_SETUP",apply:e=>(e.enemy.hp=Math.round(.8*e.enemy.hp),{message:"Intimidating: -20% Enemy HP"})}},{id:"ranger",name:"Quivera",str:[E.LIGHTNING,E.EARTH],weak:[E.WATER,E.DARK],good:"pierce",bad:"blunt",desc:"Ex-Guard turned vigilante bard. You worked together before she left Verbia. Good to reunite.",dialogue:["Just like old times, Wordsmith.","Every battle has a tempo. Find it."],victoryDialogue:"Still got it. Glad our paths crossed again.",defeatDialogue:"The song ends here. But the melody... it continues without me.",runStartDialogue:"The stage is set. One, two, three... begin.",chapterDialogue:"The tempo shifts. A new movement begins.",shopDialogue:["A brief rest. One, two, three... ready.","The merchants here still know my name. Good.","Every arrow counts. Choose wisely.","I've traveled far. These wares are familiar.","Stock up. The rhythm waits for no one.","Four beats to decide. Make them count.","Beyond the Margin, shops like this saved my life. Twice.","Graham would overthink this. I trust my instincts.","The tempo of commerce. Quick, decisive, done."],passive:{name:"Resourceful",desc:"Draw +1 T2 Word every round",phase:"SHOP_ENTRY",apply:e=>{if(e.state.inv.filter(e=>!e.hiddenInBank).length<24){const t=WORDS.filter(e=>e.rarity===T.T1&&!e.hiddenInBank);if(t.length>0){const o=t[Math.floor(Math.random()*t.length)];return e.state.inv.push({...o}),{message:"Resourceful: Drew T2 Word"}}}return null}}},{id:"mage",name:"Belle Lettres",str:[E.LIGHT,E.DARK,E.POISON],weak:[],good:"magic",bad:"slash",desc:"Princess of Verbia. The Erratum attacked while her parents were in Prosa‚Äîtheir fate unknown. Her first real fight.",dialogue:["Reality is a rough draft. Let's make revisions.","I've read this story before. Time to edit the ending."],victoryDialogue:"We won this chapter, Wordsmith. But the story isn't over. Not until I know.",defeatDialogue:"Another draft... discarded. Mother... Father...",runStartDialogue:"A new chapter begins. Let's hope for a better ending this time.",chapterDialogue:"We've turned the page. What comes next... I've read it. It gets worse.",shopDialogue:["So this is what commerce looks like outside the Library...","Fascinating inventory. I've only read about half of these.","Shopping! Like a normal person! ...Is this normal?","The royal treasury could buy all of this. ...Could have.","I should take notes. For... academic purposes.","Choose something. Anything. I trust your judgment more than mine.","Chapter twelve of 'Commerce for Beginners' did NOT prepare me for this.","I've read about haggling. Do we haggle? Should I haggle?","Mother would be horrified to see me here. ...Good."],passive:{name:"Sheltered",desc:"2 random weaknesses each battle",phase:"ENEMY_SETUP",apply:e=>{const t=[E.PHYS,E.FIRE,E.WATER,E.EARTH,E.LIGHTNING].sort(()=>Math.random()-.5).slice(0,2);e.hero&&(e.hero.weak=t);return{message:`Sheltered: Weak to ${t.map(e=>EN[e]).join(", ")}`}}}},{id:"paladin",name:"Alexandria Constanza",str:[E.LIGHT,E.PHYS],weak:[E.DARK,E.POISON],good:"blunt",bad:"pierce",desc:"Fresh from the Academy. Trained with your weapons, but this is her first real test of faith.",dialogue:["By The Word, this entry shall be preserved.","My oath binds me. My conviction drives me."],victoryDialogue:"Another page preserved. The lexicon endures.",defeatDialogue:"My oath... I couldn't keep it. Forgive me, Word.",runStartDialogue:"By The Word, I am ready. Forge me a weapon, Wordsmith.",chapterDialogue:"A chapter preserved! By The Word, we advance!",shopDialogue:["The Word provides. We must be worthy of it.","Even templars require tools. No shame in preparation.","Let us make haste. The Erratum do not rest.","The Library's coffers fund our sacred work.","Each purchase, a verse in our hymn of preservation.","I defer to your wisdom, Wordsmith.","The Academy taught us to be resourceful. This qualifies.","By my oath, I shall not waste what The Word provides.","My instructors spoke of you. They were not wrong."],passive:{name:"Vigilant",desc:"The hero has +1 life during a run, can be defeated and continue",phase:"HERO_INIT",apply:e=>(e.state.lives=2,{message:"Vigilant: +1 life"})}},{id:"assassin",name:"Caesura",str:[E.DARK,E.POISON],weak:[E.LIGHT,E.FIRE],good:"pierce",bad:"blunt",desc:"Emissary from Prosa. Brought warning of the Erratum‚Äîand news that the King and Queen's fate is unknown.",dialogue:["...","...So you're the Wordsmith."],victoryDialogue:"... Prosa feared your name. ... Perhaps they were wrong to.",defeatDialogue:"...Prosa warned them. ...They didn't listen.",runStartDialogue:"...",chapterDialogue:"...One step closer. ...To the truth.",shopDialogue:["...","...Choose.","...Time is short.","...Prosa had better.","...This will do.","...","...Verbian gold. ...It spends the same.","...The silence here is... different.","..."],passive:{name:"Meticulous",desc:"Adjective slots: +0.25 W per Word",phase:"WORD_COUNT",apply:e=>{if(["adj1","adj2","adj3","adj4"].includes(e.slotKey)){const t=.25*e.wCountDelta;return e.breakdown&&(e.breakdown.wordCount+=t),{message:`Meticulous: +0.25 Word count (${e.word.name})`,wordCountBonus:t}}return null}}},{id:"druid",name:"Reed",str:[E.EARTH,E.WATER],weak:[E.FIRE,E.LIGHTNING],good:"blunt",bad:"magic",desc:"Ancient druid of Etymos. You've worked together across the ages. Old friends.",dialogue:["The roots remember, old friend.","Etymos calls us once more."],victoryDialogue:"Another cycle together, Wordsmith. Our roots hold strong.",defeatDialogue:"The roots... wither. But new growth... will come.",runStartDialogue:"The roots call. Let us answer.",chapterDialogue:"The seasons turn. Growth continues.",shopDialogue:["The land provides what we need, if we listen.","Gold is a strange root. But it grows things.","Rest now. The next storm approaches.","Even ancient trees need nourishment.","Patience. The right seed will present itself.","The cycle continues. As it always has.","I remember when these goods had no price. Only need.","Etymos stirs. Even in commerce, I feel it.","The young ones rush. I have learned to wait."],passive:{name:"Rooted",desc:"The enemy becomes weak to the gem slot's element (disregarding resistances)",phase:"CALC_INIT",apply:e=>{if(e.sel.noun1&&void 0!==e.sel.noun1.elem){const t=e.sel.noun1.elem;return e.enemy.weak.includes(t)?e.enemy.weak=[...e.enemy.weak]:e.enemy.weak=[...e.enemy.weak,t],e.enemy.res=e.enemy.res.filter(e=>e!==t),{message:`Rooted: Enemy weak to ${EN[t]}`}}return null}}}];function applyModifiers(e,t){const o=[];if(t.hero&&t.hero.passive&&t.hero.passive.phase===e){const e=t.hero.passive.apply(t);e&&o.push(e)}return o}function getEffectiveEnemy(){if(!S.hero||!S.enemy)return S.enemy;const{hero:e,enemy:t}=getCombatants();return applyModifiers("CALC_INIT",{hero:e,enemy:t,sel:S.sel,state:S}),t}const ENEMIES=[{id:"vowel_goblin",name:"Vowel Goblin",hp:45,desc:"Hoards vowels, leaving words voiceless.",dialogue:["Ay, eee... I owe you? Why?","Gv m yr vwls!"],weak:[E.FIRE,E.DARK],res:[E.EARTH,E.POISON]},{id:"ghost",name:"Ghost",hp:40,desc:"A phantom word that refused to be erased.",dialogue:["Dord... dord... the dictionary deleted me, but I'm still here...","I was real once... wasn't I? Someone used me... someone must have..."],weak:[E.LIGHT,E.LIGHTNING],res:[E.PHYS,E.DARK]},{id:"synonym_roll",name:"Synonym Roll",hp:50,desc:"Says everything twice. Differently. Redundantly.",dialogue:["I'm on a roll! A bun! A bread thing!","Prepare to die! Perish! Expire! Cease!"],weak:[E.FIRE,E.POISON],res:[E.WATER,E.LIGHT]},{id:"comma_chameleon",name:"Comma Chameleon",hp:45,desc:"Causes hesitation, and pauses, everywhere.",dialogue:["Pause, for, effect...","Let's, take, a, break, shall, we?"],weak:[E.PHYS,E.EARTH],res:[E.LIGHT,E.POISON]},{id:"webster_spiderling",name:"Webster Spiderling",hp:55,desc:"Spins webs of tangled definitions.",dialogue:["Per the dictionary, you're doomed!","Let me define your defeat!"],weak:[E.FIRE,E.WATER],res:[E.POISON,E.DARK]},{id:"hyphen_hyena",name:"Hyphen-Hyena",hp:60,desc:"A two-faced, double-dealing, compound beast.",dialogue:["Heh-heh-heh-heh!","I'm well-armed and battle-ready!"],weak:[E.POISON,E.WATER],res:[E.PHYS,E.FIRE]},{id:"pun_goblin",name:"Pun Goblin",hp:55,desc:"Thinks it's punny. Desperately.",dialogue:["I'm dead seri-puns!","Prepare to pun-ish you! Get it? GET IT?!"],weak:[E.PHYS,E.LIGHT],res:[E.LIGHTNING,E.EARTH]},{id:"apostro_fiend",name:"Apostro-Fiend",hp:60,desc:"Take's what's your's. Possessive demon.",dialogue:["Your'e making a mistake!","Its' time to die! Your's truly!"],weak:[E.LIGHT,E.WATER],res:[E.DARK,E.FIRE]},{id:"idiomatic_undead",name:"Idiomatic Undead",hp:70,desc:"Shambling corpse animated by dead metaphors.",dialogue:["You've opened a can of worms, and I've got a bone to pick!","When it rains, it pours... YOUR BLOOD!"],weak:[E.FIRE,E.LIGHTNING],res:[E.POISON,E.PHYS]},{id:"vulgar_vandal",name:"Vulgar Vandal",hp:65,desc:"Creature of censored rage. Unfit for print.",dialogue:["#@$%*!!!","I'll @#$%ing end you, you piece of @#$%!"],weak:[E.EARTH,E.DARK],res:[E.LIGHTNING,E.PHYS]},{id:"double_negative",name:"Double Negative",hp:70,desc:"A paradox that can't not exist.",dialogue:["I ain't not gonna not destroy you!","You can't never win nothing!"],weak:[E.POISON,E.LIGHTNING],res:[E.WATER,E.EARTH]},{id:"run_on_sentence",name:"Run-On Sentence",hp:75,desc:"Never stops never pauses keeps going and going and‚Äî",dialogue:["And then I'll hit you and then I'll hit you again and also‚Äî","Wait I'm not done because there's more to say and‚Äî"],weak:[E.PHYS,E.DARK],res:[E.FIRE,E.LIGHT]},{id:"split_infinitive",name:"Split Infinitive",hp:70,desc:"To boldly split what should never be split.",dialogue:["I'm going to completely destroy you!","Prepare to fully and utterly experience defeat!"],weak:[E.EARTH,E.WATER],res:[E.DARK,E.POISON]},{id:"mixed_metaphor",name:"Mixed Metaphor",hp:75,desc:"A chaotic mashup of incompatible imagery.",dialogue:["We'll burn that bridge when we cross it!","You've let the cat out of the frying pan now!"],weak:[E.PHYS,E.POISON],res:[E.WATER,E.LIGHT]},{id:"passive_voice",name:"Passive Voice",hp:80,desc:"Mistakes were made. By whom? It is unclear.",dialogue:["Your defeat has been predetermined. By forces. Unnamed forces.","Responsibility will not be taken. Blame will be deflected. You will be defeated."],weak:[E.LIGHTNING,E.DARK],res:[E.PHYS,E.EARTH]}];function randomizeEnemyElements(e){if(e.weak&&e.res)return;const t=[...[E.PHYS,E.POISON,E.FIRE,E.WATER,E.LIGHT,E.DARK,E.EARTH,E.LIGHTNING]].sort(()=>Math.random()-.5);e.weak=t.slice(0,2),e.res=t.slice(2,4);const o=t.slice(4);e.atk=o[0]||E.PHYS}const CHAPTER_BOSSES=[{id:"cinna_antony",name:"Cinna & Antony",desc:"Warring siblings of opposite meaning. Forever arguing.",ability:{name:"Duality",desc:"All the same element or two opposite elements only"},dialogue:["Cinna: The Wordsmith! / Antony: The so-called Wordsmith.","Cinna: We'll destroy you! / Antony: Or maybe we won't."]},{id:"red_aktins",name:"Red Aktins",desc:"The Censor. Strikes words from existence.",ability:{name:"Redacted",desc:"One random adjective slot is [REDACTED] for this fight"},dialogue:["This conversation has been flagged for [REDACTED]. Your [REDACTED] will be [REDACTED].","Some words are better left... unwritten. Yours, for example. All of them."]},{id:"plague_doctor",name:"The Plague Doctor",desc:"Stealer of styles. Wears others' words like masks.",ability:{name:"Plagiarized",desc:"Immune to your strongest Element"},dialogue:["Your style... I'll take it.","Imitation is the sincerest form of... theft."]},{id:"oxy",name:"Oxy",desc:"A living oxymoron. Clearly confused. Deafeningly silent.",ability:{name:"Contradiction",desc:"Opposing Elements (Fire/Water, Light/Dark, etc.) deal 0 damage"},dialogue:["Awfully good to meet you, Wordsmith...","Your living death awaits. Bittersweet, isn't it?"]},{id:"dotdotdot",name:"Dotdotdot",desc:"Never finishes a thought... or lets you finish...",ability:{name:"Trailing Off",desc:"Gem slot is ignored...",icon:"..."},dialogue:["Ah, the famous Wordsmith! I've heard so much about... wait, I had something for this...","This is the part where I... where I... hmm, it was right on the tip of my..."]}],SECRET_CHAPTER_BOSS={id:"silent_knight",name:"The Silent Knight",desc:"The K is silent. So is he.",dialogue:["...","......"],weak:[E.LIGHTNING],res:[E.PHYS,E.EARTH,E.DARK],isSecretBoss:!0,hpMultiplier:1.5,ability:{name:"Wordless",desc:"Immune to words with fewer than 6 letters",icon:"ü§´"}},SECRET_BOSS_SPAWN_CHANCE=.05,PORTRAITS={warrior:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-w"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="w-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1f2937"/><stop offset="100%" stop-color="#0f172a"/></linearGradient><linearGradient id="w1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#6b7280"/><stop offset="100%" stop-color="#374151"/></linearGradient><linearGradient id="w2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#4b5563"/><stop offset="100%" stop-color="#1f2937"/></linearGradient></defs><rect width="120" height="120" fill="url(#w-bg)"/><g clip-path="url(#c-w)"><rect width="120" height="120" fill="url(#w-bg)"/><path d="M0,120 L0,75 Q8,68 18,65 L40,68 Q48,78 52,100 L55,120 Z" fill="url(#w1)" opacity="0.5"/><path d="M18,65 Q15,55 18,45 L22,38 L30,32 L75,32 L82,40 Q86,50 84,62 Q78,70 65,75 L45,78 Q30,78 18,65 Z" fill="url(#w1)"/><path d="M30,32 L75,32 L78,25 L72,18 L35,18 L28,25 L30,32 Z" fill="url(#w2)"/><path d="M35,18 L72,18 L70,12 L38,12 L35,18 Z" fill="url(#w1)" opacity="0.7"/><path d="M75,32 L82,40 Q90,48 92,60 Q92,72 85,82 L78,78 Q82,70 82,60 Q82,50 75,32 Z" fill="url(#w2)" opacity="0.6"/><path d="M65,52 Q75,50 85,58 Q92,68 86,80 Q78,86 68,82 Q62,76 65,52 Z" fill="url(#w1)"/><path d="M68,82 Q76,92 70,105 Q62,115 50,110 Q60,100 66,90 Q68,86 68,82 Z" fill="url(#w2)"/><path d="M50,110 Q42,115 30,112 Q26,108 36,104 Q46,103 50,110 Z" fill="url(#w1)" opacity="0.8"/><path d="M30,50 Q42,44 55,48 Q52,60 48,72 Q44,82 38,78 Q32,72 30,50 Z" fill="url(#w2)" opacity="0.4"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#4b5563" stroke-width="3"/></svg>',ranger:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-r"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="r-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#14532d"/><stop offset="100%" stop-color="#052e16"/></linearGradient><linearGradient id="r1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#15803d"/></linearGradient><linearGradient id="r2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#16a34a"/><stop offset="100%" stop-color="#166534"/></linearGradient></defs><rect width="120" height="120" fill="url(#r-bg)"/><g clip-path="url(#c-r)"><rect width="120" height="120" fill="url(#r-bg)"/><path d="M5,120 L5,85 Q12,75 22,72 L32,74 Q36,84 38,100 L40,120 Z" fill="url(#r1)" opacity="0.4"/><path d="M18,70 Q14,55 18,40 Q24,25 42,18 L48,8 L52,18 Q48,28 46,40 Q44,52 50,65 Q44,74 34,78 L22,76 Q18,74 18,70 Z" fill="url(#r1)"/><path d="M42,18 L48,8 L52,18 Q50,25 48,35 Q46,45 52,58 L46,62 Q44,52 44,40 Q44,28 42,18 Z" fill="url(#r2)"/><path d="M52,18 Q58,12 65,18 Q68,28 68,42 Q64,35 60,30 Q56,22 52,18 Z" fill="url(#r1)" opacity="0.5"/><path d="M55,52 Q62,48 72,54 Q78,64 72,74 Q66,78 58,74 Q52,68 55,52 Z" fill="url(#r1)"/><path d="M58,74 Q64,82 60,92 Q54,98 46,96 Q52,88 56,80 Q58,77 58,74 Z" fill="url(#r2)"/><path d="M46,96 Q40,100 32,100 Q28,96 36,92 Q42,91 46,96 Z" fill="url(#r1)" opacity="0.8"/><path d="M26,45 Q34,38 44,40 Q42,50 38,60 Q34,68 30,64 Q26,58 26,45 Z" fill="url(#r2)" opacity="0.5"/><path d="M72,54 Q82,42 95,35 Q108,32 115,45 Q118,60 110,78 Q100,95 85,100 Q95,85 100,70 Q105,55 100,45 Q95,40 85,48 Q78,54 72,54 Z" fill="url(#r1)" opacity="0.5"/><path d="M95,35 Q102,30 108,35 Q112,42 108,52 Q104,45 98,42 Q95,38 95,35 Z" fill="url(#r2)" opacity="0.4"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#22c55e" stroke-width="3"/></svg>',mage:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-m"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="m-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#431407"/><stop offset="100%" stop-color="#1c0a00"/></linearGradient><linearGradient id="m1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#fb923c"/><stop offset="100%" stop-color="#ea580c"/></linearGradient><linearGradient id="m2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#f97316"/><stop offset="100%" stop-color="#c2410c"/></linearGradient></defs><rect width="120" height="120" fill="url(#m-bg)"/><g clip-path="url(#c-m)"><rect width="120" height="120" fill="url(#m-bg)"/><path d="M8,120 L8,95 Q14,85 24,82 L34,84 Q38,94 40,108 L42,120 Z" fill="url(#m1)" opacity="0.35"/><path d="M22,80 Q18,65 24,50 Q32,35 50,30 Q62,28 72,35 Q66,45 64,58 Q62,72 68,85 Q62,92 50,95 L30,92 Q24,88 22,80 Z" fill="url(#m1)"/><path d="M50,30 Q62,25 74,32 L78,42 Q72,36 66,35 Q58,35 52,42 L50,30 Z" fill="url(#m2)"/><path d="M40,12 Q48,8 58,12 Q52,20 50,30 L46,32 Q44,22 40,12 Z" fill="url(#m1)" opacity="0.7"/><path d="M58,12 Q68,6 80,15 Q88,25 85,40 Q80,32 75,28 Q68,22 58,12 Z" fill="url(#m2)" opacity="0.6"/><path d="M80,15 Q92,20 98,35 Q95,28 88,24 Q82,20 80,15 Z" fill="url(#m1)" opacity="0.4"/><path d="M68,55 Q78,52 88,62 Q94,74 86,86 Q78,92 68,86 Q62,78 68,55 Z" fill="url(#m1)"/><path d="M68,86 Q76,96 70,108 Q62,116 52,112 Q62,102 66,92 Q68,89 68,86 Z" fill="url(#m2)"/><path d="M52,112 Q44,116 34,114 Q30,110 40,106 Q48,105 52,112 Z" fill="url(#m1)" opacity="0.8"/><path d="M32,55 Q42,48 54,52 Q50,64 46,76 Q42,86 36,82 Q30,76 32,55 Z" fill="url(#m2)" opacity="0.45"/><path d="M5,70 Q8,55 15,45 Q12,58 10,72 Q8,82 5,70 Z" fill="url(#m1)" opacity="0.25"/><path d="M4,88 Q6,75 12,65 Q10,78 8,90 Q6,98 4,88 Z" fill="url(#m2)" opacity="0.2"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#f97316" stroke-width="3"/></svg>',paladin:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-p"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="p-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fef3c7"/><stop offset="100%" stop-color="#fde68a"/></linearGradient><linearGradient id="p1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient><linearGradient id="p2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient></defs><rect width="120" height="120" fill="url(#p-bg)"/><g clip-path="url(#c-p)"><rect width="120" height="120" fill="url(#p-bg)"/><circle cx="55" cy="45" r="35" fill="url(#p1)" opacity="0.25"/><circle cx="55" cy="45" r="28" fill="url(#p2)" opacity="0.2"/><path d="M15,120 L15,95 Q22,85 32,82 L42,84 Q46,94 48,108 L50,120 Z" fill="url(#p1)" opacity="0.4"/><path d="M28,80 Q24,65 30,50 Q38,35 55,30 Q70,28 80,40 Q74,52 72,65 Q70,78 76,90 Q70,98 58,102 L38,98 Q32,94 28,80 Z" fill="url(#p1)"/><path d="M55,30 Q70,24 82,36 L86,48 Q80,40 72,38 Q64,38 58,46 L55,30 Z" fill="url(#p2)"/><path d="M55,30 Q60,22 68,20 Q62,26 58,32 L55,30 Z" fill="url(#p1)" opacity="0.6"/><path d="M76,58 Q86,54 96,65 Q102,78 94,92 Q86,98 76,92 Q70,84 76,58 Z" fill="url(#p1)"/><path d="M76,92 Q84,102 78,114 Q70,120 60,118 Q70,108 74,98 Q76,95 76,92 Z" fill="url(#p2)"/><path d="M60,118 Q52,120 42,118 Q38,114 48,110 Q56,109 60,118 Z" fill="url(#p1)" opacity="0.8"/><path d="M38,55 Q48,48 60,52 Q56,65 52,78 Q48,88 42,84 Q36,78 38,55 Z" fill="url(#p2)" opacity="0.45"/><path d="M86,48 Q96,58 98,75 Q98,90 90,102 Q84,96 86,86 Q88,75 86,48 Z" fill="url(#p1)" opacity="0.3"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#fbbf24" stroke-width="3"/></svg>',assassin:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-a"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="a-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e1b4b"/><stop offset="100%" stop-color="#0f0a1e"/></linearGradient><linearGradient id="a1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#a855f7"/><stop offset="100%" stop-color="#7e22ce"/></linearGradient><linearGradient id="a2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#9333ea"/><stop offset="100%" stop-color="#581c87"/></linearGradient></defs><rect width="120" height="120" fill="url(#a-bg)"/><g clip-path="url(#c-a)"><rect width="120" height="120" fill="url(#a-bg)"/><path d="M20,120 L20,100 Q26,92 34,88 L42,90 Q46,98 48,110 L50,120 Z" fill="url(#a1)" opacity="0.3"/><path d="M32,86 Q28,72 34,58 Q42,44 58,40 Q72,38 82,50 Q76,60 74,72 Q72,84 78,96 Q72,104 60,108 L42,104 Q36,100 32,86 Z" fill="url(#a1)"/><path d="M58,40 Q72,34 84,46 L88,58 Q82,50 74,48 Q66,48 60,56 L58,40 Z" fill="url(#a2)"/><path d="M58,40 Q64,32 72,30 Q78,36 80,45 L84,46 Q80,38 74,34 Q66,32 58,40 Z" fill="url(#a1)" opacity="0.5"/><path d="M34,75 Q28,85 20,88 L15,82 Q22,78 28,70 L34,75 Z" fill="url(#a2)" opacity="0.4"/><path d="M78,65 Q88,62 98,72 Q104,84 96,98 Q88,104 78,98 Q72,90 78,65 Z" fill="url(#a1)"/><path d="M78,98 Q86,108 80,118 L62,120 Q72,112 76,104 Q78,101 78,98 Z" fill="url(#a2)"/><path d="M42,62 Q52,56 64,60 Q60,72 56,84 Q52,94 46,90 Q40,84 42,62 Z" fill="url(#a2)" opacity="0.4"/><path d="M88,58 Q98,68 100,85 Q100,100 92,110 Q86,104 88,94 Q90,82 88,58 Z" fill="url(#a1)" opacity="0.25"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#a855f7" stroke-width="3"/></svg>',druid:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-d"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="d-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#134e4a"/><stop offset="100%" stop-color="#042f2e"/></linearGradient><linearGradient id="d1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#2dd4bf"/><stop offset="100%" stop-color="#14b8a6"/></linearGradient><linearGradient id="d2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#14b8a6"/><stop offset="100%" stop-color="#0d9488"/></linearGradient></defs><rect width="120" height="120" fill="url(#d-bg)"/><g clip-path="url(#c-d)"><rect width="120" height="120" fill="url(#d-bg)"/><path d="M12,120 L12,95 Q18,85 28,82 L38,84 Q42,94 44,108 L46,120 Z" fill="url(#d1)" opacity="0.35"/><path d="M26,80 Q22,65 28,50 Q36,35 52,30 Q66,28 76,40 Q70,52 68,65 Q66,78 72,90 Q66,98 54,102 L36,98 Q30,94 26,80 Z" fill="url(#d1)"/><path d="M52,30 Q66,24 78,36 L82,48 Q76,40 68,38 Q60,38 54,46 L52,30 Z" fill="url(#d2)"/><path d="M45,30 Q42,20 35,12 Q28,5 18,8 Q12,15 15,25 Q20,20 28,18 Q38,18 45,30 Z" fill="url(#d1)" opacity="0.7"/><path d="M35,12 Q30,5 22,5 Q15,8 18,18 Q22,12 28,10 Q32,10 35,12 Z" fill="url(#d2)" opacity="0.5"/><path d="M18,8 Q10,5 5,12 Q5,20 12,22 Q8,15 12,12 Q15,10 18,8 Z" fill="url(#d1)" opacity="0.4"/><path d="M52,30 Q58,22 68,18 Q80,15 92,22 Q100,32 95,45 Q88,35 78,32 Q68,32 58,40 L52,30 Z" fill="url(#d1)" opacity="0.6"/><path d="M68,18 Q78,12 90,15 Q98,22 95,35 Q90,25 82,22 Q74,20 68,18 Z" fill="url(#d2)" opacity="0.45"/><path d="M90,15 Q100,12 108,20 Q112,30 105,38 Q102,28 96,22 Q92,18 90,15 Z" fill="url(#d1)" opacity="0.35"/><path d="M72,58 Q82,55 92,65 Q98,78 90,92 Q82,98 72,92 Q66,84 72,58 Z" fill="url(#d1)"/><path d="M72,92 Q80,102 74,114 Q66,120 56,118 Q66,108 70,98 Q72,95 72,92 Z" fill="url(#d2)"/><path d="M56,118 Q48,120 38,118 Q34,114 44,110 Q52,109 56,118 Z" fill="url(#d1)" opacity="0.8"/><path d="M36,55 Q46,48 58,52 Q54,65 50,78 Q46,88 40,84 Q34,78 36,55 Z" fill="url(#d2)" opacity="0.45"/><path d="M82,48 Q92,58 94,75 Q94,90 86,102 Q80,96 82,86 Q84,75 82,48 Z" fill="url(#d1)" opacity="0.3"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#14b8a6" stroke-width="3"/></svg>',vowel_goblin:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-vg"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="vg-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#3d5c1f"/><stop offset="100%" stop-color="#1a2e0d"/></linearGradient><linearGradient id="vg1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#7cb342"/><stop offset="100%" stop-color="#558b2f"/></linearGradient><linearGradient id="vg2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#689f38"/><stop offset="100%" stop-color="#33691e"/></linearGradient></defs><rect width="120" height="120" fill="url(#vg-bg)"/><g clip-path="url(#c-vg)"><rect width="120" height="120" fill="url(#vg-bg)"/><path d="M25,85 Q20,75 22,65 Q28,55 40,50 Q50,48 55,55 Q52,62 48,70 Q45,78 40,82 L28,84 Q26,85 25,85 Z" fill="url(#vg1)"/><path d="M40,50 Q52,42 65,48 Q58,55 55,62 Q52,70 55,78 L48,82 Q45,75 44,65 Q43,55 40,50 Z" fill="url(#vg2)"/><path d="M55,65 Q62,60 70,64 Q74,70 70,76 Q65,78 60,74 Q56,70 55,65 Z" fill="url(#vg1)"/><path d="M60,74 Q65,80 62,88 Q58,92 52,90 Q55,85 57,80 Q59,77 60,74 Z" fill="url(#vg2)"/><path d="M52,90 Q48,94 42,95 Q38,92 44,88 Q49,87 52,90 Z" fill="url(#vg1)" opacity="0.8"/><path d="M35,58 Q42,52 50,52 Q48,58 45,65 Q42,72 38,70 Q35,66 35,58 Z" fill="url(#vg2)" opacity="0.6"/><path d="M45,35 Q55,28 65,35 Q60,40 55,48 L50,48 Q48,42 45,35 Z" fill="url(#vg1)" opacity="0.7"/><path d="M55,28 Q65,22 75,30 Q70,38 65,42 L60,40 Q58,34 55,28 Z" fill="url(#vg2)" opacity="0.5"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#7cb342" stroke-width="3"/></svg>',ghost:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-gh"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="gh-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e293b"/><stop offset="100%" stop-color="#0f172a"/></linearGradient><linearGradient id="gh1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#e2e8f0"/><stop offset="100%" stop-color="#94a3b8"/></linearGradient><linearGradient id="gh2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#cbd5e1"/><stop offset="100%" stop-color="#64748b"/></linearGradient></defs><rect width="120" height="120" fill="url(#gh-bg)"/><g clip-path="url(#c-gh)"><rect width="120" height="120" fill="url(#gh-bg)"/><path d="M20,120 Q18,100 22,80 Q28,60 45,45 Q58,35 70,40 Q62,52 58,68 Q55,85 60,100 L55,120 Z" fill="url(#gh1)" opacity="0.6"/><path d="M45,45 Q60,32 78,42 Q68,55 64,72 Q60,88 65,105 L58,110 Q55,95 54,78 Q53,60 45,45 Z" fill="url(#gh2)" opacity="0.5"/><path d="M65,60 Q72,55 80,60 Q85,68 80,76 Q74,78 68,74 Q64,68 65,60 Z" fill="url(#gh1)" opacity="0.7"/><path d="M68,74 Q75,82 70,92 Q64,98 58,95 Q62,88 65,80 Q67,77 68,74 Z" fill="url(#gh2)" opacity="0.6"/><path d="M30,65 Q38,55 48,54 Q45,65 42,78 Q38,88 32,85 Q28,78 30,65 Z" fill="url(#gh1)" opacity="0.4"/><path d="M78,42 Q90,48 95,65 Q95,82 88,95 Q82,88 80,76 Q82,62 78,42 Z" fill="url(#gh2)" opacity="0.3"/><path d="M35,110 Q38,95 42,115 Q45,120 40,120 L35,120 Z" fill="url(#gh1)" opacity="0.5"/><path d="M70,108 Q75,98 80,115 L80,120 L72,120 Q70,115 70,108 Z" fill="url(#gh2)" opacity="0.4"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#94a3b8" stroke-width="3"/></svg>',synonym_roll:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-sr"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="sr-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#78350f"/><stop offset="100%" stop-color="#451a03"/></linearGradient><linearGradient id="sr1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#d97706"/></linearGradient><linearGradient id="sr2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#b45309"/></linearGradient></defs><rect width="120" height="120" fill="url(#sr-bg)"/><g clip-path="url(#c-sr)"><rect width="120" height="120" fill="url(#sr-bg)"/><path d="M25,75 Q20,60 28,45 Q40,30 60,28 Q75,28 82,40 Q72,50 68,62 Q65,75 70,88 L58,92 Q50,82 48,68 Q46,55 38,50 Q30,55 28,68 Q28,78 32,88 L25,90 Q22,82 25,75 Z" fill="url(#sr1)"/><path d="M60,28 Q78,25 90,38 Q82,52 78,68 Q75,82 80,95 L72,98 Q68,85 68,70 Q68,55 60,28 Z" fill="url(#sr2)"/><path d="M70,58 Q78,52 88,58 Q92,66 88,74 Q82,78 75,74 Q70,68 70,58 Z" fill="url(#sr1)"/><path d="M75,74 Q82,82 78,92 Q72,98 65,95 Q70,88 72,80 Q74,77 75,74 Z" fill="url(#sr2)"/><path d="M38,42 Q48,35 58,38 Q55,48 50,58 Q45,68 40,65 Q36,58 38,42 Z" fill="url(#sr2)" opacity="0.7"/><path d="M45,25 Q55,18 68,22 Q62,32 58,28 Q52,25 45,25 Z" fill="url(#sr1)" opacity="0.5"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#fbbf24" stroke-width="3"/></svg>',comma_chameleon:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-cc"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="cc-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#134e4a"/><stop offset="100%" stop-color="#042f2e"/></linearGradient><linearGradient id="cc1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#2dd4bf"/><stop offset="100%" stop-color="#0d9488"/></linearGradient><linearGradient id="cc2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#14b8a6"/><stop offset="100%" stop-color="#0f766e"/></linearGradient></defs><rect width="120" height="120" fill="url(#cc-bg)"/><g clip-path="url(#c-cc)"><rect width="120" height="120" fill="url(#cc-bg)"/><path d="M18,78 Q12,62 18,45 Q28,28 50,22 Q68,18 80,30 Q70,45 65,62 Q60,78 68,92 L52,98 Q45,85 45,68 Q45,52 38,45 Q30,50 28,65 Q28,80 35,95 L22,95 Q15,88 18,78 Z" fill="url(#cc1)"/><path d="M50,22 Q72,15 88,32 Q78,50 72,68 Q68,85 75,100 L62,105 Q58,90 58,72 Q58,55 50,22 Z" fill="url(#cc2)"/><path d="M72,55 Q80,48 92,55 Q98,65 92,75 Q84,80 76,75 Q70,68 72,55 Z" fill="url(#cc1)"/><path d="M76,75 Q85,85 80,98 Q72,105 64,102 Q70,94 74,84 Q76,80 76,75 Z" fill="url(#cc2)"/><path d="M35,38 Q48,30 60,35 Q55,48 50,60 Q44,72 38,68 Q32,60 35,38 Z" fill="url(#cc2)" opacity="0.6"/><path d="M92,55 Q100,48 108,55 Q105,62 100,58 Q95,54 92,55 Z" fill="url(#cc1)" opacity="0.7"/><path d="M5,65 Q12,55 8,70 Q6,78 5,75 L5,65 Z" fill="url(#cc2)" opacity="0.4"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#2dd4bf" stroke-width="3"/></svg>',webster_spiderling:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-ws"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="ws-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1c1917"/><stop offset="100%" stop-color="#0c0a09"/></linearGradient><linearGradient id="ws1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#57534e"/><stop offset="100%" stop-color="#292524"/></linearGradient><linearGradient id="ws2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#44403c"/><stop offset="100%" stop-color="#1c1917"/></linearGradient></defs><rect width="120" height="120" fill="url(#ws-bg)"/><g clip-path="url(#c-ws)"><rect width="120" height="120" fill="url(#ws-bg)"/><path d="M30,70 Q25,55 32,42 Q42,30 58,28 Q72,28 80,42 Q72,52 68,65 Q65,78 72,90 L58,95 Q52,82 52,68 Q52,55 45,48 Q38,52 35,65 Q35,78 42,92 L30,92 Q25,82 30,70 Z" fill="url(#ws1)"/><path d="M58,28 Q78,25 92,42 Q82,58 78,75 Q75,90 82,105 L68,108 Q64,92 65,75 Q66,58 58,28 Z" fill="url(#ws2)"/><path d="M70,58 Q78,50 90,58 Q95,68 90,78 Q82,82 74,78 Q68,70 70,58 Z" fill="url(#ws1)"/><path d="M74,78 Q82,88 78,100 Q70,108 62,105 Q68,96 72,86 Q74,82 74,78 Z" fill="url(#ws2)"/><path d="M8,45 Q18,35 28,45 Q22,55 15,50 Q10,48 8,45 Z" fill="url(#ws1)" opacity="0.6"/><path d="M5,70 Q15,60 25,72 Q18,82 10,78 Q5,75 5,70 Z" fill="url(#ws2)" opacity="0.5"/><path d="M95,35 Q105,28 112,40 Q108,50 100,48 Q96,42 95,35 Z" fill="url(#ws1)" opacity="0.5"/><path d="M100,60 Q110,55 115,68 Q112,78 105,75 Q100,70 100,60 Z" fill="url(#ws2)" opacity="0.4"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#57534e" stroke-width="3"/></svg>',hyphen_hyena:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-hh"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="hh-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#44403c"/><stop offset="100%" stop-color="#1c1917"/></linearGradient><linearGradient id="hh1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#d6d3d1"/><stop offset="100%" stop-color="#a8a29e"/></linearGradient><linearGradient id="hh2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#a8a29e"/><stop offset="100%" stop-color="#78716c"/></linearGradient></defs><rect width="120" height="120" fill="url(#hh-bg)"/><g clip-path="url(#c-hh)"><rect width="120" height="120" fill="url(#hh-bg)"/><path d="M15,85 Q10,70 15,55 Q22,38 40,30 Q55,25 68,35 Q58,48 55,62 Q52,78 60,92 L45,98 Q38,85 38,70 Q38,55 30,48 Q22,55 20,70 Q20,85 28,98 L15,98 Q10,92 15,85 Z" fill="url(#hh1)"/><path d="M40,30 Q60,22 78,35 Q68,52 64,70 Q60,88 68,105 L52,110 Q48,95 48,78 Q48,60 40,30 Z" fill="url(#hh2)"/><path d="M64,55 Q74,48 88,58 Q95,72 88,85 Q78,90 68,82 Q62,72 64,55 Z" fill="url(#hh1)"/><path d="M68,82 Q78,95 72,108 Q62,115 54,110 Q62,100 66,90 Q68,86 68,82 Z" fill="url(#hh2)"/><path d="M28,42 Q40,32 52,38 Q48,50 42,62 Q35,72 30,68 Q25,60 28,42 Z" fill="url(#hh2)" opacity="0.6"/><path d="M50,18 Q62,10 75,18 Q68,28 60,25 Q55,22 50,18 Z" fill="url(#hh1)" opacity="0.7"/><path d="M70,20 Q80,12 92,22 Q85,32 78,28 Q72,24 70,20 Z" fill="url(#hh2)" opacity="0.5"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#a8a29e" stroke-width="3"/></svg>',pun_goblin:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-pg"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="pg-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#365314"/><stop offset="100%" stop-color="#1a2e05"/></linearGradient><linearGradient id="pg1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#84cc16"/><stop offset="100%" stop-color="#65a30d"/></linearGradient><linearGradient id="pg2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#a3e635"/><stop offset="100%" stop-color="#4d7c0f"/></linearGradient></defs><rect width="120" height="120" fill="url(#pg-bg)"/><g clip-path="url(#c-pg)"><rect width="120" height="120" fill="url(#pg-bg)"/><path d="M22,82 Q18,68 22,52 Q30,35 48,28 Q62,24 75,35 Q65,48 62,65 Q58,80 65,95 L50,100 Q42,88 42,72 Q42,58 35,50 Q28,55 25,70 Q25,85 32,98 L20,98 Q16,90 22,82 Z" fill="url(#pg1)"/><path d="M48,28 Q68,20 85,35 Q75,52 70,70 Q66,88 74,105 L58,110 Q52,95 54,78 Q56,60 48,28 Z" fill="url(#pg2)"/><path d="M68,58 Q78,50 92,60 Q98,72 92,84 Q82,90 72,84 Q66,74 68,58 Z" fill="url(#pg1)"/><path d="M72,84 Q82,96 76,110 Q66,118 58,112 Q66,102 70,92 Q72,88 72,84 Z" fill="url(#pg2)"/><path d="M32,45 Q44,35 56,42 Q52,55 46,68 Q40,78 34,74 Q28,65 32,45 Z" fill="url(#pg2)" opacity="0.6"/><path d="M55,22 Q68,15 80,25 Q72,35 65,30 Q60,26 55,22 Z" fill="url(#pg1)" opacity="0.7"/><path d="M45,15 Q55,8 68,15 Q60,24 52,20 Q48,18 45,15 Z" fill="url(#pg2)" opacity="0.5"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#84cc16" stroke-width="3"/></svg>',apostro_fiend:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-af"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="af-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#450a0a"/><stop offset="100%" stop-color="#1c0505"/></linearGradient><linearGradient id="af1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#dc2626"/><stop offset="100%" stop-color="#991b1b"/></linearGradient><linearGradient id="af2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#b91c1c"/><stop offset="100%" stop-color="#7f1d1d"/></linearGradient></defs><rect width="120" height="120" fill="url(#af-bg)"/><g clip-path="url(#c-af)"><rect width="120" height="120" fill="url(#af-bg)"/><path d="M20,80 Q15,65 20,48 Q28,30 48,22 Q65,18 78,30 Q68,45 64,62 Q60,80 68,95 L52,102 Q44,88 44,72 Q44,56 36,48 Q28,54 25,70 Q25,85 32,100 L18,100 Q14,92 20,80 Z" fill="url(#af1)"/><path d="M48,22 Q70,14 88,30 Q78,50 72,70 Q68,88 76,108 L60,112 Q54,96 56,78 Q58,58 48,22 Z" fill="url(#af2)"/><path d="M70,55 Q80,46 95,58 Q102,72 95,86 Q84,92 74,85 Q68,74 70,55 Z" fill="url(#af1)"/><path d="M74,85 Q85,98 78,112 Q68,120 60,115 Q68,104 72,94 Q74,90 74,85 Z" fill="url(#af2)"/><path d="M32,42 Q45,32 58,40 Q54,54 48,68 Q42,80 35,76 Q28,66 32,42 Z" fill="url(#af2)" opacity="0.6"/><path d="M55,12 Q65,5 80,12 Q72,22 65,18 Q60,15 55,12 Z" fill="url(#af1)" opacity="0.8"/><path d="M70,8 Q82,2 95,12 Q88,22 80,18 Q74,12 70,8 Z" fill="url(#af2)" opacity="0.6"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#dc2626" stroke-width="3"/></svg>',idiomatic_undead:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-iu"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="iu-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e1b18"/><stop offset="100%" stop-color="#0d0c0a"/></linearGradient><linearGradient id="iu1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#d4c8be"/><stop offset="100%" stop-color="#a39585"/></linearGradient><linearGradient id="iu2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#c4b5a5"/><stop offset="100%" stop-color="#8b7b68"/></linearGradient></defs><rect width="120" height="120" fill="url(#iu-bg)"/><g clip-path="url(#c-iu)"><rect width="120" height="120" fill="url(#iu-bg)"/><path d="M18,82 Q12,65 18,48 Q28,28 50,20 Q68,16 82,30 Q72,48 68,68 Q64,88 72,105 L55,112 Q46,96 46,78 Q46,60 38,50 Q28,56 24,74 Q24,92 32,108 L16,108 Q10,98 18,82 Z" fill="url(#iu1)"/><path d="M50,20 Q72,12 92,30 Q80,52 76,75 Q72,98 80,115 L62,120 Q56,102 58,82 Q60,62 50,20 Z" fill="url(#iu2)"/><path d="M72,58 Q84,48 100,62 Q108,78 100,94 Q88,100 76,92 Q68,80 72,58 Z" fill="url(#iu1)"/><path d="M76,92 Q88,106 80,120 L62,120 Q70,108 74,98 Q76,95 76,92 Z" fill="url(#iu2)"/><path d="M34,42 Q48,30 62,40 Q58,56 52,72 Q44,86 38,82 Q30,72 34,42 Z" fill="url(#iu2)" opacity="0.5"/><path d="M58,12 Q72,4 88,14 Q80,26 72,22 Q65,18 58,12 Z" fill="url(#iu1)" opacity="0.7"/><path d="M22,60 Q18,50 25,55 Q28,62 22,60 Z" fill="url(#iu2)" opacity="0.4"/><path d="M20,75 Q16,68 22,72 Q26,80 20,78 L20,75 Z" fill="url(#iu1)" opacity="0.3"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#a39585" stroke-width="3"/></svg>',vulgar_vandal:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-vv"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="vv-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#3f3f46"/><stop offset="100%" stop-color="#18181b"/></linearGradient><linearGradient id="vv1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient><linearGradient id="vv2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient></defs><rect width="120" height="120" fill="url(#vv-bg)"/><g clip-path="url(#c-vv)"><rect width="120" height="120" fill="url(#vv-bg)"/><path d="M20,85 Q14,68 20,50 Q30,30 52,22 Q70,18 85,32 Q74,50 70,70 Q66,90 74,108 L56,114 Q48,98 48,80 Q48,62 40,52 Q30,58 26,76 Q26,94 34,110 L18,110 Q12,100 20,85 Z" fill="url(#vv1)"/><path d="M52,22 Q75,14 95,32 Q84,54 78,78 Q74,100 82,118 L64,120 Q58,104 60,84 Q62,64 52,22 Z" fill="url(#vv2)"/><path d="M74,60 Q86,50 102,64 Q110,80 102,96 Q90,102 78,94 Q70,82 74,60 Z" fill="url(#vv1)"/><path d="M78,94 Q90,108 82,120 L66,120 Q74,110 78,100 Q80,97 78,94 Z" fill="url(#vv2)"/><path d="M36,44 Q50,32 65,42 Q60,58 54,74 Q46,88 40,84 Q32,74 36,44 Z" fill="url(#vv2)" opacity="0.6"/><path d="M60,14 Q74,6 90,16 Q82,28 74,24 Q68,20 60,14 Z" fill="url(#vv1)" opacity="0.7"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#fbbf24" stroke-width="3"/></svg>',double_negative:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-dn"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="dn-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#312e81"/><stop offset="100%" stop-color="#1e1b4b"/></linearGradient><linearGradient id="dn1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#818cf8"/><stop offset="100%" stop-color="#6366f1"/></linearGradient><linearGradient id="dn2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#6366f1"/><stop offset="100%" stop-color="#4f46e5"/></linearGradient></defs><rect width="120" height="120" fill="url(#dn-bg)"/><g clip-path="url(#c-dn)"><rect width="120" height="120" fill="url(#dn-bg)"/><path d="M18,80 Q12,62 18,44 Q28,24 50,18 Q68,14 82,28 Q72,46 68,66 Q64,86 72,104 L54,110 Q46,94 46,76 Q46,58 38,48 Q28,54 24,72 Q24,90 32,106 L16,106 Q10,96 18,80 Z" fill="url(#dn1)"/><path d="M50,18 Q72,10 92,28 Q80,50 76,72 Q72,94 80,114 L62,118 Q56,100 58,80 Q60,60 50,18 Z" fill="url(#dn2)"/><path d="M72,56 Q84,46 100,60 Q108,76 100,92 Q88,98 76,90 Q68,78 72,56 Z" fill="url(#dn1)"/><path d="M76,90 Q88,104 80,118 L64,118 Q72,106 76,96 Q78,93 76,90 Z" fill="url(#dn2)"/><path d="M34,40 Q48,28 62,38 Q58,54 52,70 Q44,84 38,80 Q30,70 34,40 Z" fill="url(#dn2)" opacity="0.5"/><path d="M58,10 Q72,2 88,12 Q80,24 72,20 Q66,16 58,10 Z" fill="url(#dn1)" opacity="0.7"/><path d="M10,55 Q18,48 15,60 Q12,68 10,62 L10,55 Z" fill="url(#dn2)" opacity="0.4"/><path d="M8,72 Q16,65 14,78 Q10,85 8,80 L8,72 Z" fill="url(#dn1)" opacity="0.35"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#818cf8" stroke-width="3"/></svg>',run_on_sentence:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-ros"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="ros-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#0c4a6e"/><stop offset="100%" stop-color="#082f49"/></linearGradient><linearGradient id="ros1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#38bdf8"/><stop offset="100%" stop-color="#0ea5e9"/></linearGradient><linearGradient id="ros2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#0ea5e9"/><stop offset="100%" stop-color="#0284c7"/></linearGradient></defs><rect width="120" height="120" fill="url(#ros-bg)"/><g clip-path="url(#c-ros)"><rect width="120" height="120" fill="url(#ros-bg)"/><path d="M5,78 Q0,60 8,42 Q18,22 42,16 Q62,12 78,28 Q68,46 64,68 Q60,90 68,110 L50,116 Q42,98 42,78 Q42,58 34,48 Q24,54 20,74 Q20,94 28,112 L10,112 Q2,100 5,78 Z" fill="url(#ros1)"/><path d="M42,16 Q66,8 88,28 Q76,52 72,78 Q68,102 76,120 L58,120 Q52,104 54,82 Q56,60 42,16 Z" fill="url(#ros2)"/><path d="M70,58 Q82,48 98,62 Q106,78 98,94 Q86,100 74,92 Q66,80 70,58 Z" fill="url(#ros1)"/><path d="M74,92 Q86,106 78,120 L62,120 Q70,108 74,98 Q76,95 74,92 Z" fill="url(#ros2)"/><path d="M30,38 Q44,26 60,38 Q56,54 50,72 Q42,86 36,82 Q28,72 30,38 Z" fill="url(#ros2)" opacity="0.5"/><path d="M55,8 Q70,0 88,12 Q78,24 70,20 Q62,16 55,8 Z" fill="url(#ros1)" opacity="0.7"/><path d="M98,62 Q108,55 115,68 Q112,78 105,74 Q100,70 98,62 Z" fill="url(#ros2)" opacity="0.5"/><path d="M100,78 Q110,72 116,86 Q114,95 108,92 Q102,88 100,78 Z" fill="url(#ros1)" opacity="0.4"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#38bdf8" stroke-width="3"/></svg>',split_infinitive:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-si"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="si-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#581c87"/><stop offset="100%" stop-color="#3b0764"/></linearGradient><linearGradient id="si1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#a855f7"/></linearGradient><linearGradient id="si2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#a855f7"/><stop offset="100%" stop-color="#9333ea"/></linearGradient></defs><rect width="120" height="120" fill="url(#si-bg)"/><g clip-path="url(#c-si)"><rect width="120" height="120" fill="url(#si-bg)"/><path d="M15,82 Q8,64 15,45 Q26,24 50,18 Q70,14 85,30 Q74,50 70,72 Q66,94 74,114 L56,120 Q48,102 48,82 Q48,62 40,52 Q30,58 26,78 Q26,98 34,116 L14,116 Q6,104 15,82 Z" fill="url(#si1)"/><path d="M50,18 Q74,10 95,30 Q84,54 78,80 Q74,104 82,120 L64,120 Q58,106 60,84 Q62,62 50,18 Z" fill="url(#si2)"/><path d="M72,62 Q85,52 102,66 Q110,82 102,98 Q90,104 78,96 Q70,84 72,62 Z" fill="url(#si1)"/><path d="M78,96 Q90,110 82,120 L66,120 Q74,112 78,102 Q80,99 78,96 Z" fill="url(#si2)"/><path d="M32,44 Q48,32 64,44 Q58,62 52,80 Q44,96 38,92 Q30,82 32,44 Z" fill="url(#si2)" opacity="0.5"/><path d="M58,10 Q74,2 92,14 Q82,28 74,24 Q66,18 58,10 Z" fill="url(#si1)" opacity="0.7"/><path d="M48,60 L52,60 L52,64 L48,64 Z" fill="url(#si-bg)" opacity="0.8"/><path d="M62,70 L66,70 L66,74 L62,74 Z" fill="url(#si-bg)" opacity="0.6"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#c084fc" stroke-width="3"/></svg>',mixed_metaphor:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-mm"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="mm-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#7c2d12"/><stop offset="100%" stop-color="#431407"/></linearGradient><linearGradient id="mm1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#fb923c"/><stop offset="100%" stop-color="#f97316"/></linearGradient><linearGradient id="mm2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#f97316"/><stop offset="100%" stop-color="#ea580c"/></linearGradient></defs><rect width="120" height="120" fill="url(#mm-bg)"/><g clip-path="url(#c-mm)"><rect width="120" height="120" fill="url(#mm-bg)"/><path d="M18,84 Q10,66 18,46 Q30,24 55,18 Q75,14 90,32 Q78,52 74,76 Q70,98 78,118 L60,120 Q52,104 52,84 Q52,64 44,54 Q34,60 30,80 Q30,100 38,118 L18,118 Q8,106 18,84 Z" fill="url(#mm1)"/><path d="M55,18 Q80,10 100,32 Q88,58 84,84 Q80,108 88,120 L68,120 Q62,108 64,86 Q66,64 55,18 Z" fill="url(#mm2)"/><path d="M76,64 Q90,54 106,70 Q114,88 106,104 Q94,110 82,102 Q74,90 76,64 Z" fill="url(#mm1)"/><path d="M82,102 Q94,116 86,120 L70,120 Q78,114 82,106 Q84,103 82,102 Z" fill="url(#mm2)"/><path d="M36,46 Q52,34 68,46 Q62,66 56,86 Q48,102 42,98 Q34,88 36,46 Z" fill="url(#mm2)" opacity="0.5"/><path d="M62,10 Q78,2 96,16 Q86,30 78,26 Q70,20 62,10 Z" fill="url(#mm1)" opacity="0.7"/><path d="M20,58 Q28,50 35,60 Q30,70 24,65 Q20,62 20,58 Z" fill="url(#mm2)" opacity="0.4"/><path d="M15,75 Q22,68 28,78 Q24,88 18,84 Q15,80 15,75 Z" fill="url(#mm1)" opacity="0.35"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#fb923c" stroke-width="3"/></svg>',passive_voice:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-pv"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="pv-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#374151"/><stop offset="100%" stop-color="#1f2937"/></linearGradient><linearGradient id="pv1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#6b7280"/></linearGradient><linearGradient id="pv2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#6b7280"/><stop offset="100%" stop-color="#4b5563"/></linearGradient></defs><rect width="120" height="120" fill="url(#pv-bg)"/><g clip-path="url(#c-pv)"><rect width="120" height="120" fill="url(#pv-bg)"/><path d="M16,82 Q8,64 16,44 Q28,22 54,16 Q74,12 90,30 Q78,50 74,74 Q70,98 78,118 L58,120 Q50,104 50,82 Q50,62 42,52 Q32,58 28,78 Q28,98 36,116 L16,116 Q6,104 16,82 Z" fill="url(#pv1)" opacity="0.7"/><path d="M54,16 Q78,8 98,30 Q86,56 82,82 Q78,106 86,120 L66,120 Q60,106 62,84 Q64,62 54,16 Z" fill="url(#pv2)" opacity="0.6"/><path d="M74,62 Q88,52 104,68 Q112,86 104,102 Q92,108 80,100 Q72,88 74,62 Z" fill="url(#pv1)" opacity="0.75"/><path d="M80,100 Q92,114 84,120 L68,120 Q76,112 80,104 Q82,101 80,100 Z" fill="url(#pv2)" opacity="0.65"/><path d="M34,44 Q50,32 66,44 Q60,64 54,84 Q46,100 40,96 Q32,86 34,44 Z" fill="url(#pv2)" opacity="0.4"/><path d="M60,8 Q76,0 94,14 Q84,28 76,24 Q68,18 60,8 Z" fill="url(#pv1)" opacity="0.55"/><path d="M18,56 Q26,48 32,58 Q28,68 22,64 Q18,60 18,56 Z" fill="url(#pv2)" opacity="0.35"/><path d="M14,74 Q22,66 28,78 Q24,88 18,84 Q14,80 14,74 Z" fill="url(#pv1)" opacity="0.3"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#9ca3af" stroke-width="3"/></svg>',silent_knight:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-sk"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="sk-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1f2937"/><stop offset="100%" stop-color="#111827"/></linearGradient><linearGradient id="sk1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#d1d5db"/><stop offset="100%" stop-color="#9ca3af"/></linearGradient><linearGradient id="sk2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#6b7280"/></linearGradient></defs><rect width="120" height="120" fill="url(#sk-bg)"/><g clip-path="url(#c-sk)"><rect width="120" height="120" fill="url(#sk-bg)"/><path d="M15,90 Q8,72 15,52 Q26,28 55,20 Q78,16 95,38 Q84,58 80,82 Q76,106 84,120 L62,120 Q54,106 54,86 Q54,66 46,56 Q36,62 32,82 Q32,102 40,120 L18,120 Q8,108 15,90 Z" fill="url(#sk1)"/><path d="M55,20 Q82,12 102,38 Q92,66 88,94 Q84,118 92,120 L70,120 Q64,110 66,88 Q68,64 55,20 Z" fill="url(#sk2)"/><path d="M80,55 Q92,44 108,58 Q116,76 110,94 Q100,102 88,96 Q80,84 80,55 Z" fill="url(#sk1)"/><path d="M88,96 Q100,110 92,120 L74,120 Q82,112 88,102 Q90,99 88,96 Z" fill="url(#sk2)"/><path d="M38,48 Q54,36 70,48 Q64,70 58,92 Q50,108 44,104 Q36,94 38,48 Z" fill="url(#sk2)" opacity="0.5"/><path d="M62,12 Q80,4 98,20 Q88,36 80,32 Q72,26 62,12 Z" fill="url(#sk1)" opacity="0.8"/><path d="M50,8 Q62,2 78,10 Q70,20 62,16 Q56,12 50,8 Z" fill="url(#sk2)" opacity="0.6"/><path d="M90,60 Q95,55 102,60 L100,65 Q95,62 90,65 L90,60 Z" fill="url(#sk-bg)" opacity="0.8"/><path d="M22,65 Q30,58 38,68 Q34,78 28,74 Q22,70 22,65 Z" fill="url(#sk1)" opacity="0.4"/><path d="M18,85 Q26,78 34,88 Q30,98 24,94 Q18,90 18,85 Z" fill="url(#sk2)" opacity="0.35"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#d1d5db" stroke-width="3"/></svg>',cinna_antony:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-ca"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="ca-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e1b4b"/><stop offset="100%" stop-color="#0f0a1e"/></linearGradient><linearGradient id="ca1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#f472b6"/><stop offset="100%" stop-color="#db2777"/></linearGradient><linearGradient id="ca2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#60a5fa"/><stop offset="100%" stop-color="#2563eb"/></linearGradient></defs><rect width="120" height="120" fill="url(#ca-bg)"/><g clip-path="url(#c-ca)"><rect width="120" height="120" fill="url(#ca-bg)"/><path d="M8,85 Q4,70 10,55 Q18,38 35,32 Q48,28 58,38 Q52,50 50,65 Q48,80 54,95 L42,100 Q36,88 36,74 Q36,60 30,52 Q22,58 20,72 Q20,88 26,102 L10,102 Q4,94 8,85 Z" fill="url(#ca1)"/><path d="M35,32 Q52,24 68,38 Q60,54 58,72 Q56,90 62,108 L48,112 Q44,96 46,78 Q48,60 35,32 Z" fill="url(#ca1)" opacity="0.7"/><path d="M58,60 Q68,52 82,62 Q88,76 82,88 Q74,94 64,88 Q58,78 58,60 Z" fill="url(#ca1)"/><path d="M62,88 Q72,100 66,112 L52,112 Q58,102 62,94 Q64,91 62,88 Z" fill="url(#ca1)" opacity="0.8"/><path d="M65,85 Q60,70 65,55 Q72,40 88,35 Q100,32 110,42 Q102,54 100,68 Q98,82 104,96 L92,100 Q88,88 88,74 Q88,60 82,52 Q74,58 72,72 Q72,88 78,102 L65,102 Q60,94 65,85 Z" fill="url(#ca2)"/><path d="M88,35 Q104,28 115,42 Q108,58 105,75 Q102,92 108,110 L95,114 Q92,98 94,80 Q96,62 88,35 Z" fill="url(#ca2)" opacity="0.7"/><path d="M100,60 Q108,54 118,62 Q120,76 115,86 Q108,90 102,86 Q98,78 100,60 Z" fill="url(#ca2)"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#a855f7" stroke-width="3"/></svg>',red_aktins:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-ra"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="ra-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1c1917"/><stop offset="100%" stop-color="#0c0a09"/></linearGradient><linearGradient id="ra1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#ef4444"/><stop offset="100%" stop-color="#b91c1c"/></linearGradient><linearGradient id="ra2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#dc2626"/><stop offset="100%" stop-color="#991b1b"/></linearGradient></defs><rect width="120" height="120" fill="url(#ra-bg)"/><g clip-path="url(#c-ra)"><rect width="120" height="120" fill="url(#ra-bg)"/><path d="M18,82 Q10,64 18,44 Q30,22 55,16 Q75,12 92,30 Q80,52 76,76 Q72,100 80,120 L60,120 Q52,104 52,82 Q52,62 44,52 Q34,58 30,78 Q30,98 38,118 L18,118 Q8,106 18,82 Z" fill="url(#ra1)"/><path d="M55,16 Q80,8 100,30 Q88,58 84,86 Q80,112 88,120 L68,120 Q62,108 64,84 Q66,60 55,16 Z" fill="url(#ra2)"/><path d="M76,62 Q90,52 106,68 Q114,86 106,102 Q94,108 82,100 Q74,88 76,62 Z" fill="url(#ra1)"/><path d="M82,100 Q94,114 86,120 L70,120 Q78,112 82,104 Q84,101 82,100 Z" fill="url(#ra2)"/><path d="M36,44 Q52,32 68,44 Q62,66 56,88 Q48,104 42,100 Q34,90 36,44 Z" fill="url(#ra2)" opacity="0.5"/><path d="M62,8 Q78,0 96,14 Q86,30 78,26 Q70,20 62,8 Z" fill="url(#ra1)" opacity="0.8"/><rect x="30" y="55" width="40" height="12" fill="url(#ra-bg)" opacity="0.9"/><rect x="32" y="57" width="36" height="8" fill="url(#ra1)" opacity="0.6"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#ef4444" stroke-width="3"/></svg>',plague_doctor:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-pd"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="pd-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1a1a1a"/><stop offset="100%" stop-color="#0a0a0a"/></linearGradient><linearGradient id="pd1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#525252"/><stop offset="100%" stop-color="#262626"/></linearGradient><linearGradient id="pd2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#404040"/><stop offset="100%" stop-color="#171717"/></linearGradient></defs><rect width="120" height="120" fill="url(#pd-bg)"/><g clip-path="url(#c-pd)"><rect width="120" height="120" fill="url(#pd-bg)"/><path d="M15,85 Q8,68 15,48 Q26,26 52,20 Q72,16 88,34 Q78,54 74,78 Q70,102 78,120 L58,120 Q50,104 50,82 Q50,62 42,52 Q32,58 28,78 Q28,100 36,118 L15,118 Q6,106 15,85 Z" fill="url(#pd1)"/><path d="M52,20 Q78,12 98,34 Q88,62 84,90 Q80,116 88,120 L68,120 Q62,108 64,85 Q66,62 52,20 Z" fill="url(#pd2)"/><path d="M74,50 Q82,42 95,48 Q102,56 100,68 Q96,78 92,85 Q88,92 82,95 Q75,92 72,85 Q68,76 70,65 Q72,55 74,50 Z" fill="url(#pd1)"/><path d="M92,85 Q100,78 110,85 Q115,95 108,105 Q98,110 92,102 Q88,95 92,85 Z" fill="url(#pd2)"/><path d="M82,95 Q90,105 85,115 L70,120 Q78,112 82,104 Q84,100 82,95 Z" fill="url(#pd1)"/><path d="M34,44 Q50,32 66,44 Q60,66 54,88 Q46,104 40,100 Q32,90 34,44 Z" fill="url(#pd2)" opacity="0.5"/><path d="M60,12 Q76,4 94,18 Q84,32 76,28 Q68,22 60,12 Z" fill="url(#pd1)" opacity="0.7"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#525252" stroke-width="3"/></svg>',oxy:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-ox"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="ox-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#18181b"/><stop offset="100%" stop-color="#09090b"/></linearGradient><linearGradient id="ox1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#fafafa"/><stop offset="100%" stop-color="#a1a1aa"/></linearGradient><linearGradient id="ox2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#27272a"/><stop offset="100%" stop-color="#09090b"/></linearGradient></defs><rect width="120" height="120" fill="url(#ox-bg)"/><g clip-path="url(#c-ox)"><rect width="120" height="120" fill="url(#ox-bg)"/><path d="M16,82 Q8,64 16,44 Q28,22 54,16 Q74,12 90,30 Q80,52 76,76 Q72,100 80,120 L60,120 Q52,104 52,82 Q52,62 44,52 Q34,58 30,78 Q30,98 38,118 L16,118 Q6,106 16,82 Z" fill="url(#ox1)"/><path d="M54,16 Q78,8 98,30 Q88,58 84,86 Q80,112 88,120 L68,120 Q62,108 64,84 Q66,60 54,16 Z" fill="url(#ox2)"/><path d="M76,60 Q90,50 106,66 Q114,84 106,100 Q94,106 82,98 Q74,86 76,60 Z" fill="url(#ox1)"/><path d="M82,98 Q94,112 86,120 L70,120 Q78,112 82,102 Q84,99 82,98 Z" fill="url(#ox2)"/><path d="M36,44 Q52,32 68,44 Q62,66 56,88 Q48,104 42,100 Q34,90 36,44 Z" fill="url(#ox2)" opacity="0.6"/><path d="M62,8 Q78,0 96,14 Q86,30 78,26 Q70,20 62,8 Z" fill="url(#ox1)" opacity="0.8"/><path d="M20,60 Q28,52 35,62 Q30,72 24,68 Q20,64 20,60 Z" fill="url(#ox1)" opacity="0.5"/><path d="M16,78 Q24,70 32,80 Q28,90 22,86 Q16,82 16,78 Z" fill="url(#ox2)" opacity="0.4"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#71717a" stroke-width="3"/></svg>',dotdotdot:'<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="c-dd"><circle cx="60" cy="60" r="56"/></clipPath><linearGradient id="dd-bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e3a5f"/><stop offset="100%" stop-color="#0c1929"/></linearGradient><linearGradient id="dd1" x1="0%" y1="0%" x2="100%" y2="80%"><stop offset="0%" stop-color="#7dd3fc"/><stop offset="100%" stop-color="#38bdf8"/></linearGradient><linearGradient id="dd2" x1="20%" y1="0%" x2="80%" y2="100%"><stop offset="0%" stop-color="#38bdf8"/><stop offset="100%" stop-color="#0284c7"/></linearGradient></defs><rect width="120" height="120" fill="url(#dd-bg)"/><g clip-path="url(#c-dd)"><rect width="120" height="120" fill="url(#dd-bg)"/><path d="M16,82 Q8,64 16,44 Q28,22 54,16 Q74,12 90,30 Q80,52 76,76 Q72,100 80,120 L60,120 Q52,104 52,82 Q52,62 44,52 Q34,58 30,78 Q30,98 38,118 L16,118 Q6,106 16,82 Z" fill="url(#dd1)" opacity="0.7"/><path d="M54,16 Q78,8 98,30 Q88,58 84,86 Q80,112 88,120 L68,120 Q62,108 64,84 Q66,60 54,16 Z" fill="url(#dd2)" opacity="0.6"/><path d="M76,60 Q90,50 106,66 Q114,84 106,100 Q94,106 82,98 Q74,86 76,60 Z" fill="url(#dd1)" opacity="0.8"/><path d="M82,98 Q94,112 86,120 L70,120 Q78,112 82,102 Q84,99 82,98 Z" fill="url(#dd2)" opacity="0.7"/><path d="M36,44 Q52,32 68,44 Q62,66 56,88 Q48,104 42,100 Q34,90 36,44 Z" fill="url(#dd2)" opacity="0.45"/><path d="M62,8 Q78,0 96,14 Q86,30 78,26 Q70,20 62,8 Z" fill="url(#dd1)" opacity="0.6"/><circle cx="88" cy="95" r="4" fill="url(#dd1)" opacity="0.9"/><circle cx="98" cy="100" r="4" fill="url(#dd1)" opacity="0.7"/><circle cx="108" cy="105" r="4" fill="url(#dd1)" opacity="0.5"/></g><circle cx="60" cy="60" r="56" fill="none" stroke="#7dd3fc" stroke-width="3"/></svg>'};function getPortraitSVG(e,t=""){let o=PORTRAITS[e]||PORTRAITS.ghost;return t&&(o=o.replace(/id="([^"]+)"/g,`id="$1-${t}"`),o=o.replace(/url\(#([^)]+)\)/g,`url(#$1-${t})`)),o}function renderPortrait(e,t,o){if(!e)return;const n=getPortraitSVG(t);if(e.innerHTML=n,o){const t=e.querySelector("circle:last-child");t&&t.setAttribute("stroke",o)}}const OPPOSITE_ELEMENTS={[E.FIRE]:E.WATER,[E.WATER]:E.FIRE,[E.EARTH]:E.LIGHTNING,[E.LIGHTNING]:E.EARTH,[E.LIGHT]:E.DARK,[E.DARK]:E.LIGHT,[E.PHYS]:E.POISON,[E.POISON]:E.PHYS},HERO_ENEMY_DIALOGUE={warrior:{vowel_goblin:["This generation can't even spell. Hand over those vowels.","Hoarding letters now? You're everything wrong with this world."],ghost:["Dord? That's not even a real word. Move on already.","You're haunting us with nonsense. Typical."],synonym_roll:["You're bread. I'm a blade. Do the math.","All those words for the same thing, and none of them are 'survivor.'"],comma_chameleon:["Stop... pausing... and... fight.","I've no patience for your punctuation games."],webster_spiderling:["I don't care what the dictionary says. You're dying either way.","Spin all the semantics you want. My blade doesn't negotiate definitions."],hyphen_hyena:["Two-faced? I'll give you two halves.","Your hyphenated laughs end here."],pun_goblin:["I've heard better wordplay from corpses.","Puns won't save you from steel."],apostro_fiend:["Your grammar is as bad as your life choices.","Possessive little demon, aren't you?"],idiomatic_undead:["Great. A corpse that speaks in clich√©s. Just my luck.","I've buried better conversationalists than you."],vulgar_vandal:["I've heard enough. Shut up and fight.","Back in my day, we had the decency to swear properly."],double_negative:["You can't not die. Wait‚Äîyou know what I mean.","Two wrongs don't make you right."],run_on_sentence:["Get to the point or I'll make one for you.","Enough. Just... enough."],split_infinitive:["I'm going to completely end you.","Your grammar crimes end here."],mixed_metaphor:["That doesn't even make sense. Neither will your corpse.","You've burned your last bridge. Or crossed it. Whatever."],passive_voice:["Mistakes were made. By you. Fatally.","Let me put this in active voice: I kill you."],silent_knight:"Finally. An enemy who doesn't talk. Your silence is the only respectable thing about you‚Äîbut even respect won't save you from my blade.",cinna_antony:"I've seen a hundred soldiers tear each other apart over nothing. You two are just louder about it. Pick a side or get out of my way.",red_aktins:"You think hiding behind black bars makes you powerful? I've fought real tyrants. You're just a coward with a marker.",plague_doctor:"Copying my stance? My technique? Years of blood and training, and you think you can just take it? Earn something for once.",oxy:"Jumbo shrimp. Military intelligence. You. None of it makes sense, and I'm too old to pretend otherwise. Let's just fight.",dotdotdot:"Spit it out or shut up. I don't have time for someone who can't even commit to a sentence..."},ranger:{vowel_goblin:["You used all five at once... wasteful.","A, E, I, O, U‚Äîand none put to purpose."],ghost:["You linger without purpose. That's the true haunting.","Even spirits must know when to let go."],synonym_roll:["Many words for the same meaning. Inefficient.","You could say it once. You chose excess."],comma_chameleon:["Pausing won't save you. Arrows don't wait.","Your hesitation is your undoing."],webster_spiderling:["Eight legs and still you've caught nothing useful in that web.","Your trap is intricate. Your purpose is not."],hyphen_hyena:["Compound words won't compound your strength.","Laugh while you can. It echoes shorter than you think."],pun_goblin:["Wordplay is no substitute for wisdom.","You waste breath that could be your last."],apostro_fiend:["What you steal, you cannot keep.","Possession is temporary. Especially yours."],idiomatic_undead:["Dead men should rest. You're wasting everyone's time.","You've overstayed your welcome by several lifetimes."],vulgar_vandal:["All that noise, and nothing said.","You mistake volume for vocabulary."],double_negative:["Two denials don't create truth.","Contradiction consumes itself."],run_on_sentence:["Learn when to stop. This is that moment.","Endless words catch no prey."],split_infinitive:["Divided purpose, divided strength.","You cannot split what I make whole."],mixed_metaphor:["Your confusion spreads to your strategy.","Mixed messages end in clear defeat."],passive_voice:["Things happen to you. You don't make them happen.","Your passivity is your grave."],silent_knight:"Silence. At least you understand that much. A quiet foe is rare‚Äîand still prey. Your armor cannot hide from my arrows.",cinna_antony:"You fight each other instead of the real enemy. That's why you'll both fall‚Äîdivided resources, divided purpose, divided fate.",red_aktins:"You redact what you fear. But truth doesn't disappear‚Äîit waits. And I've gotten very good at waiting.",plague_doctor:"Imitation is theft dressed as flattery. You've taken the surface and missed the substance entirely.",oxy:"You call yourself a paradox, but you're just confused. Nature doesn't tolerate contradiction‚Äîit resolves it.",dotdotdot:"You trail off because you fear endings. But everything ends. Everything. Even..."},mage:{vowel_goblin:["Oh my, what darling little letters you've collected! Though I wonder... do they make you feel less empty inside?","Such pretty vowels! It's almost a shame what I'm about to do. Almost."],ghost:["A phantom! How romantic, how tragic, how‚Äî wait, you're actually trying to hurt me? That's... that's quite rude, actually.","Poor lost spirit. I'd offer sympathy, but you're in my way, and I don't have time for this."],synonym_roll:["So many words for the same thing! I do that too, you know‚Äîwhen I'm avoiding something.","Darling, repetition won't hide what you really mean. Trust me, I've tried."],comma_chameleon:["What a lovely creature! Though I notice you pause a lot. Avoiding something, perhaps? ...Not that I'd know anything about that.","Your hesitation is adorable. Mine is calculated. There's a difference."],webster_spiderling:["Oh, how industrious! Weaving definitions to trap meaning. I appreciate the craft, truly. But I'm not getting caught today.","Such intricate work! It's almost a shame to burn it all down. Almost."],hyphen_hyena:["Your laughter is charming! Though it does seem a bit... forced? No judgment, I understand performance.","Joined together yet still incomplete. Hm. That's not a metaphor I want to examine too closely."],pun_goblin:["Oh, how clever! Wordplay to deflect! I would never‚Äî okay, fine, maybe I would. But I'm better at it.","Your jokes are a lovely shield, darling. I wear one too. Shall we see whose cracks first?"],apostro_fiend:["Possessive little thing, aren't you? Taking what isn't yours. I wouldn't know anything about that. Moving on.","You cling to what you've claimed. I understand. But some things must be let go."],idiomatic_undead:["Still clinging to old phrases? How quaint. Some of us evolve, you know. Some of us have to.","Dead words walking. There's poetry in that, if you squint. Now hold still."],vulgar_vandal:["Such language! I'm absolutely scandalized. ...Okay, no I'm not. I've said worse when no one's listening.","All that anger, thrown at the world. I keep mine somewhere else. Somewhere it can't be used against me."],double_negative:["Two negatives making... nothing? That's not how it works, dear. Though I wish it were.","Your math is wrong and your existence is an error. Let me correct both."],run_on_sentence:["Oh my, you just keep going! It's almost impressive. When do you breathe? When do you stop and actually feel‚Äînever mind.","All those words and none of them say what you really mean. I know the feeling."],split_infinitive:["Grammatically speaking, you're a disaster. Emotionally speaking... well, glass houses and all that.","Divided against yourself. Not that I would understand that at all. *nervous laugh*"],mixed_metaphor:["Your metaphors are all tangled up, dear. Your feelings too, I imagine. Not that I‚Äî this isn't about me.","Such confusion! It's almost relatable. I said almost."],passive_voice:["Things just happen to you, don't they? You never choose. Must be nice, actually. Simpler.","No agency, no responsibility. There's a freedom in that I sometimes envy."],silent_knight:"Oh, the strong silent type! How mysterious, how brooding, how‚Äî you know what, I don't have to fill your silence for you. I do enough of that for myself.",cinna_antony:"Fascinating, you two. So busy fighting each other you never have to look at yourselves. That's not a strategy I recognize at all. Nope. Never done that.",red_aktins:"Redacting the parts you don't like? How delightfully avoidant. I prefer illusion myself, but we all have our methods. Now get out of my way.",plague_doctor:"You copy what you see, but not what's underneath. Smart, actually. The underneath is where it gets messy. Trust me.",oxy:"Contradictions everywhere! Living death, sweet sorrow, confident princess who definitely has her life together‚Äî wait, forget that last one. Just. Forget it.",dotdotdot:"Trailing off before you have to finish the thought? Before you have to commit? ...I respect the technique, honestly."},paladin:{vowel_goblin:["What hollow hoard is this, that grasps yet never gives? / My purpose calls: to free the voice that in your shadow lives.","You clutch at letters like a drowning soul clutches driftwood. / Let go. I shall be your shore‚Äîas I was always meant to be."],ghost:["O shade who walks 'tween meaning and the void‚Äî / My blade shall write the ending you've too long avoided.","A whisper caught in amber, neither here nor hence. / My purpose is your peace. Without it, what am I?"],synonym_roll:["A thousand words for one, yet silence speaks the truth. / My duty is to cut through noise‚Äîto carve meaning from uncouth.","You spin your wheels of sameness, never moving, never still. / Stand aside, or learn what purpose means through steel and will."],comma_chameleon:["Between the pause and breath, you hide from what must come. / But I? I am the sentence's end‚Äîthe final, righteous sum.","You hesitate where I cannot. The path is clear, the duty plain. / What would I be without this charge? ...No. Forward. Strike again."],webster_spiderling:["You weave your web of meaning, trap truth in silken lies. / But justice cuts through gossamer‚Äîmy oath shall be your demise.","Definition is your prison, but purpose sets one free. / Without my sacred charge to keep... who would I even be?"],hyphen_hyena:["Joined yet incomplete, your laughter rings so hollow. / I know the shape of purpose‚Äîand your emptiness I will not follow.","Two halves a whole do not make when the center knows no creed. / My mission is my meaning. Yours? Just hunger. Just need."],pun_goblin:["Behind each jest, a wound that wit cannot conceal. / I'll break your shield of laughter‚Äîlet my righteous hammer heal.","You deflect with cleverness, but duty knows no jest. / I am defined by sacred oath. You? By running from the rest."],apostro_fiend:["What you possess was never yours to claim. / My oath demands I strip you bare‚Äîrestore the unnamed to their name.","You cling to stolen syllables like they give you form. / Without my charge, I too might grasp... No. I am the storm."],idiomatic_undead:["Dead phrases walk through you, a vessel for the past. / My purpose burns eternal‚Äîyours shall never last.","You are what repetition makes: a hollow, echoing shell. / I am what duty forges. Without it? ...I cannot tell."],vulgar_vandal:["Your curses fall like rain upon a righteous shore. / I am the cleansing tide‚Äîand I was made for nothing more.","Beneath your fury hides a soul that lost its way. / I'll show you what true purpose means‚Äîthen end your wretched day."],double_negative:["Two wrongs entwined still cannot make a right. / My oath is singular and pure‚Äîa lone and guiding light.","You cancel out yourself, becoming less than nil. / I am defined by sacred charge. You? By lack of will."],run_on_sentence:["Your story sprawls unending, formless, without grace. / I am the final period‚Äîthe pause that ends the race.","On and on you ramble, never finding rest. / My purpose is conclusion. I shall give you my best."],split_infinitive:["Divided, you stand weakened‚Äîtorn from your own core. / My oath keeps me together. Without it... what's worth fighting for?","To boldly cleave what should be whole‚Äîyour sin is written clear. / I'll mend what you have broken. That is why I'm here."],mixed_metaphor:["Your thoughts are tangled verses with no rhythm, rhyme, or reason. / My duty is to clarify‚Äîand end your muddled treason.","Confusion clouds your purpose, if you ever had one true. / I know exactly what I am. ...Most days. Most days, I do."],passive_voice:["Fate acts upon you, never by your hand. / I choose my path each morning. I rise because I stand.","To be moved by forces unknown, never to decide‚Äî / There's freedom in that absence. ...No. No. I take pride."],silent_knight:"Your silence speaks in verses my ears alone can hear‚Äî / A dirge of duty's burden, of purpose bought with tears. / I understand you, brother, more than words could ever say. / For what are we without our charge? What's left when oaths decay?",cinna_antony:"Two voices raised in discord, when harmony could reign! / My oath demands I end this strife‚Äîthough victory brings pain. / For siblings should lift each other toward the poet's light. / Without my charge to guide me... I too might lose the fight.",red_aktins:"Each word you strike from history is a soul you've left unsung! / My sacred duty speaks for those whose voices you have wrung. / Censorship is violence dressed in editorial black. / I'll write back every syllable. That's an oath I'll never slack.",plague_doctor:"You wear a hundred voices, yet speak with none your own. / Beneath the masks of mimicry, I hear a hollow tone. / Find your own verse, plagiarist, or face my righteous rhyme. / Without my purpose... I might wander, lost, through time.",oxy:"You think in contradictions, as if paradox were shield. / But unity of purpose is the weapon I shall wield! / Living death, sweet sorrow‚Äîpretty words that mean nothing true. / I am defined by sacred charge. And I shall un-define you.",dotdotdot:"Each thought you leave unfinished is a promise cast aside! / The world deserves its closure‚Äîand I shall be its guide. / For what is purpose but completion? What is oath but end? / ...And what am I without this charge? A stanza without end..."},assassin:{vowel_goblin:["...","Ditto."],ghost:["Ditto.","..."],synonym_roll:["...","Redundant."],comma_chameleon:["...","..."],webster_spiderling:["...","*cuts web*"],hyphen_hyena:["...","‚Äî"],pun_goblin:["...","*sighs*"],apostro_fiend:["...","'"],idiomatic_undead:["...","*waits*"],vulgar_vandal:["......","*faint smirk*"],double_negative:["...","Yes."],run_on_sentence:[".","..."],split_infinitive:["...","*blade drawn*"],mixed_metaphor:["...","*tilts head*"],passive_voice:["...","Act."],silent_knight:"*respectful nod*",cinna_antony:"Two halves... neither whole... I understand.",red_aktins:"[REDACTED]... becomes remembered.",plague_doctor:"You copy... but cannot feel... the weight behind the words.",oxy:"Opposite truths... can coexist... in silence.",dotdotdot:"..."},druid:{vowel_goblin:["Nature's gifts are powerful, but not finite. Those vowels belong to Etymos.","The forest does not hoard its seeds. Why do you?"],ghost:["Even the forgotten have roots. Etymos remembers what you were meant to be.","You drift because you've lost your etymology. Return to the source."],synonym_roll:["Many branches, one tree. You have forgotten the trunk.","Variety is nature's way‚Äîbut you have lost your roots."],comma_chameleon:["Nature breathes without pause. You interrupt the rhythm.","The world speaks in flow. You stutter."],webster_spiderling:["Even spiders serve the web of Etymos. You have forgotten your place within it.","You define to control. Nature defines to connect."],hyphen_hyena:["Connection should strengthen, not divide.","Your bonds are chains. The forest knows freedom."],pun_goblin:["Wordplay is the wind through leaves‚Äîbrief and forgotten.","Your jokes scatter like seeds on stone."],apostro_fiend:["What you take from words, Etymos reclaims.","Possession is illusion. Return what you borrowed."],idiomatic_undead:["The cycle demands you return to soil. You resist nature's grammar.","Decay is a form of speech. You have forgotten how to finish your sentence."],vulgar_vandal:["You poison the air with entropy. Etymos will cleanse what you've corrupted.","Language is a gift. You use it as a weapon against itself."],double_negative:["Nature knows only truth. Your contradictions wither.","Even negatives feed the cycle‚Äîbut two starve it."],run_on_sentence:["The river knows when to reach the sea. Learn from it.","Endless flow without destination is a flood."],split_infinitive:["What is divided must be rejoined. The roots teach this.","You have split the seedling. It cannot grow."],mixed_metaphor:["The forest speaks clearly. You have tangled its voice.","Nature's metaphors are singular. Yours are noise."],passive_voice:["The wind does not wait to be blown. Act, or be acted upon.","Etymos speaks through those who move."],silent_knight:"Silence is the language of the earth. You wear it well, but understand nothing. The stones are silent too‚Äîthey outlast all knights. Etymos remembers what you have forgotten.",cinna_antony:"Etymos teaches that opposition and unity are both paths to truth. You've chosen neither‚Äîonly noise. The world grows tired of your argument.",red_aktins:"Etymos knows every word you've erased. The roots remain, buried but alive. You cannot unwrite what the world has already spoken.",plague_doctor:"A seed planted in stolen soil will never truly bloom. Etymos knows the difference between a root and a graft. You are no gardener.",oxy:"Fire and water, light and dark‚ÄîEtymos holds all opposites in balance. You are not balance. You are a wound that refuses to close.",dotdotdot:"Even Etymos knows that some thoughts must end for new ones to grow. You hoard potential and call it depth. It is only..."}};function getHeroEnemyDialogue(e,t){const o=HERO_ENEMY_DIALOGUE[e];if(!o)return null;const n=o[t];return n?Array.isArray(n)?n[Math.floor(Math.random()*n.length)]:n:null}const BOSS_VICTORY_DIALOGUE={warrior:{cinna_antony:"They were at odds. Now, they are at peace.",red_aktins:"Your redactions are over. The record is restored.",plague_doctor:"An imitation is not the original. Your form was poor.",oxy:"Contradiction is illogical. Now it is resolved.",dotdotdot:"An unfinished sentence is not a life. Be complete.",silent_knight:"The 'K' is silent. Now, so are you. Your duty is done."},ranger:{cinna_antony:"Two notes make dissonance. One note makes peace. The song is over.",red_aktins:"One, two, three, your words fall away. My count is done.",plague_doctor:"You can follow my steps, but you can't find my rhythm. The dance is over.",oxy:"A tune sung high and low at once. Now... there is only quiet.",dotdotdot:"One beat, two beats, three beats... no four. An unfinished measure finds no melody.",silent_knight:"The quietest footstep makes the loudest echo. Listen."},mage:{cinna_antony:"A story pulling in two directions needs a firm editor. This draft is done.",red_aktins:"Your redactions were clumsy and cruel. Consider this my final, published revision.",plague_doctor:"A footnote trying to be the main text. Your plagiarism has earned you a full stop.",oxy:"This character's motivations were a first-draft mess. May you find consistency in the epilogue.",dotdotdot:"A promising opening, but no follow-through. Let us just write 'The End.'",silent_knight:"A character with no dialogue is a tragedy. May you find your voice in the margins."},paladin:{cinna_antony:"By my Oath, your discord is mended. Find harmony in the Archives of what-has-been.",red_aktins:"The Word cannot be chained or erased. May you find the passages you were missing.",plague_doctor:"To steal a Word is to profane it! Be cleansed of your borrowed, hollow speech.",oxy:"O, fractured soul, a paradox made manifest. The Word is Truth, not contradiction. Be whole again.",dotdotdot:"The Great Story must not be left unfinished. May you find your conclusion in the silence.",silent_knight:"Let The Word fill your void. Your silence was a prayer answered with peace."},assassin:{cinna_antony:"Arguing... then not.",red_aktins:"[REDACTED]... is un-redacted.",plague_doctor:"My moves... not yours.",oxy:"Contradiction... resolves.",dotdotdot:"You trailed off... I finished it.",silent_knight:"..."},druid:{cinna_antony:"Two branches fighting the wind. Now, they return to the same soil.",red_aktins:"You cannot prune a forest into a single, bare tree. Growth is inevitable.",plague_doctor:"A vine that mimics the shape of an oak is still just a vine. Find your own roots.",oxy:"A winter blossom, a sunless dawn. Nature does not abide such things for long. Be at ease.",dotdotdot:"A seed that never sprouts, a river that never reaches the sea. All things must complete their cycle.",silent_knight:"Even the oldest stone is worn down by patient moss. Your silence can finally feed the soil."}};function getBossVictoryDialogue(e,t){const o=BOSS_VICTORY_DIALOGUE[e];return o&&o[t]||null}const WORLD_SKY=[E.FIRE,E.WATER,E.EARTH,E.LIGHTNING],BODY_SOUL=[E.PHYS,E.POISON,E.LIGHT,E.DARK];function isWorldSky(e){return WORLD_SKY.includes(e)}function isBodySoul(e){return BODY_SOUL.includes(e)}function hasElement(e,t){return e.some(e=>e.elem===t)}function hasElements(e,t){const o=new Set(e.filter(e=>void 0!==e.elem).map(e=>e.elem));return t.every(e=>o.has(e))}function countElement(e,t){return e.filter(e=>e.elem===t).length}function countTier(e,t){return e.filter(e=>!e.isStick&&e.rarity===t).length}function countType(e,t){return e.filter(e=>e.type===t).length}function countAdjSlots(e){let t=0;return e&&e.adj1&&t++,e&&e.adj2&&t++,e&&e.adj3&&t++,e&&e.adj4&&t++,t}function hasDamageType(e,t){return e&&e.category===t}function chapterScale(e,t){return t<=1?e:Math.round(e*Math.pow(2.5,t-1)*10)/10}function chapterScaleW(e,t){return e}const TALENTS=[{id:"world_sky_focus",name:"World & Sky Focus",desc:'World & Sky Words: <span class="mod-badge word">+5 W</span> each',flavor:"Fire, Water, Earth, Lightning empowered.",rarity:"uncommon",category:"generator",apply:e=>0},{id:"body_soul_focus",name:"Body & Soul Focus",desc:'Body & Soul Words: <span class="mod-badge word">+5 W</span> each',flavor:"Physical, Poison, Light, Dark empowered.",rarity:"uncommon",category:"generator",apply:e=>0},{id:"proficiency_focus",name:"Proficiency Focus",desc:'Proficient Weapon in Forge: <span class="mod-badge word">+6 W</span>',rarity:"common",category:"generator",apply:e=>0},{id:"weakness_exploit",name:"Weakness Exploit",desc:"Hitting enemy Weakness: +6 W per Word",rarity:"uncommon",category:"generator",apply:e=>0},{id:"isocolon",name:"Isocolon",desc:'All Words same Tier: <span class="mod-badge word">+15 W</span>',flavor:"Parallel structure with equal length and rhythm.",rarity:"uncommon",category:"generator",apply:e=>0},{id:"hendiadys",name:"Hendiadys",desc:'2+ Adjective slots filled: <span class="mod-badge word">+6 W</span>',flavor:"Expression of a single idea using two words joined by 'and'.",rarity:"common",category:"generator",apply:e=>0},{id:"stony_brook",name:"Stony Brook",desc:'Water + Earth in Forge: <span class="mod-badge word">+12 W</span>',flavor:"Where rivers meet stone.",rarity:"common",category:"generator",apply:e=>hasElements(e.allWords,[E.WATER,E.EARTH])?12:0},{id:"alliteration",name:"Alliteration",desc:"2+ consecutive words same first letter: +8 W each",flavor:"Peter Piper picked a peck...",rarity:"uncommon",category:"generator",apply:e=>0},{id:"magma_core",name:"Magma Core",desc:"Fire + Earth: √ó2",rarity:"uncommon",category:"multiplier",apply:e=>hasElements(e.allWords,[E.FIRE,E.EARTH])?2:1},{id:"tempest",name:"Tempest",desc:"Lightning + Water: √ó2",rarity:"uncommon",category:"multiplier",apply:e=>hasElements(e.allWords,[E.LIGHTNING,E.WATER])?2:1},{id:"eclipse",name:"Umbral Dawn",desc:'Light + Dark in Forge: <span class="mod-badge scale">√ó2</span>',rarity:"uncommon",category:"multiplier",apply:e=>hasElements(e.allWords,[E.LIGHT,E.DARK])?2:1},{id:"necrotoxin",name:"Thanatos",desc:"Dark + Poison: √ó2",rarity:"uncommon",category:"multiplier",apply:e=>hasElements(e.allWords,[E.DARK,E.POISON])?2:1},{id:"blessed_steel",name:"Helios",desc:"Light + Physical: √ó2",rarity:"uncommon",category:"multiplier",apply:e=>hasElements(e.allWords,[E.LIGHT,E.PHYS])?2:1},{id:"static_earth",name:"Gaia",desc:"Lightning + Earth: √ó2",rarity:"uncommon",category:"multiplier",apply:e=>hasElements(e.allWords,[E.LIGHTNING,E.EARTH])?2:1},{id:"synecdoche",name:"Synecdoche",desc:'4+ Words same Element: <span class="mod-badge scale">√ó4</span>',flavor:"A part representing the whole, or the whole for a part.",rarity:"uncommon",category:"multiplier",apply:e=>{const t=e.allWords.filter(e=>void 0!==e.elem);if(t.length<4)return 1;const o=t[0].elem;return t.every(e=>e.elem===o)?4:1}},{id:"minimalist",name:"Brevity",desc:'Exactly 2 Words in Forge: <span class="mod-badge scale">√ó3</span>',rarity:"uncommon",category:"multiplier",apply:e=>2===e.allWords.length?3:1},{id:"maximalist",name:"Maximalist",desc:'All 6 slots filled: <span class="mod-badge scale">√ó2.5</span>',rarity:"uncommon",category:"multiplier",apply:e=>e.allWords.length>=6?2.5:1},{id:"dual_spec",name:"Dual Spec",desc:'Both Hero\'s Strong Elements in Forge: <span class="mod-badge scale">√ó2</span>',rarity:"uncommon",category:"multiplier",apply:e=>{const t=e.hero.str||[];return t.length<2?1:hasElements(e.allWords,t)?2:1}},{id:"weak_point",name:"Weak Point",desc:'Hit Enemy Weakness: <span class="mod-badge scale">√ó1.5</span>',rarity:"common",category:"multiplier",apply:e=>e.allWords.some(t=>void 0!==t.elem&&e.enemy.weak.includes(t.elem))?1.5:1},{id:"monolith",name:"Monolith",desc:'All Words T3: <span class="mod-badge scale">√ó4</span>',rarity:"uncommon",category:"multiplier",apply:e=>{const t=e.allWords.filter(e=>!e.isStick);return 0!==t.length&&t.every(e=>3===e.rarity)?4:1}},{id:"anaphora",name:"Anaphora",desc:'First Word in Forge: <span class="mod-badge reread">REREAD</span>',flavor:"Repetition of a word at the beginning of successive clauses.",rarity:"rare",category:"retrigger",apply:e=>0},{id:"epistrophe",name:"Epistrophe",desc:'Last Word in Forge: <span class="mod-badge reread">REREAD</span>',flavor:"Repetition of a word at the end of successive clauses.",rarity:"rare",category:"retrigger",apply:e=>0},{id:"gemination",name:"Gemination",desc:'2+ Words same Tier: <span class="mod-badge reread">REREAD</span> all matching',flavor:"The doubling of a consonant sound.",rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"diacope",name:"Diacope",desc:'All 4 Elements from one Family: <span class="mod-badge reread">REREAD ALL</span>',flavor:"Repetition separated by intervening words.",rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"resonance",name:"Resonance",desc:'Hero\'s Strong Element Words: <span class="mod-badge reread">REREAD</span> each',rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"amplify",name:"Khopesh",desc:'Weapon Slot: <span class="mod-badge reread">REREAD</span>',rarity:"rare",category:"retrigger",apply:e=>0},{id:"gem_resonance",name:"Gem Resonance",desc:'Gem Slot filled: <span class="mod-badge reread">REREAD</span>',flavor:"The gem echoes with stored power.",rarity:"common",category:"retrigger",apply:e=>0},{id:"execute",name:"Execute",desc:'Enemy survives at ‚â§15% HP: <span class="mod-badge reread">REREAD ALL</span>',rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"echo_chamber",name:"Echo Chamber",desc:'Per <span class="mod-badge reread">REREAD</span>: <span class="mod-badge word">+5 W</span>',flavor:"Words echo through the chamber, amplifying their power.",rarity:"rare",category:"converter",apply:e=>0},{id:"residual",name:"Residual",desc:'Per <span class="mod-badge word">+W</span> bonus: <span class="mod-badge add">+0.2 AP</span>',flavor:"The afterglow of powerful words.",rarity:"uncommon",category:"converter",apply:e=>0},{id:"golden_tongue",name:"Golden Tongue",desc:'Per 20 gold: <span class="mod-badge word">+1 W</span>',flavor:"Money speaks volumes.",rarity:"common",category:"converter",apply:e=>0},{id:"overkill_dividend",name:"Overkill Dividend",desc:"Overkill damage becomes Gold (10:1, max 50)",flavor:"Excessive force has its rewards.",rarity:"common",category:"converter",apply:e=>0},{id:"echo_profits",name:"Echo Profits",desc:'Per <span class="mod-badge reread">REREAD</span>: <span class="mod-badge gold">+2 Gold</span> after victory',flavor:"Every echo pays dividends.",rarity:"common",category:"converter",apply:e=>0,goldBonus:e=>2*(e.state.lastCombatRereads||0)},{id:"elemental_bounty",name:"Elemental Bounty",desc:'Per unique element: <span class="mod-badge gold">+3 Gold</span> after victory',flavor:"Nature rewards diversity.",rarity:"uncommon",category:"converter",apply:e=>0,goldBonus:e=>{const t=e.allWords||[];return 3*new Set(t.filter(e=>void 0!==e.elem).map(e=>e.elem)).size}},{id:"treasure_hunter",name:"Treasure Hunter",desc:'Per T3 word in forge: <span class="mod-badge gold">+5 Gold</span> after victory',flavor:"The rare are worth hunting.",rarity:"common",category:"converter",apply:e=>0,goldBonus:e=>5*(e.allWords||[]).filter(e=>e.rarity===T.T3).length},{id:"appraisers_eye",name:"Appraiser's Eye",desc:'Per rarity word: <span class="mod-badge gold">+5 Gold</span> after victory',flavor:"A trained eye knows true value.",rarity:"common",category:"converter",apply:e=>0,goldBonus:e=>5*(e.allWords||[]).filter(e=>"rarity"===e.type).length},{id:"reread_amplifier",name:"Reread Amplifier",desc:'Per <span class="mod-badge reread">REREAD</span>: <span class="mod-badge scale">√ó1.5</span> (stacks)',flavor:"Repetition breeds power.",rarity:"rare",category:"converter",apply:e=>0},{id:"lexicon_growth",name:"Lexicon Growth",desc:'Per Word, per Boss defeated: <span class="mod-badge word">+1 W</span>',flavor:"Your vocabulary expands with each victory.",rarity:"uncommon",category:"converter",apply:e=>0},{id:"momentum",name:"Momentum",desc:'Each Word: <span class="mod-badge word">+1 W</span> per round completed',flavor:"Victory begets victory.",rarity:"common",category:"converter",apply:e=>0},{id:"compound_interest",name:"Compound Interest",desc:'Per 50 gold: <span class="mod-badge scale">√ó1.15</span>',flavor:"Money makes money.",rarity:"rare",category:"converter",apply:e=>0},{id:"word_historian",name:"Word Historian",desc:'Per Word used this run: <span class="mod-badge word">+0.25 W</span>',flavor:"Every word you've spoken echoes forward.",rarity:"uncommon",category:"converter",apply:e=>0},{id:"reverberation",name:"Reverberation",desc:'Per <span class="mod-badge reread">REREAD</span> triggered this run: <span class="mod-badge word">+2 W</span>',flavor:"Past echoes amplify future resonance.",rarity:"uncommon",category:"converter",apply:e=>0},{id:"critical_mass",name:"Critical Mass",desc:'T3 Words in Forge: <span class="mod-badge reread">REREAD</span> each',flavor:"The tipping point.",rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"rarity_cascade",name:"Rarity Cascade",desc:'Rarity words in Forge: <span class="mod-badge reread">REREAD</span> each',flavor:"Quality echoes through time.",rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"overflow",name:"Overflow",desc:'Per <span class="mod-badge word">10 W</span> above 50: <span class="mod-badge scale">√ó1.5</span>',flavor:"More than the vessel can hold.",rarity:"rare",category:"converter",apply:e=>0},{id:"cascade",name:"Cascade",desc:'Per unique Element in Forge: <span class="mod-badge scale">√ó1.5</span>',flavor:"An unstoppable torrent.",rarity:"rare",category:"multiplier",apply:e=>{const t=new Set(e.allWords.map(e=>e.elem).filter(e=>void 0!==e));return Math.pow(1.5,t.size)}},{id:"chain_reaction",name:"Chain Reaction",desc:'4+ <span class="mod-badge reread">REREAD</span>: <span class="mod-badge scale">√ó3</span>',flavor:"One triggers another.",rarity:"rare",category:"threshold",threshold:4,resource:"REREAD",apply:e=>0},{id:"crescendo",name:"Crescendo",desc:'6+ <span class="mod-badge reread">REREAD</span>: <span class="mod-badge reread">REREAD ALL</span> again',flavor:"Building to the climax.",rarity:"rare",category:"threshold",threshold:6,resource:"REREAD",apply:e=>0},{id:"fortuna",name:"Fortuna",desc:'100+ gold: <span class="mod-badge scale">√ó2</span>',flavor:"Fortune favors the wealthy.",rarity:"uncommon",category:"threshold",threshold:100,resource:"GOLD",apply:e=>(e.state.gold||0)>=100?2:1},{id:"capital_punishment",name:"Capital Punishment",desc:'Enemy is Boss or Miniboss: <span class="mod-badge scale">√ó2.5</span>',flavor:"Big letters for big enemies.",rarity:"common",category:"threshold",apply:e=>e.enemy.isBoss||e.enemy.isMiniboss?2.5:1},{id:"berserker",name:"Berserker",desc:'Per Chapter: <span class="mod-badge scale">√ó1.5</span>',flavor:"Rage builds with time.",rarity:"rare",category:"multiplier",apply:e=>{const t=Math.floor(((e.state.roundIndex||1)-1)/9)+1;return Math.pow(1.5,t)}},{id:"perfectionist",name:"Perfectionist",desc:'All 6 slots filled, no Resisted Elements: <span class="mod-badge scale">√ó3</span>',flavor:"Flawless execution.",rarity:"uncommon",category:"threshold",apply:e=>{if(!["item","adj1","adj2","adj3","adj4","noun1"].every(t=>e.sel[t]))return 1;return e.allWords.some(t=>void 0!==t.elem&&e.enemy.res&&e.enemy.res.includes(t.elem))?1:3}},{id:"signature_style",name:"Signature Style",desc:"Proficient Weapon counts as both Hero's Strong Elements",rarity:"uncommon",category:"effect",disabled:!0,apply:e=>0},{id:"irony",name:"Irony",desc:"One Enemy Resistance becomes Weakness",flavor:"A figure of speech where the intended meaning is opposite to the literal meaning.",rarity:"common",category:"effect",apply:e=>1},{id:"crown_jewel",name:"Kohinoor",desc:'Gem Slot: <span class="mod-badge word">√ó4 W</span> instead of √ó2',flavor:"Mountain of Light.",rarity:"rare",category:"effect",apply:e=>0},{id:"hyperbole",name:"Hyperbole",desc:"Overkill √ó2 carries to next Round (max 25% HP)",flavor:"Exaggerated statements not meant to be taken literally.",rarity:"uncommon",category:"effect",apply:e=>1},{id:"word_hoard",name:"Word Hoard",desc:'Per Word in Inventory: <span class="mod-badge word">+0.2 W</span>',flavor:"A dragon's treasure of language.",rarity:"common",category:"generator",apply:e=>0},{id:"slow_burn",name:"Slow Burn",desc:'<span class="mod-badge word">+2 W</span> √ó Round',flavor:"Patience rewards the persistent.",rarity:"common",category:"generator",apply:e=>0},{id:"trinity",name:"Trinity",desc:'Exactly 3 Words in Forge: <span class="mod-badge scale">√ó2.5</span>',flavor:"Three is a magic number.",rarity:"uncommon",category:"multiplier",apply:e=>3===e.allWords.length?2.5:1},{id:"glass_cannon",name:"Glass Cannon",desc:'Exactly 1 Word in Forge: <span class="mod-badge scale">√ó5</span>',flavor:"One word to rule them all.",rarity:"uncommon",category:"multiplier",apply:e=>1===e.allWords.length?5:1},{id:"focused_fire",name:"Focused Fire",desc:'Only 1 of Hero\'s Strong Elements in Forge: <span class="mod-badge scale">√ó2.5</span>',flavor:"Specialization over diversification.",rarity:"uncommon",category:"multiplier",apply:e=>{const t=e.hero;if(!t||!t.str)return 1;const o=new Set(e.allWords.map(e=>e.elem).filter(e=>void 0!==e));return 1===t.str.filter(e=>o.has(e)).length?2.5:1}},{id:"opening_strike",name:"Opening Strike",desc:'Weapon is first slot filled: <span class="mod-badge scale">√ó1.5</span>',flavor:"Lead with your blade.",rarity:"common",category:"multiplier",apply:e=>{if(!e.sel.item)return 1;return"item"===["item","adj1","adj2","adj3","adj4","noun1"].find(t=>e.sel[t])?1.5:1}},{id:"polysyndeton",name:"Polysyndeton",desc:'3+ Elements in Forge: <span class="mod-badge reread">REREAD</span> highest AP Word',flavor:"Conjunction junction, what's your function?",rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"anadiplosis",name:"Anadiplosis",desc:'Adjacent Words share Element: <span class="mod-badge reread">REREAD</span> both',flavor:"The end of one becomes the beginning of another.",rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"chiasmus",name:"Chiasmus",desc:'First and Last elemental Words same Element: <span class="mod-badge reread">REREAD √ó2</span> both',flavor:"What begins, ends. What ends, begins.",rarity:"uncommon",category:"retrigger",apply:e=>0},{id:"tithe",name:"Tithe",desc:'Per 20 gold spent: <span class="mod-badge word">+2 W</span>',flavor:"Offerings beget power.",rarity:"uncommon",category:"converter",apply:e=>0},{id:"steady_hand",name:"Steady Hand",desc:'<span class="mod-badge word">+3 W</span>',flavor:"A firm grip yields consistent results.",rarity:"common",category:"generator",apply:e=>0},{id:"first_blood",name:"First Blood",desc:'Chapter 1: <span class="mod-badge word">+10 W</span>',flavor:"Write when the iron is hot.",rarity:"common",category:"generator",apply:e=>0},{id:"comfort_zone",name:"Comfort Zone",desc:'Only 1 Element type in Forge: <span class="mod-badge word">+6 W</span>',flavor:"Familiarity breeds confidence.",rarity:"common",category:"generator",apply:e=>0},{id:"linguist",name:"Linguist",desc:'3+ Word types in Forge: <span class="mod-badge word">+5 W</span>',flavor:"A polyglot of destruction.",rarity:"common",category:"generator",apply:e=>0},{id:"condensed",name:"Condensed",desc:'3 or fewer Words in Forge: <span class="mod-badge word">+8 W</span>',flavor:"Less is more.",rarity:"common",category:"generator",apply:e=>0},{id:"spectrum",name:"Spectrum",desc:'Per unique Element in Forge: <span class="mod-badge word">+2 W</span>',flavor:"A rainbow of destruction.",rarity:"common",category:"generator",apply:e=>0},{id:"inferno",name:"Inferno",desc:'Fire + Water in Forge: <span class="mod-badge word">+10 W</span>',flavor:"Steam and fury.",rarity:"common",category:"generator",apply:e=>hasElements(e.allWords,[E.FIRE,E.WATER])?10:0},{id:"verdant",name:"Verdant",desc:'Earth + Light in Forge: <span class="mod-badge word">+10 W</span>',flavor:"Growth under sunlight.",rarity:"common",category:"generator",apply:e=>hasElements(e.allWords,[E.EARTH,E.LIGHT])?10:0},{id:"venom_strike",name:"Venom Strike",desc:'Poison + Lightning in Forge: <span class="mod-badge word">+10 W</span>',flavor:"Shocking toxicity.",rarity:"common",category:"generator",apply:e=>hasElements(e.allWords,[E.POISON,E.LIGHTNING])?10:0},{id:"twilight",name:"Twilight",desc:'Dark + Physical in Forge: <span class="mod-badge word">+10 W</span>',flavor:"Shadows made manifest.",rarity:"common",category:"generator",apply:e=>hasElements(e.allWords,[E.DARK,E.PHYS])?10:0},{id:"bibliophile",name:"Bibliophile",desc:'Per Word in Forge: <span class="mod-badge add">+1 AP</span>',flavor:"Knowledge is power.",rarity:"common",category:"generator",apply:e=>0}],CONSUMABLES=[{id:"same_day_delivery",name:"Same-Day Delivery",cost:25,desc:"Generate a random T3 Word and add to inventory.",use:e=>{const t=WORDS.filter(e=>e.rarity===T.T3);if(t.length>0){const o=e.inv.filter(e=>!e.hiddenInBank).length;if(o>=24)return{success:!1,message:"Inventory full! Cannot add new Word."};const n=t[Math.random()*t.length|0],s={...n};return e.inv.push(s),{success:!0,message:`Generated ${n.name}!`,affectedWord:s,effectType:"generate"}}return{success:!1,message:"No T3 Words available."}}},{id:"weapon_master_consumable",name:"Weapon Master",cost:15,desc:"All weapons get √ó3 proficiency bonus this battle.",use:e=>(e.tempEffects.weaponMaster=3,{success:!0,message:"Weapon Master active! All weapons √ó3!"})},{id:"quality_assurance",name:"Quality Assurance",cost:15,desc:"Upgrade a selected Word's Tier by 1.",use:e=>{const t=e.pendingWord;if(!t)return{success:!1,message:"Highlight a Word to upgrade."};if(t.isStick){const o=e.hero?.good||"slash",n=WORDS.find(e=>"weapon"===e.type&&e.category===o&&e.rarity===T.T1)||WORDS.find(e=>"weapon"===e.type&&e.rarity===T.T1);if(n){const e={...n};return applyWordUpgrade(t,e),{success:!0,message:`Stick upgraded to ${e.name}!`,affectedWord:t,effectType:"upgrade"}}return{success:!1,message:"Could not upgrade Stick."}}if(getTierRank(t)>=3)return{success:!1,message:`${t.name} is already at the highest rank.`};const o=findNextTierWord(t);return o?(applyWordUpgrade(t,o),{success:!0,message:`${t.name} refined!`,affectedWord:t,effectType:"upgrade"}):{success:!1,message:`${t.name} is already at the highest rank.`}}},{id:"polymorph",name:"Polymorph",cost:12,desc:"Transform the enemy and remove their Resistances.",use:e=>(e.tempEffects.polymorph=!0,{success:!0,message:"Enemy resistances nullified!"})},{id:"elemental_inversion",name:"Antithesis",cost:18,desc:"Replace a Word with its opposite Element equivalent.",use:e=>{const t=e.pendingWord;if(!t)return{success:!1,message:"Highlight a Word to invert."};if(void 0===t.elem)return{success:!1,message:`${t.name} has no element.`};const o={[E.FIRE]:E.WATER,[E.WATER]:E.FIRE,[E.EARTH]:E.LIGHTNING,[E.LIGHTNING]:E.EARTH,[E.LIGHT]:E.DARK,[E.DARK]:E.LIGHT,[E.POISON]:E.PHYS,[E.PHYS]:E.POISON}[t.elem];if(void 0===o)return{success:!1,message:"Element cannot be inverted."};const n=EN[t.elem],s=EN[o],a=t.rarity,i=WORDS.filter(e=>e.elem===o&&e.rarity===a&&e.type===t.type&&!e.hiddenInBank);if(i.length>0){const o={...i[Math.floor(Math.random()*i.length)]},a=e.inv.indexOf(t);if(-1!==a){e.inv[a]=o;for(const n of["item","adj1","adj2","adj3","adj4","noun1"])e.sel[n]===t&&(e.sel[n]=o);return{success:!0,message:`${t.name} ‚Üí ${o.name}! (${n} ‚Üí ${s})`,affectedWord:o,effectType:"transform"}}}return t.elem=o,t.name=s,t.desc&&(t.desc=t.desc.replace(n,s)),{success:!0,message:`${t.name} inverted! (${n} ‚Üí ${s})`,affectedWord:t,effectType:"transform"}}},{id:"tautology",name:"Tautology",cost:20,desc:"Copy a selected Word from your inventory.",use:e=>{const t=e.pendingWord;if(!t)return{success:!1,message:"Highlight a Word to copy."};if(e.inv.filter(e=>!e.hiddenInBank).length>=24)return{success:!1,message:"Inventory full! Cannot add copy."};const o={...t};return e.inv.push(o),{success:!0,message:`Copied ${t.name}!`,affectedWord:o,sourceWord:t,effectType:"copy"}}},{id:"shackles",name:"Shackles",cost:22,desc:"Bind the Boss and disable their special ability.",use:e=>e.chapterBoss?(e.tempEffects.disableBossAbility=!0,{success:!0,message:`${e.chapterBoss.name} bound! ${e.chapterBoss.ability?.name||"Ability"} disabled!`}):{success:!1,message:"No Boss to bind!"}}],WORDS=[{id:"sword",name:"Sword",type:"weapon",category:"slash",rarity:T.T1,desc:"A balanced blade."},{id:"greatsword",name:"Greatsword",type:"weapon",category:"slash",rarity:T.T2,desc:"A powerful two-handed sword."},{id:"claymore",name:"Claymore",type:"weapon",category:"slash",rarity:T.T3,desc:"A legendary Highland blade."},{id:"bow",name:"Bow",type:"weapon",category:"pierce",rarity:T.T1,desc:"A ranged weapon."},{id:"longbow",name:"Longbow",type:"weapon",category:"pierce",rarity:T.T2,desc:"A powerful ranged weapon."},{id:"warbow",name:"Warbow",type:"weapon",category:"pierce",rarity:T.T3,desc:"A masterwork bow of immense power."},{id:"wand",name:"Wand",type:"weapon",category:"magic",rarity:T.T1,desc:"A simple magical focus."},{id:"staff",name:"Staff",type:"weapon",category:"magic",rarity:T.T2,desc:"A powerful channeling staff."},{id:"scepter",name:"Scepter",type:"weapon",category:"magic",rarity:T.T3,desc:"A royal arcane artifact."},{id:"mace",name:"Mace",type:"weapon",category:"blunt",rarity:T.T1,desc:"A heavy bludgeon."},{id:"warhammer",name:"Warhammer",type:"weapon",category:"blunt",rarity:T.T2,desc:"A crushing war weapon."},{id:"maul",name:"Maul",type:"weapon",category:"blunt",rarity:T.T3,desc:"A massive two-handed hammer."},{id:"adj_common",name:"Common",type:"rarity",mult:1.25,rarity:T.T1,desc:"√ó1.25 multiplier."},{id:"adj_uncommon",name:"Uncommon",type:"rarity",mult:1.5,rarity:T.T1,desc:"√ó1.5 multiplier."},{id:"adj_magic",name:"Magic",type:"rarity",mult:1.75,rarity:T.T2,desc:"√ó1.75 multiplier."},{id:"adj_rare",name:"Rare",type:"rarity",mult:2,rarity:T.T2,desc:"√ó2.0 multiplier."},{id:"adj_epic",name:"Epic",type:"rarity",mult:2.5,rarity:T.T3,desc:"√ó2.5 multiplier."},{id:"adj_legendary",name:"Legendary",type:"rarity",mult:3,rarity:T.T3,desc:"√ó3.0 multiplier."},{id:"fire_n",name:"Fire",type:"elemental",elem:E.FIRE,rarity:T.T1,desc:"Fire",nounForm:"Fire",adjPrimary:"Fiery",adjAlt:"Fiery"},{id:"blaze_n",name:"Blaze",type:"elemental",elem:E.FIRE,rarity:T.T2,desc:"Fire",nounForm:"Blaze",adjPrimary:"Blazing",adjAlt:"Blazing"},{id:"phoenix_n",name:"Phoenix",type:"elemental",elem:E.FIRE,rarity:T.T3,desc:"Fire",nounForm:"Phoenix",adjPrimary:"Infernal",adjAlt:"Infernal"},{id:"water_n",name:"Water",type:"elemental",elem:E.WATER,rarity:T.T1,desc:"Water",nounForm:"Water",adjPrimary:"Watery",adjAlt:"Watery"},{id:"tide_n",name:"Tide",type:"elemental",elem:E.WATER,rarity:T.T2,desc:"Water",nounForm:"Tide",adjPrimary:"Tidal",adjAlt:"Tidal"},{id:"leviathan_n",name:"Leviathan",type:"elemental",elem:E.WATER,rarity:T.T3,desc:"Water",nounForm:"Leviathan",adjPrimary:"Torrential",adjAlt:"Torrential"},{id:"spark_n",name:"Spark",type:"elemental",elem:E.LIGHTNING,rarity:T.T1,desc:"Lightning",nounForm:"Spark",adjPrimary:"Sparking",adjAlt:"Sparking"},{id:"bolt_n",name:"Bolt",type:"elemental",elem:E.LIGHTNING,rarity:T.T2,desc:"Lightning",nounForm:"Bolt",adjPrimary:"Bolting",adjAlt:"Bolting"},{id:"thunderbird_n",name:"Thunderbird",type:"elemental",elem:E.LIGHTNING,rarity:T.T3,desc:"Lightning",nounForm:"Thunderbird",adjPrimary:"Thunderous",adjAlt:"Thunderous"},{id:"stone_n",name:"Stone",type:"elemental",elem:E.EARTH,rarity:T.T1,desc:"Earth",nounForm:"Stone",adjPrimary:"Stony",adjAlt:"Stony"},{id:"quake_n",name:"Quake",type:"elemental",elem:E.EARTH,rarity:T.T2,desc:"Earth",nounForm:"Quake",adjPrimary:"Quaking",adjAlt:"Quaking"},{id:"behemoth_n",name:"Behemoth",type:"elemental",elem:E.EARTH,rarity:T.T3,desc:"Earth",nounForm:"Behemoth",adjPrimary:"Colossal",adjAlt:"Colossal"},{id:"light_n",name:"Light",type:"elemental",elem:E.LIGHT,rarity:T.T1,desc:"Light",nounForm:"Light",adjPrimary:"Bright",adjAlt:"Bright"},{id:"glow_n",name:"Glow",type:"elemental",elem:E.LIGHT,rarity:T.T2,desc:"Light",nounForm:"Glow",adjPrimary:"Glowing",adjAlt:"Glowing"},{id:"seraph_n",name:"Seraph",type:"elemental",elem:E.LIGHT,rarity:T.T3,desc:"Light",nounForm:"Seraph",adjPrimary:"Radiant",adjAlt:"Radiant"},{id:"shadow_n",name:"Shadow",type:"elemental",elem:E.DARK,rarity:T.T1,desc:"Dark",nounForm:"Shadow",adjPrimary:"Shadowy",adjAlt:"Shadowy"},{id:"gloom_n",name:"Gloom",type:"elemental",elem:E.DARK,rarity:T.T2,desc:"Dark",nounForm:"Gloom",adjPrimary:"Gloomy",adjAlt:"Gloomy"},{id:"nightmare_n",name:"Nightmare",type:"elemental",elem:E.DARK,rarity:T.T3,desc:"Dark",nounForm:"Nightmare",adjPrimary:"Voided",adjAlt:"Voided"},{id:"venom_n",name:"Venom",type:"elemental",elem:E.POISON,rarity:T.T1,desc:"Poison",nounForm:"Venom",adjPrimary:"Venomous",adjAlt:"Venomous"},{id:"toxin_n",name:"Toxin",type:"elemental",elem:E.POISON,rarity:T.T2,desc:"Poison",nounForm:"Toxin",adjPrimary:"Toxic",adjAlt:"Toxic"},{id:"basilisk_n",name:"Basilisk",type:"elemental",elem:E.POISON,rarity:T.T3,desc:"Poison",nounForm:"Basilisk",adjPrimary:"Plagued",adjAlt:"Plagued"},{id:"strike_n",name:"Strike",type:"elemental",elem:E.PHYS,rarity:T.T1,desc:"Physical",nounForm:"Strike",adjPrimary:"Striking",adjAlt:"Striking"},{id:"crush_n",name:"Crush",type:"elemental",elem:E.PHYS,rarity:T.T2,desc:"Physical",nounForm:"Crush",adjPrimary:"Crushing",adjAlt:"Crushing"},{id:"bear_n",name:"Bear",type:"elemental",elem:E.PHYS,rarity:T.T3,desc:"Physical",nounForm:"Bear",adjPrimary:"Furious",adjAlt:"Furious"}],WORD_FORMS={};function getDisplayForm(e,t="",o=S?.sel){if(!e)return"";const n=WORD_FORMS[e.id]||{},s=n.noun||n.nounForm||e.name,a=n.adjPrimary||n.adjForm||e.name,i=n.adjAlt||a,r="elemental"===e.type&&e.rarity===T.T3;if(t.startsWith("noun"))return s;if(t.startsWith("adj")){if(r)return i;const e=o||{},n=[],l=new Set,c=["item","adj1","adj2","adj3","adj4","noun1"],d=c.indexOf(t);Object.entries(e).forEach(([e,o])=>{if(o&&e!==t){if(-1!==d){const t=c.indexOf(e);if(-1!==t&&t>d)return}if(e.startsWith("adj")||e.startsWith("noun")){const t=WORD_FORMS[o.id]||{},s=t.adjPrimary||t.adjForm||o.name,a=t.noun||t.nounForm||o.name;n.push(s.toLowerCase()),n.push(a.toLowerCase());const i=e.startsWith("noun")?a:s;i&&l.add(i[0].toLowerCase())}"item"===e&&o.name&&l.add(o.name[0].toLowerCase())}});const p=a.toLowerCase(),f=a[0]?.toLowerCase(),u=i[0]?.toLowerCase(),h=n.includes(p)||n.includes(s.toLowerCase()),m=S?.talents?.includes("alliteration");if(m&&!h){const e=l.has(f);return l.has(u)&&!e?i:a}return h?i:a}return s}WORDS.forEach(e=>{const t=e.nounForm||e.name,o=e.adjPrimary||e.adjForm||e.name,n=e.adjAlt||o;WORD_FORMS[e.id]={noun:t,adjPrimary:o,adjAlt:n,nounForm:t,adjForm:o}});const STICK={id:"stick",name:"Stick",type:"weapon",category:"blunt",rarity:T.T0,ap:1,isStick:!0,desc:"A humble twig. 0.5√ó total damage. Get a real weapon!"};function getTierRank(e){if(!e)return 0;const t=e.rarity;return void 0!==t?t:0}function findNextTierWord(e){if(!e)return null;const t=getTierRank(e);return WORDS.filter(t=>t.type===e.type&&("weapon"===e.type?t.category===e.category:void 0!==e.elem?t.elem===e.elem:void 0===t.elem)).sort((e,t)=>{const o=getTierRank(e),n=getTierRank(t);return o!==n?o-n:WORDS.indexOf(e)-WORDS.indexOf(t)}).find(e=>getTierRank(e)>t)||null}function applyWordUpgrade(e,t){if(!e||!t)return;const o={...t};Object.keys(e).forEach(t=>delete e[t]),Object.assign(e,o)}function rarityToAP(e){return e??0}function fmtMod(e,t="ap",o=""){if(0===e||"scale"===t&&1===e)return"";let n,s;("scale"===t?e<1:e<0)?(n="neg",s="scale"===t?"√ó":""):"ap"===t?(n="add",s="+"):"word"===t?(n="word",s="+"):"mult"===t?(n="mult",s="+"):(n="scale",s="√ó");const a=Math.round(100*e)/100;return`<span class="mod-badge ${n}">${s}${Number.isInteger(a)?a:parseFloat(a.toFixed(2))}${o}</span>`}function fmtTalentDesc(e){if(!e)return"";const t={Physical:"#a0a0a0",Poison:"#7ee04d",Fire:"#ff6633",Water:"#4d99ff",Light:"#ffffa0",Dark:"#9966cc",Earth:"#996633",Lightning:"#ffff4d"};return e.includes('class="mod-badge')?e=(e=e.replace(/<\/span>\s*√ó(\d+)/g," √ó$1</span>")).replace(/\b(Physical|Poison|Fire|Water|Light|Dark|Earth|Lightning)\b(?![^<]*>)/g,e=>`<span style="color:${t[e]}">${e}</span>`):e.replace(/REREAD\s*√ó(\d+)/g,(e,t)=>`<span class="mod-badge reread">REREAD √ó${t}</span>`).replace(/\bREREAD\b(?!\s*√ó)/g,'<span class="mod-badge reread">REREAD</span>').replace(/√ó(\d+\.?\d*)\s*AP/gi,(e,t)=>`<span class="mod-badge add">√ó${t} AP</span>`).replace(/√ó(\d+\.?\d*)\s*W\b/g,(e,t)=>`<span class="mod-badge word">√ó${t} W</span>`).replace(/√ó(\d+\.?\d*)/g,(e,t)=>fmtMod(parseFloat(t),"scale")).replace(/\+(\d+\.?\d*)\s*AP/gi,(e,t)=>fmtMod(parseFloat(t),"ap"," AP")).replace(/\+(\d+\.?\d*)\s*W\b/g,(e,t)=>fmtMod(parseFloat(t),"word"," W")).replace(/\b(Physical|Poison|Fire|Water|Light|Dark|Earth|Lightning)\b/g,e=>`<span style="color:${t[e]}">${e}</span>`).replace(/per chapter/gi,"per Chapter").replace(/per round/gi,"per Round").replace(/per word/gi,"per Word")}function normalizeTalentText(e){if(!e)return"";if(e.includes("<span")||e.includes('class="'))return e;let t=e.replace(/\bReread\b/gi,"REREAD");const o=t.indexOf(":");if(-1!==o){const e=t.slice(0,o).trim(),n=t.slice(o+1).trim();if(n.startsWith("+")||n.startsWith("√ó")){t=`${n} on ${e.replace(/^If\s+/i,"").replace(/^If\s+weapon has\s+/i,"").replace(/^weapon has\s+/i,"").trim()}`}}t=t.replace(/\s*per\s+Round/gi,"");let n=!1;return t=t.replace(/\s*(?:based on|per)\s+Chapter/gi,()=>(n=!0,"")),n&&(t=`${t} (Chapter-scaled)`),t.replace(/\s+/g," ").trim()}function formatTalentDesc(e,t=null){const o=normalizeTalentText(e?.desc||""),n=t?getTalentLevel(t):e?.id?getTalentLevel(e.id):1;if(n<=1)return fmtTalentDesc(o);const s=e=>{const t=parseFloat(e)*n;return t<1||t%1!=0&&t<10?parseFloat(t.toFixed(1)):Math.round(t)};return fmtTalentDesc(o.replace(/\+(\d+\.?\d*)(\s*W)(?=\s|<|$)/g,(e,t,o)=>`+${s(t)}${o}`).replace(/\+(\d+\.?\d*)(\s*AP)(?=\s|<|$)/gi,(e,t,o)=>`+${s(t)}${o}`).replace(/(?<!REREAD\s*)√ó(\d+\.?\d*)/g,(e,t)=>{const o=parseFloat(t);return`√ó${(o+.25*(o-1)*(n-1)).toFixed(2).replace(/\.?0+$/,"")}`}).replace(/REREAD\s*√ó(\d+)/g,(e,t)=>`REREAD √ó${parseInt(t)+(n-1)}`).replace(/\bREREAD\b(?!\s*√ó)(?!\s*ALL)/g,()=>n>1?`REREAD √ó${n}`:"REREAD").replace(/REREAD\s*ALL(?!\s*√ó)/g,()=>n>1?`REREAD ALL √ó${n}`:"REREAD ALL"))}function formatTalentDescUpgradePreview(e,t=null){const o=normalizeTalentText(e?.desc||""),n=t?getTalentLevel(t):e?.id?getTalentLevel(e.id):1,s=n+1,a=(e,t)=>{const o=parseFloat(e)*t;return o<1||o%1!=0&&o<10?parseFloat(o.toFixed(1)):Math.round(o)},i=(e,t)=>{const o=parseFloat(e);return(o+.25*(o-1)*(t-1)).toFixed(2).replace(/\.?0+$/,"")};return fmtTalentDesc(o.replace(/\+(\d+\.?\d*)(\s*W)(?=\s|<|$)/g,(e,t,o)=>`<span class="upgrade-old">+${a(t,n)}</span><span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">+${a(t,s)}</span>${o}`).replace(/\+(\d+\.?\d*)(\s*AP)(?=\s|<|$)/gi,(e,t,o)=>`<span class="upgrade-old">+${a(t,n)}</span><span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">+${a(t,s)}</span>${o}`).replace(/(?<!REREAD\s*)√ó(\d+\.?\d*)/g,(e,t)=>`<span class="upgrade-old">√ó${i(t,n)}</span><span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">√ó${i(t,s)}</span>`).replace(/REREAD\s*√ó(\d+)/g,(e,t)=>{const o=parseInt(t);return`REREAD <span class="upgrade-old">√ó${o+(n-1)}</span><span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">√ó${o+(s-1)}</span>`}).replace(/\bREREAD\b(?!\s*√ó)(?!\s*ALL)/g,()=>1===n?`REREAD <span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">√ó${s}</span>`:`REREAD <span class="upgrade-old">√ó${n}</span><span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">√ó${s}</span>`).replace(/REREAD\s*ALL(?!\s*√ó)/g,()=>1===n?`REREAD ALL <span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">√ó${s}</span>`:`REREAD ALL <span class="upgrade-old">√ó${n}</span><span class="upgrade-arrow">‚Üí</span><span class="upgrade-new">√ó${s}</span>`))}function getBaseAP(e){return e?void 0!==e.ap?e.ap:rarityToAP(e.rarity):0}function getWordAP(e,t,o=null){if(!e)return 0;let n=getBaseAP(e);const s=t.state.heroSkillBonuses||{};"item"===o?n+=s.weaponAP||0:o&&o.startsWith("adj")?n+=s.adjAP||0:o&&o.startsWith("noun")&&(n+=s.nounAP||0);t.state.currentChapter,t.state.roundIndex;const a=e=>t.state.talents&&t.state.talents.includes(e),i=e.rarity??0,r=t.state.roundIndex||1;a("verbose")&&(n+=scaleTalentBonus("verbose",.5)*r),a("eloquent")&&i>=3&&(n+=scaleTalentBonus("eloquent",3)*r),a("erudite")&&2===i&&(n+=scaleTalentBonus("erudite",2)*r),a("fundamental")&&i<=1&&(n+=scaleTalentBonus("fundamental",1)*r),a("adjectival_emphasis")&&"rarity"===e.type&&(n+=scaleTalentBonus("adjectival_emphasis",3)*r),!a("nominal_power")||"elemental"!==e.type&&"weapon"!==e.type||(n+=scaleTalentBonus("nominal_power",2)*r);const l=void 0!==e.elem,c=a("signature_style")&&"weapon"===e.type&&!e.isStick&&t.hero&&e.category===t.hero.good&&void 0===e.elem,d=l||c;if(a("elemental_amplification")&&d&&(n+=scaleTalentBonus("elemental_amplification",.5)*r),a("apotheosis")&&d&&(n+=scaleTalentBonus("apotheosis",5)),a("bibliography")){const e=t.state.bossesDefeated||0;n+=scaleTalentBonus("bibliography",2)*e}if(a("spendthrift")){n+=(t.state.goldSpent||0)*scaleTalentBonus("spendthrift",.02)}if(a("gold_standard")&&"weapon"===e.type){n+=(t.state.gold||0)*scaleTalentBonus("gold_standard",.1)}if(a("arsenal_mastery")&&"weapon"===e.type&&(n+=scaleTalentBonus("arsenal_mastery",4)*r),void 0!==e.elem&&(a("world_sky_ink")&&isWorldSky(e.elem)&&(n+=scaleTalentBonus("world_sky_ink",1)*r),a("body_soul_ink")&&isBodySoul(e.elem)&&(n+=scaleTalentBonus("body_soul_ink",1)*r)),a("legendary_prose")&&"rarity"===e.type&&(n+=scaleTalentBonus("legendary_prose",3)*r),a("gemcutter")&&"noun1"===o&&(n+=scaleTalentBonus("gemcutter",3)*r),a("versatility")&&"item"===o&&"weapon"===e.type&&!e.isStick){const o=t.state.hero;o&&e.category!==o.good&&(n+=scaleTalentBonus("versatility",3)*r)}if(a("gemonomics")&&"noun1"===o){const e=t.state.gold||0;n+=Math.floor(e/10)*scaleTalentBonus("gemonomics",1)}if(a("prolix")){[t.state.sel?.adj1,t.state.sel?.adj2,t.state.sel?.item,t.state.sel?.adj3,t.state.sel?.adj4,t.state.sel?.noun1].filter(Boolean).filter(e=>!e.isStick).length>=4&&(n+=scaleTalentBonus("prolix",.5)*r)}if(a("liquidation")){n+=(t.state.wordsSold||0)*scaleTalentBonus("liquidation",.5)}if(a("quality_control")){n+=(t.state.rarityWordsUsed||0)*scaleTalentBonus("quality_control",.1)}if(a("grassroots")){n+=(t.state.tierWordsPlayed?.[1]||0)*scaleTalentBonus("grassroots",.05)}if(a("intermediate")){n+=(t.state.tierWordsPlayed?.[2]||0)*scaleTalentBonus("intermediate",.1)}if(a("masterwork")){n+=(t.state.tierWordsPlayed?.[3]||0)*scaleTalentBonus("masterwork",.2)}if(a("tool_mastery")){n+=(t.state.toolsUsed||0)*scaleTalentBonus("tool_mastery",1)}if(a("crate_opener")){n+=(t.state.cratesOpened||0)*scaleTalentBonus("crate_opener",1.5)}if(a("investment")){const{totalInterest:e}=calculateInterest();n+=e*scaleTalentBonus("investment",.5)}return n}function getTalentBonusesForWord(e){if(!e||!S.talents||0===S.talents.length)return[];const t=[],o=S.roundIndex||1,n=Math.floor((o-1)/9)+1,s=e.rarity??0,a=e=>S.talents.includes(e);if(a("verbose")&&t.push({name:"Verbose",value:scaleTalentBonus("verbose",.5)*o,type:"AP"}),a("prolix")){[S.sel?.adj1,S.sel?.adj2,S.sel?.item,S.sel?.adj3,S.sel?.adj4,S.sel?.noun1].filter(Boolean).filter(e=>!e.isStick).length>=4&&t.push({name:"Prolix",value:scaleTalentBonus("prolix",.5)*o,type:"AP"})}a("eloquent")&&s>=3&&t.push({name:"Eloquent",value:scaleTalentBonus("eloquent",3)*o,type:"AP"}),a("erudite")&&2===s&&t.push({name:"Erudite",value:scaleTalentBonus("erudite",2)*o,type:"AP"}),a("fundamental")&&s<=1&&t.push({name:"Fundamental",value:scaleTalentBonus("fundamental",1)*o,type:"AP"}),a("adjectival_emphasis")&&"rarity"===e.type&&t.push({name:"Adjectival Emphasis",value:scaleTalentBonus("adjectival_emphasis",3)*o,type:"AP"}),!a("nominal_power")||"elemental"!==e.type&&"weapon"!==e.type||t.push({name:"Nominal Power",value:scaleTalentBonus("nominal_power",2)*o,type:"AP"});const i=void 0!==e.elem,r=a("signature_style")&&"weapon"===e.type&&!e.isStick&&S.hero&&e.category===S.hero.good&&void 0===e.elem,l=i||r;if(a("elemental_amplification")&&l&&t.push({name:"Elemental Amplification",value:scaleTalentBonus("elemental_amplification",.5)*o,type:"AP"}),a("apotheosis")&&l&&t.push({name:"Apotheosis",value:scaleTalentBonus("apotheosis",5),type:"AP"}),a("bibliography")){const e=S.bossesDefeated||0;e>0&&t.push({name:"Bibliography",value:scaleTalentBonus("bibliography",2)*e,type:"AP"})}a("arsenal_mastery")&&"weapon"===e.type&&t.push({name:"Arsenal Mastery",value:scaleTalentBonus("arsenal_mastery",4)*o,type:"AP"}),void 0!==e.elem&&(a("world_sky_ink")&&isWorldSky(e.elem)&&t.push({name:"World & Sky Ink",value:scaleTalentBonus("world_sky_ink",1)*o,type:"AP"}),a("body_soul_ink")&&isBodySoul(e.elem)&&t.push({name:"Body & Soul Ink",value:scaleTalentBonus("body_soul_ink",1)*o,type:"AP"})),a("legendary_prose")&&"rarity"===e.type&&t.push({name:"Legendary Prose",value:scaleTalentBonus("legendary_prose",3)*o,type:"AP"});if(S.sel&&S.sel.noun1===e&&(a("gemcutter")&&t.push({name:"Scarab",value:scaleTalentBonus("gemcutter",3)*o,type:"AP"}),a("gemonomics"))){const e=S.gold||0,o=Math.floor(e/10)*scaleTalentBonus("gemonomics",1);o>0&&t.push({name:"Gemonomics",value:o,type:"AP"})}if(S.sel&&S.sel.item===e&&"weapon"===e.type&&!e.isStick&&a("versatility")&&S.hero&&e.category!==S.hero.good&&t.push({name:"Versatility",value:scaleTalentBonus("versatility",3)*o,type:"AP"}),"weapon"===e.type&&!e.isStick&&e.category){const o=chapterScaleW(scaleTalentBonus("proficiency_focus",6),n);a("proficiency_focus")&&S.hero&&e.category===S.hero.good&&t.push({name:"Proficiency Focus",value:o,type:"W"})}if(void 0!==e.elem){if(a("world_sky_focus")&&isWorldSky(e.elem)){const e=scaleTalentBonus("world_sky_focus",5);t.push({name:"World & Sky Focus",value:e,type:"W"})}if(a("body_soul_focus")&&isBodySoul(e.elem)){const e=scaleTalentBonus("body_soul_focus",5);t.push({name:"Body & Soul Focus",value:e,type:"W"})}}if(a("liquidation")){const e=(S.wordsSold||0)*scaleTalentBonus("liquidation",.5);e>0&&t.push({name:"Liquidation",value:e,type:"AP"})}if(a("quality_control")){const e=(S.rarityWordsUsed||0)*scaleTalentBonus("quality_control",.1);e>0&&t.push({name:"Quality Control",value:e,type:"AP"})}if(a("grassroots")){const e=(S.tierWordsPlayed?.[1]||0)*scaleTalentBonus("grassroots",.05);e>0&&t.push({name:"Grassroots",value:e,type:"AP"})}if(a("intermediate")){const e=(S.tierWordsPlayed?.[2]||0)*scaleTalentBonus("intermediate",.1);e>0&&t.push({name:"Intermediate",value:e,type:"AP"})}if(a("masterwork")){const e=(S.tierWordsPlayed?.[3]||0)*scaleTalentBonus("masterwork",.2);e>0&&t.push({name:"Masterwork",value:e,type:"AP"})}if(a("tool_mastery")){const e=(S.toolsUsed||0)*scaleTalentBonus("tool_mastery",1);e>0&&t.push({name:"Tool Mastery",value:e,type:"AP"})}if(a("crate_opener")){const e=(S.cratesOpened||0)*scaleTalentBonus("crate_opener",1.5);e>0&&t.push({name:"Crate Opener",value:e,type:"AP"})}if(a("momentum")){const e=Math.min((S.roundIndex||1)-1,10)*scaleTalentBonus("momentum",1);e>0&&t.push({name:"Momentum",value:e,type:"W"})}if(a("investment")){const{totalInterest:e}=calculateInterest(),o=e*scaleTalentBonus("investment",.5);o>0&&t.push({name:"Investment",value:o,type:"AP"})}return t}const WEAPON_SVG={sword:{base:'<defs>\n    <linearGradient id="sw-blade" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="50%" stop-color="BASECOLOR" stop-opacity="0.9"/><stop offset="100%" stop-color="#1f2937"/></linearGradient>\n    <linearGradient id="sw-hilt" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#8b7355"/><stop offset="100%" stop-color="#4a3728"/></linearGradient>\n    <linearGradient id="sw-guard" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#c9a227"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n  </defs>\n  <g id="sword-root">\n    <path d="M50 8 L56 16 L56 88 L50 92 L44 88 L44 16 Z" fill="url(#sw-blade)"/>\n    <path d="M51 12 L54 18 L54 84 L51 87 L48 84 L48 18 Z" fill="#ffffff" opacity="0.25"/>\n    <path d="M50 20 L52 24 L52 78 L50 80 L48 78 L48 24 Z" fill="#0f172a" opacity="0.15"/>\n    <path d="M34 88 L66 88 L62 94 L38 94 Z" fill="url(#sw-guard)"/>\n    <path d="M36 89 L64 89 L61 92 L39 92 Z" fill="#ffffff" opacity="0.2"/>\n    <rect x="45" y="94" width="10" height="24" rx="2" fill="url(#sw-hilt)"/>\n    <path d="M46 98 L54 98 M46 104 L54 104 M46 110 L54 110" stroke="#5c4a3a" stroke-width="1.5" opacity="0.6"/>\n    <ellipse cx="50" cy="122" rx="6" ry="5" fill="url(#sw-guard)"/>\n  </g>',gem:'<g id="sword-gem">\n    <ellipse cx="50" cy="91" rx="6" ry="5" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="90" rx="4" ry="3" fill="#ffffff" opacity="0.4"/>\n    <ellipse cx="50" cy="91" rx="6" ry="5" fill="GEMCOLOR" opacity="0.5"/>\n  </g>',adj1:'<g id="sw-adj1">\n    <defs><linearGradient id="sw-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.9"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M44 16 L44 88 L50 92 L50 8 Z" fill="url(#sw-adj1-grad)" opacity="0.6"/>\n    <path d="M44 20 L44 85" stroke="ADJ1COLOR" stroke-width="2" opacity="0.8" stroke-linecap="round"/>\n    <path d="M42 25 L42 75" stroke="#ffffff" stroke-width="1" opacity="0.4"/>\n  </g>',adj2:'<g id="sw-adj2">\n    <defs><linearGradient id="sw-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.7"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M56 16 L56 88 L50 92 L50 8 Z" fill="url(#sw-adj2-grad)" opacity="0.5"/>\n    <path d="M58 25 L58 75" stroke="ADJ2COLOR" stroke-width="2" opacity="0.4" stroke-linecap="round"/>\n  </g>',adj3:'<g id="sw-adj3">\n    <defs><linearGradient id="sw-adj3-grad" x1="50%" y1="0%" x2="50%" y2="100%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.8"/><stop offset="50%" stop-color="ADJ3COLOR" stop-opacity="0.3"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.6"/></linearGradient></defs>\n    <path d="M50 15 L52 20 L52 80 L50 85 L48 80 L48 20 Z" fill="url(#sw-adj3-grad)" opacity="0.5"/>\n    <line x1="50" y1="20" x2="50" y2="75" stroke="ADJ3COLOR" stroke-width="1.5" opacity="0.7"/>\n    <circle cx="50" cy="45" r="4" fill="ADJ3COLOR" opacity="0.3"/><circle cx="50" cy="45" r="2" fill="#ffffff" opacity="0.5"/>\n  </g>',adj4:'<g id="sw-adj4">\n    <defs>\n      <radialGradient id="sw-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.3"/><stop offset="70%" stop-color="ADJ4COLOR" stop-opacity="0.1"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="50" rx="28" ry="45" fill="url(#sw-adj4-aura)"/>\n    <ellipse cx="50" cy="50" rx="22" ry="38" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.25"/>\n    <ellipse cx="50" cy="50" rx="32" ry="52" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.15"/>\n  </g>'},greatsword:{base:'<defs>\n    <linearGradient id="gs-blade" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="60%" stop-color="BASECOLOR" stop-opacity="0.85"/><stop offset="100%" stop-color="#1f2937"/></linearGradient>\n    <linearGradient id="gs-hilt" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#7a6548"/><stop offset="100%" stop-color="#3d3222"/></linearGradient>\n    <linearGradient id="gs-guard" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#9a7b1a"/></linearGradient>\n  </defs>\n  <g id="greatsword-root">\n    <path d="M50 4 L58 14 L58 84 L50 90 L42 84 L42 14 Z" fill="url(#gs-blade)"/>\n    <path d="M51 10 L56 16 L56 80 L51 85 L46 80 L46 16 Z" fill="#ffffff" opacity="0.2"/>\n    <path d="M50 18 L53 22 L53 74 L50 77 L47 74 L47 22 Z" fill="#0f172a" opacity="0.12"/>\n    <rect x="30" y="84" width="40" height="8" rx="2" fill="url(#gs-guard)"/>\n    <path d="M32 85 L68 85 L66 90 L34 90 Z" fill="#ffffff" opacity="0.2"/>\n    <rect x="44" y="92" width="12" height="26" rx="2" fill="url(#gs-hilt)"/>\n    <path d="M45 96 L55 96 M45 103 L55 103 M45 110 L55 110" stroke="#4a3d2a" stroke-width="1.8" opacity="0.5"/>\n    <ellipse cx="50" cy="122" rx="7" ry="6" fill="url(#gs-guard)"/>\n  </g>',gem:'<g id="gs-gem">\n    <ellipse cx="50" cy="88" rx="7" ry="5.5" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="87" rx="5" ry="3.5" fill="#ffffff" opacity="0.35"/>\n  </g>',adj1:'<g id="gs-adj1">\n    <defs><linearGradient id="gs-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.9"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M42 14 L42 84 L50 90 L50 4 Z" fill="url(#gs-adj1-grad)" opacity="0.55"/>\n    <path d="M42 18 L42 80" stroke="ADJ1COLOR" stroke-width="2.5" opacity="0.75" stroke-linecap="round"/>\n    <path d="M40 24 L40 72" stroke="#ffffff" stroke-width="1" opacity="0.35"/>\n  </g>',adj2:'<g id="gs-adj2">\n    <defs><linearGradient id="gs-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.65"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M58 14 L58 84 L50 90 L50 4 Z" fill="url(#gs-adj2-grad)" opacity="0.45"/>\n    <path d="M60 24 L60 72" stroke="ADJ2COLOR" stroke-width="2" opacity="0.4" stroke-linecap="round"/>\n  </g>',adj3:'<g id="gs-adj3">\n    <defs><linearGradient id="gs-adj3-grad" x1="50%" y1="0%" x2="50%" y2="100%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.75"/><stop offset="50%" stop-color="ADJ3COLOR" stop-opacity="0.25"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.55"/></linearGradient></defs>\n    <path d="M50 10 L54 16 L54 78 L50 84 L46 78 L46 16 Z" fill="url(#gs-adj3-grad)" opacity="0.45"/>\n    <line x1="50" y1="18" x2="50" y2="72" stroke="ADJ3COLOR" stroke-width="2" opacity="0.65"/>\n    <circle cx="50" cy="45" r="5" fill="ADJ3COLOR" opacity="0.25"/><circle cx="50" cy="45" r="2.5" fill="#ffffff" opacity="0.45"/>\n  </g>',adj4:'<g id="gs-adj4">\n    <defs><radialGradient id="gs-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.28"/><stop offset="70%" stop-color="ADJ4COLOR" stop-opacity="0.1"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <ellipse cx="50" cy="48" rx="32" ry="48" fill="url(#gs-adj4-aura)"/>\n    <ellipse cx="50" cy="48" rx="26" ry="42" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.22"/>\n    <ellipse cx="50" cy="48" rx="38" ry="56" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.12"/>\n  </g>'},claymore:{base:'<defs>\n    <linearGradient id="cl-blade" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="55%" stop-color="BASECOLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="#1f2937"/></linearGradient>\n    <linearGradient id="cl-hilt" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#6b5840"/><stop offset="100%" stop-color="#2f261c"/></linearGradient>\n    <linearGradient id="cl-guard" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e6c547"/><stop offset="100%" stop-color="#a8891f"/></linearGradient>\n  </defs>\n  <g id="claymore-root">\n    <path d="M50 2 L60 14 L60 82 L50 90 L40 82 L40 14 Z" fill="url(#cl-blade)"/>\n    <path d="M51 8 L58 16 L58 78 L51 84 L44 78 L44 16 Z" fill="#ffffff" opacity="0.18"/>\n    <path d="M50 16 L54 20 L54 72 L50 76 L46 72 L46 20 Z" fill="#0f172a" opacity="0.1"/>\n    <rect x="26" y="82" width="48" height="10" rx="3" fill="url(#cl-guard)"/>\n    <path d="M28 83 L72 83 L70 90 L30 90 Z" fill="#ffffff" opacity="0.2"/>\n    <rect x="42" y="92" width="16" height="28" rx="3" fill="url(#cl-hilt)"/>\n    <path d="M44 97 L56 97 M44 105 L56 105 M44 113 L56 113" stroke="#3f3426" stroke-width="2" opacity="0.5"/>\n    <rect x="44" y="122" width="12" height="8" rx="2" fill="url(#cl-guard)"/>\n  </g>',gem:'<g id="cl-gem">\n    <ellipse cx="50" cy="87" rx="8" ry="6" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="86" rx="5.5" ry="4" fill="#ffffff" opacity="0.3"/>\n    <ellipse cx="50" cy="100" rx="5" ry="4" fill="GEMCOLOR" opacity="0.7"/>\n  </g>',adj1:'<g id="cl-adj1">\n    <defs><linearGradient id="cl-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.85"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M40 14 L40 82 L50 90 L50 2 Z" fill="url(#cl-adj1-grad)" opacity="0.5"/>\n    <path d="M40 18 L40 78" stroke="ADJ1COLOR" stroke-width="3" opacity="0.7" stroke-linecap="round"/>\n    <path d="M38 24 L38 70" stroke="#ffffff" stroke-width="1.2" opacity="0.3"/>\n  </g>',adj2:'<g id="cl-adj2">\n    <defs><linearGradient id="cl-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.6"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M60 14 L60 82 L50 90 L50 2 Z" fill="url(#cl-adj2-grad)" opacity="0.4"/>\n    <path d="M62 24 L62 70" stroke="ADJ2COLOR" stroke-width="2.5" opacity="0.35" stroke-linecap="round"/>\n  </g>',adj3:'<g id="cl-adj3">\n    <defs><linearGradient id="cl-adj3-grad" x1="50%" y1="0%" x2="50%" y2="100%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.7"/><stop offset="50%" stop-color="ADJ3COLOR" stop-opacity="0.2"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.5"/></linearGradient></defs>\n    <path d="M50 8 L55 16 L55 76 L50 84 L45 76 L45 16 Z" fill="url(#cl-adj3-grad)" opacity="0.4"/>\n    <line x1="50" y1="16" x2="50" y2="70" stroke="ADJ3COLOR" stroke-width="2" opacity="0.6"/>\n    <circle cx="50" cy="44" r="6" fill="ADJ3COLOR" opacity="0.2"/><circle cx="50" cy="44" r="3" fill="#ffffff" opacity="0.4"/>\n  </g>',adj4:'<g id="cl-adj4">\n    <defs><radialGradient id="cl-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.25"/><stop offset="70%" stop-color="ADJ4COLOR" stop-opacity="0.08"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <ellipse cx="50" cy="46" rx="36" ry="52" fill="url(#cl-adj4-aura)"/>\n    <ellipse cx="50" cy="46" rx="30" ry="46" fill="none" stroke="ADJ4COLOR" stroke-width="2" opacity="0.2"/>\n    <ellipse cx="50" cy="46" rx="42" ry="60" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.1"/>\n  </g>'},bow:{base:'<defs>\n    <linearGradient id="bw-limb" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="100%" stop-color="#2d1810"/></linearGradient>\n    <linearGradient id="bw-string" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="50%" stop-color="#c9a227"/><stop offset="100%" stop-color="#d4af37"/></linearGradient>\n  </defs>\n  <g id="bow-root">\n    <path d="M50 12 Q28 65 50 118 Q72 65 50 12" fill="none" stroke="url(#bw-limb)" stroke-width="7" stroke-linecap="round"/>\n    <path d="M52 18 Q34 65 52 112" fill="none" stroke="#ffffff" stroke-width="2.5" opacity="0.25" stroke-linecap="round"/>\n    <line x1="50" y1="18" x2="50" y2="112" stroke="url(#bw-string)" stroke-width="1.8"/>\n    <ellipse cx="50" cy="18" rx="4" ry="3" fill="#c9a227"/>\n    <ellipse cx="50" cy="112" rx="4" ry="3" fill="#c9a227"/>\n    <ellipse cx="50" cy="65" rx="6" ry="8" fill="url(#bw-limb)"/>\n    <ellipse cx="50" cy="65" rx="4" ry="5" fill="#ffffff" opacity="0.15"/>\n  </g>',gem:'<g id="bow-gem">\n    <ellipse cx="50" cy="65" rx="7" ry="6" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="64" rx="4.5" ry="3.5" fill="#ffffff" opacity="0.35"/>\n  </g>',adj1:'<g id="bw-adj1">\n    <defs><linearGradient id="bw-adj1-grad" x1="0%" y1="50%" x2="100%" y2="50%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M50 15 Q30 65 50 115" fill="none" stroke="url(#bw-adj1-grad)" stroke-width="12" opacity="0.4"/>\n    <path d="M48 20 Q32 65 48 110" fill="none" stroke="ADJ1COLOR" stroke-width="2" opacity="0.7" stroke-linecap="round"/>\n    <path d="M46 25 Q34 65 46 105" fill="none" stroke="#ffffff" stroke-width="1" opacity="0.3"/>\n  </g>',adj2:'<g id="bw-adj2">\n    <defs><linearGradient id="bw-adj2-grad" x1="100%" y1="50%" x2="0%" y2="50%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.6"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M50 15 Q70 65 50 115" fill="none" stroke="url(#bw-adj2-grad)" stroke-width="10" opacity="0.35"/>\n    <path d="M54 25 Q66 65 54 105" fill="none" stroke="ADJ2COLOR" stroke-width="1.5" opacity="0.5"/>\n  </g>',adj3:'<g id="bw-adj3">\n    <defs><radialGradient id="bw-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.7"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <ellipse cx="50" cy="65" rx="10" ry="12" fill="url(#bw-adj3-glow)" opacity="0.6"/>\n    <ellipse cx="50" cy="65" rx="5" ry="6" fill="ADJ3COLOR" opacity="0.4"/>\n    <ellipse cx="50" cy="64" rx="2.5" ry="3" fill="#ffffff" opacity="0.5"/>\n  </g>',adj4:'<g id="bw-adj4">\n    <defs><radialGradient id="bw-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.25"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.1"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <ellipse cx="50" cy="65" rx="35" ry="50" fill="url(#bw-adj4-aura)"/>\n    <ellipse cx="50" cy="65" rx="28" ry="42" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.2"/>\n    <ellipse cx="50" cy="65" rx="40" ry="55" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.1"/>\n  </g>'},longbow:{base:'<defs>\n    <linearGradient id="lb-limb" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="100%" stop-color="#1f1208"/></linearGradient>\n    <linearGradient id="lb-string" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="50%" stop-color="#c9a227"/><stop offset="100%" stop-color="#d4af37"/></linearGradient>\n  </defs>\n  <g id="longbow-root">\n    <path d="M50 8 Q22 65 50 122 Q78 65 50 8" fill="none" stroke="url(#lb-limb)" stroke-width="8" stroke-linecap="round"/>\n    <path d="M52 14 Q30 65 52 116" fill="none" stroke="#ffffff" stroke-width="2.8" opacity="0.22" stroke-linecap="round"/>\n    <line x1="50" y1="14" x2="50" y2="116" stroke="url(#lb-string)" stroke-width="2"/>\n    <ellipse cx="50" cy="14" rx="4.5" ry="3.5" fill="#c9a227"/>\n    <ellipse cx="50" cy="116" rx="4.5" ry="3.5" fill="#c9a227"/>\n    <rect x="44" y="60" width="12" height="12" rx="3" fill="url(#lb-limb)"/>\n    <rect x="46" y="62" width="8" height="8" rx="2" fill="#ffffff" opacity="0.12"/>\n  </g>',gem:'<g id="lb-gem">\n    <ellipse cx="50" cy="66" rx="8" ry="7" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="65" rx="5" ry="4" fill="#ffffff" opacity="0.3"/>\n  </g>',adj1:'<g id="lb-adj1">\n    <defs><linearGradient id="lb-adj1-grad" x1="0%" y1="50%" x2="100%" y2="50%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M50 10 Q26 65 50 120" fill="none" stroke="url(#lb-adj1-grad)" stroke-width="14" opacity="0.35"/>\n    <path d="M47 16 Q28 65 47 114" fill="none" stroke="ADJ1COLOR" stroke-width="2" opacity="0.65" stroke-linecap="round"/>\n    <path d="M45 22 Q32 65 45 108" fill="none" stroke="#ffffff" stroke-width="1" opacity="0.25"/>\n  </g>',adj2:'<g id="lb-adj2">\n    <defs><linearGradient id="lb-adj2-grad" x1="100%" y1="50%" x2="0%" y2="50%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.55"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M50 10 Q74 65 50 120" fill="none" stroke="url(#lb-adj2-grad)" stroke-width="12" opacity="0.3"/>\n    <path d="M55 22 Q68 65 55 108" fill="none" stroke="ADJ2COLOR" stroke-width="1.5" opacity="0.45"/>\n  </g>',adj3:'<g id="lb-adj3">\n    <defs><radialGradient id="lb-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.7"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <ellipse cx="50" cy="66" rx="12" ry="14" fill="url(#lb-adj3-glow)" opacity="0.55"/>\n    <ellipse cx="50" cy="66" rx="6" ry="7" fill="ADJ3COLOR" opacity="0.35"/>\n    <ellipse cx="50" cy="65" rx="3" ry="3.5" fill="#ffffff" opacity="0.45"/>\n  </g>',adj4:'<g id="lb-adj4">\n    <defs><radialGradient id="lb-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.22"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.08"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <ellipse cx="50" cy="65" rx="38" ry="54" fill="url(#lb-adj4-aura)"/>\n    <ellipse cx="50" cy="65" rx="32" ry="48" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.18"/>\n    <ellipse cx="50" cy="65" rx="44" ry="60" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.1"/>\n  </g>'},warbow:{base:'<defs>\n    <linearGradient id="wb-limb" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="100%" stop-color="#150a04"/></linearGradient>\n    <linearGradient id="wb-string" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#e6c547"/><stop offset="50%" stop-color="#d4af37"/><stop offset="100%" stop-color="#e6c547"/></linearGradient>\n    <linearGradient id="wb-metal" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#c9a227"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n  </defs>\n  <g id="warbow-root">\n    <path d="M50 5 Q16 65 50 125 Q84 65 50 5" fill="none" stroke="url(#wb-limb)" stroke-width="9" stroke-linecap="round"/>\n    <path d="M52 12 Q26 65 52 118" fill="none" stroke="#ffffff" stroke-width="3" opacity="0.2" stroke-linecap="round"/>\n    <line x1="50" y1="11" x2="50" y2="119" stroke="url(#wb-string)" stroke-width="2.5"/>\n    <path d="M46 11 L50 5 L54 11 Z" fill="url(#wb-metal)"/>\n    <path d="M46 119 L50 125 L54 119 Z" fill="url(#wb-metal)"/>\n    <rect x="42" y="58" width="16" height="14" rx="3" fill="url(#wb-limb)"/>\n    <rect x="47" y="58" width="6" height="14" fill="url(#wb-metal)" opacity="0.6"/>\n  </g>',gem:'<g id="wb-gem">\n    <ellipse cx="50" cy="65" rx="9" ry="8" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="64" rx="6" ry="5" fill="#ffffff" opacity="0.3"/>\n    <ellipse cx="50" cy="50" rx="5" ry="4" fill="GEMCOLOR" opacity="0.6"/>\n    <ellipse cx="50" cy="80" rx="5" ry="4" fill="GEMCOLOR" opacity="0.6"/>\n  </g>',adj1:'<g id="wb-adj1">\n    <defs><linearGradient id="wb-adj1-grad" x1="0%" y1="50%" x2="100%" y2="50%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M50 8 Q20 65 50 122" fill="none" stroke="url(#wb-adj1-grad)" stroke-width="16" opacity="0.35"/>\n    <path d="M46 14 Q24 65 46 116" fill="none" stroke="ADJ1COLOR" stroke-width="2.5" opacity="0.6" stroke-linecap="round"/>\n    <path d="M44 20 Q28 65 44 110" fill="none" stroke="#ffffff" stroke-width="1.2" opacity="0.25"/>\n  </g>',adj2:'<g id="wb-adj2">\n    <defs><linearGradient id="wb-adj2-grad" x1="100%" y1="50%" x2="0%" y2="50%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.55"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <path d="M50 8 Q80 65 50 122" fill="none" stroke="url(#wb-adj2-grad)" stroke-width="14" opacity="0.3"/>\n    <path d="M56 20 Q72 65 56 110" fill="none" stroke="ADJ2COLOR" stroke-width="2" opacity="0.4"/>\n  </g>',adj3:'<g id="wb-adj3">\n    <defs><radialGradient id="wb-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.7"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <ellipse cx="50" cy="65" rx="14" ry="16" fill="url(#wb-adj3-glow)" opacity="0.5"/>\n    <ellipse cx="50" cy="65" rx="7" ry="8" fill="ADJ3COLOR" opacity="0.35"/>\n    <ellipse cx="50" cy="64" rx="3.5" ry="4" fill="#ffffff" opacity="0.45"/>\n  </g>',adj4:'<g id="wb-adj4">\n    <defs><radialGradient id="wb-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.22"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.08"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <ellipse cx="50" cy="65" rx="42" ry="58" fill="url(#wb-adj4-aura)"/>\n    <ellipse cx="50" cy="65" rx="36" ry="52" fill="none" stroke="ADJ4COLOR" stroke-width="2" opacity="0.18"/>\n    <ellipse cx="50" cy="65" rx="48" ry="64" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.1"/>\n  </g>'},wand:{base:'<defs>\n    <linearGradient id="wn-shaft" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#5c4a3a"/><stop offset="100%" stop-color="#2a1f16"/></linearGradient>\n    <radialGradient id="wn-orb" cx="50%" cy="40%" r="50%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="70%" stop-color="BASECOLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="#1f1033"/></radialGradient>\n  </defs>\n  <g id="wand-root">\n    <rect x="47" y="58" width="6" height="64" rx="2" fill="url(#wn-shaft)"/>\n    <rect x="48" y="60" width="3" height="60" fill="#ffffff" opacity="0.1"/>\n    <circle cx="50" cy="28" r="22" fill="url(#wn-orb)"/>\n    <circle cx="50" cy="24" r="14" fill="#ffffff" opacity="0.25"/>\n    <path d="M50 28 A14 14 0 0 1 60 38" fill="none" stroke="#0f172a" stroke-width="2" opacity="0.15"/>\n    <path d="M47 88 L53 88 M47 96 L53 96 M47 104 L53 104" stroke="#8b7355" stroke-width="1.8" opacity="0.5"/>\n  </g>',gem:'<g id="wand-gem">\n    <circle cx="50" cy="28" rx="8" fill="GEMCOLOR"/>\n    <circle cx="50" cy="26" rx="5" fill="#ffffff" opacity="0.4"/>\n  </g>',adj1:'<g id="wn-adj1">\n    <defs><linearGradient id="wn-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <circle cx="50" cy="28" r="24" fill="url(#wn-adj1-grad)" opacity="0.45"/>\n    <path d="M32 28 A18 18 0 0 1 50 10" stroke="ADJ1COLOR" stroke-width="3" fill="none" opacity="0.65" stroke-linecap="round"/>\n    <path d="M30 26 A20 20 0 0 1 48 8" stroke="#ffffff" stroke-width="1.5" fill="none" opacity="0.3"/>\n  </g>',adj2:'<g id="wn-adj2">\n    <defs><linearGradient id="wn-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.55"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <circle cx="50" cy="28" r="22" fill="url(#wn-adj2-grad)" opacity="0.35"/>\n    <path d="M68 28 A18 18 0 0 1 50 46" stroke="ADJ2COLOR" stroke-width="2" fill="none" opacity="0.45"/>\n  </g>',adj3:'<g id="wn-adj3">\n    <defs><radialGradient id="wn-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <circle cx="50" cy="28" r="14" fill="url(#wn-adj3-glow)" opacity="0.5"/>\n    <circle cx="50" cy="28" r="6" fill="ADJ3COLOR" opacity="0.4"/>\n    <circle cx="50" cy="26" r="3" fill="#ffffff" opacity="0.5"/>\n  </g>',adj4:'<g id="wn-adj4">\n    <defs><radialGradient id="wn-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.3"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.1"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <circle cx="50" cy="28" r="32" fill="url(#wn-adj4-aura)"/>\n    <circle cx="50" cy="28" r="26" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.22"/>\n    <circle cx="50" cy="28" r="38" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.12"/>\n  </g>'},staff:{base:'<defs>\n    <linearGradient id="st-shaft" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#5c4a3a"/><stop offset="100%" stop-color="#1f160e"/></linearGradient>\n    <radialGradient id="st-orb" cx="50%" cy="40%" r="50%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="65%" stop-color="BASECOLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="#150a20"/></radialGradient>\n    <linearGradient id="st-cap" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#8B4513"/><stop offset="100%" stop-color="#4a2409"/></linearGradient>\n  </defs>\n  <g id="staff-root">\n    <rect x="45" y="42" width="10" height="80" rx="3" fill="url(#st-shaft)"/>\n    <rect x="47" y="44" width="4" height="76" fill="#ffffff" opacity="0.08"/>\n    <circle cx="50" cy="22" r="26" fill="url(#st-orb)"/>\n    <circle cx="50" cy="18" r="16" fill="#ffffff" opacity="0.22"/>\n    <path d="M50 22 A16 16 0 0 1 62 34" fill="none" stroke="#0f172a" stroke-width="2.5" opacity="0.12"/>\n    <path d="M38 118 L50 113 L62 118 L50 126 Z" fill="url(#st-cap)"/>\n  </g>',gem:'<g id="staff-gem">\n    <circle cx="50" cy="22" r="10" fill="GEMCOLOR"/>\n    <circle cx="50" cy="20" r="6" fill="#ffffff" opacity="0.35"/>\n    <circle cx="50" cy="10" r="5" fill="GEMCOLOR" opacity="0.6"/>\n  </g>',adj1:'<g id="st-adj1">\n    <defs><linearGradient id="st-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <circle cx="50" cy="22" r="28" fill="url(#st-adj1-grad)" opacity="0.4"/>\n    <path d="M28 22 A22 22 0 0 1 50 0" stroke="ADJ1COLOR" stroke-width="3.5" fill="none" opacity="0.6" stroke-linecap="round"/>\n    <path d="M26 20 A24 24 0 0 1 48 -2" stroke="#ffffff" stroke-width="1.5" fill="none" opacity="0.25"/>\n  </g>',adj2:'<g id="st-adj2">\n    <defs><linearGradient id="st-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.5"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <circle cx="50" cy="22" r="26" fill="url(#st-adj2-grad)" opacity="0.3"/>\n    <path d="M72 22 A22 22 0 0 1 50 44" stroke="ADJ2COLOR" stroke-width="2.5" fill="none" opacity="0.4"/>\n  </g>',adj3:'<g id="st-adj3">\n    <defs><radialGradient id="st-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <circle cx="50" cy="22" r="18" fill="url(#st-adj3-glow)" opacity="0.5"/>\n    <circle cx="50" cy="22" r="8" fill="ADJ3COLOR" opacity="0.35"/>\n    <circle cx="50" cy="20" r="4" fill="#ffffff" opacity="0.45"/>\n  </g>',adj4:'<g id="st-adj4">\n    <defs><radialGradient id="st-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.28"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.1"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <circle cx="50" cy="22" r="38" fill="url(#st-adj4-aura)"/>\n    <circle cx="50" cy="22" r="32" fill="none" stroke="ADJ4COLOR" stroke-width="2" opacity="0.2"/>\n    <circle cx="50" cy="22" r="44" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.1"/>\n  </g>'},scepter:{base:'<defs>\n    <linearGradient id="sc-shaft" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#c9a227"/><stop offset="50%" stop-color="#a8891f"/><stop offset="100%" stop-color="#5c4a1a"/></linearGradient>\n    <radialGradient id="sc-orb" cx="50%" cy="35%" r="50%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="60%" stop-color="BASECOLOR" stop-opacity="0.7"/><stop offset="100%" stop-color="#0f0520"/></radialGradient>\n    <linearGradient id="sc-crown" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e6c547"/><stop offset="100%" stop-color="#a8891f"/></linearGradient>\n  </defs>\n  <g id="scepter-root">\n    <rect x="44" y="50" width="12" height="72" rx="3" fill="url(#sc-shaft)"/>\n    <rect x="46" y="52" width="5" height="68" fill="#ffffff" opacity="0.15"/>\n    <circle cx="50" cy="22" r="28" fill="url(#sc-orb)"/>\n    <circle cx="50" cy="17" r="18" fill="#ffffff" opacity="0.2"/>\n    <path d="M50 22 A18 18 0 0 1 64 36" fill="none" stroke="#0f172a" stroke-width="3" opacity="0.1"/>\n    <path d="M36 44 L50 36 L64 44 L50 50 Z" fill="url(#sc-crown)"/>\n    <path d="M38 45 L50 38 L62 45" fill="#ffffff" opacity="0.2"/>\n  </g>',gem:'<g id="scepter-gem">\n    <circle cx="50" cy="22" r="12" fill="GEMCOLOR"/>\n    <circle cx="50" cy="19" r="7" fill="#ffffff" opacity="0.35"/>\n    <circle cx="50" cy="6" r="6" fill="GEMCOLOR" opacity="0.5"/>\n    <circle cx="36" cy="28" r="4" fill="GEMCOLOR" opacity="0.4"/>\n    <circle cx="64" cy="28" r="4" fill="GEMCOLOR" opacity="0.4"/>\n  </g>',adj1:'<g id="sc-adj1">\n    <defs><linearGradient id="sc-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <circle cx="50" cy="22" r="30" fill="url(#sc-adj1-grad)" opacity="0.4"/>\n    <path d="M26 22 A24 24 0 0 1 50 -2" stroke="ADJ1COLOR" stroke-width="4" fill="none" opacity="0.55" stroke-linecap="round"/>\n    <path d="M24 20 A26 26 0 0 1 48 -4" stroke="#ffffff" stroke-width="1.5" fill="none" opacity="0.25"/>\n  </g>',adj2:'<g id="sc-adj2">\n    <defs><linearGradient id="sc-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.5"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <circle cx="50" cy="22" r="28" fill="url(#sc-adj2-grad)" opacity="0.3"/>\n    <path d="M74 22 A24 24 0 0 1 50 46" stroke="ADJ2COLOR" stroke-width="3" fill="none" opacity="0.35"/>\n  </g>',adj3:'<g id="sc-adj3">\n    <defs><radialGradient id="sc-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <circle cx="50" cy="22" r="20" fill="url(#sc-adj3-glow)" opacity="0.45"/>\n    <circle cx="50" cy="22" r="10" fill="ADJ3COLOR" opacity="0.3"/>\n    <circle cx="50" cy="20" r="5" fill="#ffffff" opacity="0.45"/>\n  </g>',adj4:'<g id="sc-adj4">\n    <defs><radialGradient id="sc-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.25"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.08"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <circle cx="50" cy="22" r="42" fill="url(#sc-adj4-aura)"/>\n    <circle cx="50" cy="22" r="36" fill="none" stroke="ADJ4COLOR" stroke-width="2" opacity="0.18"/>\n    <circle cx="50" cy="22" r="50" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.1"/>\n  </g>'},mace:{base:'<defs>\n    <linearGradient id="mc-head" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="100%" stop-color="#2a2a35"/></linearGradient>\n    <linearGradient id="mc-haft" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#5c4a3a"/><stop offset="100%" stop-color="#2a1f16"/></linearGradient>\n    <linearGradient id="mc-band" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#c9a227"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n  </defs>\n  <g id="mace-root">\n    <rect x="46" y="50" width="8" height="70" rx="2" fill="url(#mc-haft)"/>\n    <rect x="47" y="52" width="4" height="66" fill="#ffffff" opacity="0.1"/>\n    <ellipse cx="50" cy="28" rx="22" ry="24" fill="url(#mc-head)"/>\n    <ellipse cx="50" cy="24" rx="14" ry="15" fill="#ffffff" opacity="0.2"/>\n    <path d="M50 28 A14 14 0 0 1 60 38" fill="none" stroke="#0f172a" stroke-width="2" opacity="0.15"/>\n    <rect x="42" y="46" width="16" height="6" rx="2" fill="url(#mc-band)"/>\n    <path d="M46 90 L54 90 M46 98 L54 98 M46 106 L54 106" stroke="#8b7355" stroke-width="1.6" opacity="0.5"/>\n    <ellipse cx="50" cy="118" rx="6" ry="5" fill="url(#mc-band)"/>\n  </g>',gem:'<g id="mace-gem">\n    <ellipse cx="50" cy="28" rx="8" ry="9" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="26" rx="5" ry="5" fill="#ffffff" opacity="0.35"/>\n  </g>',adj1:'<g id="mc-adj1">\n    <defs><linearGradient id="mc-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <ellipse cx="50" cy="28" rx="24" ry="26" fill="url(#mc-adj1-grad)" opacity="0.45"/>\n    <path d="M30 28 A20 20 0 0 1 50 8" stroke="ADJ1COLOR" stroke-width="3" fill="none" opacity="0.65" stroke-linecap="round"/>\n    <path d="M28 26 A22 22 0 0 1 48 6" stroke="#ffffff" stroke-width="1.2" fill="none" opacity="0.3"/>\n  </g>',adj2:'<g id="mc-adj2">\n    <defs><linearGradient id="mc-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.55"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <ellipse cx="50" cy="28" rx="22" ry="24" fill="url(#mc-adj2-grad)" opacity="0.35"/>\n    <path d="M70 28 A20 20 0 0 1 50 48" stroke="ADJ2COLOR" stroke-width="2" fill="none" opacity="0.4"/>\n  </g>',adj3:'<g id="mc-adj3">\n    <defs><radialGradient id="mc-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <ellipse cx="50" cy="28" rx="14" ry="15" fill="url(#mc-adj3-glow)" opacity="0.5"/>\n    <ellipse cx="50" cy="28" rx="6" ry="7" fill="ADJ3COLOR" opacity="0.35"/>\n    <ellipse cx="50" cy="26" rx="3" ry="3.5" fill="#ffffff" opacity="0.45"/>\n  </g>',adj4:'<g id="mc-adj4">\n    <defs><radialGradient id="mc-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.28"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.1"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <ellipse cx="50" cy="28" rx="32" ry="34" fill="url(#mc-adj4-aura)"/>\n    <ellipse cx="50" cy="28" rx="26" ry="28" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.22"/>\n    <ellipse cx="50" cy="28" rx="36" ry="40" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.12"/>\n  </g>'},warhammer:{base:'<defs>\n    <linearGradient id="wh-head" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="100%" stop-color="#1a1a25"/></linearGradient>\n    <linearGradient id="wh-haft" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#5c4a3a"/><stop offset="100%" stop-color="#1f160e"/></linearGradient>\n    <linearGradient id="wh-band" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#9a7b1a"/></linearGradient>\n  </defs>\n  <g id="warhammer-root">\n    <rect x="45" y="46" width="10" height="76" rx="3" fill="url(#wh-haft)"/>\n    <rect x="46" y="48" width="5" height="72" fill="#ffffff" opacity="0.08"/>\n    <rect x="26" y="16" width="48" height="32" rx="4" fill="url(#wh-head)"/>\n    <rect x="30" y="20" width="28" height="18" fill="#ffffff" opacity="0.18"/>\n    <path d="M28 18 L72 18 L70 44 L30 44 Z" fill="#0f172a" opacity="0.08"/>\n    <rect x="40" y="44" width="20" height="8" rx="2" fill="url(#wh-band)"/>\n    <path d="M45 88 L55 88 M45 98 L55 98 M45 108 L55 108" stroke="#8b7355" stroke-width="1.8" opacity="0.5"/>\n    <ellipse cx="50" cy="120" rx="7" ry="6" fill="url(#wh-band)"/>\n  </g>',gem:'<g id="wh-gem">\n    <ellipse cx="50" cy="32" rx="9" ry="8" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="30" rx="6" ry="5" fill="#ffffff" opacity="0.3"/>\n  </g>',adj1:'<g id="wh-adj1">\n    <defs><linearGradient id="wh-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.8"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <rect x="24" y="14" width="52" height="34" rx="4" fill="url(#wh-adj1-grad)" opacity="0.4"/>\n    <path d="M28 32 L28 18 L72 18" stroke="ADJ1COLOR" stroke-width="3" fill="none" opacity="0.6" stroke-linecap="round"/>\n    <path d="M26 30 L26 16 L70 16" stroke="#ffffff" stroke-width="1.2" fill="none" opacity="0.25"/>\n  </g>',adj2:'<g id="wh-adj2">\n    <defs><linearGradient id="wh-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.55"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <rect x="28" y="18" width="44" height="28" rx="3" fill="url(#wh-adj2-grad)" opacity="0.35"/>\n    <path d="M72 32 L72 46 L28 46" stroke="ADJ2COLOR" stroke-width="2" fill="none" opacity="0.4"/>\n  </g>',adj3:'<g id="wh-adj3">\n    <defs><radialGradient id="wh-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <ellipse cx="50" cy="32" rx="16" ry="12" fill="url(#wh-adj3-glow)" opacity="0.5"/>\n    <ellipse cx="50" cy="32" rx="7" ry="5" fill="ADJ3COLOR" opacity="0.35"/>\n    <ellipse cx="50" cy="30" rx="3.5" ry="2.5" fill="#ffffff" opacity="0.45"/>\n  </g>',adj4:'<g id="wh-adj4">\n    <defs><radialGradient id="wh-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.25"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.08"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <rect x="14" y="6" width="72" height="48" rx="8" fill="url(#wh-adj4-aura)"/>\n    <rect x="18" y="10" width="64" height="40" rx="6" fill="none" stroke="ADJ4COLOR" stroke-width="1.5" opacity="0.2"/>\n    <rect x="10" y="2" width="80" height="56" rx="10" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.1"/>\n  </g>'},maul:{base:'<defs>\n    <linearGradient id="ml-head" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="BASECOLOR"/><stop offset="100%" stop-color="#101018"/></linearGradient>\n    <linearGradient id="ml-haft" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#4a3d30"/><stop offset="100%" stop-color="#1a130c"/></linearGradient>\n    <linearGradient id="ml-band" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e6c547"/><stop offset="100%" stop-color="#a8891f"/></linearGradient>\n  </defs>\n  <g id="maul-root">\n    <rect x="44" y="44" width="12" height="80" rx="3" fill="url(#ml-haft)"/>\n    <rect x="46" y="46" width="6" height="76" fill="#ffffff" opacity="0.07"/>\n    <rect x="22" y="12" width="56" height="36" rx="5" fill="url(#ml-head)"/>\n    <rect x="26" y="16" width="34" height="22" fill="#ffffff" opacity="0.15"/>\n    <path d="M24 14 L76 14 L74 44 L26 44 Z" fill="#0f172a" opacity="0.06"/>\n    <rect x="38" y="44" width="24" height="10" rx="3" fill="url(#ml-band)"/>\n    <path d="M44 92 L56 92 M44 104 L56 104 M44 116 L56 116" stroke="#6b5840" stroke-width="2" opacity="0.5"/>\n    <rect x="44" y="120" width="12" height="8" rx="2" fill="url(#ml-band)"/>\n  </g>',gem:'<g id="maul-gem">\n    <ellipse cx="50" cy="30" rx="11" ry="10" fill="GEMCOLOR"/>\n    <ellipse cx="50" cy="28" rx="7" ry="6" fill="#ffffff" opacity="0.28"/>\n    <ellipse cx="36" cy="30" rx="5" ry="4" fill="GEMCOLOR" opacity="0.5"/>\n    <ellipse cx="64" cy="30" rx="5" ry="4" fill="GEMCOLOR" opacity="0.5"/>\n  </g>',adj1:'<g id="ml-adj1">\n    <defs><linearGradient id="ml-adj1-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="ADJ1COLOR" stop-opacity="0.75"/><stop offset="100%" stop-color="ADJ1COLOR" stop-opacity="0"/></linearGradient></defs>\n    <rect x="20" y="10" width="60" height="40" rx="6" fill="url(#ml-adj1-grad)" opacity="0.4"/>\n    <path d="M24 32 L24 14 L76 14" stroke="ADJ1COLOR" stroke-width="3.5" fill="none" opacity="0.55" stroke-linecap="round"/>\n    <path d="M22 30 L22 12 L74 12" stroke="#ffffff" stroke-width="1.5" fill="none" opacity="0.25"/>\n  </g>',adj2:'<g id="ml-adj2">\n    <defs><linearGradient id="ml-adj2-grad" x1="100%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="ADJ2COLOR" stop-opacity="0.5"/><stop offset="100%" stop-color="ADJ2COLOR" stop-opacity="0"/></linearGradient></defs>\n    <rect x="24" y="14" width="52" height="32" rx="5" fill="url(#ml-adj2-grad)" opacity="0.35"/>\n    <path d="M76 28 L76 46 L24 46" stroke="ADJ2COLOR" stroke-width="2.5" fill="none" opacity="0.35"/>\n  </g>',adj3:'<g id="ml-adj3">\n    <defs><radialGradient id="ml-adj3-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ3COLOR" stop-opacity="0.7"/><stop offset="100%" stop-color="ADJ3COLOR" stop-opacity="0.1"/></radialGradient></defs>\n    <ellipse cx="50" cy="30" rx="18" ry="14" fill="url(#ml-adj3-glow)" opacity="0.5"/>\n    <ellipse cx="50" cy="30" rx="9" ry="7" fill="ADJ3COLOR" opacity="0.3"/>\n    <ellipse cx="50" cy="28" rx="4.5" ry="3.5" fill="#ffffff" opacity="0.4"/>\n  </g>',adj4:'<g id="ml-adj4">\n    <defs><radialGradient id="ml-adj4-aura" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="ADJ4COLOR" stop-opacity="0.22"/><stop offset="60%" stop-color="ADJ4COLOR" stop-opacity="0.08"/><stop offset="100%" stop-color="ADJ4COLOR" stop-opacity="0"/></radialGradient></defs>\n    <rect x="10" y="2" width="80" height="56" rx="10" fill="url(#ml-adj4-aura)"/>\n    <rect x="14" y="6" width="72" height="48" rx="8" fill="none" stroke="ADJ4COLOR" stroke-width="2" opacity="0.18"/>\n    <rect x="6" y="-2" width="88" height="64" rx="12" fill="none" stroke="ADJ4COLOR" stroke-width="1" opacity="0.1"/>\n  </g>'},stick:{base:'<defs>\n    <linearGradient id="stk-wood" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#6b5840"/><stop offset="100%" stop-color="#2f261c"/></linearGradient>\n  </defs>\n  <g id="stick-root">\n    <rect x="46" y="20" width="8" height="100" rx="3" fill="url(#stk-wood)"/>\n    <rect x="47" y="22" width="4" height="96" fill="#ffffff" opacity="0.1"/>\n    <ellipse cx="50" cy="22" rx="5" ry="4" fill="#5c4a3a"/>\n    <ellipse cx="50" cy="118" rx="4" ry="3" fill="#4a3d30"/>\n  </g>',gem:"",adj1:"",adj2:"",adj3:"",adj4:""}},TALENT_SVG={anaphora:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="an-crown" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="an-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n      <linearGradient id="an-gold" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#an-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <path d="M25 55 L30 78 L40 65 L50 82 L60 65 L70 78 L75 55 L70 50 L60 60 L50 42 L40 60 L30 50 Z" fill="url(#an-crown)"/>\n    <path d="M30 57 L34 72 L42 63" fill="none" stroke="#fff" stroke-width="2" opacity="0.3" stroke-linecap="round"/>\n    <ellipse cx="50" cy="58" rx="6" ry="5" fill="#d4af37"/><ellipse cx="50" cy="57" rx="4" ry="3" fill="#fff" opacity="0.4"/>\n    <circle cx="28" cy="42" r="2" fill="#fff" opacity="0.6"/><circle cx="72" cy="44" r="1.5" fill="#fff" opacity="0.5"/>\n    <path d="M42 95 L50 105 L58 95" fill="none" stroke="#d4af37" stroke-width="3" stroke-linecap="round" opacity="0.8"/>\n  </svg>',epistrophe:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ep-crown" x1="0%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stop-color="#0e7490"/><stop offset="100%" stop-color="#06b6d4"/></linearGradient>\n      <radialGradient id="ep-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n      <linearGradient id="ep-gold" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#ep-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <path d="M25 55 L30 78 L40 65 L50 82 L60 65 L70 78 L75 55 L70 50 L60 60 L50 42 L40 60 L30 50 Z" fill="url(#ep-crown)" transform="rotate(180 50 65)"/>\n    <path d="M70 73 L66 58 L58 67" fill="none" stroke="#fff" stroke-width="2" opacity="0.3" stroke-linecap="round"/>\n    <ellipse cx="50" cy="72" rx="6" ry="5" fill="#d4af37"/><ellipse cx="50" cy="71" rx="4" ry="3" fill="#fff" opacity="0.4"/>\n    <circle cx="28" cy="88" r="2" fill="#fff" opacity="0.6"/><circle cx="72" cy="86" r="1.5" fill="#fff" opacity="0.5"/>\n    <path d="M42 105 L50 95 L58 105" fill="none" stroke="#d4af37" stroke-width="3" stroke-linecap="round" opacity="0.8"/>\n  </svg>',amplify:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="am-blade" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="50%" stop-color="#0891b2"/><stop offset="100%" stop-color="#164e63"/></linearGradient>\n      <radialGradient id="am-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n      <linearGradient id="am-hilt" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#am-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <path d="M30 95 Q25 80 30 60 Q35 40 55 25 Q70 35 75 50 Q72 55 65 55 Q55 55 50 65 Q48 75 50 85 L45 90 Z" fill="url(#am-blade)"/>\n    <path d="M32 90 Q28 78 32 62 Q36 45 52 32" fill="none" stroke="#fff" stroke-width="2.5" opacity="0.25" stroke-linecap="round"/>\n    <rect x="42" y="90" width="10" height="20" rx="2" fill="url(#am-hilt)"/>\n    <ellipse cx="47" cy="115" rx="8" ry="5" fill="url(#am-hilt)"/>\n    <circle cx="68" cy="38" r="2" fill="#fff" opacity="0.6"/><circle cx="35" cy="50" r="1.5" fill="#fff" opacity="0.5"/>\n  </svg>',crescendo:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="cr-wave" x1="0%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stop-color="#0e7490"/><stop offset="50%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#22d3ee"/></linearGradient>\n      <radialGradient id="cr-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#cr-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <path d="M15 95 Q20 90 25 85 Q30 75 35 70 Q42 60 50 50 Q60 38 70 30 Q78 25 80 28 Q75 35 72 45 Q68 58 62 68 Q55 80 45 88 Q35 95 25 98 Q18 100 15 95 Z" fill="url(#cr-wave)"/>\n    <path d="M20 92 Q28 82 38 68 Q50 52 65 38" fill="none" stroke="#fff" stroke-width="2.5" opacity="0.3" stroke-linecap="round"/>\n    <path d="M25 88 Q32 80 40 70 Q50 58 60 48" fill="none" stroke="#fff" stroke-width="1.5" opacity="0.2" stroke-linecap="round"/>\n    <circle cx="75" cy="32" r="3" fill="#22d3ee" opacity="0.8"/><circle cx="78" cy="28" r="1.5" fill="#fff" opacity="0.7"/>\n    <circle cx="22" cy="78" r="1.5" fill="#fff" opacity="0.5"/><circle cx="70" cy="42" r="1.5" fill="#fff" opacity="0.4"/>\n  </svg>',berserker:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="bk-mask" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#dc2626"/><stop offset="50%" stop-color="#991b1b"/><stop offset="100%" stop-color="#450a0a"/></linearGradient>\n      <radialGradient id="bk-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#bk-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <path d="M25 45 Q30 30 50 25 Q70 30 75 45 L78 55 Q75 80 70 90 Q60 105 50 108 Q40 105 30 90 Q25 80 22 55 Z" fill="url(#bk-mask)"/>\n    <path d="M28 48 Q32 35 50 30 Q68 35 72 48" fill="none" stroke="#fff" stroke-width="2" opacity="0.2" stroke-linecap="round"/>\n    <path d="M30 42 L38 50 M70 42 L62 50" stroke="#450a0a" stroke-width="4" stroke-linecap="round"/>\n    <path d="M35 60 L45 65 L35 70 M65 60 L55 65 L65 70" stroke="#0f0f0f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>\n    <path d="M38 85 Q50 92 62 85" stroke="#0f0f0f" stroke-width="3" stroke-linecap="round" fill="none"/>\n    <circle cx="25" cy="35" r="2" fill="#fff" opacity="0.5"/><circle cx="75" cy="35" r="1.5" fill="#fff" opacity="0.4"/>\n  </svg>',cascade:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ca-water" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#a855f7"/><stop offset="50%" stop-color="#7c3aed"/><stop offset="100%" stop-color="#4c1d95"/></linearGradient>\n      <radialGradient id="ca-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#ca-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <rect x="30" y="25" width="40" height="12" rx="3" fill="url(#ca-water)"/><rect x="32" y="27" width="36" height="4" rx="2" fill="#fff" opacity="0.2"/>\n    <path d="M45 37 Q42 45 45 52 M55 37 Q58 45 55 52" stroke="url(#ca-water)" stroke-width="4" fill="none" stroke-linecap="round"/>\n    <rect x="25" y="52" width="50" height="12" rx="3" fill="url(#ca-water)"/><rect x="27" y="54" width="46" height="4" rx="2" fill="#fff" opacity="0.2"/>\n    <path d="M40 64 Q36 75 40 82 M50 64 Q50 75 50 82 M60 64 Q64 75 60 82" stroke="url(#ca-water)" stroke-width="4" fill="none" stroke-linecap="round"/>\n    <rect x="20" y="82" width="60" height="14" rx="3" fill="url(#ca-water)"/><rect x="22" y="84" width="56" height="5" rx="2" fill="#fff" opacity="0.2"/>\n    <circle cx="35" cy="45" r="1.5" fill="#fff" opacity="0.6"/><circle cx="65" cy="72" r="1.5" fill="#fff" opacity="0.5"/>\n  </svg>',compound_interest:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ci-coin" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="50%" stop-color="#d4af37"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <radialGradient id="ci-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#ci-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <ellipse cx="50" cy="95" rx="25" ry="8" fill="url(#ci-coin)"/><ellipse cx="50" cy="93" rx="20" ry="5" fill="#fff" opacity="0.2"/>\n    <ellipse cx="50" cy="85" rx="22" ry="7" fill="url(#ci-coin)"/><ellipse cx="50" cy="83" rx="17" ry="4" fill="#fff" opacity="0.2"/>\n    <ellipse cx="50" cy="75" rx="19" ry="6" fill="url(#ci-coin)"/><ellipse cx="50" cy="73" rx="14" ry="4" fill="#fff" opacity="0.2"/>\n    <ellipse cx="50" cy="65" rx="16" ry="5" fill="url(#ci-coin)"/><ellipse cx="50" cy="63" rx="11" ry="3" fill="#fff" opacity="0.25"/>\n    <ellipse cx="50" cy="56" rx="13" ry="4" fill="url(#ci-coin)"/><ellipse cx="50" cy="54" rx="9" ry="2.5" fill="#fff" opacity="0.25"/>\n    <ellipse cx="50" cy="48" rx="10" ry="3" fill="url(#ci-coin)"/><ellipse cx="50" cy="46" rx="7" ry="2" fill="#fff" opacity="0.3"/>\n    <ellipse cx="50" cy="41" rx="7" ry="2.5" fill="url(#ci-coin)"/><ellipse cx="50" cy="40" rx="5" ry="1.5" fill="#fff" opacity="0.3"/>\n    <circle cx="72" cy="50" r="2" fill="#fff" opacity="0.5"/><circle cx="28" cy="80" r="1.5" fill="#fff" opacity="0.4"/>\n  </svg>',overflow:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ov-vessel" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#7c3aed"/><stop offset="100%" stop-color="#4c1d95"/></linearGradient>\n      <linearGradient id="ov-liquid" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#a855f7"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>\n      <radialGradient id="ov-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#ov-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <path d="M30 50 L25 100 Q25 110 50 110 Q75 110 75 100 L70 50 Z" fill="url(#ov-vessel)"/>\n    <path d="M32 52 L28 95 Q28 102 50 102" fill="none" stroke="#fff" stroke-width="2" opacity="0.2" stroke-linecap="round"/>\n    <ellipse cx="50" cy="50" rx="20" ry="6" fill="url(#ov-vessel)"/>\n    <path d="M32 55 Q50 35 68 55 Q50 45 32 55" fill="url(#ov-liquid)"/>\n    <ellipse cx="50" cy="50" rx="18" ry="5" fill="url(#ov-liquid)"/><ellipse cx="50" cy="49" rx="12" ry="3" fill="#fff" opacity="0.25"/>\n    <path d="M25 48 Q20 40 22 32 M75 48 Q80 40 78 32" stroke="url(#ov-liquid)" stroke-width="5" fill="none" stroke-linecap="round"/>\n    <path d="M20 30 Q18 22 22 18 M80 30 Q82 22 78 18" stroke="url(#ov-liquid)" stroke-width="3" fill="none" stroke-linecap="round"/>\n    <circle cx="18" cy="25" r="3" fill="#a855f7" opacity="0.7"/><circle cx="82" cy="25" r="3" fill="#a855f7" opacity="0.7"/>\n  </svg>',chain_reaction:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ch-dom" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#a855f7"/><stop offset="100%" stop-color="#581c87"/></linearGradient>\n      <radialGradient id="ch-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#ch-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <rect x="18" y="75" width="10" height="30" rx="2" fill="url(#ch-dom)" transform="rotate(-45 23 90)"/>\n    <rect x="33" y="68" width="10" height="30" rx="2" fill="url(#ch-dom)" transform="rotate(-30 38 83)"/>\n    <rect x="48" y="62" width="10" height="30" rx="2" fill="url(#ch-dom)" transform="rotate(-15 53 77)"/>\n    <rect x="63" y="58" width="10" height="30" rx="2" fill="url(#ch-dom)"/>\n    <rect x="78" y="58" width="10" height="30" rx="2" fill="url(#ch-dom)"/>\n    <circle cx="23" cy="55" r="3" fill="#fbbf24"/><circle cx="38" cy="48" r="3" fill="#fbbf24"/><circle cx="53" cy="42" r="3" fill="#fbbf24"/><circle cx="68" cy="38" r="3" fill="#fbbf24"/>\n    <path d="M25 52 L36 46 L51 40 L66 36" stroke="#fbbf24" stroke-width="2" stroke-dasharray="3,2" opacity="0.6"/>\n    <circle cx="15" cy="62" r="1.5" fill="#fff" opacity="0.5"/>\n  </svg>',crown_jewel:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="cj-gem" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fff"/><stop offset="30%" stop-color="#e0f2fe"/><stop offset="70%" stop-color="#7dd3fc"/><stop offset="100%" stop-color="#0ea5e9"/></linearGradient>\n      <radialGradient id="cj-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.6"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n      <linearGradient id="cj-crown" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#cj-glow)"/>\n    <ellipse cx="50" cy="65" rx="42" ry="50" fill="none" stroke="#9333ea" stroke-width="2" opacity="0.35"/>\n    <path d="M50 25 L70 55 L60 90 L40 90 L30 55 Z" fill="url(#cj-gem)"/>\n    <path d="M50 25 L30 55 L50 48 L70 55 Z" fill="#fff" opacity="0.4"/>\n    <path d="M50 48 L30 55 L40 90 L50 75 Z" fill="#0ea5e9" opacity="0.3"/>\n    <path d="M50 48 L70 55 L60 90 L50 75 Z" fill="#0284c7" opacity="0.25"/>\n    <line x1="50" y1="25" x2="50" y2="75" stroke="#fff" stroke-width="1" opacity="0.5"/>\n    <line x1="30" y1="55" x2="60" y2="90" stroke="#fff" stroke-width="0.5" opacity="0.3"/>\n    <line x1="70" y1="55" x2="40" y2="90" stroke="#fff" stroke-width="0.5" opacity="0.3"/>\n    <path d="M35 100 L50 95 L65 100 L60 105 L40 105 Z" fill="url(#cj-crown)"/>\n    <circle cx="50" cy="32" r="4" fill="#fff" opacity="0.7"/><circle cx="38" cy="55" r="2" fill="#fff" opacity="0.5"/>\n    <circle cx="25" cy="40" r="2" fill="#fff" opacity="0.5"/><circle cx="75" cy="40" r="1.5" fill="#fff" opacity="0.4"/>\n  </svg>',reread_amplifier:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ra-dial" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <linearGradient id="ra-body" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#374151"/><stop offset="100%" stop-color="#111827"/></linearGradient>\n      <radialGradient id="ra-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#ra-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <rect x="25" y="35" width="50" height="70" rx="8" fill="url(#ra-body)"/>\n    <rect x="28" y="38" width="44" height="64" rx="6" fill="#1f2937"/>\n    <circle cx="50" cy="70" r="22" fill="#0f172a" stroke="url(#ra-dial)" stroke-width="3"/>\n    <circle cx="50" cy="70" r="18" fill="#1e293b"/>\n    <path d="M30 75 A25 25 0 0 1 70 75" fill="none" stroke="#dc2626" stroke-width="4" stroke-linecap="round"/>\n    <path d="M35 78 A20 20 0 0 1 50 58" fill="none" stroke="#22c55e" stroke-width="3" stroke-linecap="round" opacity="0.5"/>\n    <line x1="50" y1="70" x2="68" y2="62" stroke="#06b6d4" stroke-width="3" stroke-linecap="round"/>\n    <circle cx="50" cy="70" r="4" fill="url(#ra-dial)"/>\n    <circle cx="32" cy="45" r="2" fill="#22c55e"/><circle cx="50" cy="42" r="2" fill="#fbbf24"/><circle cx="68" cy="45" r="2" fill="#dc2626"/>\n  </svg>',echo_chamber:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ec-wall" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#475569"/><stop offset="100%" stop-color="#1e293b"/></linearGradient>\n      <radialGradient id="ec-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#9333ea" stop-opacity="0.5"/><stop offset="100%" stop-color="#9333ea" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="45" ry="55" fill="url(#ec-glow)"/>\n    <ellipse cx="50" cy="65" rx="40" ry="48" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <path d="M20 30 L20 100 L80 100 L80 30 Q50 45 20 30" fill="url(#ec-wall)"/>\n    <path d="M22 35 L22 98 L78 98 L78 35 Q50 48 22 35" fill="#0f172a"/>\n    <circle cx="50" cy="70" r="6" fill="#06b6d4" opacity="0.9"/>\n    <circle cx="50" cy="70" r="12" fill="none" stroke="#06b6d4" stroke-width="2" opacity="0.7"/>\n    <circle cx="50" cy="70" r="20" fill="none" stroke="#06b6d4" stroke-width="1.5" opacity="0.5"/>\n    <circle cx="50" cy="70" r="28" fill="none" stroke="#06b6d4" stroke-width="1" opacity="0.3"/>\n    <circle cx="50" cy="70" r="36" fill="none" stroke="#06b6d4" stroke-width="0.5" opacity="0.2"/>\n    <path d="M24 38 L24 95" stroke="#fff" stroke-width="1" opacity="0.1"/>\n    <path d="M76 38 L76 95" stroke="#fff" stroke-width="1" opacity="0.1"/>\n    <circle cx="30" cy="50" r="1.5" fill="#fff" opacity="0.4"/><circle cx="70" cy="50" r="1.5" fill="#fff" opacity="0.4"/>\n  </svg>',steady_hand:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="sh-hand" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n      <radialGradient id="sh-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#sh-glow)"/>\n    <path d="M35 50 Q32 60 35 80 Q38 95 50 100 Q62 95 65 80 Q68 60 65 50 Q63 42 58 38 L58 55 Q55 60 50 60 Q45 60 42 55 L42 38 Q37 42 35 50" fill="url(#sh-hand)"/>\n    <path d="M38 55 Q36 65 38 78 Q40 88 50 92" fill="none" stroke="#fff" stroke-width="2.5" opacity="0.25" stroke-linecap="round"/>\n    <ellipse cx="42" cy="35" rx="4" ry="6" fill="url(#sh-hand)"/>\n    <ellipse cx="50" cy="32" rx="4" ry="7" fill="url(#sh-hand)"/>\n    <ellipse cx="58" cy="35" rx="4" ry="6" fill="url(#sh-hand)"/>\n  </svg>',first_blood:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="fb-drop" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#ef4444"/><stop offset="100%" stop-color="#7f1d1d"/></linearGradient>\n      <radialGradient id="fb-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fbbf24" stop-opacity="0.4"/><stop offset="100%" stop-color="#fbbf24" stop-opacity="0"/></radialGradient>\n      <linearGradient id="fb-dawn" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#f97316"/><stop offset="50%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#fef3c7"/></linearGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#fb-glow)"/>\n    <path d="M20 95 Q50 75 80 95 L80 110 L20 110 Z" fill="url(#fb-dawn)" opacity="0.5"/>\n    <path d="M50 25 Q35 55 35 75 Q35 95 50 100 Q65 95 65 75 Q65 55 50 25" fill="url(#fb-drop)"/>\n    <path d="M45 35 Q38 58 40 78" fill="none" stroke="#fff" stroke-width="3" opacity="0.3" stroke-linecap="round"/>\n    <ellipse cx="45" cy="80" rx="5" ry="4" fill="#fff" opacity="0.25"/>\n  </svg>',comfort_zone:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="cz-warm" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="70%" stop-color="#d97706"/><stop offset="100%" stop-color="#92400e"/></radialGradient>\n      <radialGradient id="cz-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#cz-glow)"/>\n    <circle cx="50" cy="65" r="30" fill="url(#cz-warm)"/>\n    <circle cx="50" cy="65" r="22" fill="#fef3c7" opacity="0.2"/>\n    <circle cx="50" cy="65" r="14" fill="#fff" opacity="0.15"/>\n    <circle cx="42" cy="58" r="4" fill="#fff" opacity="0.3"/>\n  </svg>',linguist:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="lg-bubble" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n      <radialGradient id="lg-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#lg-glow)"/>\n    <ellipse cx="38" cy="50" rx="18" ry="14" fill="url(#lg-bubble)"/>\n    <path d="M30 60 L25 72 L38 62" fill="url(#lg-bubble)"/>\n    <ellipse cx="38" cy="48" rx="12" ry="8" fill="#fff" opacity="0.2"/>\n    <ellipse cx="62" cy="70" rx="16" ry="12" fill="url(#lg-bubble)"/>\n    <path d="M70 78 L78 88 L65 80" fill="url(#lg-bubble)"/>\n    <ellipse cx="62" cy="68" rx="10" ry="7" fill="#fff" opacity="0.2"/>\n    <ellipse cx="50" cy="90" rx="14" ry="10" fill="url(#lg-bubble)"/>\n    <path d="M45 98 L40 108 L52 99" fill="url(#lg-bubble)"/>\n    <ellipse cx="50" cy="88" rx="9" ry="6" fill="#fff" opacity="0.2"/>\n  </svg>',condensed:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="cd-cube" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#4b5563"/></linearGradient>\n      <linearGradient id="cd-top" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d1d5db"/><stop offset="100%" stop-color="#9ca3af"/></linearGradient>\n      <radialGradient id="cd-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#cd-glow)"/>\n    <path d="M50 35 L75 50 L75 85 L50 100 L25 85 L25 50 Z" fill="url(#cd-cube)"/>\n    <path d="M50 35 L75 50 L50 65 L25 50 Z" fill="url(#cd-top)"/>\n    <path d="M50 65 L50 100 L25 85 L25 50 Z" fill="#374151"/>\n    <path d="M50 35 L50 65 M25 50 L50 65 L75 50" stroke="#fff" stroke-width="1" opacity="0.2"/>\n    <path d="M30 52 L30 80" stroke="#fff" stroke-width="2" opacity="0.15"/>\n  </svg>',spectrum:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="sp-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#sp-glow)"/>\n    <path d="M15 90 Q50 20 85 90" fill="none" stroke="#94a3b8" stroke-width="6" stroke-linecap="round"/>\n    <path d="M20 90 Q50 28 80 90" fill="none" stroke="#84cc16" stroke-width="5" stroke-linecap="round"/>\n    <path d="M25 90 Q50 36 75 90" fill="none" stroke="#f97316" stroke-width="5" stroke-linecap="round"/>\n    <path d="M30 90 Q50 44 70 90" fill="none" stroke="#3b82f6" stroke-width="5" stroke-linecap="round"/>\n    <path d="M35 90 Q50 52 65 90" fill="none" stroke="#fbbf24" stroke-width="4" stroke-linecap="round"/>\n    <path d="M40 90 Q50 60 60 90" fill="none" stroke="#6b21a8" stroke-width="4" stroke-linecap="round"/>\n    <path d="M45 90 Q50 68 55 90" fill="none" stroke="#78716c" stroke-width="3" stroke-linecap="round"/>\n    <path d="M48 90 Q50 76 52 90" fill="none" stroke="#facc15" stroke-width="3" stroke-linecap="round"/>\n  </svg>',inferno:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="in-fire" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#dc2626"/><stop offset="50%" stop-color="#f97316"/><stop offset="100%" stop-color="#fbbf24"/></linearGradient>\n      <linearGradient id="in-water" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#1e40af"/></linearGradient>\n      <radialGradient id="in-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#in-glow)"/>\n    <path d="M30 95 Q20 80 35 70 Q25 60 40 50 Q35 35 50 25 Q65 35 60 50 Q75 60 65 70 Q80 80 70 95 Z" fill="url(#in-fire)"/>\n    <ellipse cx="50" cy="100" rx="25" ry="8" fill="url(#in-water)"/>\n    <path d="M30 95 Q35 100 50 102 Q65 100 70 95" fill="none" stroke="#fff" stroke-width="3" opacity="0.4" stroke-linecap="round"/>\n    <ellipse cx="50" cy="45" rx="8" ry="6" fill="#fff" opacity="0.3"/>\n    <path d="M42 30 Q50 20 58 30" stroke="#fff" stroke-width="2" opacity="0.4" fill="none"/>\n  </svg>',verdant:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="vd-leaf" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#15803d"/></linearGradient>\n      <linearGradient id="vd-earth" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#78716c"/><stop offset="100%" stop-color="#44403c"/></linearGradient>\n      <radialGradient id="vd-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n      <radialGradient id="vd-sun" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#fbbf24" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#vd-glow)"/>\n    <ellipse cx="70" cy="30" rx="15" ry="15" fill="url(#vd-sun)" opacity="0.5"/>\n    <rect x="20" y="90" width="60" height="20" rx="3" fill="url(#vd-earth)"/>\n    <path d="M50 90 L50 55" stroke="#15803d" stroke-width="4" stroke-linecap="round"/>\n    <path d="M50 70 Q35 60 30 45 Q40 50 50 60" fill="url(#vd-leaf)"/>\n    <path d="M50 60 Q65 50 70 35 Q60 45 50 55" fill="url(#vd-leaf)"/>\n    <ellipse cx="50" cy="42" rx="8" ry="6" fill="url(#vd-leaf)"/>\n    <path d="M45 42 Q50 35 55 42" stroke="#fff" stroke-width="1.5" opacity="0.3" fill="none"/>\n  </svg>',venom_strike:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="vs-fang" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#84cc16"/><stop offset="100%" stop-color="#365314"/></linearGradient>\n      <linearGradient id="vs-bolt" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#facc15"/><stop offset="100%" stop-color="#ca8a04"/></linearGradient>\n      <radialGradient id="vs-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#vs-glow)"/>\n    <path d="M35 30 Q30 50 35 70 L40 65 Q38 50 40 35 Z" fill="url(#vs-fang)"/>\n    <path d="M65 30 Q70 50 65 70 L60 65 Q62 50 60 35 Z" fill="url(#vs-fang)"/>\n    <path d="M36 32 Q34 48 36 62" stroke="#fff" stroke-width="2" opacity="0.3" fill="none"/>\n    <path d="M64 32 Q66 48 64 62" stroke="#fff" stroke-width="2" opacity="0.3" fill="none"/>\n    <path d="M50 45 L55 60 L48 60 L55 80 L45 65 L52 65 L45 50 Z" fill="url(#vs-bolt)"/>\n    <ellipse cx="38" cy="75" rx="4" ry="6" fill="#84cc16" opacity="0.6"/>\n    <ellipse cx="62" cy="78" rx="3" ry="5" fill="#84cc16" opacity="0.5"/>\n  </svg>',twilight:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="tw-moon" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#94a3b8"/><stop offset="50%" stop-color="#64748b"/><stop offset="100%" stop-color="#1e293b"/></linearGradient>\n      <radialGradient id="tw-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#tw-glow)"/>\n    <circle cx="50" cy="65" r="28" fill="url(#tw-moon)"/>\n    <circle cx="62" cy="65" r="22" fill="#0f172a"/>\n    <circle cx="40" cy="55" r="4" fill="#475569" opacity="0.5"/>\n    <circle cx="45" cy="72" r="3" fill="#475569" opacity="0.4"/>\n    <circle cx="35" cy="65" r="2" fill="#475569" opacity="0.3"/>\n    <circle cx="42" cy="60" r="3" fill="#fff" opacity="0.15"/>\n  </svg>',bibliophile:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="bp-cover" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#8b6914"/></linearGradient>\n      <linearGradient id="bp-page" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#fef3c7"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0.3"/></linearGradient>\n      <radialGradient id="bp-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#bp-glow)"/>\n    <path d="M50 40 Q30 45 20 50 L20 95 Q30 90 50 85 Q70 90 80 95 L80 50 Q70 45 50 40" fill="url(#bp-cover)"/>\n    <path d="M50 45 Q32 50 24 54 L24 90 Q32 86 50 82" fill="url(#bp-page)"/>\n    <path d="M50 45 Q68 50 76 54 L76 90 Q68 86 50 82" fill="url(#bp-page)"/>\n    <line x1="50" y1="45" x2="50" y2="82" stroke="#8b6914" stroke-width="2"/>\n    <path d="M28 60 L44 58 M28 68 L44 66 M28 76 L44 74" stroke="#92400e" stroke-width="1.5" opacity="0.4"/>\n    <path d="M72 60 L56 58 M72 68 L56 66 M72 76 L56 74" stroke="#92400e" stroke-width="1.5" opacity="0.4"/>\n    <ellipse cx="50" cy="35" rx="8" ry="4" fill="#fbbf24" opacity="0.6"/>\n  </svg>',proficiency_focus:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="pf-metal" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#4b5563"/></linearGradient>\n      <linearGradient id="pf-wood" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#92400e"/><stop offset="100%" stop-color="#451a03"/></linearGradient>\n      <radialGradient id="pf-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#pf-glow)"/>\n    <rect x="25" y="60" width="50" height="8" rx="2" fill="url(#pf-metal)" transform="rotate(-45 50 65)"/>\n    <rect x="25" y="60" width="50" height="8" rx="2" fill="url(#pf-metal)" transform="rotate(45 50 65)"/>\n    <rect x="20" y="85" width="12" height="20" rx="2" fill="url(#pf-wood)" transform="rotate(-45 26 95)"/>\n    <rect x="68" y="85" width="12" height="20" rx="2" fill="url(#pf-wood)" transform="rotate(45 74 95)"/>\n    <circle cx="50" cy="65" r="8" fill="#d4af37"/>\n    <circle cx="50" cy="65" r="5" fill="#fff" opacity="0.3"/>\n  </svg>',hendiadys:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="hd-left" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <linearGradient id="hd-right" x1="100%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#d4af37"/></linearGradient>\n      <radialGradient id="hd-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#hd-glow)"/>\n    <circle cx="38" cy="65" r="22" fill="url(#hd-left)" opacity="0.8"/>\n    <circle cx="62" cy="65" r="22" fill="url(#hd-right)" opacity="0.8"/>\n    <path d="M50 45 Q42 65 50 85 Q58 65 50 45" fill="#fff" opacity="0.3"/>\n    <circle cx="32" cy="58" r="4" fill="#fff" opacity="0.25"/>\n    <circle cx="68" cy="58" r="4" fill="#fff" opacity="0.25"/>\n  </svg>',stony_brook:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="sb-stone" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#78716c"/><stop offset="100%" stop-color="#44403c"/></linearGradient>\n      <linearGradient id="sb-water" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3b82f6" stop-opacity="0"/><stop offset="50%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#3b82f6" stop-opacity="0"/></linearGradient>\n      <radialGradient id="sb-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#sb-glow)"/>\n    <ellipse cx="50" cy="70" rx="28" ry="20" fill="url(#sb-stone)"/>\n    <ellipse cx="45" cy="65" rx="10" ry="8" fill="#57534e" opacity="0.5"/>\n    <ellipse cx="60" cy="72" rx="8" ry="6" fill="#57534e" opacity="0.4"/>\n    <ellipse cx="42" cy="62" rx="5" ry="4" fill="#fff" opacity="0.2"/>\n    <path d="M15 95 Q30 88 50 92 Q70 88 85 95" stroke="url(#sb-water)" stroke-width="4" fill="none"/>\n    <path d="M20 100 Q35 94 50 97 Q65 94 80 100" stroke="url(#sb-water)" stroke-width="3" fill="none" opacity="0.7"/>\n    <ellipse cx="35" cy="94" rx="3" ry="2" fill="#fff" opacity="0.4"/>\n    <ellipse cx="65" cy="96" rx="2" ry="1.5" fill="#fff" opacity="0.3"/>\n  </svg>',golden_tongue:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="gt-coin" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="50%" stop-color="#d4af37"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <radialGradient id="gt-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#gt-glow)"/>\n    <ellipse cx="50" cy="60" rx="28" ry="28" fill="url(#gt-coin)"/>\n    <ellipse cx="50" cy="60" rx="22" ry="22" fill="none" stroke="#92400e" stroke-width="2" opacity="0.5"/>\n    <ellipse cx="50" cy="55" rx="10" ry="8" fill="#fff" opacity="0.25"/>\n    <circle cx="50" cy="60" r="6" fill="#92400e"/><ellipse cx="50" cy="58" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n    <path d="M40 95 Q50 105 60 95" stroke="#dc2626" stroke-width="6" fill="none" stroke-linecap="round"/>\n    <ellipse cx="50" cy="100" rx="8" ry="3" fill="#ef4444"/>\n  </svg>',momentum:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="mm-arrow" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#92400e"/><stop offset="100%" stop-color="#d4af37"/></linearGradient>\n      <radialGradient id="mm-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#mm-glow)"/>\n    <path d="M20 65 L60 65 L60 50 L85 65 L60 80 L60 65" fill="url(#mm-arrow)"/>\n    <path d="M25 65 L55 65" stroke="#fff" stroke-width="3" opacity="0.3" stroke-linecap="round"/>\n    <path d="M15 55 L25 55" stroke="#d4af37" stroke-width="2" opacity="0.5" stroke-linecap="round"/>\n    <path d="M10 65 L22 65" stroke="#d4af37" stroke-width="2" opacity="0.4" stroke-linecap="round"/>\n    <path d="M15 75 L25 75" stroke="#d4af37" stroke-width="2" opacity="0.5" stroke-linecap="round"/>\n  </svg>',word_hoard:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="wh-book1" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <linearGradient id="wh-book2" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#d4af37"/></linearGradient>\n      <radialGradient id="wh-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#wh-glow)"/>\n    <rect x="25" y="85" width="50" height="12" rx="2" fill="url(#wh-book1)"/>\n    <rect x="28" y="70" width="44" height="12" rx="2" fill="url(#wh-book2)"/>\n    <rect x="30" y="55" width="40" height="12" rx="2" fill="url(#wh-book1)"/>\n    <rect x="33" y="40" width="34" height="12" rx="2" fill="url(#wh-book2)"/>\n    <rect x="36" y="28" width="28" height="10" rx="2" fill="url(#wh-book1)"/>\n    <path d="M27 87 L27 95 M73 87 L73 95" stroke="#fff" stroke-width="1.5" opacity="0.2"/>\n    <path d="M30 72 L30 80 M70 72 L70 80" stroke="#fff" stroke-width="1.5" opacity="0.2"/>\n  </svg>',slow_burn:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="slb-wax" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fef3c7"/><stop offset="100%" stop-color="#d4af37"/></linearGradient>\n      <linearGradient id="slb-flame" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#dc2626"/><stop offset="50%" stop-color="#f97316"/><stop offset="100%" stop-color="#fbbf24"/></linearGradient>\n      <radialGradient id="slb-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#slb-glow)"/>\n    <rect x="38" y="55" width="24" height="55" rx="3" fill="url(#slb-wax)"/>\n    <rect x="40" y="57" width="8" height="50" rx="2" fill="#fff" opacity="0.2"/>\n    <line x1="50" y1="55" x2="50" y2="45" stroke="#44403c" stroke-width="2"/>\n    <path d="M50 45 Q42 35 50 20 Q58 35 50 45" fill="url(#slb-flame)"/>\n    <ellipse cx="50" cy="32" rx="4" ry="6" fill="#fff" opacity="0.4"/>\n    <ellipse cx="50" cy="110" rx="15" ry="4" fill="#92400e" opacity="0.3"/>\n  </svg>',weak_point:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="wp-target" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#dc2626"/><stop offset="30%" stop-color="#dc2626"/><stop offset="35%" stop-color="#fff"/><stop offset="55%" stop-color="#fff"/><stop offset="60%" stop-color="#dc2626"/><stop offset="100%" stop-color="#7f1d1d"/></radialGradient>\n      <radialGradient id="wp-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#wp-glow)"/>\n    <circle cx="50" cy="65" r="30" fill="url(#wp-target)"/>\n    <path d="M50 65 L55 50 L48 55 L60 40" stroke="#0f172a" stroke-width="3" fill="none" stroke-linecap="round"/>\n    <path d="M50 65 L45 80 L52 75 L40 90" stroke="#0f172a" stroke-width="2" fill="none" stroke-linecap="round" opacity="0.7"/>\n    <circle cx="50" cy="65" r="5" fill="#0f172a"/>\n  </svg>',opening_strike:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="os-blade" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#6b7280"/><stop offset="100%" stop-color="#d1d5db"/></linearGradient>\n      <linearGradient id="os-dawn" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#f97316"/><stop offset="50%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#fef3c7"/></linearGradient>\n      <radialGradient id="os-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#os-glow)"/>\n    <ellipse cx="50" cy="100" rx="40" ry="20" fill="url(#os-dawn)" opacity="0.5"/>\n    <path d="M50 20 L54 25 L54 75 L50 80 L46 75 L46 25 Z" fill="url(#os-blade)"/>\n    <path d="M47 28 L47 72" stroke="#fff" stroke-width="2" opacity="0.3"/>\n    <rect x="42" y="80" width="16" height="6" rx="1" fill="#92400e"/>\n    <rect x="45" y="86" width="10" height="15" rx="2" fill="#78716c"/>\n    <path d="M30 95 L40 85 M70 95 L60 85 M50 100 L50 90" stroke="#fbbf24" stroke-width="2" opacity="0.6"/>\n  </svg>',capital_punishment:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="dg-sling" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#92400e"/><stop offset="100%" stop-color="#451a03"/></linearGradient>\n      <linearGradient id="dg-stone" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#4b5563"/></linearGradient>\n      <radialGradient id="dg-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#dg-glow)"/>\n    <path d="M25 90 Q15 70 30 55 Q40 50 50 55" stroke="url(#dg-sling)" stroke-width="4" fill="none" stroke-linecap="round"/>\n    <path d="M75 90 Q85 70 70 55 Q60 50 50 55" stroke="url(#dg-sling)" stroke-width="4" fill="none" stroke-linecap="round"/>\n    <ellipse cx="50" cy="55" rx="12" ry="8" fill="url(#dg-sling)"/>\n    <circle cx="50" cy="55" r="10" fill="url(#dg-stone)"/>\n    <ellipse cx="46" cy="52" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n    <path d="M35 40 L45 48 M65 40 L55 48" stroke="#d4af37" stroke-width="2" opacity="0.5"/>\n  </svg>',irony:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ir-arrow1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#1e40af"/></linearGradient>\n      <linearGradient id="ir-arrow2" x1="100%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#dc2626"/><stop offset="100%" stop-color="#7f1d1d"/></linearGradient>\n      <radialGradient id="ir-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#ir-glow)"/>\n    <path d="M25 40 Q50 55 75 40" stroke="url(#ir-arrow1)" stroke-width="5" fill="none" stroke-linecap="round"/>\n    <path d="M70 35 L78 42 L72 48" fill="url(#ir-arrow1)"/>\n    <path d="M75 90 Q50 75 25 90" stroke="url(#ir-arrow2)" stroke-width="5" fill="none" stroke-linecap="round"/>\n    <path d="M30 95 L22 88 L28 82" fill="url(#ir-arrow2)"/>\n    <circle cx="50" cy="65" r="10" fill="#d4af37"/>\n    <path d="M46 62 L50 58 L54 62 M46 68 L50 72 L54 68" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/>\n  </svg>',overkill_dividend:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="od-coin" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <radialGradient id="od-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#od-glow)"/>\n    <ellipse cx="50" cy="70" rx="15" ry="15" fill="url(#od-coin)"/>\n    <ellipse cx="50" cy="68" rx="10" ry="10" fill="#fff" opacity="0.2"/>\n    <ellipse cx="30" cy="45" rx="8" ry="8" fill="url(#od-coin)"/>\n    <ellipse cx="70" cy="48" rx="7" ry="7" fill="url(#od-coin)"/>\n    <ellipse cx="25" cy="80" rx="6" ry="6" fill="url(#od-coin)"/>\n    <ellipse cx="75" cy="85" rx="7" ry="7" fill="url(#od-coin)"/>\n    <ellipse cx="40" cy="95" rx="5" ry="5" fill="url(#od-coin)"/>\n    <ellipse cx="62" cy="92" rx="6" ry="6" fill="url(#od-coin)"/>\n    <path d="M50 50 L45 35 M50 50 L55 32 M50 50 L38 42 M50 50 L62 40" stroke="#fbbf24" stroke-width="2" opacity="0.6"/>\n  </svg>',echo_profits:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ep-coin" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <radialGradient id="ep-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#ep-glow)"/>\n    <ellipse cx="50" cy="70" rx="18" ry="18" fill="url(#ep-coin)"/>\n    <ellipse cx="50" cy="68" rx="12" ry="12" fill="#fff" opacity="0.2"/>\n    <circle cx="50" cy="70" r="28" fill="none" stroke="#d4af37" stroke-width="2" opacity="0.3"/>\n    <circle cx="50" cy="70" r="35" fill="none" stroke="#d4af37" stroke-width="1.5" opacity="0.2"/>\n    <circle cx="50" cy="70" r="42" fill="none" stroke="#d4af37" stroke-width="1" opacity="0.1"/>\n    <text x="50" y="75" font-size="14" fill="#fff" text-anchor="middle" font-weight="bold">$</text>\n  </svg>',elemental_bounty:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="eb-coin" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <radialGradient id="eb-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#eb-glow)"/>\n    <circle cx="30" cy="50" r="10" fill="#f97316"/><ellipse cx="28" cy="48" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n    <circle cx="70" cy="50" r="10" fill="#3b82f6"/><ellipse cx="68" cy="48" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n    <circle cx="30" cy="80" r="10" fill="#78716c"/><ellipse cx="28" cy="78" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n    <circle cx="70" cy="80" r="10" fill="#facc15"/><ellipse cx="68" cy="78" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n    <ellipse cx="50" cy="65" rx="14" ry="14" fill="url(#eb-coin)"/>\n    <text x="50" y="70" font-size="12" fill="#fff" text-anchor="middle" font-weight="bold">$</text>\n  </svg>',treasure_hunter:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="th-chest" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#92400e"/><stop offset="100%" stop-color="#451a03"/></linearGradient>\n      <linearGradient id="th-gold" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#d97706"/></linearGradient>\n      <radialGradient id="th-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fbbf24" stop-opacity="0.5"/><stop offset="100%" stop-color="#fbbf24" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#th-glow)"/>\n    <rect x="25" y="55" width="50" height="35" rx="3" fill="url(#th-chest)"/>\n    <rect x="25" y="55" width="50" height="12" rx="3" fill="#b45309"/>\n    <rect x="45" y="62" width="10" height="8" rx="2" fill="url(#th-gold)"/>\n    <ellipse cx="35" cy="45" rx="6" ry="6" fill="#c084fc"/><ellipse cx="33" cy="43" rx="2" ry="2" fill="#fff" opacity="0.4"/>\n    <ellipse cx="50" cy="40" rx="7" ry="7" fill="#c084fc"/><ellipse cx="48" cy="38" rx="2.5" ry="2" fill="#fff" opacity="0.4"/>\n    <ellipse cx="65" cy="45" rx="6" ry="6" fill="#c084fc"/><ellipse cx="63" cy="43" rx="2" ry="2" fill="#fff" opacity="0.4"/>\n    <path d="M35 45 L40 52 M50 40 L50 50 M65 45 L60 52" stroke="#fbbf24" stroke-width="1.5" opacity="0.6"/>\n  </svg>',appraisers_eye:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ae-lens" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#bfdbfe"/><stop offset="100%" stop-color="#60a5fa"/></linearGradient>\n      <linearGradient id="ae-gold" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#d97706"/></linearGradient>\n      <radialGradient id="ae-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fbbf24" stop-opacity="0.3"/><stop offset="100%" stop-color="#fbbf24" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ae-glow)"/>\n    <circle cx="45" cy="60" r="22" fill="url(#ae-lens)" opacity="0.3"/>\n    <circle cx="45" cy="60" r="22" fill="none" stroke="url(#ae-gold)" stroke-width="4"/>\n    <line x1="62" y1="77" x2="78" y2="93" stroke="url(#ae-gold)" stroke-width="6" stroke-linecap="round"/>\n    <rect x="35" y="55" width="20" height="12" rx="2" fill="#c084fc"/>\n    <text x="45" y="64" font-size="8" fill="#fff" text-anchor="middle" font-weight="bold">RARE</text>\n  </svg>',rarity_cascade:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="rc-badge" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>\n      <radialGradient id="rc-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#c084fc" stop-opacity="0.4"/><stop offset="100%" stop-color="#c084fc" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#rc-glow)"/>\n    <circle cx="50" cy="65" r="38" fill="none" stroke="#c084fc" stroke-width="1" opacity="0.15"/>\n    <circle cx="50" cy="65" r="32" fill="none" stroke="#c084fc" stroke-width="1.5" opacity="0.25"/>\n    <circle cx="50" cy="65" r="26" fill="none" stroke="#c084fc" stroke-width="2" opacity="0.35"/>\n    <rect x="30" y="55" width="40" height="20" rx="4" fill="url(#rc-badge)"/>\n    <text x="50" y="69" font-size="10" fill="#fff" text-anchor="middle" font-weight="bold">EPIC</text>\n    <path d="M30 65 L20 65 M70 65 L80 65 M50 45 L50 35 M50 85 L50 95" stroke="#c084fc" stroke-width="2" opacity="0.5"/>\n  </svg>',gem_resonance:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="gr-gem" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#c084fc"/><stop offset="50%" stop-color="#9333ea"/><stop offset="100%" stop-color="#581c87"/></linearGradient>\n      <radialGradient id="gr-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/><stop offset="100%" stop-color="#d4af37" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#gr-glow)"/>\n    <circle cx="50" cy="65" r="32" fill="none" stroke="#9333ea" stroke-width="1" opacity="0.2"/>\n    <circle cx="50" cy="65" r="26" fill="none" stroke="#9333ea" stroke-width="1.5" opacity="0.3"/>\n    <circle cx="50" cy="65" r="20" fill="none" stroke="#9333ea" stroke-width="2" opacity="0.4"/>\n    <path d="M50 40 L65 55 L65 75 L50 90 L35 75 L35 55 Z" fill="url(#gr-gem)"/>\n    <path d="M50 40 L35 55 L50 60 L65 55 Z" fill="#fff" opacity="0.3"/>\n    <path d="M50 60 L35 55 L35 75 L50 80 Z" fill="#7c3aed" opacity="0.3"/>\n    <line x1="50" y1="40" x2="50" y2="80" stroke="#fff" stroke-width="1" opacity="0.3"/>\n    <ellipse cx="42" cy="55" rx="4" ry="3" fill="#fff" opacity="0.4"/>\n  </svg>',world_sky_focus:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="wsf-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#wsf-glow)"/>\n    <circle cx="50" cy="65" r="32" fill="#0f172a" stroke="#06b6d4" stroke-width="2" opacity="0.8"/>\n    <path d="M50 33 L50 65 L82 65" fill="none" stroke="#1e293b" stroke-width="2"/>\n    <path d="M50 33 L50 65 L18 65" fill="none" stroke="#1e293b" stroke-width="2"/>\n    <circle cx="38" cy="52" r="10" fill="#f97316"/><ellipse cx="36" cy="50" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n    <circle cx="62" cy="52" r="10" fill="#3b82f6"/><ellipse cx="60" cy="50" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n    <circle cx="38" cy="78" r="10" fill="#78716c"/><ellipse cx="36" cy="76" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n    <circle cx="62" cy="78" r="10" fill="#facc15"/><ellipse cx="60" cy="76" rx="4" ry="3" fill="#fff" opacity="0.3"/>\n  </svg>',body_soul_focus:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="bsf-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#bsf-glow)"/>\n    <circle cx="50" cy="65" r="32" fill="#0f172a" stroke="#06b6d4" stroke-width="2" opacity="0.8"/>\n    <path d="M50 33 A32 32 0 0 1 50 97" fill="#94a3b8"/>\n    <path d="M50 33 A32 32 0 0 0 50 97" fill="#6b21a8"/>\n    <circle cx="50" cy="49" r="8" fill="#84cc16"/><ellipse cx="48" cy="47" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n    <circle cx="50" cy="81" r="8" fill="#fbbf24"/><ellipse cx="48" cy="79" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n  </svg>',weakness_exploit:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="we-armor" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#6b7280"/><stop offset="100%" stop-color="#374151"/></linearGradient>\n      <radialGradient id="we-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#we-glow)"/>\n    <path d="M50 25 L75 45 L75 90 L50 105 L25 90 L25 45 Z" fill="url(#we-armor)"/>\n    <path d="M30 48 L30 85 L50 98" fill="none" stroke="#fff" stroke-width="2" opacity="0.15"/>\n    <path d="M50 50 L55 60 L48 65 L58 78 L45 85 L52 95" stroke="#dc2626" stroke-width="3" fill="none"/>\n    <path d="M50 50 L42 58 L50 62 L40 72" stroke="#dc2626" stroke-width="2" fill="none" opacity="0.7"/>\n    <circle cx="50" cy="50" r="4" fill="#dc2626"/>\n  </svg>',isocolon:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ic-bar" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0891b2"/></linearGradient>\n      <radialGradient id="ic-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ic-glow)"/>\n    <rect x="20" y="40" width="60" height="12" rx="3" fill="url(#ic-bar)"/>\n    <rect x="22" y="42" width="56" height="4" rx="2" fill="#fff" opacity="0.25"/>\n    <rect x="20" y="58" width="60" height="12" rx="3" fill="url(#ic-bar)"/>\n    <rect x="22" y="60" width="56" height="4" rx="2" fill="#fff" opacity="0.25"/>\n    <rect x="20" y="76" width="60" height="12" rx="3" fill="url(#ic-bar)"/>\n    <rect x="22" y="78" width="56" height="4" rx="2" fill="#fff" opacity="0.25"/>\n    <circle cx="12" cy="46" r="3" fill="#06b6d4"/><circle cx="12" cy="64" r="3" fill="#06b6d4"/><circle cx="12" cy="82" r="3" fill="#06b6d4"/>\n  </svg>',alliteration:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="al-wave" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="al-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#al-glow)"/>\n    <circle cx="30" cy="65" r="8" fill="url(#al-wave)"/>\n    <path d="M42 50 Q55 65 42 80" fill="none" stroke="#06b6d4" stroke-width="3" opacity="0.8"/>\n    <path d="M52 42 Q70 65 52 88" fill="none" stroke="#06b6d4" stroke-width="3" opacity="0.6"/>\n    <path d="M62 35 Q85 65 62 95" fill="none" stroke="#06b6d4" stroke-width="3" opacity="0.4"/>\n  </svg>',lexicon_growth:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="lxg-trunk" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#92400e"/><stop offset="100%" stop-color="#451a03"/></linearGradient>\n      <linearGradient id="lxg-leaf" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#15803d"/><stop offset="100%" stop-color="#22c55e"/></linearGradient>\n      <radialGradient id="lxg-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#lxg-glow)"/>\n    <rect x="45" y="70" width="10" height="35" rx="2" fill="url(#lxg-trunk)"/>\n    <circle cx="50" cy="55" r="25" fill="url(#lxg-leaf)"/>\n    <circle cx="35" cy="48" r="12" fill="url(#lxg-leaf)"/>\n    <circle cx="65" cy="48" r="12" fill="url(#lxg-leaf)"/>\n    <circle cx="50" cy="38" r="10" fill="url(#lxg-leaf)"/>\n    <ellipse cx="42" cy="50" rx="5" ry="4" fill="#fff" opacity="0.2"/>\n    <rect x="30" y="95" width="40" height="12" rx="3" fill="#78716c"/>\n    <ellipse cx="50" cy="101" rx="5" ry="3" fill="#dc2626"/><path d="M47 99 L50 95 L53 99" fill="#dc2626"/>\n  </svg>',tithe:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ti-bowl" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <linearGradient id="ti-coin" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#d4af37"/></linearGradient>\n      <radialGradient id="ti-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ti-glow)"/>\n    <path d="M25 70 Q20 85 30 95 L70 95 Q80 85 75 70 Z" fill="url(#ti-bowl)"/>\n    <ellipse cx="50" cy="70" rx="25" ry="8" fill="url(#ti-bowl)"/>\n    <ellipse cx="50" cy="68" rx="20" ry="6" fill="#fef3c7" opacity="0.3"/>\n    <ellipse cx="40" cy="55" rx="6" ry="6" fill="url(#ti-coin)"/>\n    <ellipse cx="55" cy="48" rx="5" ry="5" fill="url(#ti-coin)"/>\n    <ellipse cx="62" cy="58" rx="6" ry="6" fill="url(#ti-coin)"/>\n    <path d="M42 50 Q50 62 40 68 M57 45 Q50 58 55 68 M64 52 Q58 62 62 68" stroke="#d4af37" stroke-width="1.5" stroke-dasharray="2,2" opacity="0.5"/>\n  </svg>',word_historian:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="whist-scroll" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fef3c7"/><stop offset="100%" stop-color="#d4a76a"/></linearGradient>\n      <linearGradient id="whist-ink" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e40af"/><stop offset="100%" stop-color="#1e3a8a"/></linearGradient>\n      <radialGradient id="whist-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#whist-glow)"/>\n    <rect x="25" y="35" width="50" height="60" rx="3" fill="url(#whist-scroll)"/>\n    <ellipse cx="25" cy="35" rx="5" ry="8" fill="url(#whist-scroll)"/>\n    <ellipse cx="75" cy="35" rx="5" ry="8" fill="url(#whist-scroll)"/>\n    <ellipse cx="25" cy="95" rx="5" ry="8" fill="url(#whist-scroll)"/>\n    <ellipse cx="75" cy="95" rx="5" ry="8" fill="url(#whist-scroll)"/>\n    <line x1="32" y1="50" x2="32" y2="62" stroke="url(#whist-ink)" stroke-width="2"/>\n    <line x1="38" y1="50" x2="38" y2="62" stroke="url(#whist-ink)" stroke-width="2"/>\n    <line x1="44" y1="50" x2="44" y2="62" stroke="url(#whist-ink)" stroke-width="2"/>\n    <line x1="50" y1="50" x2="50" y2="62" stroke="url(#whist-ink)" stroke-width="2"/>\n    <line x1="30" y1="56" x2="52" y2="56" stroke="url(#whist-ink)" stroke-width="2"/>\n    <line x1="58" y1="50" x2="58" y2="62" stroke="url(#whist-ink)" stroke-width="2"/>\n    <line x1="64" y1="50" x2="64" y2="62" stroke="url(#whist-ink)" stroke-width="2"/>\n    <line x1="32" y1="72" x2="68" y2="72" stroke="#78716c" stroke-width="1" opacity="0.4"/>\n    <line x1="32" y1="80" x2="58" y2="80" stroke="#78716c" stroke-width="1" opacity="0.4"/>\n  </svg>',reverberation:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="reverb-wave" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#a855f7"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>\n      <radialGradient id="reverb-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#a855f7" stop-opacity="0.4"/><stop offset="100%" stop-color="#7c3aed" stop-opacity="0"/></radialGradient>\n      <radialGradient id="reverb-center" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#e879f9"/><stop offset="100%" stop-color="#a855f7"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#reverb-glow)"/>\n    <circle cx="50" cy="65" r="8" fill="url(#reverb-center)"/>\n    <circle cx="50" cy="65" r="8" fill="#fff" opacity="0.3"/>\n    <circle cx="50" cy="65" r="16" stroke="url(#reverb-wave)" stroke-width="2" fill="none" opacity="0.8"/>\n    <circle cx="50" cy="65" r="24" stroke="url(#reverb-wave)" stroke-width="2" fill="none" opacity="0.6"/>\n    <circle cx="50" cy="65" r="32" stroke="url(#reverb-wave)" stroke-width="2" fill="none" opacity="0.4"/>\n    <circle cx="50" cy="65" r="40" stroke="url(#reverb-wave)" stroke-width="1.5" fill="none" opacity="0.2"/>\n  </svg>',magma_core:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="mc-lava" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#7f1d1d"/><stop offset="30%" stop-color="#dc2626"/><stop offset="60%" stop-color="#f97316"/><stop offset="100%" stop-color="#fbbf24"/></linearGradient>\n      <linearGradient id="mc-rock" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#78716c"/><stop offset="100%" stop-color="#44403c"/></linearGradient>\n      <radialGradient id="mc-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#mc-glow)"/>\n    <path d="M50 30 Q70 45 70 65 Q70 90 50 100 Q30 90 30 65 Q30 45 50 30" fill="url(#mc-rock)"/>\n    <path d="M50 38 Q62 50 62 65 Q62 82 50 90 Q38 82 38 65 Q38 50 50 38" fill="url(#mc-lava)"/>\n    <path d="M45 45 Q50 55 45 65" stroke="#fbbf24" stroke-width="3" fill="none" opacity="0.6"/>\n    <circle cx="50" cy="65" r="8" fill="#fbbf24" opacity="0.5"/>\n    <circle cx="50" cy="65" r="4" fill="#fff" opacity="0.6"/>\n  </svg>',tempest:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="tm-cloud" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#6b7280"/><stop offset="100%" stop-color="#374151"/></linearGradient>\n      <linearGradient id="tm-bolt" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#facc15"/><stop offset="100%" stop-color="#ca8a04"/></linearGradient>\n      <radialGradient id="tm-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#tm-glow)"/>\n    <ellipse cx="35" cy="45" rx="18" ry="14" fill="url(#tm-cloud)"/>\n    <ellipse cx="55" cy="42" rx="20" ry="16" fill="url(#tm-cloud)"/>\n    <ellipse cx="70" cy="48" rx="15" ry="12" fill="url(#tm-cloud)"/>\n    <ellipse cx="50" cy="52" rx="30" ry="18" fill="url(#tm-cloud)"/>\n    <path d="M45 65 L52 78 L42 78 L55 100 L48 85 L58 85 L45 65" fill="url(#tm-bolt)"/>\n    <path d="M28 75 L28 85 M35 78 L35 92 M72 75 L72 88 M65 72 L65 85" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>\n    <ellipse cx="40" cy="40" rx="6" ry="4" fill="#fff" opacity="0.2"/>\n  </svg>',eclipse:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ec-sun" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f97316"/></linearGradient>\n      <radialGradient id="ec-corona" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fbbf24" stop-opacity="0.8"/><stop offset="100%" stop-color="#fbbf24" stop-opacity="0"/></radialGradient>\n      <radialGradient id="ec-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ec-glow)"/>\n    <circle cx="50" cy="65" r="35" fill="url(#ec-corona)"/>\n    <circle cx="50" cy="65" r="25" fill="url(#ec-sun)"/>\n    <circle cx="55" cy="60" r="25" fill="#1e1b4b"/>\n    <ellipse cx="62" cy="55" rx="4" ry="3" fill="#fff" opacity="0.1"/>\n    <path d="M20 65 L10 65 M80 65 L90 65 M50 30 L50 20 M50 100 L50 110" stroke="#fbbf24" stroke-width="2" opacity="0.5"/>\n    <path d="M25 40 L18 33 M75 40 L82 33 M25 90 L18 97 M75 90 L82 97" stroke="#fbbf24" stroke-width="1.5" opacity="0.4"/>\n  </svg>',necrotoxin:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="nt-skull" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#e5e7eb"/><stop offset="100%" stop-color="#9ca3af"/></linearGradient>\n      <linearGradient id="nt-poison" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#84cc16"/><stop offset="100%" stop-color="#365314"/></linearGradient>\n      <radialGradient id="nt-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#nt-glow)"/>\n    <ellipse cx="50" cy="50" rx="25" ry="22" fill="url(#nt-skull)"/>\n    <path d="M35 70 L35 85 L42 85 L42 75 L50 80 L58 75 L58 85 L65 85 L65 70" fill="url(#nt-skull)"/>\n    <ellipse cx="40" cy="48" rx="7" ry="8" fill="#1e1b4b"/>\n    <ellipse cx="60" cy="48" rx="7" ry="8" fill="#1e1b4b"/>\n    <ellipse cx="50" cy="58" rx="4" ry="3" fill="#1e1b4b"/>\n    <path d="M30 40 Q25 50 28 65 L22 75" stroke="url(#nt-poison)" stroke-width="4" fill="none" stroke-linecap="round"/>\n    <ellipse cx="22" cy="78" rx="4" ry="5" fill="url(#nt-poison)"/>\n    <path d="M70 42 Q78 52 72 68 L78 80" stroke="url(#nt-poison)" stroke-width="3" fill="none" stroke-linecap="round"/>\n    <ellipse cx="78" cy="83" rx="3" ry="4" fill="url(#nt-poison)"/>\n  </svg>',blessed_steel:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="bs-blade" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#f1f5f9"/><stop offset="50%" stop-color="#cbd5e1"/><stop offset="100%" stop-color="#64748b"/></linearGradient>\n      <radialGradient id="bs-holy" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fbbf24" stop-opacity="0.8"/><stop offset="100%" stop-color="#fbbf24" stop-opacity="0"/></radialGradient>\n      <radialGradient id="bs-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#bs-glow)"/>\n    <ellipse cx="50" cy="50" rx="30" ry="30" fill="url(#bs-holy)"/>\n    <path d="M50 20 L55 30 L55 75 L50 82 L45 75 L45 30 Z" fill="url(#bs-blade)"/>\n    <path d="M47 32 L47 72" stroke="#fff" stroke-width="2" opacity="0.4"/>\n    <rect x="38" y="82" width="24" height="8" rx="2" fill="#d4af37"/>\n    <rect x="44" y="90" width="12" height="16" rx="2" fill="#92400e"/>\n    <path d="M30 45 L20 45 M70 45 L80 45 M50 15 L50 8" stroke="#fbbf24" stroke-width="3" opacity="0.6"/>\n    <circle cx="50" cy="50" r="6" fill="#fbbf24" opacity="0.5"/>\n  </svg>',static_earth:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="se-crystal" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#a8a29e"/><stop offset="50%" stop-color="#78716c"/><stop offset="100%" stop-color="#44403c"/></linearGradient>\n      <linearGradient id="se-spark" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#facc15"/><stop offset="100%" stop-color="#ca8a04"/></linearGradient>\n      <radialGradient id="se-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#se-glow)"/>\n    <path d="M50 25 L58 50 L50 55 L42 50 Z" fill="url(#se-crystal)"/>\n    <path d="M35 45 L42 70 L35 78 L28 70 Z" fill="url(#se-crystal)"/>\n    <path d="M65 45 L72 70 L65 78 L58 70 Z" fill="url(#se-crystal)"/>\n    <path d="M50 60 L60 90 L50 100 L40 90 Z" fill="url(#se-crystal)"/>\n    <path d="M45 28 L45 48" stroke="#fff" stroke-width="1.5" opacity="0.3"/>\n    <path d="M32 48 L32 72" stroke="#fff" stroke-width="1.5" opacity="0.3"/>\n    <path d="M68 48 L68 72" stroke="#fff" stroke-width="1.5" opacity="0.3"/>\n    <path d="M48 62 L48 92" stroke="#fff" stroke-width="1.5" opacity="0.3"/>\n    <path d="M40 35 L38 42 M60 35 L62 42 M25 60 L30 65 M75 60 L70 65" stroke="url(#se-spark)" stroke-width="2"/>\n    <circle cx="50" cy="40" r="3" fill="#facc15" opacity="0.6"/>\n  </svg>',synecdoche:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="sy-gold" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <radialGradient id="sy-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#sy-glow)"/>\n    <path d="M50 30 L62 45 L58 50 L50 42 L42 50 L38 45 Z" fill="url(#sy-gold)"/>\n    <ellipse cx="50" cy="35" rx="5" ry="4" fill="#dc2626"/>\n    <ellipse cx="50" cy="34" rx="3" ry="2" fill="#fff" opacity="0.4"/>\n    <path d="M42 52 L42 48 M58 52 L58 48" stroke="#fff" stroke-width="1" opacity="0.3"/>\n    <ellipse cx="50" cy="80" rx="30" ry="20" fill="none" stroke="#06b6d4" stroke-width="1" stroke-dasharray="4,3" opacity="0.5"/>\n    <circle cx="40" cy="80" r="4" fill="#06b6d4" opacity="0.7"/><circle cx="50" cy="80" r="4" fill="#06b6d4" opacity="0.7"/><circle cx="60" cy="80" r="4" fill="#06b6d4" opacity="0.7"/>\n  </svg>',minimalist:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="mn-dot" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="mn-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#mn-glow)"/>\n    <circle cx="35" cy="65" r="15" fill="url(#mn-dot)"/>\n    <ellipse cx="32" cy="60" rx="5" ry="4" fill="#fff" opacity="0.3"/>\n    <circle cx="65" cy="65" r="15" fill="url(#mn-dot)"/>\n    <ellipse cx="62" cy="60" rx="5" ry="4" fill="#fff" opacity="0.3"/>\n  </svg>',maximalist:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="mx-star" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="mx-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#mx-glow)"/>\n    <polygon points="50,25 55,55 85,55 60,75 70,105 50,85 30,105 40,75 15,55 45,55" fill="url(#mx-star)"/>\n    <polygon points="50,35 53,58 75,58 56,72 64,95 50,78 36,95 44,72 25,58 47,58" fill="#fff" opacity="0.15"/>\n    <circle cx="50" cy="65" r="10" fill="#0e7490"/>\n    <circle cx="50" cy="65" r="6" fill="#06b6d4"/>\n    <path d="M47 62 L50 58 L53 62 M47 68 L50 72 L53 68" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',dual_spec:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ds-left" x1="100%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#1e40af"/></linearGradient>\n      <linearGradient id="ds-right" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#f97316"/><stop offset="100%" stop-color="#c2410c"/></linearGradient>\n      <radialGradient id="ds-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ds-glow)"/>\n    <path d="M50 25 L25 45 L25 80 L50 105 L50 25" fill="url(#ds-left)"/>\n    <path d="M50 25 L75 45 L75 80 L50 105 L50 25" fill="url(#ds-right)"/>\n    <path d="M28 48 L28 75 L50 95" stroke="#fff" stroke-width="2" opacity="0.2" fill="none"/>\n    <path d="M72 48 L72 75 L50 95" stroke="#fff" stroke-width="2" opacity="0.2" fill="none"/>\n    <line x1="50" y1="25" x2="50" y2="105" stroke="#d4af37" stroke-width="3"/>\n  </svg>',monolith:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="mo-stone" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#374151"/><stop offset="100%" stop-color="#111827"/></linearGradient>\n      <radialGradient id="mo-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#mo-glow)"/>\n    <path d="M50 15 L60 25 L60 105 L40 105 L40 25 Z" fill="url(#mo-stone)"/>\n    <path d="M42 28 L42 100" stroke="#fff" stroke-width="2" opacity="0.1"/>\n    <path d="M48 30 L48 98" stroke="#fff" stroke-width="1" opacity="0.08"/>\n    <path d="M45 40 L55 40 M45 55 L55 55 M45 70 L55 70 M45 85 L55 85" stroke="#06b6d4" stroke-width="1" opacity="0.4"/>\n    <ellipse cx="50" cy="22" rx="6" ry="3" fill="#9333ea" opacity="0.8"/>\n  </svg>',trinity:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="tr-knot" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="tr-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#tr-glow)"/>\n    <path d="M50 30 Q70 45 70 65 Q70 90 50 95 Q30 90 30 65 Q30 45 50 30" fill="none" stroke="url(#tr-knot)" stroke-width="5"/>\n    <path d="M50 40 Q60 50 60 65 Q60 80 50 85 Q40 80 40 65 Q40 50 50 40" fill="none" stroke="url(#tr-knot)" stroke-width="4"/>\n    <circle cx="50" cy="38" r="5" fill="url(#tr-knot)"/>\n    <circle cx="35" cy="80" r="5" fill="url(#tr-knot)"/>\n    <circle cx="65" cy="80" r="5" fill="url(#tr-knot)"/>\n    <circle cx="50" cy="63" r="4" fill="#fff" opacity="0.6"/>\n  </svg>',glass_cannon:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="gc-crystal" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e0f2fe"/><stop offset="50%" stop-color="#7dd3fc"/><stop offset="100%" stop-color="#0284c7"/></linearGradient>\n      <radialGradient id="gc-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#gc-glow)"/>\n    <path d="M50 15 L58 25 L58 80 L50 90 L42 80 L42 25 Z" fill="url(#gc-crystal)"/>\n    <path d="M50 15 L42 25 L50 30 L58 25 Z" fill="#fff" opacity="0.5"/>\n    <path d="M50 30 L42 25 L42 80 L50 85 Z" fill="#0ea5e9" opacity="0.3"/>\n    <line x1="50" y1="20" x2="50" y2="82" stroke="#fff" stroke-width="1" opacity="0.4"/>\n    <rect x="40" y="90" width="20" height="6" rx="1" fill="#9ca3af"/>\n    <rect x="44" y="96" width="12" height="12" rx="2" fill="#6b7280"/>\n    <path d="M35 40 L30 35 M65 40 L70 35 M35 60 L28 58 M65 60 L72 58" stroke="#7dd3fc" stroke-width="2" opacity="0.5"/>\n  </svg>',focused_fire:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ff-lens" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#e0f2fe"/><stop offset="100%" stop-color="#7dd3fc"/></linearGradient>\n      <linearGradient id="ff-beam" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f97316"/></linearGradient>\n      <radialGradient id="ff-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ff-glow)"/>\n    <circle cx="50" cy="50" r="25" fill="url(#ff-lens)" opacity="0.3"/>\n    <circle cx="50" cy="50" r="25" fill="none" stroke="#06b6d4" stroke-width="4"/>\n    <circle cx="50" cy="50" r="20" fill="none" stroke="#0e7490" stroke-width="2"/>\n    <ellipse cx="42" cy="42" rx="6" ry="5" fill="#fff" opacity="0.4"/>\n    <path d="M50 75 L45 100 L50 95 L55 100 L50 75" fill="url(#ff-beam)"/>\n    <circle cx="50" cy="98" r="6" fill="#f97316" opacity="0.6"/>\n    <circle cx="50" cy="98" r="3" fill="#fbbf24"/>\n  </svg>',fortuna:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="fo-wheel" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d4af37"/><stop offset="100%" stop-color="#92400e"/></linearGradient>\n      <radialGradient id="fo-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#fo-glow)"/>\n    <circle cx="50" cy="65" r="30" fill="none" stroke="url(#fo-wheel)" stroke-width="5"/>\n    <circle cx="50" cy="65" r="22" fill="none" stroke="url(#fo-wheel)" stroke-width="2"/>\n    <path d="M50 35 L50 95 M20 65 L80 65 M28 43 L72 87 M28 87 L72 43" stroke="url(#fo-wheel)" stroke-width="2"/>\n    <circle cx="50" cy="65" r="8" fill="url(#fo-wheel)"/>\n    <circle cx="50" cy="65" r="5" fill="#fbbf24"/>\n    <circle cx="50" cy="65" r="2" fill="#92400e"/>\n    <path d="M50 30 L55 38 L45 38 Z" fill="#dc2626"/>\n  </svg>',perfectionist:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="pe-gem" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fff"/><stop offset="30%" stop-color="#e0f2fe"/><stop offset="100%" stop-color="#06b6d4"/></linearGradient>\n      <radialGradient id="pe-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#pe-glow)"/>\n    <path d="M50 25 L75 50 L65 95 L35 95 L25 50 Z" fill="url(#pe-gem)"/>\n    <path d="M50 25 L25 50 L50 45 L75 50 Z" fill="#fff" opacity="0.5"/>\n    <path d="M50 45 L25 50 L35 95 L50 80 Z" fill="#0891b2" opacity="0.2"/>\n    <path d="M50 45 L75 50 L65 95 L50 80 Z" fill="#0e7490" opacity="0.15"/>\n    <line x1="50" y1="25" x2="50" y2="80" stroke="#fff" stroke-width="1" opacity="0.4"/>\n    <circle cx="50" cy="35" r="5" fill="#fff" opacity="0.7"/>\n    <circle cx="38" cy="50" r="3" fill="#fff" opacity="0.4"/>\n    <path d="M35 100 Q50 95 65 100" stroke="#22c55e" stroke-width="3" stroke-linecap="round"/>\n    <circle cx="50" cy="100" r="3" fill="#22c55e"/>\n  </svg>',gemination:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="gm-gem" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>\n      <radialGradient id="gm-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#gm-glow)"/>\n    <path d="M35 35 L48 50 L48 70 L35 85 L22 70 L22 50 Z" fill="url(#gm-gem)"/>\n    <path d="M35 35 L22 50 L35 55 L48 50 Z" fill="#fff" opacity="0.3"/>\n    <path d="M65 35 L78 50 L78 70 L65 85 L52 70 L52 50 Z" fill="url(#gm-gem)"/>\n    <path d="M65 35 L52 50 L65 55 L78 50 Z" fill="#fff" opacity="0.3"/>\n    <path d="M40 60 L50 65 L60 60" stroke="#06b6d4" stroke-width="2" stroke-dasharray="3,2"/>\n    <path d="M35 95 L50 100 L65 95" stroke="#06b6d4" stroke-width="2"/>\n  </svg>',diacope:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="di-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#di-glow)"/>\n    <circle cx="50" cy="65" r="8" fill="#06b6d4"/>\n    <circle cx="50" cy="65" r="15" fill="none" stroke="#06b6d4" stroke-width="2.5" opacity="0.8"/>\n    <circle cx="50" cy="65" r="23" fill="none" stroke="#06b6d4" stroke-width="2" opacity="0.6"/>\n    <circle cx="50" cy="65" r="31" fill="none" stroke="#06b6d4" stroke-width="1.5" opacity="0.4"/>\n    <circle cx="50" cy="65" r="39" fill="none" stroke="#06b6d4" stroke-width="1" opacity="0.2"/>\n    <circle cx="50" cy="65" r="3" fill="#fff"/>\n  </svg>',resonance:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="rs-fork" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#4b5563"/></linearGradient>\n      <radialGradient id="rs-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#rs-glow)"/>\n    <path d="M35 30 L35 75 Q35 85 45 85 L45 110 L55 110 L55 85 Q65 85 65 75 L65 30" fill="none" stroke="url(#rs-fork)" stroke-width="6" stroke-linecap="round"/>\n    <path d="M30 35 Q25 35 25 40 M70 35 Q75 35 75 40" stroke="#06b6d4" stroke-width="2" opacity="0.6"/>\n    <path d="M28 45 Q20 48 20 55 M72 45 Q80 48 80 55" stroke="#06b6d4" stroke-width="1.5" opacity="0.4"/>\n    <circle cx="35" cy="50" r="3" fill="#06b6d4" opacity="0.5"/>\n    <circle cx="65" cy="50" r="3" fill="#06b6d4" opacity="0.5"/>\n  </svg>',execute:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ex-blade" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#dc2626"/><stop offset="50%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#4b5563"/></linearGradient>\n      <linearGradient id="ex-frame" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#78716c"/><stop offset="100%" stop-color="#44403c"/></linearGradient>\n      <radialGradient id="ex-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ex-glow)"/>\n    <rect x="25" y="25" width="8" height="85" fill="url(#ex-frame)"/>\n    <rect x="67" y="25" width="8" height="85" fill="url(#ex-frame)"/>\n    <rect x="25" y="25" width="50" height="8" fill="url(#ex-frame)"/>\n    <path d="M30 70 L70 70 L70 80 L50 95 L30 80 Z" fill="url(#ex-blade)"/>\n    <path d="M32 72 L50 72 L50 88" stroke="#fff" stroke-width="1.5" opacity="0.3"/>\n    <circle cx="50" cy="50" r="6" fill="none" stroke="#dc2626" stroke-width="2"/><line x1="46" y1="46" x2="54" y2="54" stroke="#dc2626" stroke-width="2"/>\n  </svg>',critical_mass:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="cm-core" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#22d3ee"/><stop offset="70%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></radialGradient>\n      <radialGradient id="cm-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#cm-glow)"/>\n    <circle cx="50" cy="65" r="15" fill="url(#cm-core)"/>\n    <ellipse cx="50" cy="65" rx="30" ry="10" fill="none" stroke="#06b6d4" stroke-width="2" opacity="0.5"/>\n    <ellipse cx="50" cy="65" rx="10" ry="30" fill="none" stroke="#06b6d4" stroke-width="2" opacity="0.5" transform="rotate(60 50 65)"/>\n    <ellipse cx="50" cy="65" rx="10" ry="30" fill="none" stroke="#06b6d4" stroke-width="2" opacity="0.5" transform="rotate(-60 50 65)"/>\n    <circle cx="50" cy="35" r="5" fill="#fbbf24"/>\n    <circle cx="75" cy="75" r="5" fill="#a855f7"/>\n    <circle cx="25" cy="75" r="5" fill="#22c55e"/>\n    <circle cx="50" cy="65" r="5" fill="#9333ea"/>\n  </svg>',polysyndeton:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="po-link" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="po-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#po-glow)"/>\n    <ellipse cx="35" cy="45" rx="12" ry="8" fill="none" stroke="url(#po-link)" stroke-width="4"/>\n    <ellipse cx="50" cy="65" rx="12" ry="8" fill="none" stroke="url(#po-link)" stroke-width="4"/>\n    <ellipse cx="65" cy="85" rx="12" ry="8" fill="none" stroke="url(#po-link)" stroke-width="4"/>\n    <path d="M43 48 L45 60 M55 70 L58 82" stroke="url(#po-link)" stroke-width="3"/>\n    <circle cx="35" cy="100" r="4" fill="#dc2626"/><circle cx="50" cy="100" r="4" fill="#22c55e"/><circle cx="65" cy="100" r="4" fill="#3b82f6"/>\n  </svg>',anadiplosis:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ad-step" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="ad-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ad-glow)"/>\n    <rect x="20" y="75" width="20" height="20" rx="3" fill="url(#ad-step)"/>\n    <rect x="40" y="55" width="20" height="40" rx="3" fill="url(#ad-step)"/>\n    <rect x="60" y="35" width="20" height="60" rx="3" fill="url(#ad-step)"/>\n    <path d="M30 72 L30 62 L50 62 L50 52 L70 52 L70 32" stroke="#fff" stroke-width="2" stroke-dasharray="4,3" opacity="0.5" fill="none"/>\n    <circle cx="30" cy="85" r="4" fill="#f97316"/>\n    <circle cx="50" cy="75" r="4" fill="#f97316"/>\n    <circle cx="70" cy="55" r="4" fill="#f97316"/>\n  </svg>',chiasmus:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="chi-line" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#0e7490"/></linearGradient>\n      <radialGradient id="chi-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#chi-glow)"/>\n    <line x1="25" y1="35" x2="75" y2="95" stroke="url(#chi-line)" stroke-width="6" stroke-linecap="round"/>\n    <line x1="75" y1="35" x2="25" y2="95" stroke="url(#chi-line)" stroke-width="6" stroke-linecap="round"/>\n    <circle cx="25" cy="35" r="8" fill="#f97316"/><ellipse cx="23" cy="33" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n    <circle cx="75" cy="35" r="8" fill="#3b82f6"/><ellipse cx="73" cy="33" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n    <circle cx="25" cy="95" r="8" fill="#3b82f6"/><ellipse cx="23" cy="93" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n    <circle cx="75" cy="95" r="8" fill="#f97316"/><ellipse cx="73" cy="93" rx="3" ry="2" fill="#fff" opacity="0.3"/>\n    <circle cx="50" cy="65" r="10" fill="#0f172a"/>\n    <path d="M46 62 L50 56 L54 62 M46 68 L50 74 L54 68" fill="none" stroke="#06b6d4" stroke-width="2" stroke-linecap="round"/>\n  </svg>',signature_style:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="ss-ink" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e1b4b"/><stop offset="100%" stop-color="#312e81"/></linearGradient>\n      <radialGradient id="ss-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#ss-glow)"/>\n    <rect x="20" y="30" width="60" height="75" rx="3" fill="#fef3c7"/>\n    <rect x="22" y="32" width="56" height="71" rx="2" fill="#fefce8"/>\n    <path d="M30 55 Q40 45 50 55 Q60 65 70 55 Q75 50 72 60 Q68 75 55 80 Q45 82 35 78 Q25 72 30 60" fill="none" stroke="url(#ss-ink)" stroke-width="3" stroke-linecap="round"/>\n    <path d="M60 82 Q65 90 75 88" stroke="url(#ss-ink)" stroke-width="2" stroke-linecap="round"/>\n    <line x1="30" y1="92" x2="70" y2="92" stroke="#d4af37" stroke-width="2"/>\n  </svg>',hyperbole:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="hy-burst" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#fbbf24"/><stop offset="50%" stop-color="#f97316"/><stop offset="100%" stop-color="#dc2626"/></linearGradient>\n      <radialGradient id="hy-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#hy-glow)"/>\n    <polygon points="50,25 55,50 80,45 60,60 85,75 55,70 50,100 45,70 15,75 40,60 20,45 45,50" fill="url(#hy-burst)"/>\n    <circle cx="50" cy="62" r="12" fill="#fbbf24"/>\n    <circle cx="50" cy="62" r="8" fill="#fff" opacity="0.4"/>\n    <path d="M46 58 L50 54 L54 58 M46 66 L50 70 L54 66" fill="none" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/>\n  </svg>',residual:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <linearGradient id="re-drop" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#15803d"/></linearGradient>\n      <radialGradient id="re-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#06b6d4" stop-opacity="0.4"/><stop offset="100%" stop-color="#06b6d4" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="38" ry="45" fill="url(#re-glow)"/>\n    <rect x="25" y="30" width="50" height="40" rx="5" fill="#374151"/>\n    <rect x="27" y="32" width="46" height="36" rx="4" fill="#1f2937"/>\n    <circle cx="50" cy="50" r="8" fill="#d4af37"/><path d="M46 48 L50 44 L54 48 M46 52 L50 56 L54 52" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M35 70 Q32 80 35 90 Q35 98 40 100" stroke="url(#re-drop)" stroke-width="4" fill="none" stroke-linecap="round"/>\n    <ellipse cx="42" cy="102" rx="5" ry="4" fill="url(#re-drop)"/>\n    <path d="M50 70 L50 85" stroke="url(#re-drop)" stroke-width="4" fill="none" stroke-linecap="round"/>\n    <ellipse cx="50" cy="90" rx="4" ry="5" fill="url(#re-drop)"/>\n    <path d="M65 70 Q68 78 65 88" stroke="url(#re-drop)" stroke-width="3" fill="none" stroke-linecap="round"/>\n    <ellipse cx="65" cy="92" rx="3" ry="4" fill="url(#re-drop)"/>\n    <path d="M35 112 L50 118 L65 112" stroke="#22c55e" stroke-width="3" stroke-linecap="round"/>\n  </svg>',default:'<svg viewBox="0 0 100 130" xmlns="http://www.w3.org/2000/svg">\n    <defs>\n      <radialGradient id="df-glow" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#6b7280" stop-opacity="0.4"/><stop offset="100%" stop-color="#6b7280" stop-opacity="0"/></radialGradient>\n    </defs>\n    <ellipse cx="50" cy="65" rx="35" ry="40" fill="url(#df-glow)"/>\n    <circle cx="50" cy="65" r="25" fill="none" stroke="#6b7280" stroke-width="2"/>\n    <circle cx="50" cy="65" r="8" fill="#6b7280"/><circle cx="50" cy="65" r="4" fill="#9ca3af"/>\n  </svg>'};function getTalentSVG(e){return TALENT_SVG[e]||TALENT_SVG.default}const SKILL_NODE_SVG={weaponAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M3 3 L14 14 M3 14 L7 14 L7 10 M17 17 L14 14 M3 3 L7 3 L7 7" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M17 3 L6 14 M17 3 L13 3 L13 7 M3 17 L6 14" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',adjAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10 2 L10 18 M2 10 L18 10 M4 4 L16 16 M16 4 L4 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <circle cx="10" cy="10" r="2" fill="currentColor"/>\n  </svg>',nounAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10 4 L10 17" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M10 4 Q6 3 3 5 L3 16 Q6 14 10 17" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M10 4 Q14 3 17 5 L17 16 Q14 14 10 17" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>',gemAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10 2 L17 7 L10 18 L3 7 Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <path d="M3 7 L17 7 M7 7 L10 2 L13 7 M7 7 L10 18 L13 7" fill="none" stroke="currentColor" stroke-width="1" stroke-linejoin="round"/>\n  </svg>',startGold:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <ellipse cx="10" cy="14" rx="6" ry="3" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <path d="M4 14 L4 11 Q4 8 10 8 Q16 8 16 11 L16 14" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <ellipse cx="10" cy="11" rx="6" ry="3" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <path d="M4 11 L4 8 Q4 5 10 5 Q16 5 16 8 L16 11" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <ellipse cx="10" cy="8" rx="6" ry="3" fill="none" stroke="currentColor" stroke-width="1.5"/>\n  </svg>',slashAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M15 2 L5 16 L6 17 L8 16 L16 4 Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <path d="M5 16 L3 18 M6 17 L5 19" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',pierceAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M3 17 L17 3" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M17 3 L17 8 M17 3 L12 3" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M3 17 L6 14 L4 12 Z" fill="currentColor"/>\n  </svg>',bluntAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <rect x="3" y="3" width="10" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <path d="M8 9 L8 17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n  </svg>',magicAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M3 17 L14 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n    <path d="M16 4 L16 2 M16 4 L18 4 M16 4 L14 4 M16 4 L16 6 M14.5 2.5 L17.5 5.5 M17.5 2.5 L14.5 5.5" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>\n  </svg>',physAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M6 8 L6 13 Q6 16 10 16 L14 16 Q16 16 16 14 L16 9 Q16 7 14 7 L12 7 L12 5 Q12 4 11 4 L9 4 Q8 4 8 5 L8 8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <path d="M8 8 L6 8 Q4 8 4 10 L4 11" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',fireAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10 2 Q14 6 14 10 Q14 14 10 17 Q6 14 6 10 Q6 6 10 2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <path d="M10 8 Q12 10 12 12 Q12 14 10 15 Q8 14 8 12 Q8 10 10 8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n  </svg>',waterAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10 2 Q16 9 16 12 Q16 17 10 17 Q4 17 4 12 Q4 9 10 2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <path d="M7 12 Q7 14 10 14" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>\n  </svg>',lightAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="10" cy="10" r="4" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <path d="M10 2 L10 4 M10 16 L10 18 M2 10 L4 10 M16 10 L18 10 M4.3 4.3 L5.7 5.7 M14.3 14.3 L15.7 15.7 M15.7 4.3 L14.3 5.7 M5.7 14.3 L4.3 15.7" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',darkAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 4 Q9 5 9 10 Q9 15 14 16 Q10 18 6 14 Q3 10 6 6 Q10 2 14 4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <circle cx="15" cy="6" r="0.8" fill="currentColor"/>\n    <circle cx="17" cy="9" r="0.5" fill="currentColor"/>\n  </svg>',earthAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M2 16 L7 6 L10 10 L13 5 L18 16 Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <path d="M5 16 L8 11 L10 13" fill="none" stroke="currentColor" stroke-width="1" stroke-linejoin="round"/>\n  </svg>',lightningAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M12 2 L6 10 L10 10 L8 18 L14 10 L10 10 L12 2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n  </svg>',poisonAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="10" cy="8" r="5" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <circle cx="8" cy="7" r="1.2" fill="currentColor"/>\n    <circle cx="12" cy="7" r="1.2" fill="currentColor"/>\n    <path d="M8 10 L8 12 M10 10 L10 13 M12 10 L12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n    <path d="M7 16 Q7 18 8.5 18 Q10 18 10 16 Q10 18 11.5 18 Q13 18 13 16" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>\n  </svg>',bossAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 5 L6 7 L8 4 L10 7 L12 4 L14 7 L16 5 L16 8 L4 8 Z" fill="none" stroke="currentColor" stroke-width="1" stroke-linejoin="round"/>\n    <circle cx="10" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <circle cx="8" cy="11" r="1" fill="currentColor"/>\n    <circle cx="12" cy="11" r="1" fill="currentColor"/>\n    <path d="M8 14 L12 14" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>\n  </svg>',weaknessAP:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="10" cy="10" r="6" fill="none" stroke="currentColor" stroke-width="1.5"/>\n    <circle cx="10" cy="10" r="2" fill="currentColor"/>\n    <path d="M10 2 L10 6 M10 14 L10 18 M2 10 L6 10 M14 10 L18 10" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>\n  </svg>',capstone:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M3 15 L3 8 L6 11 L10 5 L14 11 L17 8 L17 15 Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n    <circle cx="3" cy="8" r="1.5" fill="currentColor"/>\n    <circle cx="10" cy="5" r="1.5" fill="currentColor"/>\n    <circle cx="17" cy="8" r="1.5" fill="currentColor"/>\n  </svg>',default:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10 2 L12 8 L18 8 L13 12 L15 18 L10 14 L5 18 L7 12 L2 8 L8 8 Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>\n  </svg>'};function getSkillNodeSVG(e){return SKILL_NODE_SVG[e]||SKILL_NODE_SVG.default}const BASE_COLORS={sword:"#7a8b99",greatsword:"#8a9baa",claymore:"#9aabbb",bow:"#8B4513",longbow:"#9B5523",warbow:"#AB6533",wand:"#9966cc",staff:"#aa77dd",scepter:"#bb88ee",mace:"#6a6a7a",warhammer:"#7a7a8a",maul:"#8a8a9a",stick:"#5a4a3a",hammer:"#86654b",dagger:"#7f7f7f",axe:"#7a4c30"},SAVE_KEY="wordyweapon-save",STATS_KEY="wordyweapon-stats";let PStats={attempts:0,victories:0,weaponsForged:0,bestDamage:0,bestWeaponName:"",heroClears:{},highestRound:0,tutorialComplete:!1,bossDefeats:{},unlockedHeroes:["Graham Moor"],heroXP:{},heroLevel:{},heroSkillPoints:{},heroSkills:{}},S={difficulty:0,wins:0,losses:0,streak:0,gold:30,hero:null,enemy:null,level:1,roundIndex:1,floor:1,nextEnemyData:null,nextChapterBoss:null,talents:[],talentLevels:{},consumables:[],inv:[],sel:{item:null,adj1:null,adj2:null,adj3:null,adj4:null,noun1:null},pendingWord:null,pendingBossLoot:null,rerollCost:5,sortMode:"type",sortAsc:!0,shopSortMode:"type",shopSortAsc:!0,heroSelected:!1,shadowBonusHP:0,battleHardenedBonus:0,quickStudyBonus:0,tempEffects:{},lives:1,usedWeaponTypes:new Set,usedWeapons:new Set,uniqueWordsUsed:new Set,bossesDefeated:0,wordsSold:0,elementWordsUsed:{},carriedOverkill:0,toolsUsed:0,cratesOpened:0,goldSpent:0,rarityWordsUsed:0,tierWordsPlayed:{1:0,2:0,3:0},toolUsedThisBattle:!1,chapterAPBonus:0,currentChapter:0,gamePhase:"shop",foughtChapterBosses:[],chapterBoss:null,blockedSlot:null},audioOn=!0;const STEAM_ACHIEVEMENTS={FIRST_VICTORY:"ACH_FIRST_VICTORY",WORDSMITH_MASTER:"ACH_WORDSMITH_MASTER",ENDLESS_WARRIOR:"ACH_ENDLESS_WARRIOR",BOSS_SLAYER:"ACH_BOSS_SLAYER",APPRENTICE_SMITH:"ACH_APPRENTICE_SMITH",ADEPT_FORGER:"ACH_ADEPT_FORGER",MASTER_BLACKSMITH:"ACH_MASTER_BLACKSMITH",BOSS_CINNA_ANTONY:"ACH_BOSS_CINNA_ANTONY",BOSS_RED_AKTINS:"ACH_BOSS_RED_AKTINS",BOSS_PLAGUE_DOCTOR:"ACH_BOSS_PLAGUE_DOCTOR",BOSS_OXY:"ACH_BOSS_OXY",BOSS_DOTDOTDOT:"ACH_BOSS_DOTDOTDOT",BOSS_SILENT_KNIGHT:"ACH_BOSS_SILENT_KNIGHT",HERO_GRAHAM:"ACH_HERO_GRAHAM",HERO_QUIVERA:"ACH_HERO_QUIVERA",HERO_BELLE:"ACH_HERO_BELLE",HERO_ALEXANDRIA:"ACH_HERO_ALEXANDRIA",HERO_CAESURA:"ACH_HERO_CAESURA",HERO_REED:"ACH_HERO_REED",HOARDER:"ACH_HOARDER",TREASURE_HUNTER:"ACH_TREASURE_HUNTER",MINIMALIST:"ACH_MINIMALIST"};async function unlockSteamAchievement(e){if(void 0===window.steamAPI)return!1;try{const t=STEAM_ACHIEVEMENTS[e];return t?await window.steamAPI.unlockAchievement(t):(console.warn("Unknown achievement key:",e),!1)}catch(e){return console.warn("Steam achievement unlock failed:",e),!1}}async function checkAndUnlockAchievements(){if(void 0===window.steamAPI)return;if(!await window.steamAPI.isAvailable())return;PStats.victories>=1&&unlockSteamAchievement("FIRST_VICTORY");const e=PStats.heroClears||{};["Graham Moor","Quivera","Belle Lettres","Alexandria Constanza","Caesura","Reed"].filter(t=>e[t]).length>=6&&unlockSteamAchievement("WORDSMITH_MASTER"),(PStats.highestRound||0)>=15&&unlockSteamAchievement("ENDLESS_WARRIOR");const t=PStats.difficultyClears||{};t[0]&&unlockSteamAchievement("APPRENTICE_SMITH"),t[1]&&unlockSteamAchievement("ADEPT_FORGER"),t[2]&&unlockSteamAchievement("MASTER_BLACKSMITH");const o=PStats.bossDefeats||{};o.cinna_antony&&unlockSteamAchievement("BOSS_CINNA_ANTONY"),o.red_aktins&&unlockSteamAchievement("BOSS_RED_AKTINS"),o.plague_doctor&&unlockSteamAchievement("BOSS_PLAGUE_DOCTOR"),o.oxy&&unlockSteamAchievement("BOSS_OXY"),o.dotdotdot&&unlockSteamAchievement("BOSS_DOTDOTDOT"),o.silent_knight&&unlockSteamAchievement("BOSS_SILENT_KNIGHT");["cinna_antony","red_aktins","plague_doctor","oxy","dotdotdot"].filter(e=>o[e]).length>=5&&unlockSteamAchievement("BOSS_SLAYER"),e["Graham Moor"]&&unlockSteamAchievement("HERO_GRAHAM"),e.Quivera&&unlockSteamAchievement("HERO_QUIVERA"),e["Belle Lettres"]&&unlockSteamAchievement("HERO_BELLE"),e["Alexandria Constanza"]&&unlockSteamAchievement("HERO_ALEXANDRIA"),e.Caesura&&unlockSteamAchievement("HERO_CAESURA"),e.Reed&&unlockSteamAchievement("HERO_REED")}function checkTreasureHunterAchievement(){S.gold>=1e3&&unlockSteamAchievement("TREASURE_HUNTER")}function checkHoarderAchievement(){(S.inv?S.inv.filter(e=>!e.hiddenInBank).length:0)>=24&&unlockSteamAchievement("HOARDER")}async function steamCloudSaveStats(){if(void 0===window.steamAPI)return!1;try{return!!await window.steamAPI.isAvailable()&&await window.steamAPI.cloudSave("wordyweapon-stats",PStats)}catch(e){return console.warn("Steam Cloud save failed:",e),!1}}async function steamCloudSaveRun(){if(void 0===window.steamAPI)return!1;try{if(!await window.steamAPI.isAvailable())return!1;const e={...S,usedWeaponTypes:Array.from(S.usedWeaponTypes||[]),usedWeapons:Array.from(S.usedWeapons||[]),uniqueWordsUsed:Array.from(S.uniqueWordsUsed||[])};return await window.steamAPI.cloudSave("wordyweapon-save",e)}catch(e){return console.warn("Steam Cloud save failed:",e),!1}}async function steamCloudLoadStats(){if(void 0===window.steamAPI)return null;try{return await window.steamAPI.isAvailable()?await window.steamAPI.cloudLoad("wordyweapon-stats"):null}catch(e){return console.warn("Steam Cloud load failed:",e),null}}async function steamCloudLoadRun(){if(void 0===window.steamAPI)return null;try{return await window.steamAPI.isAvailable()?await window.steamAPI.cloudLoad("wordyweapon-save"):null}catch(e){return console.warn("Steam Cloud load failed:",e),null}}function applyRunState(e){if(!e||!e.hero||!e.roundIndex)return!1;if(e.usedWeaponTypes&&(e.usedWeaponTypes=new Set(e.usedWeaponTypes)),e.usedWeapons&&(e.usedWeapons=new Set(e.usedWeapons)),e.uniqueWordsUsed&&(e.uniqueWordsUsed=new Set(e.uniqueWordsUsed)),e.hero&&e.hero.id){const t=HEROES.find(t=>t.id===e.hero.id);t&&t.passive&&(e.hero.passive=t.passive)}return S={...S,...e},S.hero&&S.hero.name&&(initHeroSkills(S.hero.name),S.heroSkillBonuses=getHeroSkillBonuses(S.hero.name)),S.nextEnemyData=null,S.belleRandomWeaknesses=null,S.nextEnemyBonusWeaknesses=null,S.gamePhase||(S.gamePhase="shop"),S.sel={item:null,adj1:null,adj2:null,adj3:null,adj4:null,noun1:null},S.pendingWord=null,!0}function loadStats(){try{const e=localStorage.getItem(STATS_KEY);e&&(PStats={...PStats,...JSON.parse(e)})}catch(e){console.warn("Failed to load stats",e)}}async function loadStatsAsync(){try{const e=await steamCloudLoadStats();if(e){const t=localStorage.getItem(STATS_KEY),o=t?JSON.parse(t):{};PStats=(e.victories||0)>=(o.victories||0)?{...PStats,...e}:{...PStats,...o}}else loadStats()}catch(e){console.warn("Failed to load stats async",e),loadStats()}try{await checkAndUnlockAchievements()}catch(e){console.warn("Failed to sync achievements after load",e)}}function saveStats(){try{localStorage.setItem(STATS_KEY,JSON.stringify(PStats)),steamCloudSaveStats(),checkAndUnlockAchievements()}catch(e){console.warn("Failed to save stats",e)}}function saveRun(){try{const e={...S,usedWeaponTypes:Array.from(S.usedWeaponTypes||[]),usedWeapons:Array.from(S.usedWeapons||[]),uniqueWordsUsed:Array.from(S.uniqueWordsUsed||[])};localStorage.setItem(SAVE_KEY,JSON.stringify(e)),steamCloudSaveRun()}catch(e){console.warn("Failed to save run",e)}finally{updateContinueButtons()}}function loadRun(){try{const e=localStorage.getItem(SAVE_KEY);if(e){const t=JSON.parse(e);if(!t||!t.hero||!t.roundIndex)return updateContinueButtons(),!1;const o=applyRunState(t);return updateContinueButtons(),o}}catch(e){console.warn("Failed to load run",e)}return!1}async function loadRunAsync(){try{const[e,t]=await Promise.all([steamCloudLoadRun(),Promise.resolve(localStorage.getItem(SAVE_KEY))]),o=t?JSON.parse(t):null,n=e&&e.hero&&e.roundIndex,s=o&&o.hero&&o.roundIndex;let a=null;if(n&&s){const t=e.roundIndex||0;a=t>=(o.roundIndex||0)?e:o}else a=n?e:s?o:null;if(a){let e=null;try{e=JSON.stringify(a)}catch(e){console.warn("Failed to serialize chosen run for local cache",e)}const t=applyRunState(a);if(t&&e)try{localStorage.setItem(SAVE_KEY,e)}catch(e){console.warn("Failed to cache cloud run locally",e)}return updateContinueButtons(),t}}catch(e){console.warn("Failed to load run async",e)}return updateContinueButtons(),!1}function clearRunSave(){try{localStorage.removeItem(SAVE_KEY)}catch(e){console.warn("Failed to clear save",e)}if("undefined"!=typeof window&&window.steamAPI&&window.steamAPI.cloudSave)try{window.steamAPI.cloudSave("wordyweapon-save",{cleared:!0,ts:Date.now()})}catch(e){console.warn("Failed to clear Steam Cloud save",e)}updateContinueButtons()}function hasSavedRun(){try{return!!localStorage.getItem(SAVE_KEY)}catch(e){return!1}}function updateContinueButtons(){const e=document.getElementById("continue-btn");e&&(e.style.display=hasSavedRun()?"block":"none")}function clearRunState(){S.roundIndex=0,S.heroSelected=!1,S.hero=null,S.enemy=null,S.talents=[],S.talentLevels={},S.inv=[],S.sel={item:null,adj1:null,adj2:null,adj3:null,adj4:null,noun1:null},S.consumables=[],S.tempEffects={},S.chapterBoss=null,S.blockedSlot=null,S.currentChapter=0,S.gamePhase="shop"}function showMainMenu(e=!1){["shop-overlay","pause-menu","hero-select-overlay","combat-overlay","talent-overlay","achievements-overlay","victory-overlay","chapter-celebration-overlay","round-intro-overlay"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.remove("show")});const t=document.getElementById("forge");t&&(t.style.display="none");const o=document.getElementById("battle-view");o&&(o.style.display="none");const n=document.getElementById("result-box");n&&(n.style.display="none");const s=document.getElementById("pause-btn"),a=document.getElementById("sound-btn");s&&(s.style.display="none"),a&&(a.style.display="none");const i=document.getElementById("header");i&&(i.style.display="none");const r=document.getElementById("word-bank");r&&(r.style.display="none");const l=document.getElementById("toast-overlay");l&&l.classList.remove("show");const c=document.getElementById("spotlight-tint");c&&c.classList.remove("show","full","crate"),!e&&musicEngine&&musicEngine.playing&&(musicEngine.stop(),stopSlotBounce()),setFlameColor("battle");const d=document.getElementById("main-menu");if(d&&(showOverlay(d),d.focus?.()),updateSkillBadges(),S.pendingHeroUnlock){const{hero:e,boss:t}=S.pendingHeroUnlock;S.pendingHeroUnlock=null,setTimeout(()=>{playSample("gem.ogg",1),showToast("NEW HERO UNLOCKED!",`Defeated ${t}!<br><span style="color:#4ade80;font-weight:bold">${e}</span> is now playable.`,"CONTINUE")},500)}else S.pendingHeroUnlock,0}function showVictoryScreen(){["shop-overlay","pause-menu","hero-select-overlay","combat-overlay","talent-overlay","achievements-overlay","main-menu"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.remove("show")});const e=S.roundIndex-1;if((!PStats.highestRound||e>PStats.highestRound)&&(PStats.highestRound=e,saveStats()),S.hero&&S.hero.name){const e=calcRunXP(S.roundIndex,!0),t=awardHeroXP(S.hero.name,e);S.lastRunXP={xp:e,...t}}const t=document.getElementById("victory-hero-name"),o=document.getElementById("victory-dialogue"),n=document.getElementById("victory-highest-round");t&&(t.textContent=S.hero.name),o&&(o.textContent=`"${S.hero.victoryDialogue||"Thank you, Wordsmith. We could not have done it without you."}"`),n&&(n.textContent=`Highest Round Reached: ${PStats.highestRound}`),pulseFlame(),burstSparks(window.innerWidth/2,window.innerHeight/2,60,["#ff9933","#ffcc00","#ffaa44"],!0),musicEngine&&musicEngine.initialized&&musicEngine.triggerVictoryEffect();const s=document.getElementById("victory-overlay");s&&(s.classList.add("show"),s.focus?.(),sparkManager&&sparkManager.setColorMode("victory"))}let skillTreeHeroIndex=0;const skillTreeHeroNames=["Graham Moor","Quivera","Belle Lettres","Alexandria Constanza","Caesura","Reed"],HERO_COLORS={"Graham Moor":{accent:"#6b8cae",accentDark:"#4a6a8a"},Quivera:{accent:"#4ade80",accentDark:"#22c55e"},"Belle Lettres":{accent:"#f97316",accentDark:"#ea580c"},"Alexandria Constanza":{accent:"#fde047",accentDark:"#eab308"},Caesura:{accent:"#a855f7",accentDark:"#9333ea"},Reed:{accent:"#2dd4bf",accentDark:"#14b8a6"}};function showSkillTree(e){const t=skillTreeHeroNames.indexOf(e);skillTreeHeroIndex=t>=0?t:0,renderSkillTree(),document.getElementById("skill-tree-overlay").classList.add("show"),playSfxOpen()}function closeSkillTree(){document.getElementById("skill-tree-overlay").classList.remove("show"),playSfxBack()}let skillTreeZoom=1,skillTreePanX=0,skillTreePanY=0;const SKILL_TREE_ZOOM_MIN=.6,SKILL_TREE_ZOOM_MAX=1.8,SKILL_TREE_ZOOM_STEP=.1;function renderSkillTree(){const e=skillTreeHeroNames[skillTreeHeroIndex],t=SKILL_TREES[e];if(!t)return;initHeroSkills(e);const o=HERO_COLORS[e]||{accent:"#f5c15c",accentDark:"#d4a84a"},n=document.querySelector(".skill-tree-modal");n.style.setProperty("--hero-accent",o.accent),n.style.setProperty("--hero-accent-dark",o.accentDark);const s=HEROES.find(t=>t.name===e),a=s?s.id:"warrior";let i=n.querySelector(".skill-tree-bg");i||(i=document.createElement("div"),i.className="skill-tree-bg",n.insertBefore(i,n.firstChild));const r=getPortraitSVG(a);i.innerHTML=r,document.getElementById("skill-tree-hero-name").textContent=e,document.getElementById("skill-tree-hero-name").style.color=o.accent;const l=getHeroLevel(e);document.getElementById("skill-tree-hero-level").textContent=`Level ${l}`;const c=PStats.heroXP&&PStats.heroXP[e]||0,d=getXPProgress(e),p=getXPForNextLevel(e);if(document.getElementById("skill-tree-xp-fill").style.width=100*d+"%",p){const e=HERO_XP_THRESHOLDS[l-1];document.getElementById("skill-tree-xp-text").textContent=`${c-e} / ${p-e} XP`}else document.getElementById("skill-tree-xp-text").textContent="MAX LEVEL";const f=PStats.heroSkillPoints[e]||0;document.getElementById("skill-tree-points").textContent=`Skill Points: ${f}`;const u=document.getElementById("skill-tree-container"),h=t.nodes,m={};h.forEach(e=>{m[e.row]||(m[e.row]=[]),m[e.row].push(e)});let y=`\n    <div class="skill-tree-zoom-controls">\n      <button class="skill-tree-zoom-btn" id="skill-tree-zoom-out">‚àí</button>\n      <span class="skill-tree-zoom-level" id="skill-tree-zoom-level">${Math.round(100*skillTreeZoom)}%</span>\n      <button class="skill-tree-zoom-btn" id="skill-tree-zoom-in">+</button>\n      <button class="skill-tree-zoom-reset" id="skill-tree-zoom-reset">Reset</button>\n    </div>\n    <div class="skill-tree-viewport" id="skill-tree-viewport">\n      <div class="skill-tree-grid" id="skill-tree-grid" style="transform: scale(${skillTreeZoom}) translate(${skillTreePanX}px, ${skillTreePanY}px); transform-origin: center top;">\n  `;for(let t=0;t<=7;t++){const o=m[t]||[],n=[null,null,null,null,null];o.forEach(e=>{e.col>=0&&e.col<=4&&(n[e.col]=e)}),n.forEach((t,o)=>{if(t){const o=getSkillPoints(e,t.id),n=isSkillUnlocked(e,t.id),s=o>=t.maxPoints;let a="skill-node has-tooltip";n||(a+=" locked"),o>0&&(a+=" allocated"),s&&(a+=" maxed"),"major"===t.type&&(a+=" major"),"capstone"===t.type&&(a+=" capstone");let i=t.bonusType;"capstone"===t.type&&(i="capstone");const r=getSkillNodeSVG(i);y+=`\n          <div class="${a}" data-skill="${t.id}" data-hero="${e}">\n            <div class="skill-node-icon">${r}</div>\n            <div class="skill-node-name">${t.name}</div>\n            <div class="skill-node-points">${o}/${t.maxPoints}</div>\n            <div class="tooltip">\n              <div style="font-weight:bold;margin-bottom:4px;color:${"capstone"===t.type?"#c084fc":"#f5c15c"}">${t.name}</div>\n              <div style="margin-bottom:6px;color:#d1d5db">${t.desc}</div>\n              ${n?"":'<div style="color:#ef4444;font-size:10px">Requires previous skills</div>'}\n              ${n&&!s&&f>0?'<div style="color:#4ade80;font-size:10px">Click to allocate</div>':""}\n            </div>\n          </div>\n        `}else y+='<div class="skill-node-empty"></div>'})}y+="</div></div>",u.innerHTML=y,requestAnimationFrame(()=>{drawSkillTreeLines(e,h)}),u.querySelectorAll(".skill-node:not(.locked)").forEach(e=>{e.onclick=()=>{const t=e.dataset.skill;allocateSkillPoint(e.dataset.hero,t)&&(playSfxSkillUp(),renderSkillTree())},e.onmouseenter=sfxHover}),document.getElementById("skill-tree-zoom-in").onclick=()=>{skillTreeZoom=Math.min(SKILL_TREE_ZOOM_MAX,skillTreeZoom+SKILL_TREE_ZOOM_STEP),updateSkillTreeTransform()},document.getElementById("skill-tree-zoom-out").onclick=()=>{skillTreeZoom=Math.max(SKILL_TREE_ZOOM_MIN,skillTreeZoom-SKILL_TREE_ZOOM_STEP),updateSkillTreeTransform()},document.getElementById("skill-tree-zoom-reset").onclick=()=>{skillTreeZoom=1,skillTreePanX=0,skillTreePanY=0,updateSkillTreeTransform()};const g=document.getElementById("skill-tree-viewport");document.getElementById("skill-tree-grid");g.onwheel=e=>{e.preventDefault();const t=skillTreeZoom;if(skillTreeZoom=e.deltaY<0?Math.min(SKILL_TREE_ZOOM_MAX,skillTreeZoom+SKILL_TREE_ZOOM_STEP):Math.max(SKILL_TREE_ZOOM_MIN,skillTreeZoom-SKILL_TREE_ZOOM_STEP),t!==skillTreeZoom){const e=skillTreeZoom/t;skillTreePanX*=e,skillTreePanY*=e}updateSkillTreeTransform()};let w=!1,x=0,v=0,b=0,S=0;g.onmousedown=e=>{e.target.closest(".skill-node")||(w=!0,x=e.clientX,v=e.clientY,b=skillTreePanX,S=skillTreePanY,g.classList.add("dragging"),e.preventDefault())},document.addEventListener("mousemove",function(e){if(!w)return;const t=(e.clientX-x)/skillTreeZoom,o=(e.clientY-v)/skillTreeZoom;skillTreePanX=b+t,skillTreePanY=S+o,updateSkillTreeTransform()}),document.addEventListener("mouseup",function(){if(!w)return;w=!1;const e=document.getElementById("skill-tree-viewport");e&&e.classList.remove("dragging")})}function updateSkillTreeTransform(){const e=document.getElementById("skill-tree-grid"),t=document.getElementById("skill-tree-zoom-level");e&&(e.style.transform=`scale(${skillTreeZoom}) translate(${skillTreePanX}px, ${skillTreePanY}px)`),t&&(t.textContent=`${Math.round(100*skillTreeZoom)}%`)}function drawSkillTreeLines(e,t){const o=HERO_COLORS[e]||{accent:"#f5c15c"},n=document.getElementById("skill-tree-container").querySelector(".skill-tree-grid");if(!n)return;const s=n.querySelector(".skill-tree-lines");s&&s.remove();const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.classList.add("skill-tree-lines"),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.pointerEvents="none",a.style.zIndex="0",a.style.overflow="visible";const i=new Map;n.querySelectorAll("[data-skill]").forEach(e=>{i.set(e.dataset.skill,e)});const r={};t.forEach(e=>{const t=i.get(e.id);t&&(r[e.id]={x:t.offsetLeft+t.offsetWidth/2,y:t.offsetTop+t.offsetHeight/2})}),t.forEach(t=>{if(!t.requires||0===t.requires.length)return;const n=r[t.id];n&&t.requires.forEach(s=>{const i=r[s.id];if(!i)return;const l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",i.x),l.setAttribute("y1",i.y),l.setAttribute("x2",n.x),l.setAttribute("y2",n.y),l.classList.add("skill-tree-line");const c=getSkillPoints(e,s.id)>=s.points,d=getSkillPoints(e,t.id)>0;c&&d&&(l.classList.add("active"),l.style.stroke=o.accent),a.appendChild(l)})}),n.insertBefore(a,n.firstChild)}function setupSkillTreeListeners(){const e=document.getElementById("skill-tree-back-btn"),t=document.getElementById("skill-tree-next-btn"),o=document.getElementById("skill-tree-close-btn"),n=document.getElementById("skill-tree-respec-btn");e&&(e.onclick=()=>{skillTreeHeroIndex=(skillTreeHeroIndex-1+skillTreeHeroNames.length)%skillTreeHeroNames.length,skillTreePanX=0,skillTreePanY=0,renderSkillTree(),playSample("click.ogg",.4)},e.onmouseenter=sfxHover),t&&(t.onclick=()=>{skillTreeHeroIndex=(skillTreeHeroIndex+1)%skillTreeHeroNames.length,skillTreePanX=0,skillTreePanY=0,renderSkillTree(),playSample("click.ogg",.4)},t.onmouseenter=sfxHover),o&&(o.onclick=closeSkillTree,o.onmouseenter=sfxHover),n&&(n.onclick=()=>{respecHeroSkills(skillTreeHeroNames[skillTreeHeroIndex])>0&&(playSample("rarity.ogg",.5),renderSkillTree())},n.onmouseenter=sfxHover)}async function showChapterCelebration(e,t){["shop-overlay","pause-menu","combat-overlay","talent-overlay","combat-result"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.remove("show")});const o=document.getElementById("battle-view");o&&o.classList.add("hidden");const n=19===S.roundIndex;try{const o=document.getElementById("chapter-title"),s=document.getElementById("chapter-gold-bonus"),a=document.getElementById("chapter-gold-wrapper"),i=document.getElementById("chapter-hero-dialogue"),r=document.getElementById("chapter-continue-btn"),l=document.getElementById("chapter-mainmenu-btn"),c=document.getElementById("chapter-hero-portrait"),d=document.getElementById("chapter-hero-name"),p=document.getElementById("chapter-god-rays"),f=document.querySelector("#chapter-overlay .chapter-modal");n?(o&&(o.textContent="RUN COMPLETED"),a&&(a.style.display="flex"),s&&(s.textContent=`+${t}g`),c&&S.hero&&(c.innerHTML=getPortraitSVG(S.hero.portrait||S.hero.name),c.classList.add("show")),d&&S.hero&&(d.textContent=S.hero.name,d.classList.add("show")),i&&S.hero&&S.hero.victoryDialogue?i.textContent=`"${S.hero.victoryDialogue}"`:i&&(i.textContent='"Thank you, Wordsmith. We could not have done it without you."'),p&&p.classList.add("rainbow"),f&&f.classList.add("rainbow"),pulseFlame(),burstSparks(window.innerWidth/2,window.innerHeight/2,60,["#ff6b6b","#feca57","#48dbfb","#ff9ff3","#54a0ff","#5f27cd"],!0),setTimeout(()=>{burstSparks(window.innerWidth/2-100,window.innerHeight/2,40,["#ff6b6b","#feca57","#48dbfb","#ff9ff3","#54a0ff","#5f27cd"],!0),burstSparks(window.innerWidth/2+100,window.innerHeight/2,40,["#ff6b6b","#feca57","#48dbfb","#ff9ff3","#54a0ff","#5f27cd"],!0)},300),r&&(r.textContent="CONTINUE TO ENDLESS MODE"),l&&l.classList.add("show"),musicEngine&&musicEngine.initialized&&musicEngine.triggerVictoryEffect()):(o&&(o.textContent=`CHAPTER ${e} COMPLETE`),a&&(a.style.display="flex"),s&&(s.textContent=`+${t}g`),c&&c.classList.remove("show"),d&&d.classList.remove("show"),p&&p.classList.remove("rainbow"),f&&f.classList.remove("rainbow"),i&&S.hero&&S.hero.chapterDialogue?i.textContent=`"${S.hero.chapterDialogue}"`:i&&(i.textContent=""),pulseFlame(),burstSparks(window.innerWidth/2,window.innerHeight/2,50,["#ff9933","#ffcc00","#ffaa44"],!0),r&&(r.textContent="CONTINUE"),l&&l.classList.remove("show"));try{playSample("rarity.ogg",.7)}catch(e){}const u=document.getElementById("chapter-overlay");u&&(u.classList.remove("show"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{u.classList.add("show"),u.focus?.()})})),await new Promise(e=>{r&&(r.onclick=async()=>{isTransitioning||(playSample("click.ogg",.8),await playSceneTransition(()=>{u.classList.remove("show"),p&&p.classList.remove("rainbow"),f&&f.classList.remove("rainbow"),c&&c.classList.remove("show"),d&&d.classList.remove("show"),l&&l.classList.remove("show")}),await showTalentSelect(5,2),e())},r.onmouseenter=sfxHover),l&&(l.onclick=async()=>{isTransitioning||(playSample("click.ogg",.8),await playSceneTransition(()=>{u.classList.remove("show"),p&&p.classList.remove("rainbow"),f&&f.classList.remove("rainbow"),c&&c.classList.remove("show"),d&&d.classList.remove("show"),l.classList.remove("show"),clearRunState(),showMainMenu()}),e())},l.onmouseenter=sfxHover)})}catch(e){console.error("[showChapterCelebration] ERROR:",e),await showTalentSelect(5,2)}}function showLossScreen(e,t,o,n,s){["shop-overlay","pause-menu","combat-overlay","talent-overlay","combat-result"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.remove("show")});const a=document.getElementById("battle-view");a&&a.classList.add("hidden");try{const a=document.getElementById("loss-round"),i=document.getElementById("loss-hero-name"),r=document.getElementById("loss-xp-gained"),l=document.getElementById("loss-level-up"),c=document.getElementById("loss-defeat-dialogue");a&&(a.textContent=t),i&&(i.textContent=e),r&&(r.textContent=`+${o} XP`),c&&S.hero&&S.hero.defeatDialogue?c.textContent=`"${S.hero.defeatDialogue}"`:c&&(c.textContent=""),l&&(n?(l.style.display="block",l.textContent=`LEVEL UP! ‚Üí Level ${s}`):l.style.display="none");const d=document.getElementById("loss-overlay");d&&(d.classList.add("show"),d.focus?.());const p=document.getElementById("loss-continue-btn");p&&(p.onclick=async()=>{isTransitioning||(playSample("click.ogg",.8),await playSceneTransition(()=>{d.classList.remove("show"),showMainMenu()}))},p.onmouseenter=sfxHover)}catch(e){console.error("[showLossScreen] ERROR:",e),showMainMenu()}}function executeForfeit(){S.losses++,S.streak=0,S.heroSelected=!1,clearRunSave();let e=0,t=!1,o=1;const n=S.hero?.name||"Hero";if(S.hero&&S.hero.name){e=calcRunXP(S.roundIndex,!1);const n=awardHeroXP(S.hero.name,e);t=n.leveledUp,o=n.newLevel,S.lastRunXP={xp:e,...n}}stopAllRarityDrones(),musicEngine&&musicEngine.initialized&&musicEngine.triggerLoseEffect(),clrSel(),showLossScreen(n,S.roundIndex,e,t,o)}function renderStats(){const e=document.getElementById("stats-container");if(!e)return;const t=["Graham Moor","Quivera","Belle Lettres","Alexandria Constanza","Caesura","Reed"],o=PStats.heroClears||{},n=t.filter(e=>o[e]).length,s=PStats.bossDefeats||{},a=Object.keys(s).length,i=[{id:"cinna_antony",name:"Cinna & Antony",icon:icon("yinyang"),unlocks:"Quivera"},{id:"red_aktins",name:"Red Aktins",icon:icon("scissors"),unlocks:"Belle Lettres"},{id:"plague_doctor",name:"Plague Doctor",icon:icon("clipboard"),unlocks:"Alexandria"},{id:"oxy",name:"Oxy",icon:icon("crossed-swords"),unlocks:"Caesura"},{id:"dotdotdot",name:"Dotdotdot",icon:icon("ellipsis"),unlocks:"Reed"},{id:"silent_knight",name:"The Silent Knight",icon:icon("shield"),unlocks:null,secret:!0}],r=PStats.attempts>0?Math.round(PStats.victories/PStats.attempts*100):0,l=PStats.bestWeaponName||"None yet",c=PStats.bestDamage||0;e.innerHTML=`\n    \x3c!-- Left Column: Run Stats --\x3e\n    <div class="stats-section" style="--section-color:#60a5fa">\n      <div class="stats-section-title">Run Statistics</div>\n      <div class="stat-row">\n        <span class="stat-label">Total Attempts</span>\n        <span class="stat-value">${PStats.attempts}</span>\n      </div>\n      <div class="stat-row">\n        <span class="stat-label">Victories (Round 9+)</span>\n        <span class="stat-value highlight">${PStats.victories}</span>\n      </div>\n      <div class="stat-row">\n        <span class="stat-label">Win Rate</span>\n        <span class="stat-value">${r}%</span>\n      </div>\n      <div class="stat-row">\n        <span class="stat-label">Highest Round</span>\n        <span class="stat-value gold">${PStats.highestRound||0}</span>\n      </div>\n      <div class="stat-row">\n        <span class="stat-label">Weapons Forged</span>\n        <span class="stat-value">${PStats.weaponsForged}</span>\n      </div>\n    </div>\n\n    \x3c!-- Right Column: Best Weapon --\x3e\n    <div class="stats-section" style="--section-color:#f4d03f">\n      <div class="stats-section-title">Best Weapon</div>\n      ${c>0?`\n        <div class="best-weapon-display">\n          <div class="best-weapon-name">${l}</div>\n          <div class="best-weapon-damage">${c} AP</div>\n        </div>\n      `:'\n        <div style="color:#6b7280;font-size:12px;text-align:center;padding:20px 0">Forge your first weapon to start tracking!</div>\n      '}\n    </div>\n\n    \x3c!-- Bottom Left: Hero Clears --\x3e\n    <div class="stats-section" style="--section-color:#4ade80">\n      <div class="stats-section-title">Heroes Cleared (${n}/6)</div>\n      <div class="hero-clears">\n        ${t.map(e=>`\n          <div class="hero-clear-badge ${o[e]?"":"locked"}">${e}</div>\n        `).join("")}\n      </div>\n    </div>\n\n    \x3c!-- Bottom Right: Achievements --\x3e\n    <div class="stats-section" style="--section-color:#c084fc">\n      <div class="stats-section-title">Achievements</div>\n      <div class="achievement-grid">\n        <div class="achievement-card ${PStats.victories>=1?"unlocked":"locked"}">\n          <div class="achievement-icon">${icon("crossed-swords")}</div>\n          <div class="achievement-info">\n            <div class="achievement-name">First Victory</div>\n            <div class="achievement-desc">Complete a run</div>\n          </div>\n        </div>\n        <div class="achievement-card ${n>=6?"unlocked":"locked"}">\n          <div class="achievement-icon">${icon("crown")}</div>\n          <div class="achievement-info">\n            <div class="achievement-name">Wordsmith Master</div>\n            <div class="achievement-desc">Clear with all 6 heroes</div>\n            ${n<6?`<div class="achievement-progress">${n}/6</div>`:""}\n          </div>\n        </div>\n        <div class="achievement-card ${(PStats.highestRound||0)>=15?"unlocked":"locked"}">\n          <div class="achievement-icon">${icon("fire")}</div>\n          <div class="achievement-info">\n            <div class="achievement-name">Endless Warrior</div>\n            <div class="achievement-desc">Reach Round 15</div>\n            ${(PStats.highestRound||0)<15?`<div class="achievement-progress">Round ${PStats.highestRound||0}/15</div>`:""}\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Difficulty Achievements --\x3e\n      <div class="stats-section-title" style="margin-top:16px">Difficulty Clears</div>\n      <div class="achievement-grid">\n        <div class="achievement-card ${(PStats.difficultyClears||{})[0]?"unlocked":"locked"}">\n          <div class="achievement-icon" style="font-size:20px">üî®</div>\n          <div class="achievement-info">\n            <div class="achievement-name">Apprentice Smith</div>\n            <div class="achievement-desc">Clear on Apprentice difficulty</div>\n          </div>\n        </div>\n        <div class="achievement-card ${(PStats.difficultyClears||{})[1]?"unlocked":"locked"}">\n          <div class="achievement-icon" style="font-size:20px">‚öíÔ∏è</div>\n          <div class="achievement-info">\n            <div class="achievement-name">Adept Forger</div>\n            <div class="achievement-desc">Clear on Adept difficulty</div>\n          </div>\n        </div>\n        <div class="achievement-card ${(PStats.difficultyClears||{})[2]?"unlocked":"locked"}">\n          <div class="achievement-icon" style="font-size:20px">üî•</div>\n          <div class="achievement-info">\n            <div class="achievement-name">Master Blacksmith</div>\n            <div class="achievement-desc">Clear on Master difficulty</div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Boss Defeat Achievements --\x3e\n      <div class="stats-section-title" style="margin-top:16px">Chapter Bosses (${a}/6)</div>\n      <div class="achievement-grid">\n        ${i.map(e=>`\n          <div class="achievement-card ${s[e.id]?"unlocked":"locked"}">\n            <div class="achievement-icon">${e.icon}</div>\n            <div class="achievement-info">\n              <div class="achievement-name">${s[e.id]||!e.secret?e.name:"???"}</div>\n              <div class="achievement-desc">${e.unlocks?`Unlocks ${e.unlocks}`:e.secret?"Secret Boss":""}</div>\n            </div>\n          </div>\n        `).join("")}\n        <div class="achievement-card ${a>=5?"unlocked":"locked"}">\n          <div class="achievement-icon">${icon("skull")}</div>\n          <div class="achievement-info">\n            <div class="achievement-name">Boss Slayer</div>\n            <div class="achievement-desc">Defeat all 5 chapter bosses</div>\n            ${a<5?`<div class="achievement-progress">${a}/5</div>`:""}\n          </div>\n        </div>\n      </div>\n    </div>\n  `}let audioCtx=null,masterGain=null,delayNode=null,delayGain=null;const sampleCache={};let useClickAlt=!1;const ELEMENT_SAMPLES={[E.FIRE]:"fire-element.ogg",[E.WATER]:"water-element.ogg",[E.LIGHTNING]:"lightning-element.ogg",[E.LIGHT]:"holy-element.ogg",[E.DARK]:"dark-element.ogg",[E.EARTH]:"earth-element.ogg",[E.POISON]:"poison-element.ogg",[E.PHYS]:"physical-element.ogg"};let volMaster=1,volMusic=.8,volSfx=1;const AUDIO_SETTINGS_KEY="wordyweapon_audio";function loadAudioSettings(){try{const e=localStorage.getItem(AUDIO_SETTINGS_KEY);if(e){const t=JSON.parse(e);volMaster=t.master??1,volMusic=t.music??.8,volSfx=t.sfx??1}}catch(e){console.warn("Failed to load audio settings",e)}}function saveAudioSettings(){try{localStorage.setItem(AUDIO_SETTINGS_KEY,JSON.stringify({master:volMaster,music:volMusic,sfx:volSfx}))}catch(e){console.warn("Failed to save audio settings",e)}}function applyAudioSettings(){masterGain&&(masterGain.gain.value=volMaster),musicEngine&&musicEngine.masterGain&&(musicEngine.masterGain.gain.value=volMaster*volMusic);const e=document.getElementById("vol-master"),t=document.getElementById("vol-music"),o=document.getElementById("vol-sfx");if(e){e.value=Math.round(100*volMaster);const t=e.parentElement?.querySelector(".vol-value");t&&(t.textContent=e.value+"%")}if(t){t.value=Math.round(100*volMusic);const e=t.parentElement?.querySelector(".vol-value");e&&(e.textContent=t.value+"%")}if(o){o.value=Math.round(100*volSfx);const e=o.parentElement?.querySelector(".vol-value");e&&(e.textContent=o.value+"%")}}loadAudioSettings();const TOAST_STATE={container:null,activeToasts:[],nextId:0};function initToastContainer(){if(TOAST_STATE.container)return;let e=document.getElementById("toast-container");if(!e){e=document.createElement("div"),e.id="toast-container";(document.getElementById("game-container")||document.body).appendChild(e)}TOAST_STATE.container=e}function calculateToastDuration(e){const t=e.replace(/<[^>]*>/g,"").split(/\s+/).filter(e=>e.length>0).length;return Math.min(2e3+500*t,1e4)}function getToastIcon(e){switch(e){case"success":return icon("sparkle");case"error":return icon("skull");case"warning":return icon("lightning");default:return icon("coin")}}function removeToast(e){const t=parseInt(e.dataset.toastId);TOAST_STATE.activeToasts=TOAST_STATE.activeToasts.filter(e=>e.id!==t),e.classList.add("hiding"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},RHYTHM.HALF)}function showToast(e,t,o="OK",n=null,s="info"){initToastContainer();const a=TOAST_STATE.nextId++,i=document.createElement("div");i.className=`toast ${s}`,i.dataset.toastId=a;const r=getToastIcon(s);i.innerHTML=`\n    <div class="toast-content">\n      <div class="toast-icon">${r}</div>\n      <div class="toast-body">\n        ${e?`<div class="toast-title">${e}</div>`:""}\n        <div class="toast-msg">${t}</div>\n        ${o?`<button class="toast-btn">${o}</button>`:""}\n      </div>\n    </div>\n  `,TOAST_STATE.container.appendChild(i),TOAST_STATE.activeToasts.push({id:a,element:i}),requestAnimationFrame(()=>{i.classList.add("show")});const l=i.querySelector(".toast-btn");return l&&(l.onclick=e=>{e.stopPropagation(),removeToast(i),n&&n()}),i.onclick=()=>{l&&l.click()},i}function applyChromaticToWord(e,t,o=!1){const n=document.querySelectorAll(".chip");let s,a=null,i=null;if(n.forEach(t=>{const o=t.querySelector(".chip-name");o&&o.textContent===e.name&&(i||(i=t),a=t)}),o&&i&&(a=i),!a)return;s=o&&"copy"===t?"chromatic-copy-source":"transform"===t?"chromatic-transform":"upgrade"===t?"chromatic-upgrade":"copy"===t?"chromatic-copy":"chromatic-generate",a.classList.add("chromatic-word",s);setTimeout(()=>{a.classList.remove("chromatic-word",s)},o?600:800)}function showQuickToast(e,t=null,o="info"){initToastContainer(),t||(t=calculateToastDuration(e));const n=TOAST_STATE.nextId++,s=document.createElement("div");s.className=`toast ${o}`,s.dataset.toastId=n;const a=getToastIcon(o);s.innerHTML=`\n    <div class="toast-content">\n      <div class="toast-icon">${a}</div>\n      <div class="toast-body">\n        <div class="toast-msg">${e}</div>\n      </div>\n    </div>\n    <div class="toast-progress" style="width: 100%"></div>\n  `,TOAST_STATE.container.appendChild(s),TOAST_STATE.activeToasts.push({id:n,element:s}),requestAnimationFrame(()=>{s.classList.add("show");const e=s.querySelector(".toast-progress");e&&setTimeout(()=>{e.style.transition=`width ${t}ms linear`,e.style.width="0%"},100)}),s.onclick=()=>{i&&clearTimeout(i),removeToast(s)};const i=setTimeout(()=>{removeToast(s)},t+100);return s}function preWarmGame(){performance.now();const e=document.createElement("div");e.style.cssText="position:absolute;left:-9999px;visibility:hidden",document.body.appendChild(e);const t={id:"warmup",name:"Warmup",type:"elemental",elem:0,rarity:1};for(let o=0;o<5;o++){const o=mkChip(t,!1,!1);e.appendChild(o)}e.offsetHeight,e.remove(),_lastBankState={hasItem:!1,hasNoun:!1},void 0!==sparkManager&&sparkManager&&sparkManager.init&&sparkManager.init(),void 0!==blacksmithEmberManager&&blacksmithEmberManager&&blacksmithEmberManager.init&&blacksmithEmberManager.init()}async function preloadAllSystems(e){const t=performance.now(),o=[];let n=0,s=0;const a=t=>{n++,e&&e(n,s,t)};blacksmithEmberManager||(blacksmithEmberManager=new BlacksmithEmberManager,blacksmithEmberManager.init()),void 0!==sparkManager&&sparkManager&&sparkManager.init&&sparkManager.init();if(["insert sword bow type.ogg","insert bow type.ogg","insert blunt.ogg","insert wand sound.ogg","gem.ogg","rarity.ogg","highlight word.ogg","click.ogg","click alt.ogg","buy_crate.ogg"].forEach(e=>{s++,o.push(loadSample(e).then(()=>a(`HTML Audio: ${e}`)).catch(()=>a(`HTML Audio: ${e} (failed)`)))}),"file:"!==window.location.protocol){let e=null;try{e=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.warn("[PRELOAD] Could not create AudioContext for pre-decoding")}if(e){["insert sword bow type.ogg","insert bow type.ogg","insert blunt.ogg","insert wand sound.ogg","gem.ogg","rarity.ogg","highlight word.ogg","fire-element.ogg","water-element.ogg","lightning-element.ogg","holy-element.ogg","dark-element.ogg","earth-element.ogg","poison-element.ogg","physical-element.ogg"].forEach(t=>{s++,o.push(fetch(`sfx/${t}`).then(e=>e.arrayBuffer()).then(t=>e.decodeAudioData(t)).then(e=>{audioBufferCache[t]=e,a(`Web Audio: ${t}`)}).catch(()=>a(`Web Audio: ${t} (failed)`)))})}}s++,o.push(new Promise(e=>{const t=document.createElement("div");t.style.cssText="position:absolute;left:-9999px;opacity:0;pointer-events:none",document.body.appendChild(t);for(let e=0;e<5;e++){const e=document.createElement("div");e.className="chip",e.style.willChange="transform, opacity",e.innerHTML='<div class="chip-name">Warmup</div>',t.appendChild(e)}t.offsetHeight;const o=t.querySelectorAll(".chip");let n=0;o.forEach((s,i)=>{s.animate([{opacity:0,transform:"translateX(-20px) scale(0.8)"},{opacity:1,transform:"translateX(0) scale(1.05)"},{opacity:1,transform:"translateX(0) scale(1)"}],{duration:60,delay:10*i,fill:"forwards"}).onfinish=()=>{n++,n===o.length&&(t.remove(),a("GPU layers + animations"),e())}})})),s++,o.push(new Promise(e=>{preWarmGame(),a("Chip factory"),e()})),s++,o.push(new Promise(e=>{const t=document.createElement("div");t.id="warmup-forge",t.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none;width:1920px;height:1080px",t.innerHTML='\n      <div id="warmup-bank" style="display:flex;gap:8px"></div>\n      <div id="warmup-slots" style="display:flex;gap:8px">\n        <div class="slot" data-slot="adj1"></div>\n        <div class="slot" data-slot="item"></div>\n        <div class="slot" data-slot="noun1"></div>\n      </div>\n    ',document.body.appendChild(t);const o=t.querySelector("#warmup-bank"),n=t.querySelectorAll(".slot"),s=new Map;[{id:"warmup1",name:"Fiery",type:"elemental",elem:2,rarity:1},{id:"warmup2",name:"Sword",type:"weapon",category:"slash",rarity:1},{id:"warmup3",name:"Power",type:"elemental",elem:0,rarity:1}].forEach((e,t)=>{const n=mkChip(e,!1,!1);n.dataset.wordId=e.id,n.style.willChange="transform, opacity",o.appendChild(n);const a=n.getBoundingClientRect();s.set(e.id,{left:a.left,top:a.top})}),t.offsetHeight;const i=o.querySelectorAll(".chip");i.forEach((e,t)=>{n[t]?.appendChild(e)}),i.forEach((e,t)=>{const o=s.get(e.dataset.wordId);if(o){const t=e.getBoundingClientRect(),n=o.left-t.left,s=o.top-t.top;e.animate([{transform:`translate(${n}px, ${s}px)`,opacity:1},{transform:"translate(0, 0)",opacity:1}],{duration:100,fill:"forwards"})}}),blacksmithEmberManager&&blacksmithEmberManager.burst(-9999,-9999,5,["#ff9933"],!1),setTimeout(()=>{t.remove(),a("Full placement simulation"),e()},150)})),await Promise.all(o);return performance.now()-t}function initAudio(){if(audioCtx)return;audioCtx=new(window.AudioContext||window.webkitAudioContext),masterGain=audioCtx.createGain(),masterGain.gain.value=.8,delayNode=audioCtx.createDelay(),delayNode.delayTime.value=.12,delayGain=audioCtx.createGain(),delayGain.gain.value=.2,delayNode.connect(delayGain),delayGain.connect(delayNode),delayNode.connect(masterGain),masterGain.connect(audioCtx.destination),initAudioPool("click.ogg"),initAudioPool("click alt.ogg"),initHoverSoundPool();try{const e=audioCtx.createBuffer(1,1,audioCtx.sampleRate),t=audioCtx.createBufferSource();t.buffer=e;const o=audioCtx.createGain();o.gain.value=0;const n=audioCtx.createStereoPanner();n.pan.value=0,t.connect(o),o.connect(n),n.connect(audioCtx.destination),t.start(),t.stop(audioCtx.currentTime+.001)}catch(e){}["insert sword bow type.ogg","insert bow type.ogg","insert blunt.ogg","insert wand sound.ogg","gem.ogg","rarity.ogg","highlight word.ogg","fire-element.ogg","water-element.ogg","lightning-element.ogg","holy-element.ogg","dark-element.ogg","earth-element.ogg","poison-element.ogg","physical-element.ogg"].forEach(e=>{audioBufferCache[e]||"file:"===window.location.protocol||fetch(`sfx/${e}`).then(e=>e.arrayBuffer()).then(e=>audioCtx.decodeAudioData(e)).then(t=>{audioBufferCache[e]=t}).catch(()=>{})}),document.addEventListener("mousemove",e=>{window.lastMouseX=e.clientX})}function playTone(e,t=.25,o="triangle",n=.18){if(!audioOn)return;audioCtx||initAudio();const s=audioCtx.createOscillator(),a=audioCtx.createGain();s.type=o,s.frequency.value=e;const i=audioCtx.currentTime;a.gain.setValueAtTime(1e-4,i),a.gain.exponentialRampToValueAtTime(n,i+.02),a.gain.exponentialRampToValueAtTime(.6*n,i+.4*t),a.gain.exponentialRampToValueAtTime(1e-4,i+t),s.connect(a),a.connect(masterGain),a.connect(delayNode),s.start(i),s.stop(i+t+.05)}function playBrassTone(e,t=.3,o=.12){if(!audioOn)return;audioCtx||initAudio();const n=audioCtx.currentTime,s=[],a=[];for(let i=0;i<3;i++){const r=audioCtx.createOscillator(),l=audioCtx.createGain();r.type="sawtooth",r.frequency.value=e,r.detune.value=15*(i-1),l.gain.setValueAtTime(1e-4,n),l.gain.exponentialRampToValueAtTime(o/3,n+.02),l.gain.setValueAtTime(o/3*.8,n+.3*t),l.gain.exponentialRampToValueAtTime(1e-4,n+t+.4),r.connect(l),l.connect(masterGain),l.connect(delayNode),r.start(n),r.stop(n+t+.5),s.push(r),a.push(l)}}function playSfxOpen(){playBrassTone(494,.08,.06)}function playSfxBack(){playBrassTone(330,.08,.05)}function playSfxInvalid(){playBrassTone(311.13,.06,.04)}function playSfxSkillUp(){if(!audioOn)return;audioCtx||initAudio();const e=audioCtx.currentTime;[659.25,987.77,1318.51].forEach((t,o)=>{const n=audioCtx.createOscillator(),s=audioCtx.createGain();n.type="triangle",n.frequency.value=t;const a=e+.06*o;s.gain.setValueAtTime(1e-4,a),s.gain.exponentialRampToValueAtTime(.08,a+.01),s.gain.exponentialRampToValueAtTime(.048,a+.08),s.gain.exponentialRampToValueAtTime(1e-4,a+.25),n.connect(s),s.connect(masterGain),n.start(a),n.stop(a+.3)})}function stopRarityDrone(){}function stopAllRarityDrones(){}function playRarityDrone(){}const MAGIC_SCALE_SEMITONES=[0,3,5,7,10],MAGIC_BASE_FREQ=330;function playMagicParseTone(e,t,o){if(!audioOn)return;audioCtx||initAudio();const n=e%MAGIC_SCALE_SEMITONES.length,s=Math.floor(e/MAGIC_SCALE_SEMITONES.length),a=MAGIC_SCALE_SEMITONES[n]+12*s;playBrassTone(330*Math.pow(2,a/12),o?.35:.28,o?.14:.1)}function playShepardTone(e,t,o){if(!audioOn)return;audioCtx||initAudio();const n=MAGIC_SCALE_SEMITONES[e%MAGIC_SCALE_SEMITONES.length],s=e%15/15,a=330*Math.pow(2,n/12),i=o?.3:.25,r=o?.12:.09;[-1,0,1].forEach(e=>{const t=a*Math.pow(2,e),o=(s+(e+1)/3)%1,n=Math.pow(Math.cos((o-.5)*Math.PI),2),l=r*n;l>.01&&playBrassTone(t,i,l)})}function loadSample(e){return sampleCache[e]?Promise.resolve(sampleCache[e]):new Promise((t,o)=>{const n=new Audio(`sfx/${e}`);n.addEventListener("canplaythrough",()=>{sampleCache[e]=n,t(n)},{once:!0}),n.addEventListener("error",t=>{console.warn(`Failed to load sample: ${e}`,t),o(t)}),n.load()})}const audioPools={},poolIndices={};function initAudioPool(e,t=3){audioPools[e]||(audioPools[e]=[],poolIndices[e]=0,loadSample(e).then(o=>{for(let n=0;n<t;n++){const t=o.cloneNode();t.preload="auto",audioPools[e].push(t)}}).catch(()=>{}))}function playSamplePooled(e,t=.9){if(!audioOn)return;if(!audioPools[e])return initAudioPool(e),void playSample(e,t);const o=audioPools[e];if(0===o.length)return void playSample(e,t);const n=poolIndices[e],s=o[n];poolIndices[e]=(n+1)%o.length,s.currentTime=0,s.volume=.8*t,s.play().catch(e=>console.warn("Pooled play failed:",e))}function playSample(e,t=.9,o=0){if(!audioOn)return;if(0!==o&&audioCtx)return void playSamplePanned(e,t,o);const n=e=>{if(!e)return;const o=e.cloneNode();o.volume=.8*t,o.play().catch(e=>console.warn("Play failed:",e))};sampleCache[e]?n(sampleCache[e]):loadSample(e).then(n).catch(()=>{})}const audioBufferCache={};async function playSamplePanned(e,t=.9,o=0){if(audioOn&&audioCtx){if("file:"===window.location.protocol){const o=e=>{if(!e)return;const o=e.cloneNode();o.volume=.8*t,o.play().catch(()=>{})};return void(sampleCache[e]?o(sampleCache[e]):loadSample(e).then(o).catch(()=>{}))}try{if(!audioBufferCache[e]){const t=await fetch(`sfx/${e}`),o=await t.arrayBuffer();audioBufferCache[e]=await audioCtx.decodeAudioData(o)}const n=audioBufferCache[e];if(!n)return;const s=audioCtx.createBufferSource();s.buffer=n;const a=audioCtx.createGain();a.gain.value=.8*t;const i=audioCtx.createStereoPanner();i.pan.value=Math.max(-1,Math.min(1,o)),s.connect(a),a.connect(i),i.connect(audioCtx.destination),s.start()}catch(o){console.warn("Panned playback failed, falling back:",o);const n=e=>{if(!e)return;const o=e.cloneNode();o.volume=.8*t,o.play().catch(()=>{})};sampleCache[e]?n(sampleCache[e]):loadSample(e).then(n).catch(()=>{})}}}async function playSampleWithReverb(e,t=.9){if(audioOn&&audioCtx&&"file:"!==window.location.protocol)try{if(!audioBufferCache[e]){const t=await fetch(`sfx/${e}`),o=await t.arrayBuffer();audioBufferCache[e]=await audioCtx.decodeAudioData(o)}const o=audioBufferCache[e];if(!o)return;const n=audioCtx.createBufferSource();n.buffer=o;const s=audioCtx.createGain();s.gain.value=.7*t,n.connect(s),s.connect(audioCtx.destination);const a=[.35,.25,.18,.12];[.08,.16,.28,.42].forEach((e,n)=>{const s=audioCtx.createBufferSource();s.buffer=o;const i=audioCtx.createDelay();i.delayTime.value=e;const r=audioCtx.createGain();r.gain.value=t*a[n],s.connect(i),i.connect(r),r.connect(audioCtx.destination),s.start()}),n.start()}catch(o){playSample(e,t)}else playSample(e,t)}function getSlotPan(e){return{adj1:-.5,adj2:-.25,item:0,adj3:.25,adj4:.5,noun1:0}[e]||0}function getMousePan(){return(window.lastMouseX||window.innerWidth/2)/window.innerWidth*2-1}let hoverPitchIndex=0,lastHoverTime=0;const hoverSoundPool={buffers:[],currentIndex:0,poolSize:3,initialized:!1};function initHoverSoundPool(){if(hoverSoundPool.initialized||!audioCtx)return;const e=.08*audioCtx.sampleRate;for(let t=0;t<hoverSoundPool.poolSize;t++){const t=audioCtx.createBuffer(1,e,audioCtx.sampleRate),o=t.getChannelData(0);for(let t=0;t<e;t++)o[t]=(2*Math.random()-1)*Math.exp(-t/(.3*e));hoverSoundPool.buffers.push(t)}hoverSoundPool.initialized=!0}let lastMouseX=0;function playPageFlipSound(){if(!audioOn)return;audioCtx||initAudio(),hoverSoundPool.initialized||initHoverSoundPool();const e=audioCtx.currentTime,t=Date.now();t-lastHoverTime>500&&(hoverPitchIndex=0),lastHoverTime=t;const o=hoverSoundPool.buffers[hoverSoundPool.currentIndex];hoverSoundPool.currentIndex=(hoverSoundPool.currentIndex+1)%hoverSoundPool.poolSize;const n=audioCtx.createBufferSource();n.buffer=o;const s=audioCtx.createBiquadFilter();s.type="highpass";const a=Math.min(hoverPitchIndex,5);s.frequency.value=1200+150*a,s.Q.value=1,hoverPitchIndex++;const i=a/5*.03,r=.02*(Math.random()-.5),l=Math.max(.12,.15-i+r),c=audioCtx.createStereoPanner(),d=window.innerWidth||1920,p=.4*(lastMouseX/d*2-1);c.pan.value=Math.max(-1,Math.min(1,p));const f=audioCtx.createGain(),u=.015+.003*a,h=.06-.008*a,m=u+Math.max(h,.03);f.gain.setValueAtTime(1e-4,e),f.gain.exponentialRampToValueAtTime(l,e+u),f.gain.exponentialRampToValueAtTime(.4*l,e+u+.5*h),f.gain.exponentialRampToValueAtTime(1e-4,e+m),n.connect(s),s.connect(c),c.connect(f),f.connect(masterGain),n.start(e),n.stop(e+m+.02)}function sfxHover(){playPageFlipSound()}function sfxClick(){playTone(330,.08,"sine",.12),setTimeout(()=>playTone(494,.12,"sine",.1),RHYTHM.EIGHTH)}function sfxWin(){[330,392,494,659].forEach((e,t)=>setTimeout(()=>playTone(e,.4,"sine",.25),t*RHYTHM.QUARTER))}function sfxLose(){[330,294,247,165].forEach((e,t)=>setTimeout(()=>playTone(e,.35,"sine",.15),t*RHYTHM.HALF))}document.addEventListener("mousemove",e=>{lastMouseX=e.clientX});let talkSynth=null,talkPanner=null,currentDialogueSession=null;function cancelDialogueSession(){currentDialogueSession&&(currentDialogueSession.canceled=!0,currentDialogueSession.timers.forEach(e=>clearTimeout(e)),currentDialogueSession.resolvers.forEach(e=>{try{e()}catch(e){}}),currentDialogueSession.timers=[],currentDialogueSession.resolvers=[],currentDialogueSession=null)}function startDialogueSession(){return cancelDialogueSession(),currentDialogueSession={canceled:!1,timers:[],resolvers:[]},currentDialogueSession}function scheduleDialogueTimeout(e,t,o){if(!e||e.canceled)return;const n=setTimeout(()=>{s(),e.canceled||t()},o),s=()=>{e.timers=e.timers.filter(e=>e!==n)};return e.timers.push(n),n}function dialogueDelay(e,t){return new Promise(o=>{if(!e||e.canceled)return void o();const n=setTimeout(()=>{s(),e.canceled||o()},t),s=()=>{e.timers=e.timers.filter(e=>e!==n),e.resolvers=e.resolvers.filter(e=>e!==o)};e.timers.push(n),e.resolvers.push(o)})}function playTalkSound(e="hero"){if(!audioOn)return;if("undefined"!=typeof Tone&&!talkSynth)try{talkPanner=new Tone.Panner(0).toDestination(),talkSynth=new Tone.Synth({oscillator:{type:"sine"},envelope:{attack:.01,decay:.08,sustain:.02,release:.05}}).connect(talkPanner),talkSynth.volume.value=-12}catch(e){}talkPanner&&(talkPanner.pan.value="hero"===e?-.7:.7);const t="hero"===e?["E4","G4","A4","B4","D5"]:["E3","G3","A3","B3","D4"],o=3+Math.floor(3*Math.random()),n=Tone.now?Tone.now():0;for(let s=0;s<o;s++){const o=t[Math.floor(Math.random()*t.length)],a=n+.07*s;if(talkSynth&&talkSynth.triggerAttackRelease)try{talkSynth.triggerAttackRelease(o,"32n",a)}catch(e){}else if(audioCtx){const t="hero"===e?-.7:.7;setTimeout(()=>{playTone({E3:165,G3:196,A3:220,B3:247,D4:294,E4:330,G4:392,A4:440,B4:494,D5:587}[o]||330,.06,"sine",.12,t)},70*s)}}}function stopTalkSound(){if(talkSynth)try{talkSynth.triggerRelease()}catch(e){}}function sfxCrateTier(e){if(!e||!e.length)return void playSample("buy_crate.ogg",.9);const t=Math.max(...e.map(e=>e.rarity||0));t>=3?(playTone(165,.15,"sawtooth",.2),setTimeout(()=>playTone(247,.15,"sawtooth",.18),RHYTHM.EIGHTH),setTimeout(()=>playTone(330,.2,"sawtooth",.22),RHYTHM.QUARTER),setTimeout(()=>playTone(494,.3,"sine",.25),RHYTHM.HALF)):t>=2?(playTone(247,.12,"triangle",.18),setTimeout(()=>playTone(392,.18,"triangle",.2),RHYTHM.QUARTER)):(playTone(165,.1,"sine",.15),setTimeout(()=>playTone(196,.08,"sine",.1),RHYTHM.EIGHTH))}const MUSIC_LOOPS=["bass","dark_counter","earth_drum","fire_r_guitar","light_strings","lightning_snare","physical_main","poison_percussion","water_piano"],MUSIC_LOOP_BARS=16,MUSIC_LOOP_BPM=136,ELEMENT_TO_LOOP={[E.PHYS]:"physical_main",[E.POISON]:"poison_percussion",[E.FIRE]:"fire_r_guitar",[E.WATER]:"water_piano",[E.LIGHT]:"light_strings",[E.DARK]:"dark_counter",[E.EARTH]:"earth_drum",[E.LIGHTNING]:"lightning_snare"};function safeRampTo(e,t,o){try{if(e&&"function"==typeof e.rampTo){const n=Math.max(.001,o);e.rampTo(t,n)}}catch(o){e&&void 0!==e.value&&(e.value=t),o.message?.includes("Value must be within")||console.warn("Tone.js rampTo error:",o)}}function fadeHtmlAudio(e,t,o=.35){if(!e)return;const n=e.volume,s=t-n,a=performance.now(),i=Math.max(10,1e3*o),r=t=>{const o=Math.min(1,(t-a)/i);e.volume=Math.min(1,Math.max(0,n+s*o)),o<1&&requestAnimationFrame(r)};requestAnimationFrame(r)}class MusicEngine{constructor(){this.initialized=!1,this.playing=!1,this.loopKeys=MUSIC_LOOPS,this.masterGain=null,this.shopLowPass=null,this.shopHighPass=null,this.shopReverb=null,this.effectBus=null,this.players={},this.gains={},this.playersReady=null,this._starting=!1,this.activeLoops=new Set,this._lastNeededKey="",this._startTime=0,this.inShopMode=!1,this.normalBpm=136,this.isElectron="undefined"!=typeof window&&window.electronAudio&&window.electronAudio.isElectron,this.useHtmlFallback=!this.isElectron&&"undefined"!=typeof window&&window.location&&"file:"===window.location.protocol,this.entries={},this.desired={}}getTargetGain(){return("number"==typeof volMaster?volMaster:1)*("number"==typeof volMusic?volMusic:.8)}async init(){if(!this.initialized){if(this.useHtmlFallback){const e=60/136*4*16;return this.loopKeys.forEach(t=>{const o=()=>{const e=new Audio(`sfx/loops/${t}.ogg`);return e.loop=!1,e.preload="auto",e.volume=0,e},n=o(),s=o(),a={audios:[n,s],active:0,desired:"bass"===t?.9:0,timer:null,duration:e},i=()=>{const e=n.duration||s.duration;e&&e>0&&(a.duration=e)};n.addEventListener("loadedmetadata",i),s.addEventListener("loadedmetadata",i),this.entries[t]=a}),void(this.initialized=!0)}try{await Tone.start(),this.masterGain=new Tone.Gain(this.getTargetGain()).toDestination(),this.shopLowPass=new Tone.Filter({frequency:2e4,type:"lowpass",rolloff:-24}).connect(this.masterGain),this.shopHighPass=new Tone.Filter({frequency:20,type:"highpass",rolloff:-24}).connect(this.shopLowPass),this.isElectron?(this.shopReverb=null,this.effectBus=new Tone.Gain(1).connect(this.shopHighPass)):(this.shopReverb=new Tone.Reverb({decay:1.2,wet:0,preDelay:.02}),await this.shopReverb.generate(),this.shopReverb.connect(this.shopHighPass),this.effectBus=new Tone.Gain(1).connect(this.shopReverb));const e="wav",t="wav/";for(const o of this.loopKeys){const n=`sfx/loops/${t}${o}.${e}`,s=new Tone.Player({url:n,loop:!0,autostart:!1}),a=new Tone.Gain("bass"===o?.9:0).connect(this.effectBus);s.connect(a),this.players[o]=s,this.gains[o]=a}this.playersReady=Tone.loaded(),this.initialized=!0}catch(e){}}}startEntry(e,t){if(!e)return;const o=e.audios[e.active];try{o.currentTime=0}catch(e){}o.volume=(e.desired||0)*t,o.play().catch(()=>{}),this.scheduleCrossfade(e,t)}scheduleCrossfade(e,t){if(!e)return;e.timer&&clearTimeout(e.timer);const o=e.duration||60/136*4*16,n=Math.max(50,1e3*o-10);e.timer=setTimeout(()=>this.crossfadeEntry(e,t),n)}crossfadeEntry(e,t){const o=e.active,n=0===o?1:0,s=e.audios[o],a=e.audios[n];try{a.currentTime=0}catch(e){}a.volume=0,a.play().catch(()=>{}),fadeHtmlAudio(a,(e.desired||0)*t,.05),fadeHtmlAudio(s,0,.05),setTimeout(()=>{try{s.pause(),s.currentTime=0}catch(e){}},RHYTHM.EIGHTH),e.active=n,this.scheduleCrossfade(e,t)}async start(){if(this._starting)return;if(this.initialized||(this._starting=!0,await this.init(),this._starting=!1),!this.initialized||this.playing)return;if(this.useHtmlFallback){const e=this.getTargetGain();return this.loopKeys.forEach(t=>this.startEntry(this.entries[t],e)),this._startTime=performance.now(),this.setLoopActive("bass",!0),void(this.playing=!0)}this.playersReady&&await this.playersReady,Tone.Transport.bpm.value=136,Tone.Transport.loop=!1;const e=Tone.now()+.1;this.loopKeys.forEach(t=>{const o=this.players[t];if(o)try{o.start(e)}catch(e){}}),Tone.Transport.start(),this._startTime=Tone.Transport.seconds,this.setLoopActive("bass",!0),this.playing=!0}_resyncLoop(){if(!this.isElectron||!this.electronAudios||!this.playing)return;const e=this.loopDuration,t=(performance.now()-this._startTime)/1e3%e;Object.values(this.electronAudios).forEach(o=>{if(o.paused)return;const n=Math.abs(o.currentTime-t);n>.05&&n<e-.05&&(o.currentTime=t)}),setTimeout(()=>this._resyncLoop(),RHYTHM.BEAT)}stop(){if(this._starting=!1,this.playing=!1,this.useHtmlFallback)return Object.values(this.entries).forEach(e=>{e.timer&&clearTimeout(e.timer),e.timer=null,e.audios.forEach(e=>{try{e.pause(),e.currentTime=0}catch(e){}})}),void this.activeLoops.clear();try{Tone.Transport.stop(),Tone.Transport.position=0}catch(e){}Object.values(this.players).forEach(e=>{try{e.stop(),e.unsync()}catch(e){}}),this.activeLoops.clear(),this.inShopMode=!1,Tone.Transport.swing=0,Tone.Transport.bpm.value=this.normalBpm,this.shopLowPass&&(this.shopLowPass.frequency.value=2e4),this.shopHighPass&&(this.shopHighPass.frequency.value=20),this.shopReverb&&(this.shopReverb.wet.value=0)}pause(){this.stop()}setMuted(e){if(this.useHtmlFallback){const t=e?0:this.getTargetGain();return void Object.keys(this.entries).forEach(e=>{const o=this.entries[e];o&&o.audios.forEach(e=>{e.volume=(o.desired||0)*t})})}this.masterGain&&safeRampTo(this.masterGain.gain,e?0:this.getTargetGain(),.1)}getForgeElements(e){const t=new Set,o=e?.sel||{};return[o.item,o.adj1,o.adj2,o.adj3,o.adj4,o.noun1].forEach(e=>{e&&void 0!==e.elem&&t.add(e.elem)}),t}setLoopActive(e,t){if(this.useHtmlFallback){const o=this.entries[e];if(!o)return void(t?this.activeLoops.add(e):this.activeLoops.delete(e));o.desired=t?.95:0;const n=this.getTargetGain();return o.audios.forEach((e,s)=>{s===o.active?fadeHtmlAudio(e,o.desired*n,t?.25:.2):e.volume=o.desired*n}),void(t?this.activeLoops.add(e):this.activeLoops.delete(e))}const o=this.gains[e];if(!o)return void(t?this.activeLoops.add(e):this.activeLoops.delete(e));const n=(t?.95:0)*this.getTargetGain();safeRampTo(o.gain,n,t?.2:.15),t?this.activeLoops.add(e):this.activeLoops.delete(e)}updateLayers(e){if(!this.initialized||!this.playing)return;const t=this.getForgeElements(e),o=new Set(["bass"]);t.forEach(e=>{const t=ELEMENT_TO_LOOP[e];t&&o.add(t)});const n=[...o].sort().join(",");this._lastNeededKey!==n&&(this._lastNeededKey=n,o.forEach(e=>{this.activeLoops.has(e)||this.setLoopActive(e,!0)}),[...this.activeLoops].forEach(e=>{o.has(e)||"bass"===e||this.setLoopActive(e,!1)}))}resetToBassOnly(){this.initialized&&(this.loopKeys.forEach(e=>{if("bass"===e)this.setLoopActive(e,!0);else{if(this.useHtmlFallback){const t=this.entries[e];t&&(t.desired=0,t.audios.forEach(e=>{e.volume=0}))}else{const t=this.gains[e];t&&(t.gain.value=0)}this.activeLoops.delete(e)}}),this.activeLoops.add("bass"),this._lastNeededKey="bass",this.useHtmlFallback||(this.loopKeys.forEach(e=>{const t=this.players[e];t&&(t.playbackRate=1)}),this.shopLowPass&&(this.shopLowPass.frequency.value=2e4),this.masterGain&&(this.masterGain.gain.value=this.getTargetGain())))}_animatePlaybackRate(e,t){const o=performance.now(),n={};this.loopKeys.forEach(e=>{const t=this.players[e];t&&(n[e]=t.playbackRate)});const s=()=>{const a=(performance.now()-o)/1e3,i=Math.min(1,a/t),r=1-Math.pow(1-i,2);this.loopKeys.forEach(t=>{const o=this.players[t];o&&void 0!==n[t]&&(o.playbackRate=n[t]+(e-n[t])*r)}),i<1&&requestAnimationFrame(s)};requestAnimationFrame(s)}enterShopMode(){this.inShopMode||(this.inShopMode=!0,this.useHtmlFallback||(this.shopHighPass&&safeRampTo(this.shopHighPass.frequency,200,.5),this.shopLowPass&&safeRampTo(this.shopLowPass.frequency,4e3,.5),this.shopReverb&&safeRampTo(this.shopReverb.wet,.35,.5),this.masterGain&&safeRampTo(this.masterGain.gain,.85*this.getTargetGain(),.5)))}exitShopMode(){this.inShopMode&&(this.inShopMode=!1,this.useHtmlFallback||(this.masterGain&&safeRampTo(this.masterGain.gain,.3*this.getTargetGain(),.15),this.shopHighPass&&safeRampTo(this.shopHighPass.frequency,20,.6),setTimeout(()=>{this.shopLowPass&&safeRampTo(this.shopLowPass.frequency,2e4,.8)},150),this.shopReverb&&safeRampTo(this.shopReverb.wet,0,.7),setTimeout(()=>{this.masterGain&&safeRampTo(this.masterGain.gain,this.getTargetGain(),.5)},200)))}triggerLoseEffect(){if(this.initialized&&this.playing)if(this.useHtmlFallback)this.loopKeys.forEach(e=>this.setLoopActive(e,!1)),setTimeout(()=>this.stop(),RHYTHM.BEAT);else{const e=2,t=performance.now(),o=1,n=.05;this.shopLowPass&&safeRampTo(this.shopLowPass.frequency,150,e),this.masterGain&&safeRampTo(this.masterGain.gain,0,.9*e);const s=()=>{const a=(performance.now()-t)/1e3,i=Math.min(1,a/e),r=1-Math.pow(1-i,4),l=o-(o-n)*r;this.loopKeys.forEach(e=>{const t=this.players[e];t&&(t.playbackRate=Math.max(.01,l))}),i<1&&requestAnimationFrame(s)};requestAnimationFrame(s),setTimeout(()=>{this.loopKeys.forEach(e=>{const t=this.players[e];t&&(t.playbackRate=1)}),this.shopLowPass&&(this.shopLowPass.frequency.value=2e4),this.shopHighPass&&(this.shopHighPass.frequency.value=20),this.masterGain&&(this.masterGain.gain.value=this.getTargetGain()),this.stop()},1e3*e+100)}}async triggerVictoryEffect(){if(!this.initialized)return;this.playing||await this.start();let e=0;this.loopKeys.forEach(t=>{"bass"!==t&&(setTimeout(()=>{this.activeLoops.has(t)||this.setLoopActive(t,!0)},e),e+=150)}),this._lastNeededKey=this.loopKeys.join(",")}getBeatProgress(){if(!this.initialized||!this.playing)return 0;if(this.useHtmlFallback){const e=this.entries.bass,t=e?.audios?.[e.active||0];if(!t||!t.duration)return 0;const o=t.currentTime%t.duration,n=60/136*4;return Math.min(1,Math.max(0,o%n/n))}try{const e=Tone.Transport.position,[t,o,n]=e.split(":").map(parseFloat),s=(o+n/4)/4;return Math.min(1,Math.max(0,s))}catch(e){return 0}}getBeatInfo(){if(!this.initialized||!this.playing)return{beat:0,progress:0,totalBeats:0};const e=60/136;let t=0;if(this.useHtmlFallback){const e=this.entries.bass,o=e?.audios?.[e.active||0];if(!o||!o.duration)return{beat:0,progress:0,totalBeats:0};t=o.currentTime}else try{t=Tone.Transport.seconds}catch(e){return{beat:0,progress:0,totalBeats:0}}const o=t/e;return{beat:Math.floor(o)%4,progress:o%1,totalBeats:o}}}let musicEngine=null;function getMusicEngine(){return musicEngine||(musicEngine=new MusicEngine),musicEngine}async function waitForNextBeat(){const e=musicEngine;if(!e||!e.playing)return;const{progress:t}=e.getBeatInfo(),o=(1-t)*RHYTHM.BEAT;o>.2*RHYTHM.BEAT&&o<.95*RHYTHM.BEAT&&await dly(o)}async function waitForNextQuarterBeat(){const e=musicEngine;if(!e||!e.playing)return;const{progress:t}=e.getBeatInfo(),o=4*t,n=(Math.ceil(o)-o)/4*RHYTHM.BEAT;n>.05*RHYTHM.BEAT&&n<.24*RHYTHM.BEAT&&await dly(n)}async function ensureMusicStarted(){try{"undefined"!=typeof Tone&&Tone.context&&"running"!==Tone.context.state&&await Tone.start();const e=getMusicEngine();e.initialized||await e.init(),e.setMuted(!audioOn),e.playing||e.start(),startSlotBounce()}catch(e){console.warn("Music engine failed to start:",e)}}const $=e=>document.querySelector(e),$$=e=>document.querySelectorAll(e),escapeHtml=e=>String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]||e));let slotBounceAnimationId=null,lastBouncedBeat=-1;function getFilledSlots(){const e=[];return["adj1","adj2","item","adj3","adj4","noun1"].forEach(t=>{if(S.sel&&S.sel[t]){const o=document.querySelector(`.slot[data-slot="${t}"]`);o&&e.push({slot:t,element:o})}}),e}function applyBounce(e){e.style.transition="transform 0.06s ease-out",e.style.transform="translateY(-2px)",setTimeout(()=>{e.style.transition="transform 0.1s ease-in",e.style.transform="translateY(0)"},60)}function updateSlotBounce(){if(gfxSettings&&gfxSettings.lowFx)return void(slotBounceAnimationId=requestAnimationFrame(updateSlotBounce));const e=musicEngine;if(!e||!e.playing)return void(slotBounceAnimationId=requestAnimationFrame(updateSlotBounce));const{beat:t,totalBeats:o}=e.getBeatInfo(),n=Math.floor(o);if(n!==lastBouncedBeat){lastBouncedBeat=n;const e=getFilledSlots();if(e.length>0){applyBounce(e[t%e.length].element)}}slotBounceAnimationId=requestAnimationFrame(updateSlotBounce)}function startSlotBounce(){slotBounceAnimationId||(lastBouncedBeat=-1,slotBounceAnimationId=requestAnimationFrame(updateSlotBounce))}function stopSlotBounce(){slotBounceAnimationId&&(cancelAnimationFrame(slotBounceAnimationId),slotBounceAnimationId=null),lastBouncedBeat=-1,document.querySelectorAll(".slot").forEach(e=>{e.style.transform="",e.style.transition=""})}let flipPositions=new Map,justPlacedSlot=null,pendingBankFlip=!1;function recordFlipPositions(e){if(flipPositions.clear(),!e)return;e.querySelectorAll(".chip[data-word-id]").forEach(e=>{const t=e.dataset.wordId,o=e.getBoundingClientRect();flipPositions.set(t,{left:o.left,top:o.top})})}function playFlipAnimation(e){if(!e||0===flipPositions.size)return;const t=e.querySelectorAll(".chip[data-word-id]");t.forEach(e=>{e.style.willChange="transform, opacity"}),t.forEach(e=>{const t=e.dataset.wordId,o=flipPositions.get(t);if(!o){return void(e.animate([{transform:"scale(0.3)",opacity:0},{transform:"scale(1.1)",opacity:1,offset:.6},{transform:"scale(0.97)",opacity:1,offset:.8},{transform:"scale(1)",opacity:1}],{duration:280,easing:"ease-out",fill:"forwards"}).onfinish=()=>{e.style.willChange=""})}const n=e.getBoundingClientRect(),s=o.left-n.left,a=o.top-n.top,i=Math.sqrt(s*s+a*a);if(i<2)return e.style.opacity="",void(e.style.willChange="");const r=Math.abs(a)>25,l=Math.abs(s)>Math.abs(a);let c;c=i<60?180+.8*i:i<150?230+.6*(i-60):290+Math.min(.4*(i-150),100);const d=Math.min(.08+i/600,.18);if(!r&&l){const t=1-.5*d,o=1+.5*d,n=Math.min(.06*i,4);return void(e.animate([{transform:`translate(${s}px, 0) scaleX(1)`,opacity:1,offset:0},{transform:`translate(${.5*s}px, 0) scaleX(${o})`,opacity:1,offset:.4},{transform:`translate(${-n*Math.sign(s)}px, 0) scaleX(${t})`,opacity:1,offset:.75},{transform:"translate(0, 0) scaleX(1)",opacity:1,offset:1}],{duration:c,easing:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fill:"forwards"}).onfinish=()=>{e.style.willChange=""})}const p=l?1-d:1+.7*d,f=l?1+.7*d:1-d,u=l?1+d:1-.5*d,h=l?1-.5*d:1+d,m=Math.min(.08*i,6),y=l?-Math.sign(s)*m:0,g=l?0:-Math.sign(a)*m;e.animate([{transform:`translate(${s}px, ${a}px) scale(1, 1)`,opacity:1,offset:0},{transform:`translate(${s}px, ${a}px) scale(${p}, ${f})`,opacity:1,offset:.12},{transform:`translate(${.35*s}px, ${.35*a}px) scale(${u}, ${h})`,opacity:1,offset:.45},{transform:`translate(${y}px, ${g}px) scale(${.97*u}, ${.97*h})`,opacity:1,offset:.72},{transform:`translate(0, 0) scale(${p}, ${f})`,opacity:1,offset:.88},{transform:"translate(0, 0) scale(1, 1)",opacity:1,offset:1}],{duration:c,easing:"cubic-bezier(0.22, 1, 0.36, 1)",fill:"forwards"}).onfinish=()=>{e.style.willChange=""}}),flipPositions.clear()}function flyToSlot(e,t,o,n,s){if(!e||!t)return void s();const a=e.getBoundingClientRect(),i=t.getBoundingClientRect(),r=i.left+i.width/2-(a.left+a.width/2),l=i.top+i.height/2-(a.top+a.height/2),c=Math.sqrt(r*r+l*l),d=Math.min(40,.15*c),p=e.cloneNode(!0);p.classList.add("flying-chip"),p.style.position="fixed",p.style.left=a.left+"px",p.style.top=a.top+"px",p.style.width=a.width+"px",p.style.height=a.height+"px",p.style.zIndex="10002",p.style.pointerEvents="none",p.style.margin="0",document.body.appendChild(p),e.style.visibility="hidden";const f=Math.min(400,250+.3*c);p.animate([{transform:"translate(0, 0) scale(1) rotate(0deg)",opacity:1,offset:0},{transform:`translate(${.5*r}px, ${.5*l-d}px) scale(1.05) rotate(${r>0?5:-5}deg)`,opacity:1,offset:.5},{transform:`translate(${r}px, ${l}px) scale(0.85) rotate(0deg)`,opacity:1,offset:.85},{transform:`translate(${r}px, ${l}px) scale(0.95) rotate(0deg)`,opacity:.8,offset:1}],{duration:f,easing:"cubic-bezier(0.34, 1.2, 0.64, 1)",fill:"forwards"}),setTimeout(()=>{p.remove(),s()},f)}function showOverlay(e){e&&("string"==typeof e&&(e=document.querySelector(e)),e&&(e.style.display="flex",e.classList.contains("instant-show")?e.classList.add("show"):requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.classList.add("show")})})))}function hideOverlay(e,t=250){e&&("string"==typeof e&&(e=document.querySelector(e)),e&&(e.classList.remove("show"),setTimeout(()=>{e.classList.contains("show")||(e.style.display="none",e.classList.remove("instant-show"))},t)))}function shatterHealthBar(e,t,o){if(!e||gfxSettings.lowFx)return;const n=e.getBoundingClientRect(),s=t/o,a=Math.min(16,Math.max(8,Math.floor(20*s))),i=Math.min(1,s),r=n.width*i,l=s>=1?["#dc2626","#ef4444","#f87171"]:s>=.7?["#ea580c","#f97316","#fb923c"]:["#f59e0b","#fbbf24","#fcd34d"];for(let e=0;e<a;e++){const e=document.createElement("div");e.className="health-shard";const t=n.width-r+Math.random()*r,o=6+10*Math.random(),s=l[Math.floor(Math.random()*l.length)];e.style.left=n.left+t+"px",e.style.top=n.top+Math.random()*n.height+"px",e.style.width=o+"px",e.style.height=o+"px",e.style.background=s,e.style.boxShadow=`0 0 6px ${s}`,e.style.clipPath="polygon(50% 0%, 0% 100%, 100% 100%)";const a=Math.random()*Math.PI*2,i=100+60*Math.random(),c=Math.cos(a)*i,d=Math.sin(a)*i*.7,p=90*(Math.random()-.5);e.animate([{transform:"translate(0, 0) rotate(0deg) scale(1)",opacity:1,offset:0},{transform:`translate(${.5*c}px, ${.5*d}px) rotate(${.5*p}deg) scale(1)`,opacity:1,offset:.1},{transform:`translate(${.75*c}px, ${.75*d}px) rotate(${.75*p}deg) scale(0.95)`,opacity:1,offset:.25},{transform:`translate(${.88*c}px, ${.88*d}px) rotate(${.88*p}deg) scale(0.9)`,opacity:1,offset:.5},{transform:`translate(${.96*c}px, ${.96*d}px) rotate(${.96*p}deg) scale(0.85)`,opacity:.6,offset:.8},{transform:`translate(${c}px, ${d}px) rotate(${p}deg) scale(0.7)`,opacity:0,offset:1}],{duration:1100+300*Math.random(),easing:"linear",fill:"forwards",delay:20*Math.random()}),document.body.appendChild(e),setTimeout(()=>e.remove(),RHYTHM.BAR)}}function initParallax(){const e=document.getElementById("battle-view"),t=(document.getElementById("forge"),(e,t="0.15s")=>{e&&(e.style.transition=`transform ${t} ease-out`,e.style.willChange="transform",e.style.backfaceVisibility="hidden",e.style.transform="translate3d(0, 0, 0)")});if(e){const o=e.querySelector(".hero-portrait"),n=e.querySelector(".enemy-portrait"),s=document.getElementById("weapon-display");t(o),t(n),t(s),document.addEventListener("mousemove",e=>{if(gfxSettings.lowFx)return;const t=2*(e.clientX/window.innerWidth-.5),a=2*(e.clientY/window.innerHeight-.5);o&&(o.style.transform=`translate3d(${Math.round(4*-t)}px, ${Math.round(4*-a)}px, 0)`),n&&(n.style.transform=`translate3d(${Math.round(4*-t)}px, ${Math.round(4*-a)}px, 0)`),s&&(s.style.transform=`translate3d(${Math.round(6*t)}px, ${Math.round(6*a)}px, 0)`)})}}function init(){const e=WORDS.filter(e=>"weapon"===e.type&&e.rarity===T.T1),t=WORDS.filter(e=>"weapon"!==e.type&&!e.hiddenInBank&&(0===e.rarity||2===e.rarity)),o=shuf([...t]),n=Math.min(t.length,Math.floor(12)-e.length),s=o.slice(0,Math.max(0,n)).map(e=>({...e}));S.inv=[...e.map(e=>({...e})),...s],setupEvents(),initParallax();const a=document.getElementById("forge-btn");a&&(a.onclick=forge,a.onmouseenter=sfxHover);const i=document.getElementById("combat-continue");i&&(i.onclick=()=>{if(i.disabled)return;i.disabled=!0;const e=document.getElementById("combat-overlay");e&&e.classList.add("combat-exit");const t=document.getElementById("spotlight-tint");t&&t.classList.add("show","full"),afterCombat()},i.onmouseenter=sfxHover);const r=document.getElementById("exit-shop-btn");r&&(r.textContent="EXIT SHOP",r.onclick=async()=>{const{totalInterest:e}=calculateInterest();e>0&&(S.gold+=e,checkTreasureHunterAchievement(),playSample("gem.ogg",.5)),saveRun(),S.rerollCost=5,clrSel(),newEnc(),await playSceneTransition(()=>{if(document.getElementById("shop-overlay").classList.remove("show"),musicEngine&&musicEngine.initialized&&musicEngine.exitShopMode(),setFlameColor("battle"),sparkManager){const e=S.roundIndex%9==0&&S.roundIndex>0;sparkManager.setColorMode(e?"boss":"normal")}showRoundIntro()}),await waitForIntroDismiss();const t=document.getElementById("forge");t&&t.classList.remove("shop-hidden"),S.gamePhase="forge",saveRun(),render()},r.onmouseenter=sfxHover);const l=document.getElementById("shop-menu");l&&(l.onclick=()=>{document.getElementById("shop-overlay").classList.remove("show"),showOverlay("#pause-menu")},l.onmouseenter=sfxHover);const c=document.getElementById("shop-talents-btn");c&&(c.onclick=()=>openTalentViewer(),c.onmouseenter=sfxHover);const d=document.getElementById("reroll-btn");d&&(d.onclick=rerollShop,d.onmouseenter=sfxHover);const p=document.getElementById("damage-preview-text");p&&(attachDamageTooltip(p),p.__tooltipContent=()=>getSharedBreakdownContent(S.sel.item?calc({breakdown:!0}):null));const f=document.getElementById("combat-total"),u=document.getElementById("combat-result");u&&u.classList.add("click-tooltip"),attachDamageTooltip(f),attachDamageTooltip(u);const h=document.getElementById("sell-word-btn");h&&(h.onmouseenter=sfxHover,h.onclick=e=>{if(e.stopPropagation(),selectedSellWords&&selectedSellWords.length>0){const e=selectedSellWords.map(({idx:e})=>e).sort((e,t)=>t-e);let t=0;selectedSellWords.forEach(({word:e})=>{const o=e.rarity||0;let n=0===o?1:2===o?2:5;S.talents&&S.talents.includes("golden_tongue")&&(n=Math.ceil(1.5*n)),t+=n}),S.gold+=t,checkTreasureHunterAchievement(),S.wordsSold=(S.wordsSold||0)+selectedSellWords.length,gfxSettings.lowFx||(recordFlipPositions($("#shop-word-bank")),pendingBankFlip=!0),e.forEach(e=>{e>=0&&S.inv.splice(e,1)}),playSample("buy_crate.ogg",.9),selectedSellWords=[],document.getElementById("sell-word-btn").textContent="Sell Selected",document.getElementById("sell-word-btn").disabled=!0,document.querySelectorAll("#shop-word-bank .chip.selected").forEach(e=>e.classList.remove("selected")),renderShop(),!gfxSettings.lowFx&&pendingBankFlip&&(requestAnimationFrame(()=>playFlipAnimation($("#shop-word-bank"))),pendingBankFlip=!1),render()}});const m=document.getElementById("deselect-btn");m&&(m.onclick=()=>{selectedSellWords=[],document.getElementById("sell-word-btn").textContent="Sell Selected",document.getElementById("sell-word-btn").disabled=!0;const e=document.getElementById("shop-word-bank");e&&e.querySelectorAll(".chip.selected").forEach(e=>e.classList.remove("selected")),playSfxBack()},m.onmouseenter=sfxHover);const y=()=>{initAudio()};document.addEventListener("click",y,{once:!0}),document.addEventListener("mousedown",y,{once:!0}),document.addEventListener("keydown",y,{once:!0}),document.addEventListener("touchstart",y,{once:!0}),document.addEventListener("click",e=>{if(e.target.closest(".hero-portrait")||e.target.closest(".enemy-portrait"))return;if(e.target.closest(".logo-img"))return;if(e.target.closest(".chip")||e.target.closest(".word-bank")||e.target.closest("#word-bank")||e.target.closest("#shop-word-bank"))return;if(e.target.closest(".weapon-slot"))return;if(e.target.closest("#header")||e.target.closest("#pause-menu")||e.target.closest("#shop-menu"))return;if(e.target.closest(".shop-top-right")||e.target.closest(".shop-top-left")||e.target.closest("#shop-talents-btn"))return;if(e.target.closest("#deselect-btn"))return;if(e.target.closest(".intro-hint")||e.target.closest(".chapter-intro")||e.target.closest("#round-intro-screen"))return;if(e.target.closest("#combat-result-modal"))return;if(e.target.closest("#achievements-overlay")||e.target.closest("#credits-overlay")||e.target.closest("#graphics-settings"))return;if(e.target.closest("#talent-viewer-overlay")||e.target.closest("#sound-panel"))return;if(e.target.closest("#main-menu button"))return;if(e.target.closest("#consumables-bar")||e.target.closest(".consumable-item"))return;playSample(useClickAlt?"click alt.ogg":"click.ogg",.6,getMousePan()),useClickAlt=!useClickAlt}),document.addEventListener("click",e=>{const t=e.target,o=t.closest("button");if(o&&(o.disabled||o.classList.contains("btn-disabled")))return void playSfxInvalid();const n=t.closest(".chip");if(n&&n.classList.contains("disabled"))return void playSfxInvalid();if(t.closest(".sold-out")||t.closest(".crate-sold-out"))return void playSfxInvalid();const s=t.closest(".hero-portrait");s&&s.classList.contains("locked")&&playSfxInvalid()});const g=document.getElementById("inv-counter"),w=document.getElementById("sort-indicator");if(g){const e=[{mode:"type",asc:!0,label:"Type ‚Üì"},{mode:"type",asc:!1,label:"Type ‚Üë"},{mode:"rarity",asc:!0,label:"Rarity ‚Üì"},{mode:"rarity",asc:!1,label:"Rarity ‚Üë"}];let t=0;g.onclick=()=>{t=(t+1)%e.length;const o=e[t];S.sortMode=o.mode,S.sortAsc=o.asc,w&&(w.textContent=o.label),renderBank(),sfxHover()},g.onmouseenter=sfxHover}$$("#shop-sort-btns button").forEach(e=>{e.onclick=()=>{S.shopSortMode=e.dataset.sort,$$("#shop-sort-btns button").forEach(e=>e.classList.remove("active")),e.classList.add("active"),renderShopWordBank(!1)},e.onmouseenter=sfxHover});const x=document.getElementById("sort-dir-btn");x&&(x.onclick=()=>{S.shopSortAsc=!S.shopSortAsc,x.textContent=S.shopSortAsc?"‚Üì":"‚Üë",renderShopWordBank(!1)},x.onmouseenter=sfxHover)}let ONBOARD={active:!1,step:0,weaponPlaced:!1,secondWordPlaced:!1,forgeAttempted:!1};function onboardingChip(e,t=1,o=null,n="elemental"){const s=`tier-${t}`;let a="",i="",r="";return"elemental"===n&&null!==o?(a=`<div class="chip-tab ${["elem-phys","elem-poison","elem-fire","elem-water","elem-light","elem-dark","elem-earth","elem-lightning"][o]}"></div>`,i=`<div class="chip-elem" style="color:${EC[o]}">${EN[o]}</div>`):"weapon"===n&&(r=s),`<div class="chip onboarding-chip" style="pointer-events:none">\n    ${a}\n    <div class="chip-tier ${s}">T${t}</div>\n    <div class="chip-name ${r}">${e}</div>\n    ${i}\n  </div>`}function playOnboardingTalk(){const e=[329.63,392,440,493.88,587.33],t=5+Math.floor(3*Math.random());for(let o=0;o<t;o++)setTimeout(()=>{const t=e[Math.floor(Math.random()*e.length)],o=.06+.04*Math.random();try{playTone(t,o,"sine",.08)}catch(e){}},60*o)}function showOnboarding(e,t="",o=!0){const n=document.getElementById("onboarding-overlay"),s=document.getElementById("onboarding-portrait"),a=document.getElementById("onboarding-name"),i=document.getElementById("onboarding-text"),r=document.getElementById("onboarding-example");return n?(s&&o?(s.innerHTML=getPortraitSVG("warrior"),s.style.display=""):s&&(s.style.display="none"),a&&(a.textContent="Graham Moor"),i&&(i.innerHTML=e),r&&(r.innerHTML=t,r.style.display=t?"flex":"none"),n.classList.add("visible"),playOnboardingTalk(),new Promise(e=>{const t=o=>{n.removeEventListener("click",t),sfxClick(),n.classList.remove("visible"),e()};n.addEventListener("click",t)})):Promise.resolve()}async function startOnboarding(){ONBOARD.active=!0,ONBOARD.step=1,ONBOARD.weaponPlaced=!1,ONBOARD.secondWordPlaced=!1,ONBOARD.forgeAttempted=!1;const e=onboardingChip("Sword",1,null,"weapon");await showOnboarding('Wordsmith! I need a <span class="highlight">"Wordy" Weapon</span> to defeat this foe.',e)}async function onOnboardingWordPlaced(e,t){if(ONBOARD.active)if("item"!==t||ONBOARD.weaponPlaced)ONBOARD.weaponPlaced&&!ONBOARD.secondWordPlaced&&"item"!==t&&(ONBOARD.secondWordPlaced=!0,ONBOARD.step=5,await dly(RHYTHM.HALF),await showOnboarding('That\'s more <span class="highlight">Wordy</span>! Continue forging until the Weapon will be powerful enough to defeat the enemy, indicated by its <span class="highlight">AP</span> in the center and the enemy\'s <span class="highlight">HP bar</span>. When you\'re ready, hit <span class="highlight">"Forge Weapon"</span>.'));else{ONBOARD.weaponPlaced=!0,ONBOARD.step=2,await dly(RHYTHM.HALF),await showOnboarding('Heroes have their preferred weapon. Mine ‚Äî a <span class="highlight">Sword</span>.');const e=onboardingChip("Stone",1,E.PHYS)+onboardingChip("Venom",1,E.POISON)+onboardingChip("Fire",1,E.FIRE)+onboardingChip("Water",1,E.WATER)+onboardingChip("Light",1,E.LIGHT)+onboardingChip("Shadow",1,E.DARK)+onboardingChip("Earth",1,E.EARTH)+onboardingChip("Spark",1,E.LIGHTNING);await showOnboarding('A Weapon alone is not enough, it needs to be <span class="highlight">enhanced</span>. Words can be <span class="highlight">Elemental</span> or define its <span class="highlight">Rarity</span>. Keep in mind the Hero and Enemy\'s Strengths and Weaknesses.',e);const t=onboardingChip("Fire",1,E.FIRE)+'<span style="color:#6b7280;font-size:20px;align-self:center">‚Üí</span>'+onboardingChip("Fiery",1,E.FIRE);await showOnboarding('Select a Word and place it in another slot. Depending where, it\'ll take on its proper form ‚Äî as an <span class="highlight">adjective</span> or a <span class="highlight">noun</span>.',t),ONBOARD.step=4}}async function onOnboardingForgeAttempt(){if(!ONBOARD.active)return!1;return!!((calc().heroDmg||0)<(S.enemy?.hp||0))&&(await showOnboarding('That won\'t do. Add more <span class="highlight">Words</span> and its power will grow.'),!0)}async function showOnboardingComplete(){ONBOARD.active&&(ONBOARD.active=!1,PStats.tutorialComplete=!0,saveStats(),await showOnboarding('I see you haven\'t lost your edge, <span class="highlight">Wordsmith</span>.<br><br>Next, you\'ll be able to buy and sell Words, Tools, and more.<br><br>Accompany me on this adventure ‚Äî all I ask is to craft me a <span class="highlight">Wordy Weapon</span>!'))}function shouldStartOnboarding(){return!PStats.tutorialComplete&&1===S.roundIndex}async function startNewRun(){closeRunOverlays(),stopAllRarityDrones(),musicEngine&&musicEngine.inShopMode&&musicEngine.exitShopMode(),setFlameColor("battle"),isForging=!1,isTransitioning=!1,S.wins=0,S.losses=0,S.streak=0,S.gold=30,S.level=1,S.roundIndex=1,S.floor=1,S.talents=[],S.talentLevels={},S.shadowBonusHP=0,S.battleHardenedBonus=0,S.quickStudyBonus=0,S.pendingBossLoot=null,S.tempEffects={},S.consumables=[],S.usedWeaponTypes=new Set,S.usedWeapons=new Set,S.uniqueWordsUsed=new Set,S.bossesDefeated=0,S.carriedOverkill=0,S.toolsUsed=0,S.cratesOpened=0,S.goldSpent=0,S.rarityWordsUsed=0,S.tierWordsPlayed={1:0,2:0,3:0},S.toolUsedThisBattle=!1,S.wordsUsedThisRun=0,S.wordsSold=0,S.rereadTriggersThisRun=0,S.foughtChapterBosses=[],S.chapterBoss=null,S.blockedSlot=null,S.chapterAPBonus=0,S.currentChapter=0,S.gamePhase="shop",S.heroSelected=!1;const e=WORDS.filter(e=>"weapon"===e.type&&e.rarity===T.T1),t=WORDS.filter(e=>"weapon"!==e.type&&!e.hiddenInBank&&(0===e.rarity||2===e.rarity)),o=shuf([...t]),n=Math.min(t.length,Math.floor(12)-e.length),s=o.slice(0,Math.max(0,n)).map(e=>({...e}));S.inv=[...e.map(e=>({...e})),...s],PStats.attempts++,saveStats(),clearRunSave(),clrSel(),showHeroSelect()}let currentHeroIndex=0;const DIFF_DESCRIPTIONS=["","Enemies have +50% HP. Shop prices +25%.","Enemies have +100% HP. Shop prices +50%."];function isDifficultyUnlocked(e,t=null){if(0===e)return!0;const o=t||(S.hero?S.hero.name:HEROES[currentHeroIndex]?.name);if(!o)return!1;return((PStats.heroDifficultyClears||{})[o]||{})[e-1]>=1}function setupDifficultySelector(){const e=document.getElementById("difficulty-selector"),t=document.getElementById("difficulty-desc");if(!e)return;let o=PStats.preferredDifficulty||0;for(;o>0&&!isDifficultyUnlocked(o);)o--;S.difficulty=o;const n=e.querySelectorAll(".diff-btn");n.forEach(e=>{const o=parseInt(e.dataset.diff),s=isDifficultyUnlocked(o);e.classList.toggle("selected",o===S.difficulty),e.classList.toggle("locked",!s),e.disabled=!s,e.title=s?"":`Beat ${DIFF_NAMES[o-1]} to unlock`,e.onclick=()=>{s&&(S.difficulty=o,PStats.preferredDifficulty=o,saveStats(),n.forEach(e=>e.classList.toggle("selected",parseInt(e.dataset.diff)===o)),updateDifficultyDesc(t,o),playSfxOpen())},e.onmouseenter=sfxHover}),updateDifficultyDesc(t,S.difficulty)}function updateDifficultyDesc(e,t){e.textContent=DIFF_DESCRIPTIONS[t]}function showHeroSelect(){currentHeroIndex=0,updateSkillBadges(),setupDifficultySelector();const e=document.getElementById("pause-btn");e&&(e.style.display="none");const t=document.getElementById("sound-btn");t&&(t.style.display="none");const o=document.getElementById("header");o&&(o.style.display="none");const n=document.getElementById("word-bank");n&&(n.style.display="none");const s=document.getElementById("forge");s&&(s.style.display="none");const a=document.querySelector(".hero-portrait .portrait-frame"),i=document.querySelector(".enemy-portrait .portrait-frame");a&&(a.innerHTML=""),i&&(i.innerHTML=""),PStats.unlockedHeroes||(PStats.unlockedHeroes=["Graham Moor"]);const r={Quivera:{boss:"Cinna & Antony",icon:icon("yinyang")},"Belle Lettres":{boss:"Red Aktins",icon:icon("scissors")},"Alexandria Constanza":{boss:"Plague Doctor",icon:icon("clipboard")},Caesura:{boss:"Oxy",icon:icon("crossed-swords")},Reed:{boss:"Dotdotdot",icon:icon("ellipsis")}},l=$("#hero-card-container");l.innerHTML="",HEROES.forEach((e,t)=>{const o=PStats.unlockedHeroes.includes(e.name),n=r[e.name],s=document.createElement("div");s.className="card hero"+(o?"":" locked-hero"),s.style.minWidth="100%",s.style.flex="0 0 100%",s.style.cursor=o?"pointer":"not-allowed",o||(s.style.opacity="0.6");const a=e.passive?`\n      <div class="card-section" style="margin-top:8px">\n        <div class="card-section-title">PASSIVE</div>\n        <div style="color:#fbbf24;font-weight:bold">${e.passive.name}</div>\n        <div style="font-size:12px;color:#9ca3af;margin-top:2px">${e.passive.desc}</div>\n      </div>\n    `:"";let i="";!o&&n&&(i=`\n        <div class="hero-locked-overlay" style="position:absolute;inset:0;background:rgba(0,0,0,0.7);display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:inherit;z-index:10">\n          <div style="font-size:28px;margin-bottom:8px">üîí</div>\n          <div style="color:#f87171;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.1em">Locked</div>\n          <div style="color:#9ca3af;font-size:11px;margin-top:4px">Defeat ${n.icon} ${n.boss}</div>\n        </div>\n      `);const c=getPortraitSVG(e.id),d=getHeroLevel(e.name);s.innerHTML=`\n      ${i}\n      <div class="hero-select-portrait" style="width:80px;height:80px;margin:0 auto 12px;border-radius:50%;overflow:hidden">${c}</div>\n      <div class="card-name">${e.name}</div>\n      <div style="font-size:11px;color:#9ca3af;margin-bottom:4px;text-transform:uppercase;letter-spacing:0.1em">Level ${d}</div>\n      <div class="card-desc">${e.desc}</div>\n      <div class="card-section" style="margin-bottom:4px"><div class="card-section-title">Strong using</div><div>${e.str.map(e=>`<span class="tag str">${EN[e]}</span>`).join("")}</div></div>\n      <div class="card-section" style="margin-bottom:4px"><div class="card-section-title">Weak using</div><div>${e.weak.map(e=>`<span class="tag weak">${EN[e]}</span>`).join("")}</div></div>\n      <div class="card-section"><div class="card-section-title">PROFICIENCIES</div><div><span class="mod-badge add">${e.good.charAt(0).toUpperCase()+e.good.slice(1)} √ó2</span> <span class="mod-badge neg">${e.bad.charAt(0).toUpperCase()+e.bad.slice(1)} √ó0.5</span></div></div>\n      ${a}\n    `,l.appendChild(s)}),updateCarousel(),$("#hero-prev").onclick=()=>{currentHeroIndex=(currentHeroIndex-1+HEROES.length)%HEROES.length,updateCarousel()},$("#hero-prev").onmouseenter=sfxHover,$("#hero-next").onclick=()=>{currentHeroIndex=(currentHeroIndex+1)%HEROES.length,updateCarousel()},$("#hero-next").onmouseenter=sfxHover,$("#hero-select-btn").onclick=async()=>{const e=HEROES[currentHeroIndex];if(PStats.unlockedHeroes||(PStats.unlockedHeroes=["Graham Moor"]),!PStats.unlockedHeroes.includes(e.name)){const e=$("#hero-select-btn");return e.style.animation="none",void requestAnimationFrame(()=>{requestAnimationFrame(()=>e.style.animation="shake 0.3s ease")})}await playSceneTransition(async()=>{S.hero={...e},S.heroId=e.id,S.heroSelected=!0,S.lives=1;const t=S.hero.name;initHeroSkills(t),S.heroSkillBonuses=getHeroSkillBonuses(t);const o=S.heroSkillBonuses.startGold||0;o>0&&(S.gold+=o),applyModifiers("HERO_INIT",{hero:S.hero,state:S}),$("#hero-select-overlay").classList.remove("show");const n=document.getElementById("pause-btn"),s=document.getElementById("sound-btn"),a=document.getElementById("header");n&&(n.style.display=""),s&&(s.style.display=""),a&&(a.style.display=""),musicEngine&&("undefined"!=typeof Tone&&Tone.context&&"running"!==Tone.context.state&&await Tone.start(),musicEngine.initialized||await musicEngine.init(),musicEngine.resetToBassOnly(),musicEngine.setMuted(!audioOn),musicEngine.playing||await musicEngine.start()),newEnc(),showRoundIntro(),saveRun()}),await waitForIntroDismiss(),shouldStartOnboarding()&&"Graham Moor"===S.hero.name&&await startOnboarding(),render()},$("#hero-select-btn").onmouseenter=sfxHover,$("#hero-select-close").onclick=async()=>{isTransitioning||(playSfxBack(),await playSceneTransition(()=>{$("#hero-select-overlay").classList.remove("show"),showMainMenu(!0)}))},$("#hero-select-close").onmouseenter=sfxHover,$("#start-hero-skills").onclick=()=>{showSkillTree(HEROES[currentHeroIndex].name)},$("#start-hero-skills").onmouseenter=sfxHover;const c=document.getElementById("hero-select-overlay");c&&c.classList.add("instant-show"),showOverlay(c||"#hero-select-overlay")}function updateCarousel(){$("#hero-card-container").style.transform=`translateX(-${100*currentHeroIndex}%)`;const e=HEROES[currentHeroIndex];PStats.unlockedHeroes||(PStats.unlockedHeroes=["Graham Moor"]);const t=PStats.unlockedHeroes.includes(e.name),o=$("#hero-select-btn");o&&(o.disabled=!t,o.textContent=t?"SELECT HERO":"LOCKED",o.style.opacity=t?"1":"0.5",o.style.cursor=t?"pointer":"not-allowed"),setupDifficultySelector()}function newEnc(){if(!S.heroSelected)return void showHeroSelect();S.toolUsedThisBattle=!1,S.heroDialogueIndex=0,S.enemyDialogueIndex=0;const e=document.getElementById("forge");e&&(e.style.display="");const t=document.getElementById("battle-view");t&&(t.style.display="");const o=document.getElementById("word-bank");o&&(o.style.display="");const n=S.roundIndex%9==0;if(!S.nextEnemyData){const e=ENEMIES[Math.random()*ENEMIES.length|0]||ENEMIES[0];S.nextEnemyData={...e},randomizeEnemyElements(S.nextEnemyData)}S.enemy={...S.nextEnemyData},S.enemy.hp=enemyHp(S.roundIndex),S.enemy.hpMultiplier&&(S.enemy.hp=Math.round(S.enemy.hp*S.enemy.hpMultiplier));const s=n;if(S.roundIndex%3==0&&!s?(S.enemy.hp=Math.round(1.3*S.enemy.hp),S.enemy.ap=Math.round(1.2*S.enemy.ap),S.enemy.boss=!0,S.enemy.isMiniboss=!0):s||(S.enemy.boss=!1),s){let e;if(S.nextChapterBoss)e=S.nextChapterBoss,S.nextChapterBoss=null;else if(Math.random()<.05)e=SECRET_CHAPTER_BOSS;else{let t=CHAPTER_BOSSES.filter(e=>!S.foughtChapterBosses.includes(e.id));0===t.length&&(S.foughtChapterBosses=[],t=[...CHAPTER_BOSSES]),e=t[Math.floor(Math.random()*t.length)]}if(e.isSecretBoss||S.foughtChapterBosses.push(e.id),S.chapterBoss=e,S.enemy.name=e.name,S.enemy.desc=e.desc,S.enemy.dialogue=e.dialogue,S.enemy.isChapterBoss=!0,S.enemy.isSecretBoss=e.isSecretBoss||!1,S.enemy.ability=e.ability,S.enemy.id=e.id,e.weak?S.enemy.weak=[...e.weak]:S.enemy.weak=S.enemy.weak.slice(0,1),e.res?S.enemy.res=[...e.res]:S.enemy.res=S.enemy.res.slice(0,2),e.hpMultiplier?S.enemy.hp=Math.round(S.enemy.hp*e.hpMultiplier):S.enemy.hp=Math.round(1.3*S.enemy.hp),S.enemy.boss=!0,S.enemy.isBoss=!0,"red_aktins"===e.id){const e=["adj1","adj2","adj3","adj4","noun1"];S.blockedSlot=e[Math.floor(Math.random()*e.length)]}else S.blockedSlot=null;S.enemy.weak&&S.enemy.weak.length>1&&(S.enemy.weak=S.enemy.weak.slice(0,S.enemy.weak.length-1))}else S.chapterBoss=null,S.enemy.isChapterBoss=!1,S.enemy.ability=null,S.blockedSlot=null;applyModifiers("ENEMY_SETUP",{hero:S.hero,enemy:S.enemy,state:S}),S.nextEnemyData=null,S.shadowBonusHP>0&&(S.enemy.hp=Math.max(1,S.enemy.hp-S.shadowBonusHP),S.shadowBonusHP=0),render()}function render(){if(!S.hero||!S.enemy)return;const e=performance.now(),t={},o=S.hero,n=S.enemy,s=getEffectiveEnemy(),a=$("#hero-name"),i=$("#enemy-name");if(a&&(a.textContent=o.name),i){let e="";n.isChapterBoss?e=' <span class="tag ability" style="font-size:9px;padding:1px 6px;vertical-align:middle">Boss</span>':S.roundIndex%3==0&&(e=' <span class="tag ability" style="font-size:9px;padding:1px 6px;vertical-align:middle">Mini-Boss</span>'),i.innerHTML=n.name+e}const r=document.querySelector(".hero-portrait .portrait-frame"),l=document.querySelector(".enemy-portrait .portrait-frame");if(r&&o.id&&renderPortrait(r,o.id,"#4ade80"),l&&n.id){renderPortrait(l,(n.isChapterBoss,n.id),"#f87171")}const c=performance.now(),d=calc();t.calcMs=performance.now()-c;const p=d.heroDmg||0;S.lastCalcDmg=p;const f=o.str.map(e=>`<span class="tag str">${EN[e]}</span>`).join(""),u=o.weak.map(e=>`<span class="tag weak">${EN[e]}</span>`).join(""),h=!(!S.tempEffects||!S.tempEffects.weaponMaster),m=S.talents&&S.talents.includes("overcoming"),y=e=>e?e.charAt(0).toUpperCase()+e.slice(1):"";let g="";if(h){g=`<span class="tag prof">All Weapons √ó${S.tempEffects.weaponMaster||3} (Weapon Master)</span>`}else g=m?`<span class="tag prof">${y(o.good)} √ó2</span><span class="tag prof">${y(o.bad)} √ó1.5 <span style="font-size:9px;opacity:0.7">(Overcoming)</span></span>`:`<span class="tag prof">${y(o.good)} √ó2</span><span class="tag weak">${y(o.bad)} √ó0.5</span>`;const w=$("#hero-elements");w&&(w.innerHTML=""+f+u+g);const x=S.talents&&S.talents.includes("irony"),v=s.weak.map(e=>`<span class="tag str">${EN[e]}</span>`).join(""),b=S.tempEffects&&S.tempEffects.polymorph?[]:s.res,k=b.length?b.map((e,t)=>x&&0===t?`<span class="tag irony">${EN[e]} <span class="irony-badge">Irony</span></span>`:`<span class="tag weak">${EN[e]}</span>`).join(""):"";let E="";if(n.isChapterBoss&&n.ability){if(S.tempEffects&&S.tempEffects.disableBossAbility)E=`<span class="tag ability" style="opacity:0.5;text-decoration:line-through">${n.ability.name}: SILENCED</span>`;else{let e=n.ability.desc;if(S.chapterBoss&&"red_aktins"===S.chapterBoss.id&&S.blockedSlot){e=`${{adj1:"Prefix 1",adj2:"Prefix 2",adj3:"Suffix 1",adj4:"Suffix 2",noun1:"Gem"}[S.blockedSlot]} [REDACTED]`}E=`<span class="tag ability">${n.ability.name}: "${e}"</span>`}}const L=$("#enemy-elements");L&&(L.innerHTML=v+k+E),updateHealthBars();const T=document.getElementById("hero-ap");T&&(T.textContent=`HP: ${o.hp}`);const M=$("#hero-desc"),A=$("#hero-dialogue");M&&(M.textContent=o.desc);const P=(S.enemy?getHeroEnemyDialogue(o.id,S.enemy.id):null)||o.dialogue[Math.random()*o.dialogue.length|0];A&&(A.textContent=`"${P}"`);{const e=document.getElementById("hero-inline-dialogue");e&&(e.textContent=P)}const R=$("#hero-str"),C=$("#hero-weak"),I=$("#hero-prof");if(R&&(R.innerHTML=o.str.map(e=>`<span class="tag str">${EN[e]}</span>`).join("")),C&&(C.innerHTML=o.weak.map(e=>`<span class="tag weak">${EN[e]}</span>`).join("")),I)if(h){const e=S.tempEffects.weaponMaster||3;I.innerHTML=`<span class="tag prof">All Weapons √ó${e} W (Weapon Master)</span>`}else I.innerHTML=`<span class="tag prof">${o.good} √ó2.0 W</span><span class="tag weak">${o.bad} √ó0.5 W</span>`;const _=$("#enemy-desc"),B=$("#enemy-dialogue");_&&(_.textContent=n.desc),B&&(B.textContent=`"${n.dialogue[Math.random()*n.dialogue.length|0]}"`);{const e=document.getElementById("enemy-inline-dialogue");if(e){const t=n.dialogue[Math.random()*n.dialogue.length|0];e.textContent=t}}const Q=$("#enemy-weak"),G=$("#enemy-res");Q&&(Q.innerHTML=s.weak.map(e=>`<span class="tag str">${EN[e]}</span>`).join(""));const O=S.tempEffects&&S.tempEffects.polymorph?[]:s.res;G&&(G.innerHTML=O.length?O.map((e,t)=>x&&0===t?`<span class="tag irony">${EN[e]} <span class="irony-badge">Irony</span></span>`:`<span class="tag weak">${EN[e]}</span>`).join(""):""),document.getElementById("gold")&&(document.getElementById("gold").textContent=S.gold),document.getElementById("level")&&(document.getElementById("level").textContent=S.level),document.getElementById("round-num")&&(document.getElementById("round-num").textContent=S.roundIndex);const H=Math.floor((S.roundIndex-1)/9)+1;document.getElementById("chapter-num")&&(document.getElementById("chapter-num").textContent=H);const{totalInterest:D}=calculateInterest(),W=document.getElementById("gold-interest");W&&(W.textContent=D>0?`| +${D}`:"");const j=document.getElementById("lives-counter"),F=document.getElementById("lives");j&&F&&(S.hero&&"paladin"===S.hero.id&&S.lives>0?(j.style.display="",F.textContent=S.lives):j.style.display="none");const N=document.getElementById("hero-talents");N&&(N.innerHTML="");const q=S.inv.filter(e=>!e.hiddenInBank).length,Y=document.getElementById("inv-counter-text");Y&&(Y.textContent=`${q}/24`);const Z=document.getElementById("inv-breakdown-tooltip");Z&&(Z.innerHTML=generateInvBreakdown());const z=performance.now();updSlots(),t.updSlotsMs=performance.now()-z;const U=performance.now();renderBank(!1,_fastRemoveWordId),_fastRemoveWordId=null,t.renderBankMs=performance.now()-U;const J=performance.now();renderConsumables(),t.renderConsMs=performance.now()-J;const K=performance.now();renderTalents(),t.renderTalentsMs=performance.now()-K;const V=performance.now();renderWeapon(),t.renderWeaponMs=performance.now()-V;const X=performance.now();updateSlotCalcs(),t.updateSlotCalcsMs=performance.now()-X;const ee=document.getElementById("forge-btn");ee&&(ee.disabled=!S.sel.item),t.totalMs=performance.now()-e,"function"==typeof window.logPerfEvent&&t.totalMs>8&&window.logPerfEvent("RENDER",t)}function updateHealthBars(){S.hero;const e=S.enemy,t=document.getElementById("hero-health-fill"),o=document.getElementById("hero-health-text");t&&(t.style.width="0%"),o&&(o.textContent=""),$("#enemy-health-fill").style.width="100%";const n=document.getElementById("enemy-health-text");if(S.carriedOverkill>0?n.innerHTML=`${fmtBig(e.hp)} / ${fmtBig(e.hp)} <span style="color:#f472b6;font-size:10px">(-${fmtBig(S.carriedOverkill)} Hyperbole)</span>`:n.textContent=`${fmtBig(e.hp)} / ${fmtBig(e.hp)}`,S.sel.item){const t=calc({breakdown:!0}),o=Math.round(t.heroDmg),n=(Math.round(t.enemyDmg),e=>Number.isInteger(e)?e:parseFloat(e.toFixed(2)));n(t.baseAP),n(t.wordCount);$("#preview-hero-dmg").textContent=fmtBig(o),$("#preview-base-ap").textContent="";const s=document.getElementById("preview-bonus-badges");if(s){const e=[];e.push(`<span class="mod-badge add">${n(t.baseAP)} AP</span>`);const o=t.breakdown?t.breakdown.wordCount:t.wordCount;e.push(`<span class="mod-badge word">${n(o)} W</span>`),t.totalMultiplier>1&&e.push(`<span class="mod-badge scale">√ó${n(t.totalMultiplier)}</span>`),s.innerHTML=e.join("")}const a=document.getElementById("damage-preview-text");a&&a.classList.toggle("goal-achieved",o>=e.hp);const i=Math.max(e.hp-o,0);document.getElementById("enemy-health-text").textContent=`${fmtBig(i)} / ${fmtBig(e.hp)}`;const r=o/e.hp*100,l=document.getElementById("enemy-damage-preview");l.style.width=`${r}%`,l.style.display="block",l.classList.remove("blink"),requestAnimationFrame(()=>{requestAnimationFrame(()=>l.classList.add("blink"))}),$("#hero-damage-preview").style.display="none",o>=e.hp?($("#preview-hero-dmg").style.color="#4ade80",$("#preview-hero-dmg").style.fontWeight="bold"):($("#preview-hero-dmg").style.color="#fb923c",$("#preview-hero-dmg").style.fontWeight="")}else{$("#preview-hero-dmg").textContent="0",$("#enemy-damage-preview").style.display="none",$("#hero-damage-preview").style.display="none",$("#preview-base-ap").textContent="";const e=document.getElementById("damage-preview-text");e&&e.classList.remove("goal-achieved");const t=document.getElementById("preview-bonus-badges");t&&(t.innerHTML="")}musicEngine&&musicEngine.initialized&&musicEngine.updateLayers(S)}function updateEnemyCalc(){const e=S.hero,t=S.enemy,o=e.str.includes(t.atk)?.7:e.weak.includes(t.atk)?1.5:1,n=Math.round(t.ap*o),s=$("#enemy-calc");o<1?(s.className="enemy-atk-calc reduced",s.textContent=`${t.ap}√ó0.7 = ${n} ‚úì`):o>1?(s.className="enemy-atk-calc amplified",s.textContent=`${t.ap}√ó1.5 = ${n} ‚ö†`):(s.className="enemy-atk-calc neutral",s.textContent=`= ${n} dmg`)}function hasWeapons(){return S.inv.some(e=>"weapon"===e.type)}function updSlots(){const e=!!S.sel.item,t=!!S.sel.noun1,o=e,n=e&&t;t||["adj3","adj4"].forEach(e=>{const t=S.sel[e];t&&(S.inv.includes(t)||S.inv.push(t),S.sel[e]=null)}),["adj1","adj2"].forEach(e=>{const t=document.querySelector(`[data-slot="${e}"].slot-container`);t&&t.classList.toggle("hidden",!o)}),["adj3","adj4"].forEach(e=>{const t=document.querySelector(`[data-slot="${e}"].slot-container`);t&&t.classList.toggle("hidden",!n)});const s=document.querySelector('[data-slot="noun1"].slot-container');s&&s.classList.toggle("hidden",!e),$("#of-label").classList.toggle("hidden",!e);const a={};["item","adj1","adj2","adj3","adj4","noun1"].forEach(e=>{a[e]=$(`[data-slot="${e}"].slot`)});const i=["elem-physical","elem-poison","elem-fire","elem-water","elem-light","elem-dark","elem-earth","elem-lightning"],r=["physical","poison","fire","water","light","dark","earth","lightning"];["item","adj1","adj2","adj3","adj4","noun1"].forEach(e=>{const t=a[e];if(!t)return;const o=S.sel[e],n=t.querySelector(".tooltip");n&&n.remove(),t.classList.remove("has-tooltip"),t.removeAttribute("tabindex"),t.__tooltipContent=null;const s=S.tempEffects&&S.tempEffects.disableBossAbility,l=S.blockedSlot===e&&!s;t.classList.toggle("redacted-slot",l);const c=t.querySelector(".redacted-overlay");if(c&&c.remove(),l){const e=document.createElement("div");e.className="redacted-overlay",e.textContent="REDACTED",t.appendChild(e)}if(o){const n=TC[o.rarity],s=getDisplayForm(o,e,S.sel),a=justPlacedSlot===e?" popping-in":"";if(t.innerHTML=`<span class="${n} slot-content${a}" draggable="false">${s}</span>`,t.classList.add("filled"),justPlacedSlot===e&&(justPlacedSlot=null),t.classList.remove(...i),void 0!==o.elem&&t.classList.add(`elem-${r[o.elem]}`),"noun1"===e){let e="#9ca3af";if(void 0!==o.elem)e=EC[o.elem];else{const t=o.rarity||0;2===t?e="#60a5fa":t>=3&&(e="#f4d03f")}t.style.setProperty("--glow-color",e),t.classList.add("gem-slot-filled")}const l=S.talents&&S.talents.includes("signature_style");"item"===e&&l&&!o.isStick&&o.category===S.hero.good?t.classList.add("signature-style-active"):"item"===e&&t.classList.remove("signature-style-active"),attachDamageTooltip(t),t.__tooltipContent=()=>mkTooltip(o,{bare:!0});const c=t.querySelector(".tooltip.modal-tooltip, .tooltip");c&&(c.innerHTML=t.__tooltipContent())}else{t.classList.remove(...i),"noun1"===e&&(t.classList.remove("gem-slot-filled"),t.style.removeProperty("--glow-color")),"item"===e&&t.classList.remove("signature-style-active");const o={item:"Weapon",adj1:"Adjective",adj2:"Adjective",adj3:"Adjective",adj4:"Adjective",noun1:S.talents&&S.talents.includes("crown_jewel")?"Gem (4x W)":"Gem (2x W)"};t.innerHTML=o[e]||"",t.classList.remove("filled")}})}function updateSlotCalcs(){const e=S.sel;if(!S.hero||!S.enemy){const e=document.getElementById("forge-btn");return void(e&&(e.disabled=!S.sel.item))}if(!e.item){["item","adj1","adj2","adj3","adj4","noun1"].forEach(e=>{const t=$("#calc-"+e),o=document.getElementById("mult-"+e);t&&(t.textContent="",t.className="slot-calc"),o&&(o.textContent="")});const e=document.getElementById("forge-btn");return void(e&&(e.disabled=!0))}let t,o,n;try{t=calc({wantBreakdown:!0}),o=t.wordDataMap,n=t.retriggeredWords||[]}catch(e){console.error("[updateSlotCalcs] calc() error:",e),["item","adj1","adj2","adj3","adj4","noun1"].forEach(e=>{const t=$("#calc-"+e),o=document.getElementById("mult-"+e);t&&(t.textContent="",t.className="slot-calc"),o&&(o.textContent="")});const t=document.getElementById("forge-btn");return void(t&&(t.disabled=!S.sel.item))}["item","adj1","adj2","adj3","adj4","noun1"].forEach(function(t){const s=$("#calc-"+t),a=document.getElementById("mult-"+t);if(!s)return;const i=e[t];if(!i)return s.textContent="",s.className="slot-calc",void(a&&(a.textContent=""));const r=function(e,t){if(!e)return{apText:"",multText:"",className:"",wordCountText:""};const n=o.get(e);if(!n)return{apText:"",multText:"",className:"",wordCountText:""};const s=n.apContribution,a=Number.isInteger(s)?s:parseFloat(s.toFixed(2));let i="";0===s?i="negative":s>0&&(i="positive");const r=`${a}AP`;let l=[];void 0!==e.mult&&"noun1"!==t&&l.push(fmtMod(e.mult,"scale")),n.talentMults&&n.talentMults.length>0&&n.talentMults.forEach(e=>{l.push(`<span class="mod-badge scale" title="${e.name}">√ó${e.mult}</span>`)});const c=l.join(" "),d=n.wCountTotal??n.wCountDelta??1,p=Number.isInteger(d)?d:parseFloat(d.toFixed(2));let f=d?`<span class="mod-badge word">+${p} W</span>`:"";return n.echoChamberW&&n.echoChamberW>0&&(f+=` <span class="mod-badge word" style="background:linear-gradient(135deg,#3b82f6,#8b5cf6)">+${n.echoChamberW} W</span>`),{apText:r,multText:c,className:i,wordCountText:f}}(i,t),l=function(e){return e?n.filter(t=>t.word===e).length:0}(i);let c="";if(l>0){c+=`<div style="margin-bottom:1px"><span class="mod-badge reread">√ó${l+1}</span></div>`}c+=r.apText,s.innerHTML=c,s.className="slot-calc"+(r.className?` ${r.className}`:"");let d=r.multText;r.wordCountText&&(d=r.wordCountText+(d?" "+d:"")),a&&(a.innerHTML=d)});const s=document.getElementById("forge-btn");s&&(s.disabled=!S.sel.item),updateFlameBaseline()}function sortInventory(e,t){const o=[...e],n=t||S.sortMode;if("type"===n)o.sort((e,t)=>{const o="weapon"===e.type,n="weapon"===t.type;if(o&&!n)return-1;if(!o&&n)return 1;if(o&&n){const o={slash:0,pierce:1,blunt:2,magic:3},n=o[e.category]??99,s=o[t.category]??99;if(n!==s)return n-s;const a=t.rarity-e.rarity;return 0!==a?a:e.name.localeCompare(t.name)}const s=void 0!==e.elem,a=void 0!==t.elem;if(s&&!a)return-1;if(!s&&a)return 1;if(s&&a){const o={0:0,1:1,2:2,3:3,4:4,5:5,7:6,6:7},n=(o[e.elem]??e.elem)-(o[t.elem]??t.elem);if(0!==n)return n;const s=t.rarity-e.rarity;return 0!==s?s:e.name.localeCompare(t.name)}const i={adj_legendary:6,adj_epic:5,adj_rare:4,adj_magic:3,adj_uncommon:2,adj_common:1},r=i[e.id]||0,l=i[t.id]||0;return r&&l?l-r:t.rarity-e.rarity||e.name.localeCompare(t.name)});else if("rarity"===n){const e={adj_legendary:6,adj_epic:5,adj_rare:4,adj_magic:3,adj_uncommon:2,adj_common:1};o.sort((t,o)=>{const n=o.rarity-t.rarity;if(0!==n)return n;const s=e[t.id]||0,a=e[o.id]||0;return s&&a?a-s:t.name.localeCompare(o.name)})}return o}function getVisibleBankWords(e){const t=Object.values(S.sel).filter(Boolean);return e.filter(e=>!t.includes(e)&&!e.hiddenInBank)}function getSortedVisibleBankWords(e,t,o=!0){let n=sortInventory(getVisibleBankWords(e),t);return o||(n=n.slice().reverse()),n}function generateInvBreakdown(){const e=S.inv.filter(e=>!e.hiddenInBank),t={};for(let e=0;e<EN.length;e++)t[e]=0;const o={T1:0,T2:0,T3:0};let n=0,s=0,a=0;e.forEach(e=>{void 0!==e.elem&&t[e.elem]++;const i=e.rarity||0;0===i||1===i?o.T1++:2===i?o.T2++:i>=3&&o.T3++,"weapon"===e.type?n++:void 0!==e.elem?s++:a++});let i="";i+='<div class="inv-section">',i+='<div class="inv-section-title">Elements</div>',i+='<div class="inv-row">';for(let e=0;e<EN.length;e++){const o=t[e];i+=`<div class="inv-elem${0===o?" missing":""}" style="border-left:3px solid ${EC[e]}">`,i+=`<span class="inv-elem-count">${o}</span>`,i+=`<span>${EN[e]}</span>`,i+="</div>"}return i+="</div></div>",i+='<div class="inv-section">',i+='<div class="inv-section-title">Rarity</div>',i+='<div class="inv-row">',i+=`<div class="inv-elem" style="border-left:3px solid #9ca3af"><span class="inv-elem-count">${o.T1}</span><span class="tier-1">T1</span></div>`,i+=`<div class="inv-elem" style="border-left:3px solid #60a5fa"><span class="inv-elem-count">${o.T2}</span><span class="tier-2">T2</span></div>`,i+=`<div class="inv-elem" style="border-left:3px solid #f4d03f"><span class="inv-elem-count">${o.T3}</span><span class="tier-3">T3</span></div>`,i+="</div></div>",i+='<div class="inv-section">',i+='<div class="inv-section-title">Categories</div>',i+='<div class="inv-row">',i+=`<div class="inv-elem"><span class="inv-elem-count">${n}</span><span>Weapons</span></div>`,i+=`<div class="inv-elem"><span class="inv-elem-count">${s}</span><span>Elemental</span></div>`,i+=`<div class="inv-elem"><span class="inv-elem-count">${a}</span><span>Other</span></div>`,i+="</div></div>",i}let _lastBankState={hasItem:!1,hasNoun:!1},_fastRemoveWordId=null;function renderBank(e=!0,t=null){const o=$("#bank"),n=!!S.sel.item,s=!!S.sel.noun1,a=!hasWeapons(),i=pendingBankFlip,r=(e||i)&&!gfxSettings.lowFx;i&&(pendingBankFlip=!1);const l=n!==_lastBankState.hasItem||s!==_lastBankState.hasNoun;if(_lastBankState={hasItem:n,hasNoun:s},t&&!l&&!a){const e=o.querySelector(`[data-word-id="${t}"]`);if(e)return void(r?(e.style.transform="scale(0.8)",e.style.opacity="0",e.style.transition="transform 0.15s, opacity 0.15s",setTimeout(()=>e.remove(),150)):e.remove())}r&&!i&&recordFlipPositions(o),$("#backup-weapon").style.display=a?"block":"none";const c=document.createDocumentFragment();if(a&&!S.sel.item){const e=mkChip(STICK,!1,!0);c.appendChild(e)}getSortedVisibleBankWords(S.inv,S.sortMode,S.sortAsc).forEach(e=>{const t=mkChip(e,isWordDisabled(e,n,s),!1);r&&flipPositions.has(e.id)&&(t.style.opacity="0"),c.appendChild(t)}),o.innerHTML="",o.appendChild(c),r&&requestAnimationFrame(()=>playFlipAnimation(o))}function renderConsumables(){const e=document.getElementById("consumables-inline");if(!e)return;e.innerHTML="";const t=S.consumables||[];for(let o=0;o<2;o++){const n=t[o],s=n?CONSUMABLES.find(e=>e.id===n):null,a=document.createElement("div");if(a.className="consumable-pill",s){a.classList.add("has-tooltip");const e=`<div class="tooltip"><div class="tooltip-title">${s.name}</div><div class="tooltip-line">${s.desc}</div></div>`;a.innerHTML=`${s.name}${e}`,a.onclick=()=>{const e=s.use(S);if(e&&"object"==typeof e&&!0===e.success){a.animate([{transform:"scale(1) rotate(0deg)",opacity:1},{transform:"scale(1.1) rotate(-3deg)",opacity:1,offset:.15},{transform:"scale(1.15) rotate(3deg)",opacity:.9,offset:.3},{transform:"scale(0.8) rotate(-2deg)",opacity:.6,offset:.6},{transform:"scale(0.3) rotate(0deg)",opacity:0,offset:1}],{duration:350,easing:"ease-out",fill:"forwards"});const t=a.getBoundingClientRect();burstSparks(t.left+t.width/2,t.top+t.height/2,15,["#fbbf24","#f59e0b","#d97706"]),S.consumables.splice(o,1),S.toolsUsed=(S.toolsUsed||0)+1,S.toolUsedThisBattle=!0,e.affectedWord&&(S._chromaticTarget=e.affectedWord,S._chromaticType=e.effectType),e.sourceWord&&(S._chromaticSource=e.sourceWord);const n=e.effectType;"upgrade"===n?(playBrassTone(330,.1,.07),setTimeout(()=>playBrassTone(392,.1,.07),RHYTHM.QUARTER),setTimeout(()=>playBrassTone(494,.15,.08),RHYTHM.HALF)):"transform"===n?(playBrassTone(494,.1,.06),setTimeout(()=>playBrassTone(330,.1,.06),RHYTHM.QUARTER),setTimeout(()=>playBrassTone(392,.15,.07),RHYTHM.HALF)):"generate"===n||"copy"===n?(playBrassTone(392,.1,.06),setTimeout(()=>playBrassTone(494,.1,.07),RHYTHM.EIGHTH),setTimeout(()=>playBrassTone(659,.15,.08),RHYTHM.QUARTER)):playBrassTone(494,.12,.08)}else playSfxInvalid();showQuickToast((e&&"object"==typeof e?e.message:e)||`${s.name} used`,1500),render(),S._chromaticSource&&(applyChromaticToWord(S._chromaticSource,S._chromaticType,!0),S._chromaticSource=null),S._chromaticTarget&&(applyChromaticToWord(S._chromaticTarget,S._chromaticType),S._chromaticTarget=null,S._chromaticType=null)}}else a.classList.add("empty"),a.textContent="‚Äî";e.appendChild(a)}}function renderTalents(){const e=document.getElementById("talent-bar");if(!e)return;e.innerHTML="";const t=document.getElementById("view-talents-btn");t&&(S.talents&&S.talents.length>0?(t.style.display="block",t.textContent=`Talents (${S.talents.length})`):t.style.display="none"),S.talents&&0!==S.talents.length&&S.talents.forEach(t=>{const o=TALENTS.find(e=>e.id===t)||{},n=document.createElement("div");n.className="chip";const s={common:"tier-1",uncommon:"tier-2",rare:"tier-3"}[o.rarity]||"tier-1",a=o.id?mkTooltip(o):"";n.innerHTML=`<div class="chip-name ${s}">${o.name||t}</div><div class="chip-info">Talent</div>${a}`,n.classList.add("disabled"),e.appendChild(n)})}function openTalentViewer(){const e=document.getElementById("talent-viewer-overlay"),t=document.getElementById("talent-viewer-content");if(e&&t){if(playSfxOpen(),t.innerHTML="",S.hero&&S.hero.passive){const e=S.hero.passive,o=document.createElement("div");o.className="talent-viewer-hero-passive",o.innerHTML=`\n      <span style="color:#6b7280">${S.hero.name}:</span>\n      <span style="color:#9ca3af">${e.name}</span>\n      <span style="color:#4b5563">‚Äî</span>\n      <span style="color:#6b7280;font-style:italic">${e.desc}</span>\n    `,o.style.cssText="text-align:center;font-size:11px;margin-bottom:2px;padding:4px 0;grid-column:1/-1",t.appendChild(o)}if(S.talents&&S.talents.length>0){const e=1+.1*S.talents.length,o=document.createElement("div");o.style.cssText="text-align:center;font-size:11px;color:#6b7280;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid #374151;grid-column:1/-1",o.innerHTML=`Talent Multiplier: <span class="mod-badge scale" style="font-size:10px;padding:2px 6px">√ó${e.toFixed(1)}</span>`,t.appendChild(o)}if(S.talents&&0!==S.talents.length){const e=[S.sel.adj1,S.sel.adj2,S.sel.item,S.sel.adj3,S.sel.adj4,S.sel.noun1].filter(Boolean),o=S.sel.item,n=HEROES.find(e=>e.id===S.heroId)||{},s=S.enemy||{weak:[],resist:[]},a={state:S,allWords:e,weapon:o,hero:n,enemy:s,sel:S.sel},i=[{key:"generator",label:"+W Generators",color:"#60a5fa"},{key:"multiplier",label:"√óMult (Multipliers)",color:"#f472b6"},{key:"retrigger",label:"REREAD",color:"#fb923c"},{key:"converter",label:"Converters",color:"#22d3ee"},{key:"threshold",label:"Thresholds",color:"#a855f7"},{key:"effect",label:"Effects",color:"#a78bfa"},{key:"flat_ap",label:"+AP (Flat Damage)",color:"#4ade80"},{key:"word_ap_bonus",label:"+AP (Per Word)",color:"#4ade80"},{key:"word_count_bonus",label:"+W (Word Count)",color:"#60a5fa"},{key:"multiplicative_mult",label:"√óMult (Multipliers)",color:"#f472b6"},{key:"special",label:"Special",color:"#a78bfa"},{key:"economy",label:"Economy",color:"#fbbf24"}],r={};S.talents.forEach(e=>{const t=TALENTS.find(t=>t.id===e);if(t){const e=t.category||"effect";r[e]||(r[e]=[]),r[e].push(t)}}),i.forEach(e=>{const o=r[e.key];if(!o||0===o.length)return;const n=document.createElement("div");n.style.cssText="margin-bottom:16px";const s=document.createElement("div");s.style.cssText=`font-size:12px;font-weight:bold;color:${e.color};margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid ${e.color}33;letter-spacing:0.1em;text-transform:uppercase`,s.textContent=e.label,n.appendChild(s);const i=document.createElement("div");i.style.cssText="display:grid;grid-template-columns:repeat(2,1fr);gap:8px",o.forEach(e=>i.appendChild(function(e){const t={common:"tier-1",uncommon:"tier-2",rare:"tier-3"}[e.rarity]||"tier-1",o={common:"T1",uncommon:"T2",rare:"T3"}[e.rarity]||"T1";let n="";if(e.apply&&"function"==typeof e.apply)try{const t=e.apply(a);if("flat_ap"===e.category&&0!==t){const e=Math.round(10*t)/10;n=`<span class="mod-badge ${e<0?"neg":"add"}" style="margin-left:8px">${e<0?"":"+"}${e} AP</span>`}else if("word_count_bonus"===e.category&&0!==t){const e=Math.round(10*t)/10;n=`<span class="mod-badge word" style="margin-left:8px">${e<0?"":"+"}${e} W</span>`}else if(("multiplier"===e.category||"multiplicative_mult"===e.category||"threshold"===e.category)&&1!==t){const e=Math.round(10*t)/10;n=`<span class="mod-badge ${e<1?"neg":"scale"}" style="margin-left:8px">√ó${e}</span>`}}catch(e){}let s="";const i=(e.desc||"").toLowerCase(),r="word_count_bonus"===e.category;if(i.includes("per round")){const t=S.roundIndex||1,o=e.desc.match(/\+(\d+\.?\d*)/);if(o){const e=parseFloat(o[1])*t,n=e%1==0?e:parseFloat(e.toFixed(1));s=`<div style="font-size:11px;margin-top:4px">Round ${t} this run: ${r?fmtMod(n,"word"," W"):fmtMod(n,"ap"," AP")}${i.includes("each")||i.includes("per word")||i.includes("/word")?"/Word":""}</div>`}}else if(i.includes("per chapter")){const t=Math.floor((S.roundIndex-1)/9)+1,o=e.desc.match(/\+(\d+\.?\d*)/);if(o){const e=chapterScale(parseFloat(o[1]),t),n=e%1==0?e:parseFloat(e.toFixed(1));s=`<div style="font-size:11px;margin-top:4px">Chapter ${t} this run: ${r?fmtMod(n,"word"," W"):fmtMod(n,"ap"," AP")}${i.includes("each")||i.includes("per word")||i.includes("/word")?"/Word":""}</div>`}}else if("anthology"===e.id){const e=S.uniqueWordsUsed?S.uniqueWordsUsed.size:0,t=Math.min(.5*e,10);s=`<div style="font-size:11px;margin-top:4px">${e} unique words: ${fmtMod(t%1==0?t:parseFloat(t.toFixed(1)),"word"," W")}/Word</div>`}else if("bibliography"===e.id){const e=S.bossesDefeated||0,t=2*e;s=`<div style="font-size:11px;margin-top:4px">${e} bosses √ó 2 = ${0===t?'<span class="mod-badge add">+0 AP</span>':fmtMod(t,"ap"," AP")}/Word</div>`}else if("liquidation"===e.id){const e=S.wordsSold||0,t=.2*e,o=t%1==0?t:parseFloat(t.toFixed(1));s=`<div style="font-size:11px;margin-top:4px">${e} sold √ó 0.2 = ${0===o?'<span class="mod-badge add">+0 AP</span>':fmtMod(o,"ap"," AP")}/Word</div>`}else if("economy"===e.category&&e.goldBonus)try{const t=e.goldBonus(a);s=t>0?`<div style="font-size:11px;margin-top:4px;color:#fbbf24">End of battle: <span style="font-weight:bold">+${t}g</span></div>`:'<div style="font-size:11px;margin-top:4px;color:#6b7280">No bonus yet (use more words!)</div>'}catch(e){}else if("golden_tongue"===e.id){const e=S.gold||0,t=scaleTalentBonus("golden_tongue",1);s=`<div style="font-size:11px;margin-top:4px">${e}g √∑ 20 √ó ${t} = ${fmtMod(Math.floor(e/20)*t,"word"," W")}${getTalentLevel("golden_tongue")>1?` (Lv.${getTalentLevel("golden_tongue")})`:""}</div>`}else if("tithe"===e.id){const e=S.goldSpent||0,t=scaleTalentBonus("tithe",2);s=`<div style="font-size:11px;margin-top:4px">${e}g spent √∑ 20 √ó ${t} = ${fmtMod(Math.floor(e/20)*t,"word"," W")}${getTalentLevel("tithe")>1?` (Lv.${getTalentLevel("tithe")})`:""}</div>`}else if("momentum"===e.id){const e=Math.min((S.roundIndex||1)-1,10);s=`<div style="font-size:11px;margin-top:4px">${e} rounds played: ${fmtMod(e*scaleTalentBonus("momentum",1),"word"," W")}/Word${getTalentLevel("momentum")>1?` (Lv.${getTalentLevel("momentum")})`:""}</div>`}else if("word_historian"===e.id){const e=S.wordsUsedThisRun||0,t=scaleTalentBonus("word_historian",.25),o=Math.floor(e*t);s=`<div style="font-size:11px;margin-top:4px">${e} words used: ${o>0?fmtMod(o,"word"," W"):'<span class="mod-badge word">+0 W</span>'}${getTalentLevel("word_historian")>1?` (Lv.${getTalentLevel("word_historian")})`:""}</div>`}else if("reverberation"===e.id){const e=S.rereadTriggersThisRun||0,t=e*scaleTalentBonus("reverberation",2);s=`<div style="font-size:11px;margin-top:4px">${e} rereads: ${t>0?fmtMod(t,"word"," W"):'<span class="mod-badge word">+0 W</span>'}${getTalentLevel("reverberation")>1?` (Lv.${getTalentLevel("reverberation")})`:""}</div>`}else if("lexicon_growth"===e.id){const e=S.bossesDefeated||0,t=e*scaleTalentBonus("lexicon_growth",1);s=`<div style="font-size:11px;margin-top:4px">${e} bosses: ${0===t?'<span class="mod-badge word">+0 W</span>':fmtMod(t,"word"," W")}/Word${getTalentLevel("lexicon_growth")>1?` (Lv.${getTalentLevel("lexicon_growth")})`:""}</div>`}else if("compound_interest"===e.id){const e=S.gold||0,t=Math.floor(e/50),o=Math.pow(1.15,t);s=`<div style="font-size:11px;margin-top:4px">${e}g √∑ 50 = ${t} stacks: <span class="mod-badge scale">√ó${Math.round(100*o)/100}</span></div>`}else if("overflow"===e.id){const e=[S.sel?.item,S.sel?.adj1,S.sel?.adj2,S.sel?.adj3,S.sel?.adj4,S.sel?.noun1].filter(Boolean).reduce((e,t)=>e+(t.word?.length||t.name?.length||0),0);if(e>50){const t=e-50,o=Math.floor(t/10),n=Math.pow(1.5,o);s=`<div style="font-size:11px;margin-top:4px;color:#4ade80">~${e} W: ${o} stacks = <span class="mod-badge scale">√ó${Math.round(100*n)/100}</span></div>`}else s=`<div style="font-size:11px;margin-top:4px;color:#6b7280">~${e} W (need 50+ to activate)</div>`}else if("word_hoard"===e.id){const e=(S.inv||[]).filter(e=>!e.hiddenInBank).length,t=scaleTalentBonus("word_hoard",.2);s=`<div style="font-size:11px;margin-top:4px">${e} Words √ó ${t} = ${fmtMod(Math.floor(e*t*10)/10,"word"," W")}${getTalentLevel("word_hoard")>1?` (Lv.${getTalentLevel("word_hoard")})`:""}</div>`}else if("slow_burn"===e.id){const e=S.roundIndex||1,t=scaleTalentBonus("slow_burn",2);s=`<div style="font-size:11px;margin-top:4px">Round ${e} √ó ${t} = ${fmtMod(e*t,"word"," W")}${getTalentLevel("slow_burn")>1?` (Lv.${getTalentLevel("slow_burn")})`:""}</div>`}else if("world_sky_focus"===e.id||"body_soul_focus"===e.id){const t=getTalentLevel(e.id);s=`<div style="font-size:11px;margin-top:4px">${fmtMod(5*t,"word"," W")} each${t>1?` (Lv.${t})`:""}</div>`}else if("proficiency_focus"===e.id){const e=Math.floor((S.roundIndex-1)/9)+1,t=8,o=fmtMod("function"==typeof chapterScaleW?chapterScaleW(t,e):t*e,"word"," W");s=`<div style="font-size:11px;margin-top:4px">Chapter ${e} (${S.hero&&S.hero.good?S.hero.good:"?"}): ${o}</div>`}else if("weakness_exploit"===e.id){const e=Math.floor((S.roundIndex-1)/9)+1,t=6;s=`<div style="font-size:11px;margin-top:4px">Chapter ${e}: ${fmtMod("function"==typeof chapterScaleW?chapterScaleW(t,e):t*e,"word"," W")}/Word</div>`}else if("isocolon"===e.id){const e=Math.floor((S.roundIndex-1)/9)+1,t=10;s=`<div style="font-size:11px;margin-top:4px">Chapter ${e}: ${fmtMod("function"==typeof chapterScaleW?chapterScaleW(t,e):t*e,"word"," W")}</div>`}else if("hendiadys"===e.id){const e=Math.floor((S.roundIndex-1)/9)+1,t=6;s=`<div style="font-size:11px;margin-top:4px">Chapter ${e}: ${fmtMod("function"==typeof chapterScaleW?chapterScaleW(t,e):t*e,"word"," W")}</div>`}else if("stony_brook"===e.id)s=`<div style="font-size:11px;margin-top:4px">Bonus: ${fmtMod(12,"word"," W")}</div>`;else if("alliteration"===e.id)s=`<div style="font-size:11px;margin-top:4px">Bonus: ${fmtMod(8,"word"," W")} each</div>`;else if("threshold"===e.category&&"W"===e.resource){const t=e.threshold||0,o=[S.sel?.item,S.sel?.adj1,S.sel?.adj2,S.sel?.adj3,S.sel?.adj4,S.sel?.noun1].filter(Boolean).reduce((e,t)=>e+(t.word?.length||t.name?.length||0),0);s=`<div style="font-size:11px;margin-top:4px;color:${o>=t?"#4ade80":"#9ca3af"}">Current W: ~${o} / ${t}</div>`}else if("fortuna"===e.id){const e=S.gold||0,t=100;s=`<div style="font-size:11px;margin-top:4px;color:${e>=t?"#4ade80":"#9ca3af"}">Current Gold: ${e} / ${t}</div>`}const l=document.createElement("div");l.style.cssText="padding:10px;border:1px solid #4ade8033;border-radius:6px;background:rgba(0,0,0,0.3);display:flex;gap:10px";const c=getTalentLevel(e.id),d=c>1?`<span class="talent-level">Lv.${c}</span>`:"";return l.innerHTML=`\n        <div class="talent-card-icon" style="flex-shrink:0;width:40px;height:52px;margin:0">${getTalentSVG(e.id)}</div>\n        <div style="flex:1;min-width:0">\n          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">\n            <div class="${t}" style="font-size:14px;font-weight:bold">${e.name} ${d}${n}</div>\n            <div style="font-size:10px;color:#9ca3af">${o}</div>\n          </div>\n          <div style="font-size:12px;color:#d1d5db">${formatTalentDesc(e,e.id)}</div>\n          ${s}\n          ${e.flavor?`<div style="font-size:10px;color:#9ca3af;margin-top:4px;font-style:italic">${e.flavor}</div>`:""}\n        </div>\n      `,l}(e))),n.appendChild(i),t.appendChild(n)})}else{const e=document.createElement("div");e.style.cssText="text-align:center;color:#9ca3af;padding:20px",e.textContent="No talents acquired yet.",t.appendChild(e)}e.classList.add("show")}}function mkChip(e,t,o){const n=document.createElement("div");n.className="chip"+(t?" disabled":"")+(o?" rusty":""),"weapon"===e.type&&n.classList.add("weapon-tile"),o||"talent"===e.type||(n.dataset.idx=S.inv.indexOf(e)),e.id&&(n.dataset.wordId=e.id),void 0!==e.elem&&(n.dataset.elem=e.elem);const s=TC[e.rarity];let a="";if(e.isStick)a="Backup";else if("weapon"===e.type){const t=e.category||"";a=t.charAt(0).toUpperCase()+t.slice(1)}else"talent"===e.type&&(a="Talent");let i="";void 0!==e.elem?i=`<div class="chip-elem" style="color:${EC[e.elem]}">${EN[e.elem]}</div>`:e.mult&&1!==e.mult&&(i=`<span class="mod-badge scale" style="margin-top:2px;font-size:9px">√ó${e.mult}</span>`);let r="",l="";const c=["elem-phys","elem-poison","elem-fire","elem-water","elem-light","elem-dark","elem-earth","elem-lightning"],d=["elem-wash-phys","elem-wash-poison","elem-wash-fire","elem-wash-water","elem-wash-light","elem-wash-dark","elem-wash-earth","elem-wash-lightning"];if("elemental"===e.type&&void 0!==e.elem)r=`<div class="chip-tab ${c[e.elem]||""}"></div>`,e.rarity===T.T2?l=` tier-wash-2 ${d[e.elem]||""}`:e.rarity===T.T3&&(l=` tier-wash-3 ${d[e.elem]||""}`);else if("rarity"===e.type){l=` rarity-word ${e.rarity===T.T3?"rarity-t3":e.rarity===T.T2?"rarity-t2":"rarity-t1"}`}l&&(n.className+=l);let p=e.name;"weapon"===e.type||e.isStick||(p=getDisplayForm(e,"noun1",null)||e.name);const f="elemental"===e.type?"":s,u=e.isStick?"":`<div class="chip-tier tier-${e.rarity}">${TN[e.rarity]||"T1"}</div>`;n.innerHTML=`\n    ${r}\n    ${u}\n    <div class="chip-name ${f}">${p}</div>\n    <div class="chip-info">${a}</div>\n    ${i}\n  `,attachDamageTooltip(n),n.__tooltipContent=()=>mkTooltip(e,{bare:!0});const h=n.querySelector(".tooltip.modal-tooltip, .tooltip");return h&&(h.innerHTML=n.__tooltipContent()),t||(n.onclick=()=>{playSample("highlight word.ogg",.5);const t=o?STICK:e;S.pendingWord===t||o&&S.pendingWord?.isStick?S.pendingWord=null:S.pendingWord=t,render()},n.oncontextmenu=e=>e.preventDefault(),n.onmouseenter=sfxHover),(S.pendingWord===e||o&&S.pendingWord?.isStick)&&n.classList.add("selected"),n}function mkTooltip(e,t={}){if("talent"===e.type||e.category&&["flat_ap","additive_mult","multiplicative_mult","multiplier","retrigger","converter","threshold","generator","effect"].includes(e.category)){const o={common:"tier-1",uncommon:"tier-2",rare:"tier-3"}[e.rarity]||"tier-1";let n=[];e.desc&&n.push(`<div class="tooltip-line">${formatTalentDesc(e)}</div>`);const s=`\n      <div class="tooltip-title ${o}">${e.name}</div>\n      ${n.join("")}\n    `;return t?.bare?s:`<div class="tooltip">${s}</div>`}const o=TC[e.rarity],n=e.rarity??e.rarity??0,s=e.isStick?"Backup":TN[n]||TN[e.rarity]||"T1",a=("elemental"===e.type||e.type,S.talents&&S.talents.includes("signature_style")&&"weapon"===e.type&&!e.isStick&&S.hero&&e.category===S.hero.good&&void 0===e.elem);let i=[];const r=e.desc&&/^\+\d+ AP \w+$/.test(e.desc);if(e.desc&&!r&&i.push(`<div class="tooltip-line">${e.desc}</div>`),"weapon"===e.type&&!e.isStick){const t=!(!S.tempEffects||!S.tempEffects.weaponMaster),o=S.hero?.good===e.category,n=S.hero?.bad===e.category;let s="No proficiency",a=1,r="neutral";t?(s="Weapon Master active",a=S.tempEffects.weaponMaster||3,r="word"):o?(s="Good proficiency",a=2,r="word"):n&&(s="Poor proficiency",a=.5,r="penalty"),i.push(`<div class="tooltip-line">${s}: <span class="mod-badge ${r}">√ó${a} W</span></div>`)}if(e.mult&&i.push(`<div class="tooltip-line">Multiplier: ${fmtMod(e.mult,"scale")}</div>`),"weapon"===e.type||"elemental"===e.type||"rarity"===e.type){const{hero:t,enemy:o}=getCombatants(),n=getWordAP(e,{hero:t,enemy:o,allWords:[S.sel?.adj1,S.sel?.adj2,S.sel?.item,S.sel?.adj3,S.sel?.adj4,S.sel?.noun1].filter(Boolean),weapon:S.sel?.item,state:S,talentCount:S.talents?.length||0},null),s=n-getBaseAP(e),a=S.heroSkillBonuses||{};let r="";if("weapon"===e.type){const e=a.weaponAP||0;e>0&&(r=` <span class="dim">(+${e} Skills)</span>`)}else if("rarity"===e.type){const e=a.adjAP||0;e>0&&(r=` <span class="dim">(+${e} Skills in Adj slot)</span>`)}else if("elemental"===e.type){const e=a.nounAP||0;e>0&&(r=` <span class="dim">(+${e} Skills in Noun slot)</span>`)}let l=[];if(s>0&&l.push(`+${Math.floor(s)} Talents`),l.length>0||r){const e=l.length>0?` <span class="dim">(${l.join(", ")})</span>`:"";i.push(`<div class="tooltip-line">Base AP: ${fmtMod(Math.floor(n),"ap")}${e}${r}</div>`)}else i.push(`<div class="tooltip-line">Base AP: ${fmtMod(n,"ap")}</div>`)}const l=[];if(void 0!==e.elem?l.push(e.elem):a&&S.hero.str&&l.push(...S.hero.str),l.length>0&&S.hero&&S.enemy){const{hero:e,enemy:t}=getCombatants();applyModifiers("CALC_INIT",{hero:e,enemy:t,sel:S.sel,state:S});const o=S.tempEffects&&S.tempEffects.polymorph?[]:t.res,n=S.talents&&S.talents.includes("irony"),s={strong:{weak:3,neutral:1.5,strong:1},neutral:{weak:2,neutral:1,strong:.5},weak:{weak:1.5,neutral:.5,strong:0}},r=e=>e>=3?"strong":e>=2?"add":1.5===e?"stalemate":1===e?"neutral":.5===e?"penalty":"neg";if(a&&l.length>1){let e=0;const a=[];if(l.forEach(i=>{const r=S.hero.str.includes(i),l=S.hero.weak.includes(i),c=t.weak.includes(i),d=o.includes(i),p=o.length>0&&o[0]===i,f=n&&d&&p,u=c||f?"weak":d?"strong":"neutral",h=s[r?"strong":l?"weak":"neutral"][u];e+=h,a.push({elem:i,mult:h,ironyApplies:f&&!c})}),e>0){const t=r(e/l.length*2),o=a.map(e=>`${EN[e.elem]}: √ó${e.mult}`).join(", ");i.push(`<div class="tooltip-line">Combined: <span class="mod-badge ${t}">√ó${e} AP</span> <span class="dim">(${o})</span></div>`)}}else{const e=l[0],a=S.hero.str.includes(e),c=S.hero.weak.includes(e),d=t.weak.includes(e),p=o.includes(e),f=o.length>0&&o[0]===e,u=n&&p&&f,h=d||u?"weak":p?"strong":"neutral",m=s[a?"strong":c?"weak":"neutral"][h],y=u&&!d;if(m>=2){const e=r(m),t=y?' <span class="irony-badge">Irony</span>':"";i.push(`<div class="tooltip-line">Effective vs Enemy <span class="mod-badge ${e}">√ó${m} AP</span>${t}</div>`)}else if(m<=.5){const e=`<span class="mod-badge ${0===m?"neg":"penalty"}">√ó${m} AP</span>`;i.push(`<div class="tooltip-line">Resisted by Enemy ${e}</div>`)}else if(m>1){const e=r(m),t=y?' <span class="irony-badge">Irony</span>':"";i.push(`<div class="tooltip-line">Boosted <span class="mod-badge ${e}">√ó${m} AP</span>${t}</div>`)}}}const c=WORD_FORMS[e.id];if(c){const t=c.adjPrimary||c.adjForm||e.name,o=c.adjAlt&&c.adjAlt!==t?c.adjAlt:null,n=c.noun||c.nounForm||e.name;if(t!==e.name||n!==e.name||o){const e=o?`${t} (alt: ${o})`:t;i.push(`<div class="tooltip-line dim">Adjective form: ${e}</div>`),i.push(`<div class="tooltip-line dim">Noun form: ${n}</div>`)}}if(S.talents&&S.talents.length>0){const t=getTalentBonusesForWord(e);t.length>0&&(i.push('<div class="tooltip-talents">'),t.forEach(e=>{const t="W"===e.type?"word":"AP"===e.type?"ap":"scale",o=(e.type,"x"===e.type?"":` ${e.type}`);i.push(`<div class="tooltip-talent-row"><span class="talent-name-badge">${e.name}</span> ${fmtMod(e.value,t,o)}</div>`)}),i.push("</div>"))}let d="";if(void 0!==e.elem&&(d=`<span class="tooltip-elem" style="background:${EC[e.elem]}33;color:${EC[e.elem]}">${EN[e.elem]}</span>`),a&&S.hero.str&&S.hero.str.length>0){d=S.hero.str.map(e=>`<span class="tooltip-elem" style="background:${EC[e]}33;color:${EC[e]}">${EN[e]}</span>`).join(" "),i.push(`<div class="tooltip-line"><span class="talent-name-badge">Signature Style</span> Gains ${S.hero.str.map(e=>EN[e]).join(" + ")}</div>`)}const p=[s];d&&p.push(d);const f=`\n    <div class="tooltip-title ${o}">${e.name}</div>\n    <div class="tooltip-type">${p.join(" ")}</div>\n    ${i.join("")}\n  `;return t?.bare?f:`<div class="tooltip">${f}</div>`}function formatDamageBreakdown(e){const t=e||(S.sel.item?calc({breakdown:!0}):null);if(!t||!t.breakdown)return"";const o=t,n=e=>Number.isInteger(e)?e:parseFloat(e.toFixed(2));function s(e,t="ap"){const o={},n=[];e.forEach(e=>{let s=null,a=0;if("ap"===t){const t=e.match(/\(([^)]+)\)\s*$/),o=e.match(/<\/span>\s*(.+?)(?:\s*\(|$)/),n=e.match(/AP\s+(.+?)(?:\s*\(|$)/);t?s=t[1].trim():o?s=o[1].trim():n&&(s=n[1].trim());const i=e.match(/[+]?([\d.]+)\s*(?:AP)?/);i&&(a=parseFloat(i[1]))}else if("mult"===t){const t=e.match(/√ó([\d.]+)/),o=e.match(/<\/span>\s*(.+?)(?:\s*\(|$)/)||e.match(/√ó[\d.]+\s+(.+?)(?:\s*\(|$)/);o&&(s=o[1].trim()),t&&(a=parseFloat(t[1]))}else if("word"===t){const t=e.match(/[+]?([\d.]+)\s*W/i),o=e.match(/<\/span>\s*(.+?)(?:\s*\(|$)/)||e.match(/W\s+(.+?)(?:\s*\(|$)/i);o&&(s=o[1].trim()),t&&(a=parseFloat(t[1]))}s&&(s=s.replace(/<[^>]+>/g,"").trim()),s&&a&&s.length>0&&s.length<50?(o[s]||(o[s]={total:0,count:0,mode:t}),"mult"===t?o[s].total=0===o[s].total?a:o[s].total*a:o[s].total+=a,o[s].count++):n.push(e)});const s=[];return Object.entries(o).forEach(([e,t])=>{const o=t.count>1?` (√ó${t.count})`:"";"ap"===t.mode?s.push(`${fmtMod(t.total,"ap"," AP")} ${e}${o}`):"mult"===t.mode?s.push(`${fmtMod(t.total,"scale")} ${e}${o}`):"word"===t.mode&&s.push(`${fmtMod(t.total,"word"," W")} ${e}${o}`)}),[...s,...n]}const a=[],i=[],r=[];o.breakdown.base.forEach(e=>{e.includes("REREAD")?r.push(e):e.match(/^\+[\d.]+ [A-Z]/i)&&!e.includes("(")||e.match(/^\+[\d.]+ [A-Z][a-z]+\s*\(/)?a.push(e):i.push(e)});const l=[],c=[];o.breakdown.multipliers.forEach(e=>{e.includes("REREAD")?r.push(e):e.includes(" W ")||e.includes(" W<")?l.push(e):c.push(e)});const d=s(i,"ap"),p=s(l,"word"),f=s(c,"mult");f.sort((e,t)=>{const o=e=>{const t=e.match(/√ó([\d.]+)/);return t?parseFloat(t[1]):1};return o(t)-o(e)});let u='<div class="tooltip-title">Damage Breakdown</div>';if(u+='<div class="breakdown-grid">',u+='<div class="breakdown-col">',u+='<div class="breakdown-section-title">AP Sources</div>',a.forEach(e=>{u+=`<div class="tooltip-line" style="font-size:10px">${e}</div>`}),d.length&&d.forEach(e=>{u+=`<div class="tooltip-line" style="font-size:10px;color:#4ade80">${e}</div>`}),u+="</div>",u+='<div class="breakdown-col">',u+='<div class="breakdown-section-title">Word Count</div>',u+=`<div class="tooltip-line" style="font-size:10px">${fmtMod(o.breakdown.wordCount,"word"," W")} Base Words</div>`,p.length&&p.forEach(e=>{u+=`<div class="tooltip-line" style="font-size:10px">${e}</div>`}),u+="</div>",u+="</div>",u+='<div class="breakdown-row" style="justify-content:center;gap:12px;margin:6px 0 8px 0;flex-wrap:wrap">',u+=`<div class="breakdown-total" style="min-width:120px"><span class="label">Total AP</span><span class="value">${n(o.baseAP)}</span></div>`,u+=`<div class="breakdown-total" style="min-width:120px"><span class="label">Total W</span><span class="value">${n(o.breakdown.wordCount)}</span></div>`,u+="</div>",u+='<div class="breakdown-section">',u+='<div class="breakdown-section-title">Global Multipliers</div>',f.length?f.forEach(e=>{u+=`<div class="tooltip-line" style="font-size:10px">${e}</div>`}):u+='<div class="tooltip-line" style="font-size:10px;color:#9ca3af">None</div>',u+=`<div class="breakdown-total"><span class="label">Total √ó</span><span class="value">${fmtMod(o.totalMultiplier,"scale")}</span></div>`,u+="</div>",r.length){u+='<div class="breakdown-section">',u+='<div class="breakdown-section-title" style="color:#fb923c">Rereads</div>';const e={};r.forEach(t=>{const o=t.match(/\((\w+)\s+REREAD\)/);if(o){const n=o[1];e[n]||(e[n]={apTotal:0,multTotal:1,count:0,hasMult:!1});const s=t.match(/^\+?([\d.]+)\s*AP/i)||t.match(/>([+-]?[\d.]+)<\/span>\s*AP/i),a=t.match(/√ó([\d.]+)/);s?(e[n].apTotal+=parseFloat(s[1]),e[n].count++):a&&(e[n].multTotal*=parseFloat(a[1]),e[n].hasMult=!0)}else u+=`<div class="tooltip-line breakdown-reread" style="font-size:10px">${t}</div>`}),Object.entries(e).forEach(([e,t])=>{const o=t.count>1?` (√ó${t.count})`:"";t.apTotal>0&&(u+=`<div class="tooltip-line breakdown-reread" style="font-size:10px">${fmtMod(t.apTotal,"ap"," AP")} ${e} REREAD${o}</div>`),t.hasMult&&1!==t.multTotal&&(u+=`<div class="tooltip-line breakdown-reread" style="font-size:10px">${fmtMod(t.multTotal,"scale")} ${e} REREAD${o}</div>`)}),u+="</div>"}if(o.breakdown.words.length){let e=s(o.breakdown.words.filter(e=>!e.includes("REREAD")),"ap");e.filter(e=>!e.includes("(√ó")).length>3&&(e=s(e,"mult")),e.length&&(u+='<div style="margin-top:6px">',u+='<div class="breakdown-section-title">Word Effects</div>',e.forEach(e=>{u+=`<div class="tooltip-line" style="font-size:10px">${e}</div>`}),u+="</div>")}const h=o.heroDmg,m=o.totalMultiplier>1?`(${n(o.baseAP)} AP √ó ${n(o.breakdown.wordCount)} W) √ó ${n(o.totalMultiplier)}`:`${n(o.baseAP)} AP √ó ${n(o.breakdown.wordCount)} W`;return u+='<div class="breakdown-formula-row">',u+=`<div class="breakdown-formula">${m}</div>`,u+='<div class="breakdown-formula-equals">=</div>',u+=`<div class="breakdown-formula-total">${h}</div>`,u+="</div>",u}function fitCombatBreakdownTooltip(e){e&&(e.style.transform="translate(-50%, -50%) scale(1)",e.style.maxHeight="none",e.style.overflow="visible",e.style.transformOrigin="center center",requestAnimationFrame(()=>{const t=e.getBoundingClientRect(),o=.82*window.innerHeight,n=.92*window.innerWidth,s=t.height>o?o/t.height:1,a=t.width>n?n/t.width:1,i=Math.min(s,a),r=i<1?Math.max(i,.6):1,l=t.height*r,c=Math.max(12,(window.innerHeight-l)/2);e.style.left="50%",e.style.top=`${c}px`,e.style.transform=`translate(-50%, 0) scale(${r})`,e.style.maxHeight=`${Math.floor(o)}px`,e.style.overflow="auto"}))}function getSharedBreakdownContent(e){return formatDamageBreakdown(e)||'<div class="tooltip-line">Forge a weapon to see the breakdown.</div>'}function attachDamageTooltip(e){if(!e)return;let t;e.classList.add("has-tooltip"),e.setAttribute("tabindex","0");const o="damage-preview-text"===e.id||"combat-result"===e.id||"combat-total"===e.id;if(o){const o=e.querySelector(".tooltip.modal-tooltip");o&&o.remove();const n=e.id+"-tooltip-portal";t=document.getElementById(n),t?t.classList.add("breakdown-tooltip"):(t=document.createElement("div"),t.id=n,t.className="modal-tooltip",t.classList.add("breakdown-tooltip"),t.style.cssText="\n        position: fixed !important;\n        z-index: 999999 !important;\n        pointer-events: none !important;\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.98);\n        transition: opacity 0.12s ease, transform 0.12s ease;\n\n        /* Sizing Logic: Grow with text, but don't get too wide */\n        width: auto !important;\n        min-width: 300px !important;\n        height: auto !important;\n        max-width: 560px !important;\n        white-space: normal !important;\n        word-wrap: break-word !important;\n        overflow-wrap: break-word !important;\n\n        /* Visuals (Replicating .tooltip style manually since we removed the class) */\n        background: #1a1d24 !important;\n        border: 1px solid #4b5563 !important;\n        border-radius: 8px !important;\n        padding: 12px !important;\n        box-shadow: 0 10px 30px rgba(0,0,0,0.9) !important;\n        color: #e5e7eb !important;\n        font-size: 11px !important;\n        line-height: 1.4 !important;\n        text-align: left !important;\n        max-height: none !important;\n        overflow: visible !important;\n      ",document.body.appendChild(t))}else t=e.querySelector(".tooltip.modal-tooltip"),t||(t=document.createElement("div"),t.className="tooltip modal-tooltip",t.style.whiteSpace="normal",t.style.pointerEvents="none",e.appendChild(t));if(e.__tooltipAttached)return;e.__tooltipAttached=!0;const n=e.classList.contains("click-tooltip"),s=()=>{const s="function"==typeof e.__tooltipContent?e.__tooltipContent()||"":e.__tooltipContent||"";t.innerHTML=s,o&&(t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%) scale(1)"),n&&(t.style.pointerEvents="auto"),t.style.opacity=s?"1":"0",t.dataset.visible=s?"true":"false"},a=()=>{t.style.opacity="0",t.dataset.visible="false",o&&(t.style.transform="translate(-50%, -50%) scale(0.98)")};if(n){const o=e=>{e.stopPropagation();"true"===t.dataset.visible?a():s()};e.addEventListener("click",o),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o(e))}),document.addEventListener("click",t=>{e.contains(t.target)||a()})}else["mouseenter","focus"].forEach(t=>e.addEventListener(t,s)),["mouseleave","blur"].forEach(t=>e.addEventListener(t,a))}function isWordDisabled(e,t,o){if("weapon"!==e.type&&!t)return!0;if("weapon"===e.type&&S.sel.item)return!0;if("rarity"===e.type){if(["adj1","adj2","adj3","adj4","noun1"].some(e=>S.sel[e]&&"rarity"===S.sel[e].type))return!0}const n=!!(S.sel.adj1&&S.sel.adj2&&S.sel.adj3&&S.sel.adj4),s=!!S.sel.noun1;return"weapon"!==e.type&&(n&&s)}function clickWord(e,t=null){let o;t&&!gfxSettings.lowFx&&t.classList.add("popping-out"),"weapon"===e.type?(S.sel.item=e,o="item"):S.sel.adj1?S.sel.adj2?S.sel.adj3?S.sel.adj4?S.sel.noun1?(S.sel.adj1=e,o="adj1"):(S.sel.noun1=e,o="noun1"):(S.sel.adj4=e,o="adj4"):(S.sel.adj3=e,o="adj3"):(S.sel.adj2=e,o="adj2"):(S.sel.adj1=e,o="adj1");const n=t&&!gfxSettings.lowFx?120:0,s=document.querySelector(`[data-slot="${o}"].slot`),a=s?s.getBoundingClientRect():null;setTimeout(()=>{setTimeout(()=>{if(s&&a){if(burstSparks(a.left+a.width/2,a.top+a.height/2,10,getElementSparkColors(e),!1),!gfxSettings.lowFx){const e=s.querySelector(".slot-content");e&&(e.classList.add("popping-in"),setTimeout(()=>e.classList.remove("popping-in"),RHYTHM.HALF))}}},50),render()},n)}function createAuraAnimation(e,t,o){playElementalEffect(e,document.getElementById("weapon-svg"),o)}function attachParallaxTilt(e){if(!e||e.dataset.parallaxInit)return;const t=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,o=!window.matchMedia||window.matchMedia("(hover: hover)").matches;if(t||!o)return e.dataset.parallaxEnabled="false",void(e.dataset.parallaxInit="1");e.addEventListener("pointermove",t=>{if(gfxSettings.lowFx)return;const o=e.getBoundingClientRect(),n=(t.clientX-o.left)/o.width-.5,s=(t.clientY-o.top)/o.height-.5;e.style.setProperty("--tilt-y",`${(3*n).toFixed(2)}deg`),e.style.setProperty("--tilt-x",`${(3*-s).toFixed(2)}deg`)}),e.addEventListener("pointerleave",()=>{e.style.setProperty("--tilt-x","0deg"),e.style.setProperty("--tilt-y","0deg")}),e.dataset.parallaxEnabled="true",e.dataset.parallaxInit="1"}function ensureWeaponLayers(e){const t="string"==typeof e?$(e):e;if(!t)return null;t.classList.add("weapon-canvas");const o=t.querySelector(".weapon-layered");(!o||!o.querySelector(".weapon-layer.gem"))&&(t.innerHTML='<div class="weapon-layered" style="transform:rotate(15deg)"><div class="weapon-shadow"></div><svg class="weapon-layer base" viewBox="0 0 100 130"></svg><svg class="weapon-layer gem" viewBox="0 0 100 130"></svg><svg class="weapon-layer adj adj1" viewBox="0 0 100 130"></svg><svg class="weapon-layer adj adj2" viewBox="0 0 100 130"></svg><svg class="weapon-layer adj adj3" viewBox="0 0 100 130"></svg><svg class="weapon-layer adj adj4" viewBox="0 0 100 130"></svg><div class="weapon-glow"></div></div>',attachParallaxTilt(t.querySelector(".weapon-layered")));const n=t.querySelector(".weapon-layered");n.style.transform="rotate(15deg)";const s=t.querySelector(".weapon-layer.base"),a=t.querySelector(".weapon-layer.gem"),i=t.querySelector(".weapon-layer.adj1"),r=t.querySelector(".weapon-layer.adj2"),l=t.querySelector(".weapon-layer.adj3"),c=t.querySelector(".weapon-layer.adj4"),d=t.querySelector(".weapon-glow"),p=t.querySelector(".weapon-shadow");return{host:t,wrapper:n,base:s,gem:a,adj1:i,adj2:r,adj3:l,adj4:c,flair1:a,flair2:i,glow:d,shadow:p}}function clearWeaponLayers(e){e&&(e.base&&(e.base.innerHTML=""),e.gem&&(e.gem.innerHTML=""),e.adj1&&(e.adj1.innerHTML=""),e.adj2&&(e.adj2.innerHTML=""),e.adj3&&(e.adj3.innerHTML=""),e.adj4&&(e.adj4.innerHTML=""),e.glow&&(e.glow.style.background="none"),e.shadow&&(e.shadow.style.background="none"))}function setupEvents(){["item","adj1","adj2","adj3","adj4","noun1"].forEach(e=>{const t=document.querySelector(`[data-slot="${e}"].slot`);t&&(t.onclick=()=>{const o=S.pendingWord;if(o){if("weapon"===o.type&&"item"!==e)return;if("weapon"!==o.type&&"item"===e)return;const n=performance.now(),s={},a=!(!S.sel[e]||"item"===e);a&&(stopRarityDrone(e),S.sel[e]=null),"item"===e?(clrSel(),S.sel.item=o):S.sel[e]=o,S.pendingWord=null,t.classList.add("word-placed"),setTimeout(()=>t.classList.remove("word-placed"),RHYTHM.HALF),s.stateMs=performance.now()-n;const i=performance.now();try{const t=["adj_common","adj_uncommon","adj_magic","adj_rare","adj_epic","adj_legendary"];o.id&&t.includes(o.id)&&(playRarityDrone(o.id),playSample("rarity.ogg",.5));const n=getSlotPan(e);if("noun1"===e&&playSample("gem.ogg",.7,n),"item"!==e||"weapon"!==o.type||o.isStick||("slash"===o.category?playSample("insert sword bow type.ogg",.8,n):"pierce"===o.category?playSample("insert bow type.ogg",.8,n):"blunt"===o.category?playSample("insert blunt.ogg",.8,n):"magic"===o.category&&playSample("insert wand sound.ogg",.8,n)),void 0!==o.elem){const e=ELEMENT_SAMPLES[o.elem];if(e){playSample(e,o.elem===E.LIGHTNING||o.elem===E.PHYS?.5:.3,n)}}}catch(e){}s.soundMs=performance.now()-i;const r=performance.now(),l=t.getBoundingClientRect();burstSparks(l.left+l.width/2,l.top+l.height/2,10,getElementSparkColors(o),!1),createAuraAnimation(t,e,o),s.fxMs=performance.now()-r;const c=performance.now();gfxSettings.lowFx||(justPlacedSlot=e,recordFlipPositions($("#bank")),pendingBankFlip=!0),s.flipMs=performance.now()-c;const d=performance.now();return _fastRemoveWordId=a?null:o.id||null,render(),s.renderMs=performance.now()-d,s.totalMs=performance.now()-n,"function"==typeof window.logPerfEvent&&window.logPerfEvent("WORD_SLOT",{word:o.text||o.id||"unknown",slot:e,lowFx:gfxSettings.lowFx,...s}),void(ONBOARD.active&&onOnboardingWordPlaced(o,e))}if(S.sel[e]){S.sel[e];playSample("highlight word.ogg",.5),stopRarityDrone(e),gfxSettings.lowFx||(recordFlipPositions($("#bank")),pendingBankFlip=!0),S.sel[e]=null,"item"===e&&(stopAllRarityDrones(),S.sel.adj1=null,S.sel.adj2=null,S.sel.adj3=null,S.sel.adj4=null,S.sel.noun1=null),render()}})}),document.body.__clickSparksAttached||(document.body.__clickSparksAttached=!0,document.body.addEventListener("click",e=>{if(gfxSettings.lowFx)return;const t=e.target;"BUTTON"===t.tagName||t.closest("button")||t.classList.contains("word")||t.classList.contains("slot")||t.classList.contains("consumable-item")||t.classList.contains("crate")||createFizzySparks(e.clientX,e.clientY,{count:6,colors:["#ff9933","#ffcc00","#ffaa44"],shape:"line",size:4,velocity:3,gravity:.15,duration:800,initialOpacity:.85})}))}function renderWeapon(e="#weapon-svg"){const t=ensureWeaponLayers(e),o=S.sel;if(!t)return;if("#weapon-svg"===e){const e=document.querySelector("#weapon-display .weapon-canvas");e&&e.classList.remove("fly-out")}if(!o.item){if(clearWeaponLayers(t),"#weapon-svg"===e){$("#weapon-name").textContent="";const e=document.getElementById("weapon-aura");e&&(e.style.background="none")}else if("#combat-weapon-svg"===e){const e=document.getElementById("combat-weapon-aura");e&&(e.style.background="none")}return}const n=o.item.isStick?"stick":o.item.id,s=WEAPON_SVG[n],a=BASE_COLORS[n],i=o.noun1&&void 0!==o.noun1.elem?EC[o.noun1.elem]:"transparent",r=o.adj1&&void 0!==o.adj1.elem?EC[o.adj1.elem]:"transparent",l=o.adj2&&void 0!==o.adj2.elem?EC[o.adj2.elem]:"transparent",c=o.adj3&&void 0!==o.adj3.elem?EC[o.adj3.elem]:"transparent",d=o.adj4&&void 0!==o.adj4.elem?EC[o.adj4.elem]:"transparent";if(t.base&&(t.base.innerHTML=s.base.replace(/BASECOLOR/g,a)),t.gem&&s.gem&&(t.gem.innerHTML=o.noun1?s.gem.replace(/GEMCOLOR/g,i):""),t.adj1&&s.adj1&&(t.adj1.innerHTML=o.adj1?s.adj1.replace(/ADJ1COLOR/g,r):""),t.adj2&&s.adj2&&(t.adj2.innerHTML=o.adj2?s.adj2.replace(/ADJ2COLOR/g,l):""),t.adj3&&s.adj3&&(t.adj3.innerHTML=o.adj3?s.adj3.replace(/ADJ3COLOR/g,c):""),t.adj4&&s.adj4&&(t.adj4.innerHTML=o.adj4?s.adj4.replace(/ADJ4COLOR/g,d):""),t.shadow&&(t.shadow.style.background=`radial-gradient(circle at 50% 10%, ${a}40 0%, ${a}30 15%, ${a}18 30%, ${a}08 45%, transparent 65%)`),"#weapon-svg"===e){const e=document.getElementById("weapon-aura");if(e){const t=o.noun1&&void 0!==o.noun1.elem?i:a;e.style.background=`radial-gradient(circle, ${t}50 0%, ${t}40 10%, ${t}30 20%, ${t}20 35%, ${t}10 50%, ${t}08 60%, ${t}04 70%, ${t}02 80%, transparent 90%)`}}else if("#combat-weapon-svg"===e){const e=document.getElementById("combat-weapon-aura");if(e){const t=o.noun1&&void 0!==o.noun1.elem?i:a;e.style.background=`radial-gradient(circle, ${t}50 0%, ${t}40 10%, ${t}30 20%, ${t}20 35%, ${t}10 50%, ${t}08 60%, ${t}04 70%, ${t}02 80%, transparent 90%)`}}if("#weapon-svg"===e){const e=buildWeaponNameParts(),t=buildWeaponNameFromParts(e),o=$("#weapon-name");o&&(o.setAttribute("aria-label",t),o.innerHTML=e.map(e=>{const t=escapeHtml(e.text);return e.italic?`<em class="connector-phrase">${t}</em>`:t}).join(" "))}}function renderWeaponProgress(e,t){const o=ensureWeaponLayers(e),n=S.sel||{};if(!o)return;if(!n.item)return void clearWeaponLayers(o);const s=n.item.isStick?"stick":n.item.id,a=WEAPON_SVG[s];if(!a)return void clearWeaponLayers(o);const i=BASE_COLORS[s]||"#888",r=n.noun1&&void 0!==n.noun1.elem?EC[n.noun1.elem]:"transparent",l=n.adj1&&void 0!==n.adj1.elem?EC[n.adj1.elem]:"transparent",c=n.adj2&&void 0!==n.adj2.elem?EC[n.adj2.elem]:"transparent",d=n.adj3&&void 0!==n.adj3.elem?EC[n.adj3.elem]:"transparent",p=n.adj4&&void 0!==n.adj4.elem?EC[n.adj4.elem]:"transparent";function f(e,t){if(!e)return;const o=""!==e.innerHTML.trim(),n=t&&""!==t.trim();e.innerHTML=t||"",!o&&n&&(e.classList.remove("slam-in"),requestAnimationFrame(()=>{requestAnimationFrame(()=>e.classList.add("slam-in"))}))}f(o.base,t>0?a.base.replace(/BASECOLOR/g,i):""),a.adj1&&f(o.adj1,t>=.3&&n.adj1?a.adj1.replace(/ADJ1COLOR/g,l):""),a.adj2&&f(o.adj2,t>=.4&&n.adj2?a.adj2.replace(/ADJ2COLOR/g,c):""),a.adj3&&f(o.adj3,t>=.5&&n.adj3?a.adj3.replace(/ADJ3COLOR/g,d):""),a.adj4&&f(o.adj4,t>=.6&&n.adj4?a.adj4.replace(/ADJ4COLOR/g,p):""),a.gem&&f(o.gem,t>=.8&&n.noun1?a.gem.replace(/GEMCOLOR/g,r):""),o.glow&&(o.glow.style.background=t>=1?`radial-gradient(circle at 50% 35%, ${"transparent"!==r?r:i}55, transparent 70%)`:"none"),o.shadow&&(o.shadow.style.background=`radial-gradient(circle at 50% 10%, ${i}40 0%, ${i}30 15%, ${i}18 30%, ${i}08 45%, transparent 65%)`)}function buildWeaponNameParts(){const e=S.sel,t=[];function o(o,n){o&&t.push({text:getDisplayForm(o,n,e),italic:!1})}return o(e.adj1,"adj1"),o(e.adj2,"adj2"),o(e.item,"item"),e.noun1&&(t.push({text:"of the",italic:!0}),o(e.adj3,"adj3"),o(e.adj4,"adj4"),o(e.noun1,"noun1")),t}function buildWeaponNameFromParts(e=buildWeaponNameParts()){return e.map(e=>e.text).join(" ")}function getCombatants(){S.hero||console.warn("[combat] Missing hero data; using defaults"),S.enemy||console.warn("[combat] Missing enemy data; using defaults");const e={hp:100,str:[],weak:[],good:null,bad:null,name:"Hero",...S.hero||{}},t={hp:50,ap:0,weak:[],res:[],name:"Enemy",...S.enemy||{}};return e.str&&(e.str=[...e.str]),e.weak&&(e.weak=[...e.weak]),t.weak&&(t.weak=[...t.weak]),t.res&&(t.res=[...t.res]),{hero:e,enemy:t}}function calc(e={}){const t=!(!e.breakdown&&!e.wantBreakdown),o=t?{base:[],words:[],multipliers:[],wordCount:0}:null,{hero:n,enemy:s}=getCombatants(),a=S.sel,i=e=>S.talents.includes(e),r=!(!S.tempEffects||!S.tempEffects.weaponMaster);applyModifiers("CALC_INIT",{hero:n,enemy:s,sel:a,state:S,breakdown:o});const l=e=>!(S.tempEffects&&S.tempEffects.polymorph)&&s.res.includes(e),c=S.tempEffects&&S.tempEffects.disableBossAbility,d=c?null:S.blockedSlot,p=S.chapterBoss&&"dotdotdot"===S.chapterBoss.id&&!c,f={...a};d&&f[d]&&(f[d]=null),p&&(f.noun1=null);const u=[f.adj1,f.adj2,f.item,f.adj3,f.adj4,f.noun1].filter(Boolean),h={hero:n,enemy:s,allWords:u,weapon:a.item,sel:a,state:S,talentCount:S.talents.length,breakdown:o};let m=0;i("battle_hardened")&&(m+=S.battleHardenedBonus,t&&S.battleHardenedBonus&&o.base.push(`${fmtMod(S.battleHardenedBonus,"ap"," AP")} Battle Hardened`));const y=S.inv.filter(e=>!e.hiddenInBank).length;if(i("word_hoarder")&&y>15){const e=(y-15)*scaleTalentBonus("word_hoarder",1);m+=e,t&&o.base.push(`${fmtMod(e,"ap"," AP")} Word Hoarder`)}if(i("descriptive")){const e=u.filter(e=>"rarity"===e.type).length*scaleTalentBonus("descriptive",1);m+=e,t&&e&&o.base.push(`${fmtMod(e,"ap"," AP")} Descriptive`)}let g=0,w=null;const x={};i("sharpening_stone")&&u.forEach((e,t)=>{!e.isStick&&Math.random()<.25&&(x[t]=1)});let v=0;w=null;const b=new Map,k=S.tempEffects&&S.tempEffects.disableBossAbility;let L=null;S.chapterBoss&&"plague_doctor"===S.chapterBoss.id&&!k&&n.str&&n.str.length>0&&(L=n.str[0]);let T=null;const M=S.tempEffects&&S.tempEffects.disableBossAbility,A=S.chapterBoss&&"oxy"===S.chapterBoss.id&&!M,P=new Set(u.filter(e=>void 0!==e.elem).map(e=>e.elem)),$=[];A&&P.forEach(e=>{const t=OPPOSITE_ELEMENTS[e];void 0!==t&&P.has(t)&&$.push([e,t])});const R=Math.floor((S.roundIndex-1)/9)+1,C=new Map;u.forEach(e=>{e&&void 0!==e.elem&&C.set(e.elem,(C.get(e.elem)||0)+1)});new Set(Array.from(C.entries()).filter(([e,t])=>t>1).map(([e])=>e));const I=u.filter(e=>e&&!e.isStick),_=I.length>0&&I.every(e=>e.rarity===I[0].rarity),B=["adj1","adj2","adj3","adj4"].filter(e=>S.sel[e]).length>=2,Q=(u.filter(e=>e&&void 0!==e.elem).length,new Set);for(let e=1;e<u.length;e++){const t=u[e-1],o=u[e];if(!t||!o)continue;const n=(t.name||"").charAt(0).toLowerCase(),s=(o.name||"").charAt(0).toLowerCase();n&&n===s&&(Q.add(t),Q.add(o))}["item","adj1","adj2","adj3","adj4","noun1"].forEach(e=>{const a=f[e];if(!a)return;if(a.isStick)return void(w=a);let c=u.indexOf(a),d=getWordAP(a,h,e);if(t){const e=S.roundIndex||1;if(i("arsenal_mastery")&&"weapon"===a.type){const t=3*e;o.words.push(`${fmtMod(t,"ap"," AP")} Arsenal Mastery (${a.name})`)}}c>=0&&x[c]&&(d=Math.min(3,d+1)),i("pyromancer")&&a.elem===E.FIRE&&(d=Math.min(3,d+1),t&&o.words.push(`${fmtMod(1,"ap"," AP")} Pyromancer (${a.name})`)),i("scribe_sigil")&&(d+=1,t&&o.words.push(`${fmtMod(1,"ap"," AP")} Scribe's Sigil (${a.name})`));let p=1,m=0,y=a.elem,k=[];if(i("signature_style")&&"item"===e&&!a.isStick&&a.category===n.good&&void 0===y&&(k=[...n.str],y=n.str[0],p+=1,t&&k.length>0)){const e=k.map(e=>EN[e]).join(" + ");o.words.push(`Signature Style: ${a.name} gains ${e}`),o.multipliers.push(`${fmtMod(1,"word"," W")} Signature Style (dual elements)`)}if("item"===e&&!a.isStick&&a.category)if(r){const e=S.tempEffects.weaponMaster||2;p=parseFloat((p*e).toFixed(2)),t&&o.multipliers.push(`${fmtMod(e,"scale")} Weapon Master W (${a.name})`)}else if(n.good===a.category)p=parseFloat((2*p).toFixed(2)),t&&o.multipliers.push(`${fmtMod(2,"scale")} Proficiency W (${a.name})`);else if(n.bad===a.category)if(i("overcoming")){const e=scaleTalentMult("overcoming",1.5);p=parseFloat((p*e).toFixed(2)),t&&o.multipliers.push(`${fmtMod(e,"scale")} Overcoming W (${a.name})`)}else p=parseFloat((.5*p).toFixed(2)),t&&o.multipliers.push(`${fmtMod(.5,"scale"," W")} Poor Proficiency (${a.name})`);let M=1,P=!1,C=!1,I=!1;const Q=hasCapstone("Alexandria Constanza")&&"Alexandria Constanza"===n.name;function G(e,a,r=!1){let c=1,d=!1,p=!1,f=!1;if(A&&$.length>0){if($.some(t=>t.includes(e)))return t&&!r&&o.words.push(`Oxy: ${EN[e]} nullified by contradiction! (${a})`),{mult:0,nullified:!0,flipped:!1,plagiarized:!1}}let u=e;if(Q&&(e===E.FIRE||e===E.LIGHT)){const t=e===E.FIRE?E.LIGHT:E.FIRE,o=s.weak&&s.weak.includes(e),n=s.weak&&s.weak.includes(t),a=l(e),i=l(t);(!o&&n||a&&!i)&&(u=t,f=!0)}const h=n.str.includes(u),m=n.weak.includes(u),y=s.weak.includes(u);let g=l(u);if(L===e)return p=!0,{mult:0,nullified:!0,flipped:!1,plagiarized:!0,elem:e};const w=h?"strong":m?"weak":"neutral";let x=y?"weak":g?"strong":"neutral";i("irony")&&"strong"===x&&(null!==T&&T!==e||(T=e,x="weak",d=!0));return c={strong:{weak:3,neutral:1.5,strong:1},neutral:{weak:2,neutral:1,strong:.5},weak:{weak:1.5,neutral:.5,strong:0}}[w][x],{mult:c,nullified:!1,flipped:d,plagiarized:p,elem:e,trinityUsed:f,effectiveElem:u}}if(k.length>1){let e=0;for(const n of k){const s=G(n,a.name,!1);e+=s.mult,s.flipped&&(P=!0),s.plagiarized&&(I=!0),s.nullified&&(C=!0),t&&s.mult>0&&o.words.push(`${EN[n]}: <span class="mod-badge add">√ó${s.mult.toFixed(1)} AP</span> (${a.name})`)}M=e}else if(void 0!==y){const e=G(y,a.name);M=e.mult,P=e.flipped,I=e.plagiarized,C=e.nullified,t&&e.trinityUsed&&o.words.push(`Trinity: ${EN[y]} ‚Üí ${EN[e.effectiveElem]} (${a.name})`),t&&P&&o.words.push(`Irony: ${EN[y]} resist ‚Üí weak! (${a.name})`),t&&I&&!P&&o.words.push(`Plagiarized: ${EN[y]} (your Strength) resisted! (${a.name})`)}let O=d*M;v+=O;applyModifiers("WORD_COUNT",{hero:n,word:a,slotKey:e,wCountDelta:p,breakdown:o,state:S}).forEach(e=>{e&&e.wordCountBonus&&(m+=e.wordCountBonus,t&&o.multipliers.push(`${fmtMod(e.wordCountBonus,"word"," W")} ${a.name} (Meticulous)`))});const H=function(e,t){if(!e)return[];const o=[],n=(e,t,n)=>{const s=n?getTalentLevel(n):1,a=e*s,i=s>1?` Lv.${s}`:"";a>0&&o.push({amt:a,label:t+i})};return void 0!==e.elem&&(S.talents.includes("world_sky_focus")&&isWorldSky(e.elem)&&n(chapterScaleW(5,R),"World & Sky Focus","world_sky_focus"),S.talents.includes("body_soul_focus")&&isBodySoul(e.elem)&&n(chapterScaleW(5,R),"Body & Soul Focus","body_soul_focus")),"item"===t&&e.category&&S.talents.includes("proficiency_focus")&&S.hero&&e.category===S.hero.good&&n(chapterScaleW(8,R),"Proficiency Focus","proficiency_focus"),B&&t.startsWith("adj")&&S.talents.includes("hendiadys")&&n(chapterScaleW(6,R),"Hendiadys","hendiadys"),_&&S.talents.includes("isocolon")&&n(chapterScaleW(10,R),"Isocolon","isocolon"),void 0!==e.elem&&S.enemy&&S.enemy.weak&&S.enemy.weak.includes(e.elem)&&S.talents.includes("weakness_exploit")&&n(chapterScaleW(6,R),"Weakness Exploit","weakness_exploit"),o}(a,e);H.forEach(e=>{m+=e.amt,t&&o.multipliers.push(`${fmtMod(e.amt,"word"," W")} ${e.label}`)});let D=p+m;if("noun1"===e){const e=S.talents&&S.talents.includes("crown_jewel"),n=e?4:2,s=D;D*=n,p*=n,m*=n;const i=e?`${a.name} Gem (Kohinoor)`:`${a.name} Gem`;t&&o.multipliers.push(`${fmtMod(n,"scale")} ${i} (${s}W √ó ${n})`)}if(g+=D,t){const t=[];if(void 0!==a.elem){const e=EC[a.elem];t.push(`<span class="tag" style="color:${e};border-color:${e}55;font-size:9px;padding:1px 5px">${EN[a.elem]}</span>`)}if("noun1"===e&&t.push('<span class="tag" style="color:#fbbf24;border-color:#fbbf2455;font-size:9px;padding:1px 5px">Gem</span>'),a.category){const e=a.category.charAt(0).toUpperCase()+a.category.slice(1);t.push(`<span class="tag prof" style="font-size:9px;padding:1px 5px">${e}</span>`)}const n=t.length?" "+t.join(" "):"";o.base.push(`+${W=O,Number.isInteger(W)?W:parseFloat(W.toFixed(2))} ${a.name}${n}`)}var W;"item"===e&&(w=a);const j=p+m;b.set(a,{apContribution:O,wCountDelta:p,wCountBonus:m,wCountTotal:j,slotKey:e,elemMult:M,mult:void 0!==a.mult&&"noun1"!==e?a.mult:null,talentMults:[]})});if([{id:"magma_core",elements:[E.FIRE,E.EARTH],mult:2,name:"Magma Core"},{id:"tempest",elements:[E.LIGHTNING,E.WATER],mult:2,name:"Tempest"},{id:"eclipse",elements:[E.LIGHT,E.DARK],mult:2.5,name:"Umbral Dawn"},{id:"necrotoxin",elements:[E.DARK,E.POISON],mult:2,name:"Thanatos"},{id:"blessed_steel",elements:[E.LIGHT,E.PHYS],mult:2,name:"Helios"},{id:"static_earth",elements:[E.LIGHTNING,E.EARTH],mult:2,name:"Gaia"}].forEach(e=>{if(i(e.id)&&hasElements(u,e.elements)){const t=u.find(t=>e.elements.includes(t.elem));if(t){const o=b.get(t);if(o){const t=getTalentLevel(e.id),n=scaleTalentMult(e.id,e.mult),s=t>1?` Lv.${t}`:"";o.talentMults.push({name:e.name+s,mult:n})}}}}),hasCapstone("Reed")&&"Reed"===n.name){const e=u.some(e=>e.elem===E.EARTH),n=u.some(e=>e.elem===E.WATER);e&&n&&u.forEach(e=>{if(e.elem===E.EARTH||e.elem===E.WATER){const n=b.get(e);n&&(n.talentMults.push({name:"One With Nature",mult:1.5}),t&&o.multipliers.push(`${fmtMod(1.5,"scale")} ${e.name} (One With Nature)`))}})}let G=m+v,O=1;a.item&&a.item.isStick&&(O*=.5,t&&o.multipliers.push(`${fmtMod(.5,"scale")} Stick (no weapon)`)),u.forEach(e=>{void 0!==e.mult&&e!==S.sel.noun1&&(O*=e.mult,t&&o.multipliers.push(`${fmtMod(e.mult,"scale")} ${e.name}`))});if(S.talents.map(e=>TALENTS.find(t=>t.id===e)).filter(e=>e&&("multiplier"===e.category||"multiplicative_mult"===e.category||"threshold"===e.category)).map(e=>({talent:e,mult:e.apply(h)})).filter(({mult:e})=>e>1).sort((e,t)=>e.mult-t.mult).forEach(({talent:e,mult:n})=>{O*=n,t&&o.multipliers.push(`${fmtMod(n,"scale")} ${e.name}`)}),i("dual_spec")){if(new Set(u.filter(e=>void 0!==e.elem).map(e=>e.elem)).size>=2){const e=scaleTalentMult("dual_spec",2);O*=e,t&&o.multipliers.push(`${fmtMod(e,"scale")} Dual Spec`)}}if(i("min_max")){if(!u.some(e=>!e.isStick&&2===e.rarity)&&u.length>0){const e=scaleTalentMult("min_max",1.75);O*=e,t&&o.multipliers.push(`${fmtMod(e,"scale")} Min‚ÄëMax`)}}if(i("wordsmiths_fervor")){const e=1+scaleTalentBonus("wordsmiths_fervor",.1)*g;O*=e,t&&o.multipliers.push(`${fmtMod(e,"scale")} Wordsmith's Fervor`)}let H=0,D=0,W=1;const j=[],F=e=>e?e.wCountTotal??e.wCountDelta??0:0,N=(e,n,s,a,i=1)=>{if(n){for(let t=0;t<i;t++)H+=n.apContribution,D+=F(n),n.mult&&(W*=n.mult),j.push({word:e,talent:a});if(t){const t=i>1?` <span class="mod-badge reread">√ó${i}</span>`:"";if(o.base.push(`${fmtMod(n.apContribution*i,"ap"," AP")} ${e.name} (${a} REREAD${t})`),n.mult){const s=Math.pow(n.mult,i);o.multipliers.push(`${fmtMod(s,"scale")} ${e.name} (${a} REREAD${t})`)}}}};S.talents.forEach(e=>{const t=TALENTS.find(t=>t.id===e);if(t&&"retrigger"===t.category){const o=getTalentLevel(e);if("anaphora"===t.id&&u.length>0){const e=u[0],t=b.get(e);N(e,t,0,"Anaphora",o)}if("epistrophe"===t.id&&u.length>0){const e=a.noun1?a.noun1:a.item;if(e){const t=b.get(e);N(e,t,0,"Epistrophe",o)}}if("critical_mass"===t.id){u.filter(e=>3===e.rarity).forEach(e=>{const t=b.get(e);N(e,t,0,"Critical Mass",o)})}if("rarity_cascade"===t.id){u.filter(e=>"rarity"===e.type).forEach(e=>{const t=b.get(e);N(e,t,0,"Rarity Cascade",o)})}if("epizeuxis"===t.id){const e=u.filter(e=>e.id).map(e=>e.id),t=e.filter((t,o)=>e.indexOf(t)!==o);[...new Set(t)].forEach(e=>{const t=u.find(t=>t.id===e),n=b.get(t);N(t,n,0,"Epizeuxis",o)})}if("diacope"===t.id){const e=[E.FIRE,E.WATER,E.EARTH,E.LIGHTNING],t=[E.PHYS,E.POISON,E.LIGHT,E.DARK],n=u.filter(t=>void 0!==t.elem&&e.includes(t.elem)),s=u.filter(e=>void 0!==e.elem&&t.includes(e.elem)),a=new Set(n.map(e=>e.elem)),i=new Set(s.map(e=>e.elem));4===a.size&&n.forEach(e=>{const t=b.get(e);N(e,t,0,"Diacope",o)}),4===i.size&&s.forEach(e=>{const t=b.get(e);N(e,t,0,"Diacope",o)})}if("gemination"===t.id){const e={};u.forEach(t=>{const o=void 0!==t.rarity?t.rarity:0;e[o]||(e[o]=[]),e[o].push(t)}),Object.keys(e).forEach(t=>{const n=e[t];n.length>=2&&n.forEach(e=>{const t=b.get(e);N(e,t,0,"Gemination",o)})})}if("resonance"===t.id&&u.forEach((e,t)=>{if(void 0!==e.elem&&n.str.includes(e.elem)){const t=b.get(e);N(e,t,0,"Resonance",o)}}),"cascade"===t.id&&u.forEach(e=>{if(e.elem===E.WATER){const t=b.get(e);N(e,t,0,"Cascade",o)}}),"chain_lightning"===t.id&&u.forEach(e=>{if(e.elem===E.LIGHTNING){const t=b.get(e);N(e,t,0,"Chain Lightning",o)}}),"combustion"===t.id&&u.forEach(e=>{if(e.elem===E.FIRE&&s.weak&&s.weak.includes(E.FIRE)){const t=b.get(e);N(e,t,0,"Combustion",o)}}),"null_and_void"===t.id){const e=2+(o-1);u.forEach(t=>{const o=b.get(t);o&&o.elemMult<1&&N(t,o,0,"Magatsu",e)})}if("amplify"===t.id&&a.item){const e=a.item,t=b.get(e);N(e,t,0,"Khopesh",o)}if("gem_resonance"===t.id&&a.noun1){const e=a.noun1,t=b.get(e);N(e,t,0,"Gem Resonance",o)}if("polysyndeton"===t.id){const e=new Set(u.map(e=>e.elem).filter(e=>void 0!==e));if(e.size>=3){let e=0,t=null;if(u.forEach(o=>{const n=b.get(o);n&&n.apContribution>e&&(e=n.apContribution,t=o)}),t){const e=b.get(t);N(t,e,0,"Polysyndeton",o)}}}if("anadiplosis"===t.id){const e=u.filter(e=>void 0!==e.elem),t=new Set;for(let n=0;n<e.length-1;n++){const s=e[n],a=e[n+1];s.elem===a.elem&&[s,a].forEach(e=>{if(t.has(e))return;t.add(e);const n=b.get(e);N(e,n,0,"Anadiplosis",o)})}}if("chiasmus"===t.id){const e=2+(o-1),t=u.filter(e=>void 0!==e.elem);if(t.length>=2){const o=t[0],n=t[t.length-1];o.elem===n.elem&&[o,n].forEach(t=>{const o=b.get(t);N(t,o,0,"Chiasmus",e)})}}}});const q=n.name;if(hasCapstone("Graham Moor")&&"Graham Moor"===q&&a.item&&"slash"===a.item.category){const e=a.item,n=b.get(e);n&&(H+=n.apContribution,D+=F(n),n.mult&&(W*=n.mult),j.push({word:e,talent:"Cross the T's"}),t&&o.base.push(`${fmtMod(n.apContribution,"ap"," AP")} ${e.name} <span class="mod-badge reread">REREAD</span> Cross the T's`),t&&n.mult&&o.multipliers.push(`${fmtMod(n.mult,"scale")} ${e.name} (Cross the T's)`))}if(hasCapstone("Quivera")&&"Quivera"===q&&u.length>0){const e=a.noun1?a.noun1:a.item;if(e){const n=b.get(e);n&&(H+=n.apContribution,D+=F(n),n.mult&&(W*=n.mult),j.push({word:e,talent:"Count Cadence"}),t&&o.base.push(`${fmtMod(n.apContribution,"ap"," AP")} ${e.name} <span class="mod-badge reread">REREAD</span> Count Cadence`),t&&n.mult&&o.multipliers.push(`${fmtMod(n.mult,"scale")} ${e.name} (Count Cadence)`))}}if(hasCapstone("Caesura")&&"Caesura"===q){let e=!1;["adj1","adj2","item","adj3","adj4","noun1"].forEach(n=>{const s=a[n];if(s){if(e){const e=b.get(s);e&&(H+=e.apContribution,D+=F(e),e.mult&&(W*=e.mult),j.push({word:s,talent:"Ellipsis"}),t&&o.base.push(`${fmtMod(e.apContribution,"ap"," AP")} ${s.name} <span class="mod-badge reread">REREAD</span> Ellipsis`),t&&e.mult&&o.multipliers.push(`${fmtMod(e.mult,"scale")} ${s.name} (Ellipsis)`))}}else e=!0})}hasCapstone("Belle Lettres")&&"Belle Lettres"===q&&u.forEach(e=>{const n=b.get(e);n&&(H+=n.apContribution,D+=F(n),n.mult&&(W*=n.mult),j.push({word:e,talent:"Knowledge Eternal"}),t&&o.base.push(`${fmtMod(n.apContribution,"ap"," AP")} ${e.name} <span class="mod-badge reread">REREAD</span> Knowledge Eternal`),t&&n.mult&&o.multipliers.push(`${fmtMod(n.mult,"scale")} ${e.name} (Knowledge Eternal)`))}),G+=H,g+=D,O*=W;let Y=j.length,Z=0,z=0;const U=Number.MAX_SAFE_INTEGER;let J=0,K=!1;const V=new Set;let X=0;const ee=e=>{let n=0;return u.forEach(s=>{const a=b.get(s);a&&(G+=a.apContribution,g+=F(a),a.mult&&(O*=a.mult),j.push({word:s,talent:e}),n++,t&&o.base.push(`${fmtMod(a.apContribution,"ap"," AP")} ${s.name} <span class="mod-badge reread">REREAD</span> ${e}`))}),n};let te=!0;for(;te&&J<100;){te=!1,J++;const e=Y;if(i("echo_chamber")&&Y>0){const n=Y-(1===J?0:e);if(n>0||1===J){const e=1===J?Y:n,s=scaleTalentBonus("echo_chamber",5),a=e*s;if(Z+=a,z+=a,1===J){const e=new Map;j.forEach(t=>{const o=e.get(t.word)||0;e.set(t.word,o+1)}),e.forEach((e,t)=>{const o=b.get(t);o&&(o.echoChamberW=e*s)})}if(t&&a>0){const e=new Map;j.forEach(t=>{const o=e.get(t.word)||0;e.set(t.word,o+1)}),e.forEach((e,t)=>{const n=e*s;o.multipliers.push(`${fmtMod(n,"word"," W")} Echo Chamber (${t.name} √ó${e})`)})}}}if(i("golden_tongue")&&1===J){const e=scaleTalentBonus("golden_tongue",1),n=Math.floor((S.gold||0)/20)*e;n>0&&(Z+=n,z+=n,t&&o.multipliers.push(`${fmtMod(n,"word"," W")} Golden Tongue (${S.gold} Gold)`))}if(i("lexicon_growth")&&1===J){const e=S.bossesDefeated||0,n=scaleTalentBonus("lexicon_growth",1),s=u.length*e*n;s>0&&(Z+=s,z+=s,t&&o.multipliers.push(`${fmtMod(s,"word"," W")} Lexicon Growth (${e} bosses)`))}if(i("momentum")&&1===J){const e=Math.min((S.roundIndex||1)-1,10),n=scaleTalentBonus("momentum",1),s=u.length*e*n;s>0&&(Z+=s,z+=s,t&&o.multipliers.push(`${fmtMod(s,"word"," W")} Momentum (${e} rounds)`))}if(i("stony_brook")&&1===J&&hasElements(u,[E.WATER,E.EARTH])){const e=scaleTalentBonus("stony_brook",12);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Stony Brook`)}if(i("word_hoard")&&1===J){const e=(S.inv||[]).filter(e=>!e.hiddenInBank).length,n=scaleTalentBonus("word_hoard",.2),s=Math.floor(e*n);s>0&&(Z+=s,z+=s,t&&o.multipliers.push(`${fmtMod(s,"word"," W")} Word Hoard (${e} Words)`))}if(i("slow_burn")&&1===J){const e=S.roundIndex||1,n=e*scaleTalentBonus("slow_burn",2);Z+=n,z+=n,t&&o.multipliers.push(`${fmtMod(n,"word"," W")} Slow Burn (Round ${e})`)}if(i("tithe")&&1===J){const e=S.goldSpent||0,n=Math.floor(e/20);if(n>0){const s=n*scaleTalentBonus("tithe",2);Z+=s,z+=s,t&&o.multipliers.push(`${fmtMod(s,"word"," W")} Tithe (${e} Gold spent)`)}}if(i("word_historian")&&1===J){const e=S.wordsUsedThisRun||0;if(e>0){const n=scaleTalentBonus("word_historian",.25),s=Math.floor(e*n);s>0&&(Z+=s,z+=s,t&&o.multipliers.push(`${fmtMod(s,"word"," W")} Word Historian (${e} Words used)`))}}if(i("reverberation")&&1===J){const e=S.rereadTriggersThisRun||0;if(e>0){const n=e*scaleTalentBonus("reverberation",2);Z+=n,z+=n,t&&o.multipliers.push(`${fmtMod(n,"word"," W")} Reverberation (${e} Rereads)`)}}if(i("steady_hand")&&1===J){const e=scaleTalentBonus("steady_hand",3);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Steady Hand`)}if(i("first_blood")&&1===J){if((S.roundIndex||1)<=9){const e=scaleTalentBonus("first_blood",10);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} First Blood (Ch.1)`)}}if(i("comfort_zone")&&1===J){if(1===new Set(u.filter(e=>void 0!==e.elem).map(e=>e.elem)).size){const e=scaleTalentBonus("comfort_zone",6);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Comfort Zone`)}}if(i("linguist")&&1===J){const e=new Set(u.map(e=>e.type));if(e.size>=3){const n=scaleTalentBonus("linguist",5);Z+=n,z+=n,t&&o.multipliers.push(`${fmtMod(n,"word"," W")} Linguist (${e.size} types)`)}}if(i("condensed")&&1===J&&u.length<=3){const e=scaleTalentBonus("condensed",8);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Condensed (${u.length} Words)`)}if(i("spectrum")&&1===J){const e=new Set(u.filter(e=>void 0!==e.elem).map(e=>e.elem)),n=scaleTalentBonus("spectrum",2),s=e.size*n;s>0&&(Z+=s,z+=s,t&&o.multipliers.push(`${fmtMod(s,"word"," W")} Spectrum (${e.size} Elements)`))}if(i("inferno")&&1===J&&hasElements(u,[E.FIRE,E.WATER])){const e=scaleTalentBonus("inferno",10);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Inferno`)}if(i("verdant")&&1===J&&hasElements(u,[E.EARTH,E.LIGHT])){const e=scaleTalentBonus("verdant",10);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Verdant`)}if(i("venom_strike")&&1===J&&hasElements(u,[E.POISON,E.LIGHTNING])){const e=scaleTalentBonus("venom_strike",10);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Venom Strike`)}if(i("twilight")&&1===J&&hasElements(u,[E.DARK,E.PHYS])){const e=scaleTalentBonus("twilight",10);Z+=e,z+=e,t&&o.multipliers.push(`${fmtMod(e,"word"," W")} Twilight`)}if(i("bibliophile")&&1===J){const e=scaleTalentBonus("bibliophile",1),n=u.length*e;n>0&&(G+=n,t&&o.base.push(`${fmtMod(n,"ap"," AP")} Bibliophile (${u.length} Words)`))}if(i("residual")&&z>0&&1===J){const e=scaleTalentBonus("residual",.2),n=Math.floor(z*e);n>0&&(G+=n,t&&o.base.push(`${fmtMod(n,"ap"," AP")} Residual (${z} W bonuses)`))}if(i("reread_amplifier")&&Y>0&&1===J){const e=scaleTalentMult("reread_amplifier",1.5),n=Math.pow(e,Y);O*=n,t&&o.multipliers.push(`${fmtMod(n,"scale")} Reread Amplifier (${Y} REREADs)`)}if(i("compound_interest")&&1===J){const e=Math.floor((S.gold||0)/50);if(e>0){const n=scaleTalentMult("compound_interest",1.15),s=Math.pow(n,e);O*=s,t&&o.multipliers.push(`${fmtMod(s,"scale")} Compound Interest (${e}√ó50 Gold)`)}}if(i("overflow")&&1===J){const e=g+Z;if(e>50){const n=e-50,s=Math.floor(n/10);if(s>0){const e=scaleTalentMult("overflow",1.5),n=Math.pow(e,s);O*=n,t&&o.multipliers.push(`${fmtMod(n,"scale")} Overflow (${s}√ó10 W above 50)`)}}}const n=Y-X;if(i("crescendo")&&n>=6&&!V.has("crescendo")){V.add("crescendo");const e=ee("Crescendo");X+=e,Y+=e,e>0&&(te=!0),t&&o.multipliers.push(`<span class="mod-badge reread">REREAD √ó${e}</span> Crescendo (${n} non-Crescendo REREADs ‚â• 6)`)}if(i("chain_reaction")&&Y>=4&&!V.has("chain_reaction")){V.add("chain_reaction");const e=scaleTalentMult("chain_reaction",3);O*=e,t&&o.multipliers.push(`${fmtMod(e,"scale")} Chain Reaction (${Y} REREADs ‚â• 4)`)}const s=G*(g+Z)*O;(s>=U||!Number.isFinite(s))&&(K=!0,te=!1,t&&o.multipliers.push('<span class="mod-badge ultimate">THE ULTIMATE WEAPON FORGED</span>')),J>=100&&(K=!0,te=!1,t&&o.multipliers.push('<span class="mod-badge ultimate">INFINITE LOOP DETECTED - ULTIMATE WEAPON!</span>'))}g+=Z;const oe=S.talents.length>0?Math.min(2,1.1+.1*S.talents.length):1;t&&S.talents.length>0&&o.multipliers.push(`${fmtMod(oe,"scale")} Talent Count (${S.talents.length})`);let ne=Math.floor(G*g*O*oe);if(i("execute")&&!K){const e=s.hp;let n=ne;S.carriedOverkill>0&&(n+=S.carriedOverkill);const a=e-n,i=a/e;if(a>0&&i<=.15){const e=getTalentLevel("execute"),n=e>1?` √ó${e}`:"";t&&o.multipliers.push(`<span class="mod-badge reread">REREAD ALL${n}</span> Execute (enemy at ${Math.round(100*i)}% HP)`);let s=0,a=0,r=1;for(let n=0;n<e;n++)u.forEach(e=>{const n=b.get(e);n&&(s+=n.apContribution,a+=F(n),n.mult&&(r*=n.mult),j.push({word:e,talent:"Execute"}),t&&o.base.push(`${fmtMod(n.apContribution,"ap"," AP")} ${e.name} <span class="mod-badge reread">REREAD</span> Execute`))});G+=s,g+=a,O*=r,ne=Math.floor(G*g*O*oe)}}if(S.carriedOverkill>0){const e=S.carriedOverkill;ne+=e,t&&(o.base.push(`${fmtMod(e,"ap"," AP")} Hyperbole (carried overkill)`),S.carriedOverkill=0)}if(s.damageReduction&&s.damageReduction>0){const e=Math.floor(ne*s.damageReduction);ne-=e,t&&o.multipliers.push(`<span class="mod-badge neg">-${e}</span> Armored (${Math.round(100*s.damageReduction)}% reduction)`)}if(S.chapterBoss&&"cinna_antony"===S.chapterBoss.id&&!M){const e=u.filter(e=>void 0!==e.elem).map(e=>e.elem);if(e.length>0){const n=e.every(t=>t===e[0]),s=[...new Set(e)];let a=!0;for(const e of s){const t=OPPOSITE_ELEMENTS[e];if(!s.includes(t)){a=!1;break}}if(n||a){if(t){const e=n?"all same element":"opposite pairs only";o.multipliers.push(`<span style="color:#4ade80">Cinna & Antony: ${e} ‚úì</span>`)}}else ne=0,t&&o.multipliers.push('<span style="color:#ef4444">Cinna & Antony: Mixed elements! (0 damage)</span>')}}const se=O*oe;let ae=Math.round(g*se*10)/10;const ie=s.hp,re=Math.max(0,ie-ne);return t&&(o.wordCount=g),{heroDmg:K?1/0:ne,enemyDmg:0,heroMax:n.hp,enemyMax:ie,heroFin:n.hp,enemyFin:K?0:re,win:K||re<=0,tie:!1,baseAP:G,wordCount:ae,heroBonus:1,weaponType:w?.id||"stick",allWords:u,totalMultiplier:se,breakdown:o,retriggeredWords:j,wordDataMap:b,ultimateWeaponForged:K,loopIterations:J,totalRereadCount:Y}}function updPrev(){const e=!!S.sel.item;if($("#forge-btn").disabled=!e,!e){const e=S.hero.str.includes(S.enemy.atk)?.7:S.hero.weak.includes(S.enemy.atk)?1.5:1;return $("#pv-hero").textContent="0",void($("#pv-enemy").textContent=Math.round(S.enemy.ap*e))}const t=calc();$("#pv-hero").textContent=Math.round(t.heroDmg),$("#pv-enemy").textContent=Math.round(t.enemyDmg)}function updatePreviewStats(e){}function buildWeaponName(e){const t=[];return e.adj1&&t.push(getDisplayForm(e.adj1,"adj1",e)),e.adj2&&t.push(getDisplayForm(e.adj2,"adj2",e)),e.item&&t.push(e.item.name),e.adj3&&t.push(getDisplayForm(e.adj3,"adj3",e)),e.adj4&&t.push(getDisplayForm(e.adj4,"adj4",e)),e.noun1&&t.push(`of ${getDisplayForm(e.noun1,"noun1",e)}`),t.join(" ")||"Unknown Weapon"}let isForging=!1;async function forge(){const e=document.getElementById("onboarding-overlay")?.classList.contains("visible");if(isForging||isTransitioning||e)return;if(isForging=!0,ONBOARD.active){if(await onOnboardingForgeAttempt())return void(isForging=!1)}playSample("forge weapon button.ogg",.9);const t=document.getElementById("spotlight-tint");t&&t.classList.add("show"),pulseFlame();const o=document.getElementById("forge-btn");if(o){const e=o.getBoundingClientRect();burstSparks(e.left+e.width/2,e.top+e.height/2,30)}const n=document.querySelector("#weapon-display .weapon-canvas");n&&n.classList.add("fly-out"),S.sel.item&&(S.sel.item.category&&S.usedWeaponTypes.add(S.sel.item.category),S.sel.item.name&&S.usedWeapons.add(S.sel.item.name));const s=[S.sel.adj1,S.sel.adj2,S.sel.item,S.sel.adj3,S.sel.adj4,S.sel.noun1].filter(Boolean);s.forEach(e=>{if(e.id&&S.uniqueWordsUsed.add(e.id),void 0!==e.elem&&(S.elementWordsUsed||(S.elementWordsUsed={}),S.elementWordsUsed[e.elem]=(S.elementWordsUsed[e.elem]||0)+1),void 0!==e.rarity){const t=e.rarity<=0?1:e.rarity<=2?2:3;S.tierWordsPlayed||(S.tierWordsPlayed={1:0,2:0,3:0}),S.tierWordsPlayed[t]=(S.tierWordsPlayed[t]||0)+1}"rarity"===e.type&&(S.rarityWordsUsed=(S.rarityWordsUsed||0)+1)});const a=calc({breakdown:!0});S.wordsUsedThisRun=(S.wordsUsedThisRun||0)+s.length,a.retriggeredWords&&a.retriggeredWords.length>0&&(S.rereadTriggersThisRun=(S.rereadTriggersThisRun||0)+a.retriggeredWords.length),S.lastCombatRereads=a.totalRereadCount||0,PStats.weaponsForged++;const i=Math.round(a.heroDmg||0);i>PStats.bestDamage&&(PStats.bestDamage=i,PStats.bestWeaponName=buildWeaponName(S.sel)),saveStats(),renderWeapon("#combat-weapon-svg");const r=new Map;a.retriggeredWords&&a.retriggeredWords.length>0&&a.retriggeredWords.forEach(({word:e,talent:t})=>{const o=r.get(e)||1;r.set(e,o+1)});const l=[],c=S.enemy,d=e=>!(S.tempEffects&&S.tempEffects.polymorph)&&c.res.includes(e);function p(e,t){if(!e)return null;if(e.isStick)return{name:e.name,value:"",tooltip:"√ó0.25",rarity:-1,color:null};const o=getDisplayForm(e,t,S.sel);if(void 0!==e.mult&&"noun1"!==t)return{name:o,value:"",tooltip:fmtMod(e.mult,"scale"),rarity:e.rarity,color:null};let n=getBaseAP(e),s=`+${n}`,a=null;if(void 0!==e.elem)if(a=EC[e.elem],c.weak.includes(e.elem)){let e=2*n;s="noun1"===t?`+${2*e} (GEM+WEAK!)`:`+${e} (WEAK!)`}else d(e.elem)?s="√ó0 (RES)":"noun1"===t&&(s=`+${2*n} (GEM)`);else"noun1"===t&&(s=`+${2*n} (GEM)`);return{name:o,value:"",tooltip:s,rarity:e.rarity,color:a}}const f=["adj3","adj4"];if(["adj1","adj2"].forEach(e=>{const t=S.sel[e],o=p(t,e);if(o){const e=t?r.get(t):null;l.push({...o,intensity:1,retriggerCount:e,wordRef:t})}}),S.sel.item){const e=S.sel.item;let t=getBaseAP(e),o=`+${t}`,n=null;void 0!==e.elem&&(n=EC[e.elem],c.weak.includes(e.elem)?o=`+${2*t} (WEAK!)`:d(e.elem)&&(o="√ó0 (RES)"));const s=r.get(e);l.push({name:e.name,value:"",tooltip:o,rarity:e.rarity,intensity:1,color:n,retriggerCount:s,wordRef:e})}if(null!==S.sel.noun1){l.push({name:"of the",value:"",rarity:3,intensity:1,color:null,italic:!0}),f.forEach(e=>{const t=S.sel[e],o=p(t,e);if(o){const e=t?r.get(t):null;l.push({...o,intensity:1,retriggerCount:e,wordRef:t})}});const e=p(S.sel.noun1,"noun1");if(e){const t=S.sel.noun1?r.get(S.sel.noun1):null;l.push({...e,intensity:1,retriggerCount:t,wordRef:S.sel.noun1})}}const u={gold:0,items:[]},{enemy:h}=getCombatants(),m=h.hp||0;if(S.pendingBossLoot=null,a.heroDmg>=m){let e=20;u.gold=e;if(S.roundIndex%3==0){const e=rollBossLootDrops();S.pendingBossLoot=e;const t=[];e&&Array.isArray(e.words)&&t.push(...e.words),e&&e.weapon&&t.push(e.weapon),u.items.push(...t.map(e=>e.name))}}Object.values(S.sel).filter(Boolean).forEach(e=>{if(!e.isStick){const t=S.inv.indexOf(e);t>=0&&S.inv.splice(t,1)}}),showCombat(a,l,u)}function getTalentWeightBoosts(){const e={elements:{},weaponTypes:{}};if(!S.talents||0===S.talents.length)return e;const t=e=>S.talents.includes(e),o=2.5;return(t("world_sky_ink")||t("world_sky_focus"))&&WORLD_SKY.forEach(t=>e.elements[t]=o),(t("body_soul_ink")||t("body_soul_focus"))&&BODY_SOUL.forEach(t=>e.elements[t]=o),t("magma_core")&&(e.elements[E.FIRE]=(e.elements[E.FIRE]||1)*o,e.elements[E.EARTH]=(e.elements[E.EARTH]||1)*o),t("tempest")&&(e.elements[E.WATER]=(e.elements[E.WATER]||1)*o,e.elements[E.LIGHTNING]=(e.elements[E.LIGHTNING]||1)*o),t("eclipse")&&(e.elements[E.LIGHT]=(e.elements[E.LIGHT]||1)*o,e.elements[E.DARK]=(e.elements[E.DARK]||1)*o),t("necrotoxin")&&(e.elements[E.DARK]=(e.elements[E.DARK]||1)*o,e.elements[E.POISON]=(e.elements[E.POISON]||1)*o),t("blessed_steel")&&(e.elements[E.LIGHT]=(e.elements[E.LIGHT]||1)*o,e.elements[E.PHYS]=(e.elements[E.PHYS]||1)*o),t("static_earth")&&(e.elements[E.EARTH]=(e.elements[E.EARTH]||1)*o,e.elements[E.LIGHTNING]=(e.elements[E.LIGHTNING]||1)*o),t("proficiency_focus")&&S.hero&&S.hero.good&&(e.weaponTypes[S.hero.good]=2),e}function buildWeightedPool(e,t=!0){const o=[],n=getTalentWeightBoosts(),s=[],a=[],i=[],r=[];return e.forEach(e=>{if(t&&S.hero)"weapon"===e.type?e.category===S.hero.good?i.push(e):r.push(e):void 0!==e.elem&&S.hero.str&&S.hero.str.includes(e.elem)?s.push(e):a.push(e);else{const t=e.rarity||0,n=0===t?11:2===t?7:2;for(let t=0;t<n;t++)o.push(e)}}),t&&S.hero&&(s.forEach(e=>{const t=e.rarity||0;let s=3*(0===t?11:2===t?7:2);void 0!==e.elem&&n.elements[e.elem]&&(s=Math.floor(s*n.elements[e.elem]));for(let t=0;t<s;t++)o.push(e)}),a.forEach(e=>{const t=e.rarity||0;let s=0===t?11:2===t?7:2;void 0!==e.elem&&n.elements[e.elem]&&(s=Math.floor(s*n.elements[e.elem]));for(let t=0;t<s;t++)o.push(e)}),i.forEach(e=>{const t=e.rarity||0;let s=2*(0===t?11:2===t?7:2);e.category&&n.weaponTypes[e.category]&&(s=Math.floor(s*n.weaponTypes[e.category]));for(let t=0;t<s;t++)o.push(e)}),r.forEach(e=>{const t=e.rarity||0;let s=0===t?11:2===t?7:2;e.category&&n.weaponTypes[e.category]&&(s=Math.floor(s*n.weaponTypes[e.category]));for(let t=0;t<s;t++)o.push(e)})),o}function rollBossLootDrops(){const e=WORDS.filter(e=>"weapon"===e.type),t=e.filter(e=>e.category===S.hero?.good),o=Math.random()<.8&&t.length>0?t[Math.floor(Math.random()*t.length)]:e[Math.floor(Math.random()*e.length)],n=WORDS.filter(e=>"weapon"!==e.type&&!e.hiddenInBank),s=S.hero?.str||[],a=n.filter(e=>(e.rarity||0)>=3),i=a.filter(e=>void 0!==e.elem&&s.includes(e.elem)),r=Math.random()<.7&&i.length>0?i[Math.floor(Math.random()*i.length)]:a.length>0?a[Math.floor(Math.random()*a.length)]:null,l=[];r&&l.push(r);const c=n.filter(e=>void 0!==e.elem&&s.includes(e.elem));for(let e=l.length;e<3&&0!==n.length;e++)if(Math.random()<.7&&c.length>0){const e=c[Math.floor(Math.random()*c.length)];e&&l.push(e)}else{const e=n[Math.floor(Math.random()*n.length)];e&&l.push(e)}return{weapon:o,words:l}}async function afterCombat(){isForging=!1;const e=window.lastCombatResult,t=$("#spotlight-tint");if(!e)return $("#combat-overlay").classList.remove("show","combat-reveal","combat-result","combat-exit"),void(t&&t.classList.remove("show","full"));const o=S.pendingBossLoot;S.pendingBossLoot=null;const n=t&&t.classList.contains("full");t&&t.classList.add("full"),n?await dly(RHYTHM.QUARTER):(await dly(RHYTHM.HALF),await dly(RHYTHM.BEAT)),$("#combat-overlay").classList.remove("show","combat-reveal","combat-result","combat-exit");const s=$("#combat-breakdown-tooltip"),a=$("#combat-breakdown-btn");s&&s.classList.remove("show"),a&&a.classList.remove("active"),S.tempEffects={};const i=e=>S.talents.includes(e);if(e.win){if(S.wins++,S.streak++,S.roundIndex>=18){PStats.victories++,S.hero&&S.hero.name&&(PStats.heroClears[S.hero.name]=!0),PStats.heroDifficultyClears||(PStats.heroDifficultyClears={});const e=S.hero.name;PStats.heroDifficultyClears[e]||(PStats.heroDifficultyClears[e]={});const t=S.difficulty||0;PStats.heroDifficultyClears[e][t]=(PStats.heroDifficultyClears[e][t]||0)+1,PStats.difficultyClears||(PStats.difficultyClears={}),PStats.difficultyClears[t]=(PStats.difficultyClears[t]||0)+1,saveStats(),checkAndUnlockAchievements()}if(S.chapterBoss&&S.chapterBoss.id){const e=S.chapterBoss.id;if(PStats.bossDefeats||(PStats.bossDefeats={}),!PStats.bossDefeats[e]){PStats.bossDefeats[e]=!0;const t={cinna_antony:"Quivera",red_aktins:"Belle Lettres",plague_doctor:"Alexandria Constanza",oxy:"Caesura",dotdotdot:"Reed"}[e];t&&!PStats.unlockedHeroes&&(PStats.unlockedHeroes=["Graham Moor"]),t&&!PStats.unlockedHeroes.includes(t)&&(PStats.unlockedHeroes.push(t),S.pendingHeroUnlock={hero:t,boss:S.chapterBoss.name}),saveStats(),checkAndUnlockAchievements()}}const n=S.roundIndex%3==0;let s=15;n&&(s+=15);const a=Math.max(0,Math.round(e.heroDmg-e.enemyMax));if(i("hyperbole")&&a>0){const t=Math.floor(.25*e.enemyMax),o=scaleTalentMult("hyperbole",2);S.carriedOverkill=Math.min(Math.floor(a*o),t)}else S.carriedOverkill=0;const r=[S.sel.adj1,S.sel.adj2,S.sel.item,S.sel.adj3,S.sel.adj4,S.sel.noun1].filter(Boolean);if(S.talents.forEach(e=>{const t=TALENTS.find(t=>t.id===e);if(t&&t.goldBonus){const e={state:S,hero:S.hero,enemy:S.enemy,allWords:r},o=t.goldBonus(e);o>0&&(s+=o)}}),S.gold+=s,checkTreasureHunterAchievement(),i("battle_hardened")&&(S.battleHardenedBonus+=scaleTalentBonus("battle_hardened",3)),S.level++,n){S.bossesDefeated++,r.length<=3&&unlockSteamAchievement("MINIMALIST");const e=o||rollBossLootDrops(),t=[];e&&Array.isArray(e.words)&&t.push(...e.words),e&&e.weapon&&t.push(e.weapon);const n=S.inv.filter(e=>!e.hiddenInBank).length,s=Math.max(0,24-n);s>0&&(t.slice(0,s).forEach(e=>S.inv.push({...e})),checkHoarderAchievement())}const l=S.roundIndex%9==0;S.roundIndex++,S.belleRandomWeaknesses=null,S.nextEnemyBonusWeaknesses=null,S.nextEnemyData=null;const c=S.roundIndex-1;if((!PStats.highestRound||c>PStats.highestRound)&&(PStats.highestRound=c,saveStats()),saveRun(),l){S.currentChapter++;const e=25+15*S.currentChapter;S.gold+=e,checkTreasureHunterAchievement();const o=document.getElementById("combat-result");o&&o.classList.remove("show");const n=document.getElementById("combat-overlay");return n&&n.classList.remove("show","combat-reveal","combat-result","combat-exit"),await showChapterCelebration(S.currentChapter,e),void(t&&(t.classList.remove("full"),await dly(RHYTHM.EIGHTH),t.classList.remove("show")))}l?await showTalentSelect(5,2):n?await showTalentSelect(3,1):(ONBOARD.active&&2===S.roundIndex&&(await showOnboardingComplete(),await new Promise(e=>setTimeout(e,RHYTHM.BEAT))),await showShop(!0),t&&(t.classList.remove("full"),await dly(RHYTHM.EIGHTH),t.classList.remove("show")))}else if(S.lives--,S.lives>0){clrSel(),S.roundIndex++;const e=S.roundIndex-1;(!PStats.highestRound||e>PStats.highestRound)&&(PStats.highestRound=e,saveStats()),newEnc(),await showShop(!0),t&&(t.classList.remove("full"),await dly(RHYTHM.EIGHTH),t.classList.remove("show"))}else{S.losses++,S.streak=0,S.heroSelected=!1,clearRunSave();let e=0,t=!1,o=1;const n=S.hero?.name||"Hero";if(S.hero&&S.hero.name){e=calcRunXP(S.roundIndex,!1);const n=awardHeroXP(S.hero.name,e);t=n.leveledUp,o=n.newLevel,S.lastRunXP={xp:e,...n}}stopAllRarityDrones(),musicEngine&&musicEngine.initialized&&musicEngine.triggerLoseEffect(),clrSel(),showLossScreen(n,S.roundIndex,e,t,o)}}const TALENT_CAP=6;function getTalentLevel(e){return S.talentLevels&&S.talentLevels[e]||1}function setTalentLevel(e,t){S.talentLevels||(S.talentLevels={}),S.talentLevels[e]=t}function upgradeRandomTalent(){if(!S.talents||0===S.talents.length)return null;const e=Math.floor(Math.random()*S.talents.length),t=S.talents[e],o=TALENTS.find(e=>e.id===t),n=getTalentLevel(t),s=n+1;return setTalentLevel(t,s),{talent:o,oldLevel:n,newLevel:s}}function scaleTalentBonus(e,t){return t*getTalentLevel(e)}function scaleTalentMult(e,t){const o=getTalentLevel(e);if(o<=1)return t;return t+.25*(t-1)*(o-1)}async function showTalentSelect(e=5,t=2){S.talents||(S.talents=[]);const o=TALENTS.filter(e=>!S.talents.includes(e.id)&&!e.disabled);if(0===o.length)return void showShop();const n={common:50,uncommon:35,rare:15};let s=!1;const a=S.talents&&S.talents.length>=TALENT_CAP,i=Math.min(e,o.length),r=Math.min(t,i);let l=function(e,t){const o=[],s=[...e];for(let e=0;e<t&&s.length>0;e++){const e=s.reduce((e,t)=>e+(n[t.rarity]||15),0);let t=Math.random()*e,a=null;for(let e=0;e<s.length;e++)if(t-=n[s[e].rarity]||15,t<=0){a=s.splice(e,1)[0];break}a&&o.push(a)}return o}(o,i),c=[],d=null;$("#talent-level").textContent=S.level;const p=document.getElementById("talent-select-view-btn"),f=document.getElementById("talent-select-count");if(p){const e=S.talents?S.talents.length:0;p.style.display=e>0?"block":"none",f&&(f.textContent=e)}const u=$("#talent-choices");if(!u)return console.error("[showTalentSelect] #talent-choices not found, falling back to shop"),void showShop();const h={common:"T1",uncommon:"T2",rare:"T3"};async function m(e,t=!0){const o=$("#talent-choices");if(!o)return void console.error("[renderTalentCards] #talent-choices not found");o.style.transition="",o.style.opacity="",o.innerHTML="";const n=document.createElement("div");n.id="talent-pick-counter",n.className="talent-pick-counter";const p=r-c.length;a&&!d?n.textContent="Talents Full - Pick one to swap":d?n.textContent="Select a talent to replace":p>1?n.innerHTML=`Pick <span style="color:#fbbf24">${p}</span> ‚Äî <span style="color:#9ca3af;font-size:0.9em">New talent or Upgrade</span>`:1===p?n.innerHTML='Pick <span style="color:#fbbf24">1</span> more':n.textContent="Done!",o.appendChild(n);const f=document.createElement("div");f.className="talent-cards-row";const y=[];e.forEach((e,t)=>{const o=h[e.rarity]||"T1",n={state:S,hero:S.hero,enemy:S.enemy,weapon:S.sel.item,allWords:Object.values(S.sel).filter(Boolean),sel:S.sel};let s="";if(e.desc){const t=e.desc.toLowerCase(),o="word_count_bonus"===e.category,a=["momentum","word_historian","reverberation"].includes(e.id);if(t.includes("per round")&&!a){const n=S.roundIndex||1,a=e.desc.match(/\+(\d+\.?\d*)/);if(a){const e=parseFloat(a[1])*n,i=e%1==0?e:parseFloat(e.toFixed(1));s=`<div style="font-size:10px;margin-top:6px">Round ${n} this run: ${o?fmtMod(i,"word"," W"):fmtMod(i,"ap"," AP")}${t.includes("each")?"/Word":""}</div>`}}else if(t.includes("per chapter")){const t=(S.currentChapter||0)+1,n=e.desc.match(/\+(\d+\.?\d*)/);if(n){const e=chapterScale(parseFloat(n[1]),t),a=e%1==0?e:parseFloat(e.toFixed(1));s=`<div style="font-size:10px;margin-top:6px">Chapter ${t} this run: ${o?fmtMod(a,"word"," W"):fmtMod(a,"ap"," AP")}</div>`}}else if("anthology"===e.id){const e=S.uniqueWordsUsed?S.uniqueWordsUsed.size:0,t=Math.min(.5*e,10);s=`<div style="font-size:10px;margin-top:6px">${e} unique words: ${fmtMod(t%1==0?t:parseFloat(t.toFixed(1)),"word"," W")}/Word</div>`}else if("bibliography"===e.id){const e=S.bossesDefeated||0;s=`<div style="font-size:10px;margin-top:6px">${e} bosses = ${fmtMod(2*e,"ap"," AP")}/Word</div>`}else if("lexicon_growth"===e.id){const e=S.bossesDefeated||0;s=`<div style="font-size:10px;margin-top:6px">${e} bosses: ${0===e?'<span class="mod-badge word">+0 W</span>':fmtMod(e,"word"," W")}/Word</div>`}else if("economy"===e.category&&e.goldBonus)try{const t={state:S,hero:S.hero,enemy:S.enemy,allWords:Object.values(S.sel).filter(Boolean)},o=e.goldBonus(t);s=o>0?`<div style="font-size:10px;margin-top:6px;color:#fbbf24">This run: <span style="font-weight:bold">+${o}g</span></div>`:'<div style="font-size:10px;margin-top:6px;color:#6b7280">No bonus yet</div>'}catch(e){}else if("word_count_bonus"===e.category){const t=e.apply(n)||0;if(t>0){s=`<div style="font-size:10px;margin-top:6px">Current: ${fmtMod(t%1==0?t:parseFloat(t.toFixed(1)),"word"," W")}</div>`}}else if("quality_control"===e.id){const e=S.rarityWordsUsed||0,t=.1*e;s=`<div style="font-size:10px;margin-top:6px">${e} rarity words: ${fmtMod(t%1==0?t:parseFloat(t.toFixed(1)),"ap"," AP")}/Word</div>`}else if("grassroots"===e.id){const e=S.tierWordsPlayed?.[1]||0,t=.05*e;s=`<div style="font-size:10px;margin-top:6px">${e} T1 words: ${fmtMod(t%1==0?t:parseFloat(t.toFixed(2)),"ap"," AP")}/Word</div>`}else if("intermediate"===e.id){const e=S.tierWordsPlayed?.[2]||0,t=.1*e;s=`<div style="font-size:10px;margin-top:6px">${e} T2 words: ${fmtMod(t%1==0?t:parseFloat(t.toFixed(1)),"ap"," AP")}/Word</div>`}else if("masterwork"===e.id){const e=S.tierWordsPlayed?.[3]||0,t=e*scaleTalentBonus("masterwork",.2);s=`<div style="font-size:10px;margin-top:6px">${e} T3 words: ${fmtMod(t%1==0?t:parseFloat(t.toFixed(1)),"ap"," AP")}/Word${getTalentLevel("masterwork")>1?` (Lv.${getTalentLevel("masterwork")})`:""}</div>`}else if("adaptive_arsenal"===e.id){const e=(S.usedWeapons||new Set).size,t=scaleTalentBonus("adaptive_arsenal",.5),o=Math.min(e,12)*t;s=`<div style="font-size:10px;margin-top:6px">${e} weapons: ${fmtMod(o%1==0?o:parseFloat(o.toFixed(1)),"word"," W")}/Word${getTalentLevel("adaptive_arsenal")>1?` (Lv.${getTalentLevel("adaptive_arsenal")})`:""}</div>`}else if("word_hoard"===e.id){const e=(S.inv||[]).filter(e=>!e.hiddenInBank).length,t=scaleTalentBonus("word_hoard",.2);s=`<div style="font-size:10px;margin-top:6px">${e} words √ó ${t} = ${fmtMod(Math.floor(e*t*10)/10,"word"," W")}${getTalentLevel("word_hoard")>1?` (Lv.${getTalentLevel("word_hoard")})`:""}</div>`}else if("momentum"===e.id){const e=Math.min((S.roundIndex||1)-1,10);s=`<div style="font-size:10px;margin-top:6px">${e} rounds played: ${fmtMod(e*scaleTalentBonus("momentum",1),"word"," W")}/Word${getTalentLevel("momentum")>1?` (Lv.${getTalentLevel("momentum")})`:""}</div>`}else if("word_historian"===e.id){const e=S.wordsUsedThisRun||0,t=scaleTalentBonus("word_historian",.25),o=Math.floor(e*t);s=`<div style="font-size:10px;margin-top:6px">${e} words used: ${o>0?fmtMod(o,"word"," W"):'<span class="mod-badge word">+0 W</span>'}${getTalentLevel("word_historian")>1?` (Lv.${getTalentLevel("word_historian")})`:""}</div>`}else if("reverberation"===e.id){const e=S.rereadTriggersThisRun||0,t=e*scaleTalentBonus("reverberation",2);s=`<div style="font-size:10px;margin-top:6px">${e} rereads: ${t>0?fmtMod(t,"word"," W"):'<span class="mod-badge word">+0 W</span>'}${getTalentLevel("reverberation")>1?` (Lv.${getTalentLevel("reverberation")})`:""}</div>`}else if("overflow"===e.id){const e=Object.values(S.sel).filter(Boolean).reduce((e,t)=>e+(t.word?.length||t.name?.length||0),0);if(e>50){const t=e-50,o=Math.floor(t/10),n=Math.pow(1.5,o);s=`<div style="font-size:10px;margin-top:6px;color:#4ade80">~${e} W: ${o} stacks = <span class="mod-badge scale">√ó${Math.round(100*n)/100}</span></div>`}else s=`<div style="font-size:10px;margin-top:6px;color:#6b7280">~${e} W (need 50+)</div>`}else if("threshold"===e.category&&e.apply)try{const t=e.apply(n);if(t>1){s=`<div style="font-size:10px;margin-top:6px;color:#4ade80">Active now: <span class="mod-badge scale">√ó${Math.round(10*t)/10}</span></div>`}else s='<div style="font-size:10px;margin-top:6px;color:#6b7280">Not active yet</div>'}catch(e){}}const i=document.createElement("div");i.className="talent-card",i.dataset.talentId=e.id,i.innerHTML=`\n        <div class="talent-card-inner">\n          <div class="talent-card-face talent-card-front">\n            <div class="talent-card-front-content">\n              <div class="talent-card-front-text">Talent</div>\n            </div>\n          </div>\n          <div class="talent-card-face talent-card-back tier-${"rare"===e.rarity?"3":"uncommon"===e.rarity?"2":"1"}">\n            <div class="talent-card-icon">${getTalentSVG(e.id)}</div>\n            <div class="talent-card-header">\n              <div class="talent-card-name">${e.name}</div>\n              <span class="talent-card-rarity-badge">${o}</span>\n            </div>\n            <div class="talent-card-desc">${formatTalentDesc(e)}</div>\n            ${s}\n            ${e.flavor?`<div class="talent-card-flavor"><em>${e.flavor}</em></div>`:""}\n          </div>\n        </div>\n      `,i.onclick=async()=>{if(!i.classList.contains("flipped"))return;if(i.classList.contains("selecting"))return;if(c.length>=r&&!a)return;if(d)return;i.classList.add("selecting","selected"),c.push(e.id);const t=i.getBoundingClientRect();rarityBurst(t.left+t.width/2,t.top+t.height/2,e.rarity||"common");try{playTone(659,.3,"sine",.2),setTimeout(()=>playTone(988,.2,"sine",.15),RHYTHM.QUARTER)}catch(e){}if(a)return d=e,await dly(RHYTHM.BEAT),void await async function(e){u.innerHTML="";const t=document.createElement("div");t.className="talent-pick-counter",t.innerHTML=`Swap <strong>${e.name}</strong> for:`,u.appendChild(t);const o=document.createElement("div");o.className="talent-cards-row talent-swap-row",S.talents.forEach((t,n)=>{const s=TALENTS.find(e=>e.id===t);if(!s)return;const a=h[s.rarity]||"T1",i=document.createElement("div");i.className="talent-card talent-swap-card flipped",i.dataset.talentId=s.id,i.innerHTML=`\n        <div class="talent-card-inner">\n          <div class="talent-card-face talent-card-front">\n            <div class="talent-card-front-content">\n              <div class="talent-card-front-text">Talent</div>\n            </div>\n          </div>\n          <div class="talent-card-face talent-card-back tier-${"rare"===s.rarity?"3":"uncommon"===s.rarity?"2":"1"}">\n            <div class="talent-card-icon">${getTalentSVG(s.id)}</div>\n            <div class="talent-card-header">\n              <div class="talent-card-name">${s.name}</div>\n              <span class="talent-card-rarity-badge">${a}</span>\n            </div>\n            <div class="talent-card-desc">${formatTalentDesc(s)}</div>\n            ${s.flavor?`<div class="talent-card-flavor"><em>${s.flavor}</em></div>`:""}\n          </div>\n        </div>\n      `,i.onclick=async()=>{if(i.classList.contains("selecting"))return;i.classList.add("selecting");try{playTone(392,.15,"sine",.15),setTimeout(()=>playTone(523,.15,"sine",.12),RHYTHM.QUARTER),setTimeout(()=>playTone(659,.2,"sine",.15),RHYTHM.HALF)}catch(e){}const t=S.talents.indexOf(s.id);t>-1&&S.talents.splice(t,1),S.talents.push(e.id);const o=i.getBoundingClientRect();rarityBurst(o.left+o.width/2,o.top+o.height/2,e.rarity||"common"),d=null,await dly(RHYTHM.BEAT);r-c.length>0?(l=l.filter(e=>!c.includes(e.id)),await m(l,!1)):(saveRun(),await dly(RHYTHM.QUARTER),await playSceneTransition(async()=>{$("#talent-overlay").classList.remove("show"),await showShop(!0)}))},o.appendChild(i)}),u.appendChild(o);const n=document.createElement("div");n.className="talent-reroll-container";const s=document.createElement("button");s.className="talent-reroll-btn",s.textContent="Back",s.onclick=async()=>{try{playTone(392,.15,"sine",.12),setTimeout(()=>playTone(330,.2,"sine",.1),RHYTHM.QUARTER)}catch(e){}d=null,c=[],await m(l,!1)};const a=document.createElement("button");a.className="talent-skip-btn talent-upgrade-btn",a.textContent="‚¨Ü Upgrade",a.title="Upgrade one of your existing talents",a.onclick=async()=>{const e=Array.from(o.querySelectorAll(".talent-swap-card")),t=u.querySelector(".talent-pick-counter");t&&(t.innerHTML='<span class="upgrade-header-text">Choose a Talent to Upgrade</span>'),n.style.display="none",e.forEach(o=>{o.classList.add("talent-upgrade-selectable"),o.style.cursor="pointer";const s=o.dataset.talentId,a=TALENTS.find(e=>e.id===s),i=getTalentLevel(s),l=o.querySelector(".talent-level-display");l&&(l.innerHTML=`Lv.${i} ‚Üí Lv.${i+1}`,l.classList.add("talent-level-preview"));const p=o.querySelector(".talent-card-desc");p&&a&&(p.innerHTML=formatTalentDescUpgradePreview(a,s)),o.onmouseenter=()=>{o.classList.contains("upgrade-selected")||(sfxHover(),o.classList.add("upgrade-hover"))},o.onmouseleave=()=>{o.classList.remove("upgrade-hover")},o.onclick=async()=>{if(o.classList.contains("upgrade-selected"))return;o.classList.add("upgrade-selected");const s=o.dataset.talentId,a=TALENTS.find(e=>e.id===s);try{playTone(523,.15,"sine",.2),setTimeout(()=>playTone(659,.12,"sine",.15),RHYTHM.QUARTER)}catch(e){}e.forEach(e=>{e!==o&&(e.classList.add("not-selected"),e.style.pointerEvents="none")});const i=getTalentLevel(s),l=i+1;setTalentLevel(s,l),o.classList.add("upgrade-winner"),await dly(RHYTHM.BEAT),o.classList.add("upgrade-wiggle"),await dly(RHYTHM.BEAT),o.classList.remove("upgrade-wiggle"),o.classList.add("upgrade-pop");const p=o.querySelector(".talent-level-display");p&&(p.innerHTML=`<span class="level-old">Lv.${i}</span> ‚Üí <span class="level-new">Lv.${l}</span>`,p.classList.remove("talent-level-preview"),p.classList.add("level-upgraded"));const f=o.querySelector(".talent-card-desc");f&&(f.innerHTML=formatTalentDesc(a,s),f.classList.add("desc-upgraded"));try{playTone(523,.1,"sine",.15),setTimeout(()=>playTone(659,.1,"sine",.15),RHYTHM.QUARTER),setTimeout(()=>playTone(784,.1,"sine",.15),RHYTHM.HALF),setTimeout(()=>playTone(1047,.2,"sine",.25),RHYTHM.HALF)}catch(e){}const u=o.getBoundingClientRect();burstSparks(u.left+u.width/2,u.top+u.height/2,30),t&&(t.innerHTML=`<span class="upgrade-header-text">${a.name} Upgraded!</span>`),c.push("__upgrade__"),d=null,await dly(RHYTHM.BAR);const h=r-c.length;h>0?(t&&(t.innerHTML=`<span class="upgrade-header-text">Choose a Talent to Upgrade (${h} left)</span>`),e.forEach(e=>{e.classList.remove("not-selected","upgrade-selected","upgrade-winner","upgrade-pop","upgrade-hover"),e.style.pointerEvents="",e.style.cursor="pointer";const t=e.dataset.talentId,o=TALENTS.find(e=>e.id===t),n=getTalentLevel(t),s=e.querySelector(".talent-level-display");s&&(s.innerHTML=`Lv.${n} ‚Üí Lv.${n+1}`,s.classList.remove("level-upgraded"),s.classList.add("talent-level-preview"));const a=e.querySelector(".talent-card-desc");a&&o&&(a.innerHTML=formatTalentDescUpgradePreview(o,t),a.classList.remove("desc-upgraded"))}),n.style.display=""):(saveRun(),await dly(RHYTHM.QUARTER),await playSceneTransition(async()=>{$("#talent-overlay").classList.remove("show"),await showShop(!0)}))}})},n.appendChild(s),n.appendChild(a),u.appendChild(n)}(e);S.talents||(S.talents=[]),S.talents.push(e.id),function(){const e=document.getElementById("talent-pick-counter");if(e){const t=r-c.length;e.textContent=t>0?`Pick ${t} more`:"Done!"}}(),c.length>=r&&(await dly(RHYTHM.BEAT),saveRun(),await dly(RHYTHM.QUARTER),await playSceneTransition(async()=>{$("#talent-overlay").classList.remove("show"),await showShop(!0)}))},f.appendChild(i),y.push(i)}),o.appendChild(f);const g=document.createElement("div");g.className="talent-reroll-container";const w=document.createElement("button");w.className="talent-reroll-btn"+(s?" used":""),w.textContent=s?"Rerolled":"Reroll",w.disabled=s,w.title="See new talents (disables upgrades)";let x=null,v=null;w.onclick=async()=>{if(s)return;s=!0,w.disabled=!0,w.classList.add("used"),w.textContent="Rerolled",v&&(v.style.display="none"),x&&(x.disabled=!0,x.classList.add("used"),x.textContent="Upgrades Disabled",x.title="You chose to reroll - upgrades are no longer available");try{playTone(440,.15,"sine",.2),setTimeout(()=>playTone(523,.15,"sine",.15),RHYTHM.QUARTER),setTimeout(()=>playTone(659,.15,"sine",.1),RHYTHM.HALF)}catch(e){}y.forEach((e,t)=>{e.style.transition="opacity 0.2s ease, transform 0.2s ease",e.style.opacity="0",e.style.transform="scale(0.95)"}),await dly(RHYTHM.HALF);const e=TALENTS.filter(e=>!S.talents.includes(e.id)&&!c.includes(e.id)&&!e.disabled);l=shuf([...e]).slice(0,Math.min(i,e.length)),await m(l,!0)},g.appendChild(w);if(S.talents&&S.talents.length>0){const e=document.createElement("span");e.className="connector-phrase",e.textContent="or",e.style.cssText="margin: 0 12px; color: #6b7280; font-size: 14px;",s&&(e.style.display="none"),v=e,g.appendChild(e);const t=document.createElement("button");x=t,t.className="talent-skip-btn talent-upgrade-btn"+(s?" used":""),t.textContent=s?"Upgrades Disabled":"‚¨Ü Upgrade",t.disabled=s,t.title=s?"You chose to reroll - upgrades are no longer available":"Upgrade one of your existing talents",t.onclick=async()=>{y.forEach((e,t)=>{e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="0",e.style.transform="scale(0.9)"}),await dly(RHYTHM.HALF),o.innerHTML="";const e=document.createElement("div");e.className="talent-pick-counter",e.innerHTML='<span class="upgrade-header-text">Choose a Talent to Upgrade</span>',o.appendChild(e);const t=document.createElement("div");t.className="talent-cards-row talent-upgrade-select-row";const n=[];S.talents.forEach((o,s)=>{const a=TALENTS.find(e=>e.id===o);if(!a)return;const i=getTalentLevel(o),l="rare"===a.rarity?"Rare":"uncommon"===a.rarity?"Uncommon":"Common",d=document.createElement("div");d.className="talent-card talent-upgrade-selectable flipped",d.dataset.talentId=a.id,d.dataset.index=s;const p=`Lv.${i} ‚Üí Lv.${i+1}`;d.innerHTML=`\n            <div class="talent-card-inner">\n              <div class="talent-card-face talent-card-front">\n                <div class="talent-card-front-content">\n                  <div class="talent-card-front-text">Talent</div>\n                </div>\n              </div>\n              <div class="talent-card-face talent-card-back tier-${"rare"===a.rarity?"3":"uncommon"===a.rarity?"2":"1"}">\n                <div class="talent-card-icon">${getTalentSVG(a.id)}</div>\n                <div class="talent-card-header">\n                  <div class="talent-card-name">${a.name}</div>\n                  <span class="talent-card-rarity-badge">${l}</span>\n                </div>\n                <div class="talent-level-display talent-level-preview">${p}</div>\n                <div class="talent-card-desc">${formatTalentDescUpgradePreview(a,o)}</div>\n              </div>\n            </div>\n          `,d.style.cursor="pointer",d.onmouseenter=()=>{sfxHover(),d.classList.add("upgrade-hover")},d.onmouseleave=()=>{d.classList.remove("upgrade-hover")},d.onclick=async()=>{if(d.classList.contains("upgrade-selected"))return;d.classList.add("upgrade-selected");try{playTone(523,.15,"sine",.2),setTimeout(()=>playTone(659,.12,"sine",.15),RHYTHM.QUARTER)}catch(e){}n.forEach(({card:e})=>{e!==d&&(e.classList.add("not-selected"),e.style.pointerEvents="none")});const t=getTalentLevel(o),s=t+1;setTalentLevel(o,s),c.push("__upgrade__"),d.classList.add("upgrade-winner"),await dly(RHYTHM.BEAT),d.classList.add("upgrade-wiggle"),await dly(RHYTHM.BEAT),d.classList.remove("upgrade-wiggle"),d.classList.add("upgrade-pop");const i=d.querySelector(".talent-level-display");i&&(i.innerHTML=`<span class="level-old">Lv.${t}</span> ‚Üí <span class="level-new">Lv.${s}</span>`,i.classList.remove("talent-level-preview"),i.classList.add("level-upgraded"));const l=d.querySelector(".talent-card-desc");l&&(l.innerHTML=formatTalentDesc(a,o),l.classList.add("desc-upgraded"));try{playTone(523,.1,"sine",.15),setTimeout(()=>playTone(659,.1,"sine",.15),RHYTHM.QUARTER),setTimeout(()=>playTone(784,.1,"sine",.15),RHYTHM.HALF),setTimeout(()=>playTone(1047,.2,"sine",.25),RHYTHM.HALF)}catch(e){}const p=d.getBoundingClientRect();burstSparks(p.left+p.width/2,p.top+p.height/2,30),e.innerHTML=`<span class="upgrade-header-text">${a.name} Upgraded!</span>`,await dly(RHYTHM.BAR);const f=r-c.length;f>0?(e.innerHTML=`<span class="upgrade-header-text">Choose a Talent to Upgrade (${f} left)</span>`,n.forEach(({card:e,talent:t,tid:o})=>{e.classList.remove("not-selected","upgrade-selected","upgrade-winner","upgrade-pop","upgrade-hover"),e.style.pointerEvents="",e.style.cursor="pointer";const n=getTalentLevel(o),s=e.querySelector(".talent-level-display");s&&(s.innerHTML=`Lv.${n} ‚Üí Lv.${n+1}`,s.classList.remove("level-upgraded"),s.classList.add("talent-level-preview"));const a=e.querySelector(".talent-card-desc");a&&t&&(a.innerHTML=formatTalentDescUpgradePreview(t,o),a.classList.remove("desc-upgraded"))})):(saveRun(),await dly(RHYTHM.QUARTER),await playSceneTransition(async()=>{$("#talent-overlay").classList.remove("show"),await showShop(!0)}))},n.push({card:d,talent:a,tid:o}),t.appendChild(d)}),o.appendChild(t);const s=document.createElement("div");s.style.cssText="display:flex;justify-content:center;margin-top:16px";const a=document.createElement("button");a.className="talent-upgrade-back-btn",a.textContent="‚Üê Back to Talents",a.onclick=async()=>{try{playTone(440,.1,"sine",.15)}catch(e){}n.forEach(({card:e})=>{e.style.transition="opacity 0.2s ease, transform 0.2s ease",e.style.opacity="0",e.style.transform="scale(0.95)"}),a.style.opacity="0",await dly(RHYTHM.HALF),await m(l,!1)},s.appendChild(a),o.appendChild(s)},g.appendChild(t)}if(o.appendChild(g),t){await dly(RHYTHM.HALF);for(let e=0;e<y.length;e++){await dly(RHYTHM.HALF),y[e].classList.add("flipped");try{playMagicParseTone(2*e,y.length,!1)}catch(e){}}try{await dly(RHYTHM.HALF),playMagicParseTone(5,y.length,!1)}catch(e){}}else y.forEach(e=>e.classList.add("flipped"))}$("#talent-overlay").classList.add("show"),await m(l,!0)}async function showCombat(e,t,o){const{hero:n,enemy:s}=getCombatants(),a={heroDmg:0,enemyDmg:0,heroMax:n.hp,enemyMax:s.hp,heroFin:n.hp,enemyFin:s.hp,win:!1,tie:!1,...e},i={gold:o&&"number"==typeof o.gold?o.gold:0,items:Array.isArray(o?.items)?o.items:[]};window.lastCombatResult=a,window.lastCombatRewards=i;let r=1;a.ultimateWeaponForged?r=8:a.totalRereadCount>20?r=5:a.totalRereadCount>10?r=3:a.totalRereadCount>5&&(r=2);const l=$("#combat-overlay"),c=$("#combat-words"),d=$("#combat-total"),p=$("#combat-flames"),f=$("#combat-weapon-svg"),u=ensureWeaponLayers(f),h=u?.wrapper||f,m=$("#cb-hero"),y=$("#cb-enemy"),g=$("#bar-hero"),w=$("#bar-enemy");l&&!l.__clickSparksAttached&&(l.__clickSparksAttached=!0,l.addEventListener("click",e=>{gfxSettings.lowFx||createFizzySparks(e.clientX,e.clientY,{count:4,colors:["#ff9933","#ffcc00"],shape:"line",size:2,velocity:2.2,gravity:.15,duration:1200,initialOpacity:.6})}));const x=$("#txt-hero"),v=$("#txt-enemy"),b=$("#combat-result"),k=$("#combat-result-title"),L=$("#combat-result-detail"),M=$("#combat-breakdown-btn"),A=$("#combat-breakdown-tooltip");if(M&&(M.style.display="none"),M&&A&&!M.__tooltipAttached){M.__tooltipAttached=!0;const e=e=>{e.stopPropagation(),playSample("click.ogg",.5);if(A.classList.contains("show"))A.classList.remove("show"),M.classList.remove("active");else{const e=formatDamageBreakdown(window.lastCombatResult||a);A.innerHTML=e,e&&fitCombatBreakdownTooltip(A),A.classList.add("show"),M.classList.add("active")}},t=e=>{M.contains(e.target)||A.contains(e.target)||(A.classList.remove("show"),M.classList.remove("active"))};M.addEventListener("click",e),M.addEventListener("mouseenter",sfxHover),document.addEventListener("click",t)}if(!(l&&c&&d&&p&&f&&m&&y&&g&&w&&x&&v))return void console.warn("[combat] Missing combat DOM; skipping animation");c.innerHTML="",d.classList.remove("show"),d.textContent="",p.style.opacity="0",h&&(h.style.transform="rotate(15deg)");const P=document.getElementById("combat-new-run");P&&(P.style.display="none");var R=[S.sel.item,S.sel.adj1,S.sel.adj2,S.sel.adj3,S.sel.adj4,S.sel.noun1].filter(Boolean).length,C=0;renderWeaponProgress(f,0),m.textContent="0",y.textContent="0",g.style.width="0%",w.style.width="100%",x.textContent="",v.textContent=`${fmtBig(a.enemyMax)}/${fmtBig(a.enemyMax)}`;const I=w.parentElement;I&&(I.style.opacity="1",I.style.transition=""),v&&(v.style.opacity="1",v.style.transition=""),b.style.display="none",b.classList.remove("show"),l.classList.remove("combat-reveal","combat-result","combat-exit"),l.classList.add("show"),setTimeout(()=>{l.classList.add("combat-reveal")},200);const _=document.getElementById("combat-continue"),B=document.getElementById("combat-new-run");B&&B.remove(),_&&(_.style.display="none",_.disabled=!0,_.classList.remove("show"));try{c.innerHTML="",d.classList.remove("show"),d.textContent="",p.style.opacity="0",h&&(h.style.transform="rotate(15deg)");R=[S.sel.item,S.sel.adj1,S.sel.adj2,S.sel.adj3,S.sel.adj4,S.sel.noun1].filter(Boolean).length,C=0;renderWeaponProgress(f,0),$("#cb-hero").textContent="0",$("#cb-enemy").textContent="0",$("#bar-hero").style.width="0%",$("#bar-enemy").style.width="100%",$("#txt-hero").textContent="",$("#txt-enemy").textContent=`${fmtBig(e.enemyMax)}/${fmtBig(e.enemyMax)}`;const n=$("#bar-enemy").parentElement;n&&(n.style.opacity="1",n.style.transition="");const s=$("#txt-enemy");s&&(s.style.opacity="1",s.style.transition=""),b&&(b.style.display="none"),l.classList.add("show"),await dly(RHYTHM.HALF),t.forEach(e=>{const t=document.createElement("div");t.className="combat-word",e.tooltip&&t.setAttribute("title",e.tooltip);const o=TC[e.rarity]||"",n=e.retriggerCount&&e.retriggerCount>1?`<div class="combat-word-retrigger"><span class="mod-badge reread">√ó${e.retriggerCount}</span></div>`:"",s=e.italic?" italic":"";t.innerHTML=`<div class="combat-word-name ${o}${s}" ${e.color?`style="color:${e.color}"`:""}>${e.name}</div>${n}`,c.appendChild(t)});const i=[...c.querySelectorAll(".combat-word")],u=t.reduce((e,t)=>e+(t.retriggerCount||1),0);let m=0,y=0;const g=w.parentElement,x=document.getElementById("bar-enemy-preview");w.style.width="100%",x&&(x.style.width="0%",x.classList.add("active")),updateHPBarDamageState(w,null,0),await waitForNextBeat();const P=buildRereadPasses(t),I=new Array(t.length).fill(!1);for(let o=0;o<P.length;o++){const n=P[o];for(let o of n){const n=t[o],s=i[o],a=!I[o],l=!a,c=m/u;let d=1;c>.4?d=8:c>.25?d=4:c>.1&&(d=2),d=Math.min(d,r);const p=l?RHYTHM.HALF:RHYTHM.BEAT;await dly(Math.max(50,p/d)),a?(s.classList.add("show"),I[o]=!0):s.classList.add("retrigger");try{playShepardTone(y,u,l),y++;if(playSample(useClickAlt?"click alt.ogg":"click.ogg",.5),useClickAlt=!useClickAlt,n.wordRef&&"weapon"===n.wordRef.type&&!n.wordRef.isStick&&("slash"===n.wordRef.category?playSample("insert sword bow type.ogg",.5):"pierce"===n.wordRef.category?playSample("insert bow type.ogg",.5):"blunt"===n.wordRef.category?playSample("insert blunt.ogg",.5):"magic"===n.wordRef.category&&playSample("insert wand sound.ogg",.5)),n.wordRef&&void 0!==n.wordRef.elem){const e=ELEMENT_SAMPLES[n.wordRef.elem];e&&playSample(e,n.wordRef.elem===E.LIGHTNING?.4:.25)}if(f){const e=f.getBoundingClientRect(),t=e.left+e.width/2,o=e.top+e.height/2;let a=["#ff9933","#ffcc00","#ffaa44"];if(n.wordRef&&void 0!==n.wordRef.elem){const e={[E.FIRE]:["#ff6633","#ff9933","#ffcc00"],[E.WATER]:["#4d99ff","#66b3ff","#99ccff"],[E.LIGHTNING]:["#ffff4d","#ffffff","#ffffaa"],[E.EARTH]:["#996633","#cc9966","#aa7744"],[E.POISON]:["#7ee04d","#99ff66","#66cc33"],[E.LIGHT]:["#ffffa0","#ffffff","#ffffcc"],[E.DARK]:["#9966cc","#bb88ee","#7744aa"],[E.PHYS]:["#a0a0a0","#cccccc","#888888"]};e[n.wordRef.elem]&&(a=e[n.wordRef.elem])}const i=n.wordRef&&n.wordRef.tier===T.T3?12:n.wordRef&&n.wordRef.tier===T.T2?8:5;if(createFizzySparks(t,o,{count:i,colors:a,shape:"line",size:5,velocity:4,gravity:.2,duration:600,initialOpacity:.9}),n.wordRef&&void 0!==n.wordRef.elem&&s){const e={[E.PHYS]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==MetalClash&&fxAnimations&&addFxAnimation(new MetalClash(n,a,t,o,"#a0a0a0"))},[E.LIGHTNING]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==LightningBolt&&fxAnimations&&(addFxAnimation(new LightningBolt(n,a,t,o,"#ffffff")),setTimeout(()=>addFxAnimation(new LightningBolt(n,a,t,o,"#ffff4d")),50))},[E.FIRE]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==ParticleTrail&&fxAnimations&&addFxAnimation(new ParticleTrail(n,a,t,o,"fire","#ff6633"))},[E.WATER]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==WaterStream&&fxAnimations&&addFxAnimation(new WaterStream(n,a,t,o,"#4d99ff"))},[E.EARTH]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==RockThrow&&fxAnimations&&addFxAnimation(new RockThrow(n,a,t,o,"#996633"))},[E.POISON]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==WindGust&&fxAnimations&&addFxAnimation(new WindGust(n,a,t,o,"#7ee04d"))},[E.LIGHT]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==EnergyBeam&&fxAnimations&&addFxAnimation(new EnergyBeam(n,a,t,o,"#ffffa0",!1))},[E.DARK]:()=>{const e=s.getBoundingClientRect(),n=e.left+e.width/2,a=e.top+e.height/2;void 0!==EnergyBeam&&fxAnimations&&addFxAnimation(new EnergyBeam(n,a,t,o,"#9966cc",!0))}};e[n.wordRef.elem]&&e[n.wordRef.elem]()}}}catch(e){console.error("Tally effect error:",e)}if(n.intensity>.3&&(s.classList.add("impact"),h&&(h.style.animation="weaponShake .3s ease-out",setTimeout(()=>h.style.animation="",RHYTHM.HALF)),n.intensity>1&&spawnFlames(3+Math.floor(2*n.intensity))),await dly(Math.max(50,RHYTHM.HALF/d)),s.classList.remove("impact"),a&&C<R){const e=++C/Math.max(R,1);renderWeaponProgress(f,e>=1?1:e)}m++;const w=m/u,b=e.heroDmg*w,S=Math.max(0,e.enemyMax-b),k=Math.min(100,b/e.enemyMax*100);x&&(x.style.width=`${k}%`),v.textContent=`${fmtBig(Math.round(S))}/${fmtBig(e.enemyMax)}`,g&&(g.classList.add("shake"),setTimeout(()=>g.classList.remove("shake"),RHYTHM.HALF))}}await dly(Math.max(50,RHYTHM.BEAT/r)),p.style.opacity="0.5",d.textContent=`${fmtBig(e.heroDmg)} DAMAGE!`,d.classList.add("show");try{playShepardTone(y+1,u,!1),playSample("boom.ogg",.8)}catch(e){}x&&x.classList.remove("active"),await dly(RHYTHM.BEAT),shatterHealthBar(g,e.heroDmg,e.enemyMax),g&&(g.style.transition="opacity 0.15s ease-out",g.style.opacity="0"),v&&(v.style.transition="opacity 0.15s ease-out",v.style.opacity="0"),await dly(RHYTHM.HALF),x&&(x.style.width="0%");const _=e.enemyFin/e.enemyMax*100;if(w.style.transition="none",w.style.width=`${_}%`,updateHPBarState(w,null,_),v.textContent=`${fmtBig(e.enemyFin)}/${fmtBig(e.enemyMax)}`,await dly(RHYTHM.HALF),e.enemyFin>0&&(g&&(g.style.transition="opacity 0.3s ease-in",g.style.opacity="1"),v&&(v.style.transition="opacity 0.3s ease-in",v.style.opacity="1"),await dly(RHYTHM.BEAT),g&&(g.style.transition=""),v&&(v.style.transition=""),w.style.transition=""),p.style.opacity="0",await dly(RHYTHM.HALF),await anim($("#cb-hero"),0,e.heroDmg,500),await dly(RHYTHM.QUARTER),await anim($("#cb-enemy"),0,e.enemyDmg,350),await dly(RHYTHM.HALF),$("#bar-hero").style.width="0%",$("#txt-hero").textContent="",await dly(RHYTHM.HALF),M&&A){const e=formatDamageBreakdown(window.lastCombatResult||a);A.innerHTML=e,e&&fitCombatBreakdownTooltip(A),A.classList.remove("show"),A.style.opacity="",M.classList.remove("active"),M.style.display=e?"inline-flex":"none"}if(b&&(b.className=""),b&&(b.style.display="block"),l.classList.add("combat-result"),setTimeout(()=>{b&&b.classList.add("show")},80),e.win){b&&b.classList.add("win"),k&&(k.textContent="VICTORY!");try{playSample("victory.ogg",.9)}catch(e){}if(L){L.innerHTML="";const e=document.createElement("div");if(e.className="result-detail-line",e.textContent="Enemy defeated!",L.appendChild(e),S.enemy&&S.enemy.boss&&S.hero){const e=S.chapterBoss?.id||S.enemy.id,t=getBossVictoryDialogue(S.hero.id,e);if(t){const e=document.createElement("div");e.className="result-detail-line",e.style.cssText="font-style:italic;color:#d1d5db;margin-top:8px;font-size:13px",e.textContent=`"${t}"`,L.appendChild(e)}}if(o&&o.gold>0){const e=document.createElement("div");e.className="result-detail-line gold-reward",e.innerHTML=`<span class="gold">+${o.gold} Gold</span>`,L.appendChild(e)}if(o&&o.items.length>0){const e=Math.max(0,24-(S.inv?.length||0)),t=o.items.slice(0,e);if(t.length>0){const n=document.createElement("div");n.className="result-detail-line boss-loot-label",n.textContent="Boss Reward:",L.appendChild(n);const s=document.createElement("div");if(s.className="result-loot-chips",t.forEach(e=>{const t=S.inv.find(t=>t.name===e)||WORDS.find(t=>t.name===e);if(t){const e=mkChip(t,!0);e.classList.add("loot-chip"),s.appendChild(e)}else{const t=document.createElement("span");t.className="loot-word-name",t.textContent=e,s.appendChild(t)}}),L.appendChild(s),e<o.items.length){const e=document.createElement("div");e.className="result-detail-line dim",e.textContent="(inventory space limited)",L.appendChild(e)}}else{const e=document.createElement("div");e.className="result-detail-line dim",e.textContent="Boss Loot: (inventory full)",L.appendChild(e)}}}sfxWin()}else e.tie?(b&&b.classList.add("lose"),k&&(k.textContent="DRAW"),L&&(L.innerHTML='<div class="result-detail-line">Both fell...</div>'),sfxLose(),musicEngine&&musicEngine.initialized&&S.lives<=1&&musicEngine.triggerLoseEffect()):(b&&b.classList.add("lose"),k&&(k.textContent="DEFEAT"),L&&(L.innerHTML='<div class="result-detail-line">The enemy won...</div>'),sfxLose(),musicEngine&&musicEngine.initialized&&S.lives<=1&&musicEngine.triggerLoseEffect());render()}catch(e){console.error(e),b&&(b.className="lose",b.style.display="block"),k&&(k.textContent="‚ö†Ô∏è Combat Error",k.style.color="#f59e0b"),L&&(L.textContent="Something went wrong resolving combat. You can continue to keep playing.",L.style.whiteSpace="pre-line")}finally{_&&(_.style.display="block",_.disabled=!1,setTimeout(()=>{_.classList.add("show"),_.focus()},150))}}function spawnFlames(e){const t=$("#combat-flames");for(let o=0;o<e;o++){const e=document.createElement("div");e.className="flame-particle",e.style.left=100*Math.random()+"%",e.style.bottom="0",e.style.animationDuration=.6+.6*Math.random()+"s",t.appendChild(e),setTimeout(()=>e.remove(),RHYTHM.BAR)}}let shopCrates=[],shopConsumables=[];async function showShop(e=!1){const t=document.getElementById("battle-view");t&&(t.style.display="none"),stopAllRarityDrones(),applyModifiers("SHOP_ENTRY",{hero:S.hero,state:S}),S.gamePhase="shop",S.rerollCost=5;const o=Math.ceil(25*DIFF_PRICE_MULT[S.difficulty||0]);S.cratePrices={world_sky:o,body_soul:o},rollShop(),renderShop(),saveRun();const n=document.getElementById("shop-hero-dialogue");if(n&&S.hero&&S.hero.shopDialogue&&Math.random()<.3){const e=S.hero.shopDialogue,t=e[Math.floor(Math.random()*e.length)];n.textContent=`"${t}"`}else n&&(n.textContent="");const s=document.getElementById("exit-shop-btn");s&&(s.disabled=!0,s.classList.add("btn-disabled"));const a=()=>{const e=document.getElementById("result-box");e&&(e.style.display="none");const t=document.getElementById("forge");t&&t.classList.add("shop-hidden"),$("#shop-overlay").classList.add("show"),musicEngine&&musicEngine.initialized&&musicEngine.enterShopMode();const o=S.roundIndex%9==0&&S.roundIndex>0;setFlameColor(o?"boss-shop":"shop"),sparkManager&&sparkManager.setColorMode(o?"boss":"shop")};e?a():await playSceneTransition(a);const i=$("#spotlight-tint");i&&(i.classList.remove("full"),await dly(RHYTHM.EIGHTH),i.classList.remove("show")),setTimeout(()=>{const e=document.getElementById("exit-shop-btn");e&&(e.disabled=!1,e.classList.remove("btn-disabled"))},500)}function rollShop(){shopCrates=[],S.cratePrices||(S.cratePrices={world_sky:25,body_soul:25});const e=S.talents&&S.talents.includes("refinement"),t=WORDS.filter(t=>"weapon"===t.type&&(!e||!(void 0===t.rarity||t.rarity<=T.T1))),o=WORDS.filter(e=>"rarity"===e.type),n=[E.FIRE,E.WATER,E.EARTH,E.LIGHTNING],s=WORDS.filter(t=>"weapon"!==t.type&&(!t.hiddenInBank&&((!e||!(void 0===t.rarity||t.rarity<=T.T1))&&(void 0!==t.elem&&n.includes(t.elem))))),a=[E.PHYS,E.POISON,E.LIGHT,E.DARK],i=WORDS.filter(t=>"weapon"!==t.type&&(!t.hiddenInBank&&((!e||!(void 0===t.rarity||t.rarity<=T.T1))&&(void 0!==t.elem&&a.includes(t.elem)))));let r=3;S.talents&&S.talents.includes("bulk_discount")&&(r+=1),S.talents&&S.talents.includes("crate_connoisseur")&&(r+=1);const l=o.filter(e=>e.rarity===T.T1),c=o.filter(e=>e.rarity===T.T2),d=o.filter(e=>e.rarity===T.T3);if(shopCrates.push({type:"world_sky",name:"World & Sky",elements:n,weaponPool:t,wordPool:s,t1RarityPool:l,t2RarityPool:c,t3RarityPool:d,weaponQty:1,wordQty:r,rarityQty:0,price:S.cratePrices.world_sky,qty:1+r,words:[]}),shopCrates.push({type:"body_soul",name:"Body & Soul",elements:a,weaponPool:t,wordPool:i,t1RarityPool:l,t2RarityPool:c,t3RarityPool:d,weaponQty:1,wordQty:r,rarityQty:0,price:S.cratePrices.body_soul,qty:1+r,words:[]}),shopConsumables=shuf([...CONSUMABLES]).slice(0,3),S.talents&&S.talents.includes("complimentary")){const e=S.talents.includes("well_equipped")?3:2;if(S.consumables.length<e){const e=CONSUMABLES.filter(e=>!S.consumables.includes(e.id));if(e.length>0){const t=shuf([...e])[0];S.consumables.push(t.id)}}}}function renderShop(){$("#shop-gold").textContent=`${S.gold}`;const{goldInterest:e,slotInterest:t,totalInterest:o,emptySlots:n}=calculateInterest(),s=document.getElementById("shop-gold-interest");s&&(o>0?(s.innerHTML=`| +${o} <span style="font-size:9px;opacity:0.7">(${e}g+${t}s)</span>`,s.title=`Interest on Exit: +${o}\n‚Ä¢ Gold: +${e} (${S.gold}/60g)\n‚Ä¢ Slots: +${t} (${n} empty)`):(s.textContent="",s.title=""));const a=document.getElementById("shop-round-num");a&&(a.textContent=`${S.roundIndex}`);const i=Math.floor((S.roundIndex-1)/9)+1,r=document.getElementById("shop-chapter-num");r&&(r.textContent=`${i}`);const l=document.getElementById("shop-inventory");if(l){const e=S.inv.filter(e=>!e.hiddenInBank).length;l.textContent=`${e}/24`}const c=document.getElementById("shop-inv-breakdown-tooltip");c&&(c.innerHTML=generateInvBreakdown());const d=document.getElementById("shop-consumable-cap");d&&(d.textContent=`${S.consumables.length}/2`,d.classList.toggle("at-limit",S.consumables.length>=2));const p=document.getElementById("shop-hero-portrait-container");if(p){let e=null;if(S.hero&&S.hero.id)e=S.hero.id;else if(S.heroId)e=S.heroId;else if(S.hero&&S.hero.name){const t=HEROES.find(e=>e.name===S.hero.name);t&&(e=t.id)}if(e){const t=getPortraitSVG(e,"shop");p.innerHTML=`<div class="portrait-frame">${t}</div>`}}const f=document.getElementById("shop-hero-info");if(f)if(S.hero){const e=S.hero,t=e.str.map(e=>`<span class="tag str">${EN[e]}</span>`).join(""),o=("Belle Lettres"===e.name&&S.belleRandomWeaknesses?S.belleRandomWeaknesses:e.weak).map(e=>`<span class="tag weak">${EN[e]}</span>`).join(""),n=e.good?e.good.charAt(0).toUpperCase()+e.good.slice(1):"None",s=e.bad?e.bad.charAt(0).toUpperCase()+e.bad.slice(1):"None",a=S.talents&&S.talents.includes("overcoming")?`<span class="tag prof">${s} √ó1.5 W</span>`:`<span class="tag weak">${s} √ó0.5 W</span>`;f.innerHTML=`<div style="margin-bottom:2px"><span class="hero-c" style="font-weight:bold;font-size:13px">${e.name}</span></div><div style="margin-bottom:2px"><span class="dim" style="font-size:10px">Strong:</span> ${t||'<span class="dim">None</span>'}</div><div style="margin-bottom:2px"><span class="dim" style="font-size:10px">Weak:</span> ${o||'<span class="dim">None</span>'}</div><div><span class="dim" style="font-size:10px">Proficient:</span> <span class="tag prof">${n} √ó2 W</span> ${a}</div>`}else f.textContent="";const u=document.getElementById("shop-talent-count");u&&(u.textContent=S.talents?S.talents.length:0),renderNextEnemyPreview(),renderShopCrates(),renderShopWordBank(!1),renderShopTalents(),renderShopConsumables()}function renderNextEnemyPreview(){const e=S.roundIndex,t=e%9==0,o=e%3==0&&!t;if(t&&!S.nextChapterBoss)if(Math.random()<.05)S.nextChapterBoss=SECRET_CHAPTER_BOSS;else{let e=CHAPTER_BOSSES.filter(e=>!S.foughtChapterBosses.includes(e.id));0===e.length&&(e=[...CHAPTER_BOSSES]),S.nextChapterBoss=e[Math.floor(Math.random()*e.length)]}if(!S.nextEnemyData){const e=ENEMIES[Math.floor(Math.random()*ENEMIES.length)]||ENEMIES[0];S.nextEnemyData={...e},randomizeEnemyElements(S.nextEnemyData)}const n={...S.nextEnemyData};if(n.weak=[...S.nextEnemyData.weak],n.res=[...S.nextEnemyData.res],n.hp=enemyHp(e),t&&S.nextChapterBoss&&(n.name=S.nextChapterBoss.name,n.id=S.nextChapterBoss.id,n.ability=S.nextChapterBoss.ability,n.isChapterBoss=!0,n.isSecretBoss=S.nextChapterBoss.isSecretBoss||!1,S.nextChapterBoss.weak?n.weak=[...S.nextChapterBoss.weak]:n.weak=n.weak.slice(0,1),S.nextChapterBoss.res?n.res=[...S.nextChapterBoss.res]:n.res=n.res.slice(0,2),S.nextChapterBoss.hpMultiplier?n.hp=Math.round(n.hp*S.nextChapterBoss.hpMultiplier):n.hp=Math.round(1.3*n.hp)),o&&!t&&(n.isMiniboss=!0,n.hp=Math.round(1.3*n.hp)),S.hero&&"Belle Lettres"===S.hero.name){const e=[E.PHYS,E.POISON,E.FIRE,E.WATER,E.LIGHT,E.DARK,E.EARTH,E.LIGHTNING];if(!S.belleRandomWeaknesses){const t=e.filter(e=>!S.hero.str.includes(e));S.belleRandomWeaknesses=[...t].sort(()=>Math.random()-.5).slice(0,2)}if(!S.nextEnemyBonusWeaknesses){const t=e.filter(e=>!n.weak.includes(e)&&!n.res.includes(e));S.nextEnemyBonusWeaknesses=[...t].sort(()=>Math.random()-.5).slice(0,2)}n.weak=[...n.weak,...S.nextEnemyBonusWeaknesses]}S.enemy=n;const s=document.getElementById("shop-enemy-portrait-container");if(s&&S.enemy){const e=getPortraitSVG(S.enemy.id,"shop-enemy");s.innerHTML=`<div class="portrait-frame">${e}</div>`}const a=$("#next-enemy-preview");if(a){const e=S.talents&&S.talents.includes("irony"),t=S.tempEffects&&S.tempEffects.disableBossAbility;let o=null;"plague_doctor"===n.id&&S.hero&&!t&&S.hero.str&&S.hero.str.length>0&&(o=S.hero.str[0]);const s=n.weak&&n.weak.length>0?n.weak:[],i=s.length>0?s.map(e=>`<span class="tag str">${EN[e]}</span>`).join(""):'<span class="dim">None</span>',r=[...n.res||[]];let l="";if(r.length>0||null!==o){const t=r.map((t,o)=>e&&0===o?`<span class="tag irony">${EN[t]} <span class="irony-badge">Irony</span></span>`:`<span class="tag weak">${EN[t]}</span>`);null!==o&&t.push(`<span class="tag weak" style="background:#4a0000;border-color:#990000">${EN[o]} <span style="font-size:8px;opacity:0.8">(IMMUNE)</span></span>`),l=t.join("")}else l='<span class="dim">None</span>';let c="";n.ability&&(c=`<div style="margin-top:8px;padding:8px;background:#2a1a2a;border:1px solid #9966cc;border-radius:6px">\n        <div style="color:#a78bfa;font-size:11px;font-weight:bold">${n.ability.icon||icon("lightning")} ${n.ability.name}</div>\n        <div style="color:#9ca3af;font-size:10px;margin-top:4px">${n.ability.desc}</div>\n      </div>`);let d="";n.isChapterBoss?d=' <span class="tag ability">Boss</span>':n.isMiniboss&&(d=' <span class="tag ability">Mini-Boss</span>'),a.innerHTML=`<div style="margin-bottom:8px"><span class="enemy-c" style="font-weight:bold;font-size:14px">${n.name}</span>${d}</div><div style="margin-bottom:4px"><span class="dim" style="font-size:11px">HP:</span> <span class="gold">${n.hp}</span></div><div style="margin-bottom:4px"><span class="dim" style="font-size:11px">Weak to:</span> ${i}</div><div style="margin-bottom:4px"><span class="dim" style="font-size:11px">Resists:</span> ${l}</div>`+c}}function renderShopCrates(){const e=$("#shop-crates");e.innerHTML="",shopCrates.forEach((t,o)=>{const n=document.createElement("div"),s="world_sky"===t.type?"crate-earth-sky":"body_soul"===t.type?"crate-body-soul":"";n.className=`shop-item card-surface crate-clickable ${s}`,n.style.cssText="min-width:150px;max-width:180px;cursor:pointer";const a={world_sky:{icon:icon("earth-sky"),color:"#4ade80",subtitle:"Fire ‚Ä¢ Water ‚Ä¢ Earth ‚Ä¢ Lightning"},body_soul:{icon:icon("body-soul"),color:"#a78bfa",subtitle:"Physical ‚Ä¢ Poison ‚Ä¢ Light ‚Ä¢ Dark"}}[t.type]||{icon:icon("crate"),color:"#9ca3af",subtitle:""},i=e=>S.talents.includes(e);let r=t.price;i("merchant_guild")&&(r=Math.ceil(.5*r)),i("bargain_hunter")&&(r=Math.ceil(.8*r));const l=S.gold>=r;l||n.classList.add("crate-disabled"),n.innerHTML=`\n      <div style="font-size:14px;font-weight:bold;color:${a.color};margin-bottom:4px">${t.name}</div>\n      <div style="font-size:9px;color:#6b7280;margin-bottom:6px">${a.subtitle||""}</div>\n      <div style="font-size:11px;color:#9ca3af;margin-bottom:8px">1 Weapon + ${t.wordQty} Elemental + 1 Rarity</div>\n      <div class="shop-price gold">${icon("coin")}${r}</div>\n    `,n.onmouseenter=()=>{l&&sfxHover()},n.onclick=async()=>{let e=t.price;if(i("merchant_guild")&&(e=Math.ceil(.5*e)),i("bargain_hunter")&&(e=Math.ceil(.8*e)),S.gold>=e){const o=t.qty,s=S.inv.filter(e=>!e.hiddenInBank).length;if(s+o>24)return void showQuickToast(`Not enough inventory space! Need ${o-(24-s)} more slot(s).`);playSample("buy_crate.ogg",.9);const a=n.getBoundingClientRect();goldBurst(a.left+a.width/2,a.top+a.height/2);i("ninja_loot")&&Math.random()<.2||(S.gold-=e,S.goldSpent=(S.goldSpent||0)+e),S.cratesOpened=(S.cratesOpened||0)+1;const r=await showCrateReelAnimation(t);sfxCrateTier(r),gfxSettings.lowFx||recordFlipPositions($("#shop-word-bank")),r.forEach(e=>{S.inv.push({...e})}),checkHoarderAchievement();const l=S.cratePrices[t.type]||25;S.cratePrices[t.type]=Math.min(Math.ceil(1.5*l),150),t.price=S.cratePrices[t.type],renderShop(),gfxSettings.lowFx||requestAnimationFrame(()=>playFlipAnimation($("#shop-word-bank"))),render(),"function"==typeof onTutorialCratePurchased&&onTutorialCratePurchased()}},e.appendChild(n)}),0===shopCrates.length&&(e.innerHTML='<div class="dim" style="padding:10px;font-size:11px">Sold out!</div>')}let selectedSellWords=[];function renderShopWordBank(e=!0){const t=$("#shop-word-bank");e&&!gfxSettings.lowFx&&recordFlipPositions(t),t.innerHTML="",selectedSellWords=[],document.getElementById("sell-word-btn").textContent="Sell Selected",document.getElementById("sell-word-btn").disabled=!0;const o=getSortedVisibleBankWords(S.inv,S.shopSortMode,S.shopSortAsc);o.forEach(e=>{const o=document.createElement("div");o.className="chip has-tooltip",e.id&&(o.dataset.wordId=e.id),e.rarity===T.T0&&o.classList.add("rusty"),"weapon"===e.type&&o.classList.add("weapon-tile");const n=TC[e.rarity]||TC[0],s=TN[e.rarity]||"T1";let a="";void 0!==e.elem?a=`<div class="chip-elem" style="color:${EC[e.elem]}">${EN[e.elem]}</div>`:e.mult&&1!==e.mult&&(a=`<span class="mod-badge scale" style="margin-top:2px;font-size:9px">√ó${e.mult}</span>`);let i="";const r=["elem-phys","elem-poison","elem-fire","elem-water","elem-light","elem-dark","elem-earth","elem-lightning"],l=["elem-wash-phys","elem-wash-poison","elem-wash-fire","elem-wash-water","elem-wash-light","elem-wash-dark","elem-wash-earth","elem-wash-lightning"];if("elemental"===e.type&&void 0!==e.elem)i=`<div class="chip-tab ${r[e.elem]||""}"></div>`,e.rarity===T.T2?o.classList.add("tier-wash-2",l[e.elem]||""):e.rarity===T.T3&&o.classList.add("tier-wash-3",l[e.elem]||"");else if("rarity"===e.type){const t=e.rarity===T.T3?"rarity-t3":e.rarity===T.T2?"rarity-t2":"rarity-t1";o.classList.add("rarity-word",t)}const c=mkTooltip(e);let d=e.name;"weapon"===e.type||e.isStick||(d=getDisplayForm(e,"noun1",null)||e.name);let p="";if("weapon"===e.type&&e.category){const t=e.category;p=t.charAt(0).toUpperCase()+t.slice(1)}const f="elemental"===e.type?"":n,u=`<div class="chip-tier tier-${e.rarity}">${s}</div>`;o.innerHTML=`\n      ${i}\n      ${u}\n      <div class="chip-name ${f}">${d}</div>\n      <div class="chip-info">${p}</div>\n      ${a}\n      ${c}\n    `,o.onclick=()=>{playSample("highlight word.ogg",.5);const t=S.inv.indexOf(e),n=selectedSellWords.findIndex(e=>e.idx===t);n>=0?(selectedSellWords.splice(n,1),o.classList.remove("selected")):(selectedSellWords.push({word:e,idx:t}),o.classList.add("selected"));let s=0;selectedSellWords.forEach(({word:e})=>{const t=e.rarity||0;let o=0===t?1:2===t?2:5;S.talents&&S.talents.includes("golden_tongue")&&(o=Math.ceil(1.5*o)),s+=o});const a=document.getElementById("sell-word-btn");s>0?(a.innerHTML=`Sell Selected (${s}${icon("coin")})`,a.disabled=!1):(a.textContent="Sell Selected",a.disabled=!0)},o.onmouseenter=sfxHover,o.draggable=!1,t.appendChild(o)}),0===o.length&&(t.innerHTML='<div class="dim" style="padding:10px;font-size:11px">No words in inventory</div>'),e&&!gfxSettings.lowFx&&requestAnimationFrame(()=>playFlipAnimation(t))}function renderShopConsumables(){const e=$("#shop-consumables"),t=$("#shop-owned-consumables");if(!e||!t)return;e.innerHTML="",t.innerHTML="";const o=(e,t,o)=>{const n=document.createElement("div");n.className="consumable-item has-tooltip",n.onmouseenter=sfxHover;const s=e?.name||"Consumable";let a=e?.cost||0;a=Math.ceil(a*DIFF_PRICE_MULT[S.difficulty||0]),S.talents&&S.talents.includes("tinkerer")&&(a=Math.ceil(.75*a));const i=(e=>`<div class="tooltip"><div class="tooltip-title">${e?.name||"Consumable"}</div><div class="tooltip-line">${e?.desc||"Consumable"}</div></div>`)(e);if("shop"===t){const t=S.talents&&S.talents.includes("well_equipped")?3:2,r=S.consumables.length>=t,l=S.gold>=a,c=`${r?"At capacity":"Buy"} ¬∑ ${icon("coin")}${a}`;!r&&l||n.classList.add("disabled"),n.innerHTML=`<div class="chip-name" style="color:#fbbf24">${s}</div><div class="chip-info">${c}</div>${i}`,n.onclick=()=>{if(r)showQuickToast(`You can only carry ${t} Tools.`);else if(l){if(S.gold>=a){playSample("buy_crate.ogg",.9),n.animate([{transform:"scale(1)",opacity:1},{transform:"scale(1.2)",opacity:1,offset:.2},{transform:"scale(0.8) translateY(-20px)",opacity:.7,offset:.5},{transform:"scale(0.5) translateY(-40px)",opacity:0,offset:1}],{duration:300,easing:"ease-out",fill:"forwards"});const t=n.getBoundingClientRect();burstSparks(t.left+t.width/2,t.top+t.height/2,20,["#4ade80","#22c55e","#16a34a"]),S.gold-=a,S.goldSpent=(S.goldSpent||0)+a,S.consumables.push(e.id),shopConsumables.splice(o,1),setTimeout(()=>{renderShop(),render()},150)}}else showQuickToast(`Not enough gold! Need ${icon("coin")}${a}, have ${icon("coin")}${S.gold}`)}}else{const t=Math.max(1,Math.floor(a/2));n.onclick=()=>{const n=S.consumables.indexOf(e?.id||o);n>=0&&(playSample("highlight word.ogg",.5),S.consumables.splice(n,1),S.gold+=t,renderShop(),render())},n.innerHTML=`<div class="chip-name" style="color:#fbbf24">${s}</div><div class="chip-info">Sell ¬∑ ${icon("coin")}${t}</div>${i}`}return n},n=shopConsumables.map((e,t)=>({item:e,mode:"shop",index:t})),s=S.consumables.map((e,t)=>({item:CONSUMABLES.find(t=>t.id===e)||{id:e,name:e,desc:"Consumable",cost:0},mode:"owned",index:t}));if(0===n.length){const t=document.createElement("div");t.className="dim",t.style.fontSize="11px",t.style.padding="6px",t.textContent="Sold out!",e.appendChild(t)}else n.forEach(({item:t,mode:n,index:s})=>e.appendChild(o(t,n,s)));if(0===s.length){const e=document.createElement("div");e.className="dim",e.style.fontSize="11px",e.style.padding="6px",e.textContent="No consumables owned",t.appendChild(e)}else s.forEach(({item:e,mode:n,index:s})=>t.appendChild(o(e,n,s)))}function renderShopTalents(){const e=document.getElementById("shop-talent-bar");if(!e)return;if(e.innerHTML="",!S.talents||0===S.talents.length)return void(e.innerHTML='<div class="dim" style="font-size:10px;padding:4px">No active Talents</div>');const t=document.createElement("div");t.style.cssText="display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:8px";const o=document.createElement("div");o.className="dim",o.style.fontSize="10px",o.textContent=`${S.talents.length} Active Talents`,t.appendChild(o);const n=document.createElement("button");n.textContent="üëÅÔ∏è View All",n.style.cssText="padding:2px 8px;font-size:10px;background:transparent;border:1px solid #4b5563;",n.onmouseenter=sfxHover,n.onclick=()=>{openTalentViewer()},t.appendChild(n),e.appendChild(t),S.talents.forEach(t=>{const o=TALENTS.find(e=>e.id===t);if(!o)return;const n=document.createElement("div");n.className="chip";const s={common:"tier-1",uncommon:"tier-2",rare:"tier-3"}[o.rarity]||"tier-1",a=getTalentLevel(t),i=a>1?` <span class="talent-level">Lv.${a}</span>`:"",r=mkTooltip(o);n.innerHTML=`<div class="chip-name ${s}">${o.name}${i}</div><div class="chip-info">Talent</div>${r}`,n.style.cursor="default",n.style.opacity="0.9",e.appendChild(n)})}function rerollShop(){if(S.gold>=S.rerollCost){const e=S.rerollCost;S.gold-=e,S.goldSpent=(S.goldSpent||0)+e,S.rerollCost=Math.min(Math.ceil(1.5*S.rerollCost),50),rollShop(),playSample("buy_crate.ogg",.9),renderShop(),render()}}function wPrice(e){let t=8;return"weapon"===e.type?t=12:"adjective"===e.type?t=Math.round(8*(e.mult||1)):"noun"===e.type?t=Math.round(2.5*(e.ap||4)):"elemental"===e.type&&(t=Math.round(6*(e.mult||1.5))),Math.max(5,Math.round(t*(e.rarity>=0?1+.5*e.rarity:1)))}function showInv(){const e=$("#inv-list");e.innerHTML="";const t=S.inv.filter(e=>!e.hiddenInBank).length;$("#inv-count").textContent=`(${t} words)`;sortInventory(S.inv).forEach(t=>{const o=document.createElement("div");o.className="chip",o.style.cursor="default";let n=t.name;"weapon"===t.type||t.isStick||(n=getDisplayForm(t,"noun1",null)||t.name);const s=TN[t.rarity]||"T1";let a="";if("weapon"===t.type&&t.category){const e=t.category;a=e.charAt(0).toUpperCase()+e.slice(1)}let i=void 0!==t.elem?`<div class="chip-elem" style="color:${EC[t.elem]}">${EN[t.elem]}</div>`:t.mult&&1!==t.mult?`<span class="mult-pill">√ó${t.mult}</span>`:"",r="";const l=["elem-phys","elem-poison","elem-fire","elem-water","elem-light","elem-dark","elem-earth","elem-lightning"],c=["elem-wash-phys","elem-wash-poison","elem-wash-fire","elem-wash-water","elem-wash-light","elem-wash-dark","elem-wash-earth","elem-wash-lightning"];if("elemental"===t.type&&void 0!==t.elem)r=`<div class="chip-tab ${l[t.elem]||""}"></div>`,t.rarity===T.T2?o.classList.add("tier-wash-2",c[t.elem]||""):t.rarity===T.T3&&o.classList.add("tier-wash-3",c[t.elem]||"");else if("rarity"===t.type){const e=t.rarity===T.T3?"rarity-t3":t.rarity===T.T2?"rarity-t2":"rarity-t1";o.classList.add("rarity-word",e)}const d="elemental"===t.type?"":TC[t.rarity],p=`<div class="chip-tier tier-${t.rarity}">${s}</div>`;o.innerHTML=`${r}${p}<div class="chip-name ${d}">${n}</div><div class="chip-info">${a}</div>${i}`,e.appendChild(o)}),$("#inv-overlay").classList.add("show")}function clrSel(){stopAllRarityDrones(),S.sel={item:null,adj1:null,adj2:null,adj3:null,adj4:null,noun1:null}}function shuf(e){for(let t=e.length-1;t>0;t--){const o=Math.random()*(t+1)|0;[e[t],e[o]]=[e[o],e[t]]}return e}function dly(e){return new Promise(t=>setTimeout(t,e))}function anim(e,t,o,n,s=e=>Math.round(e)){return new Promise(a=>{const i=performance.now(),r=l=>{const c=Math.min((l-i)/n,1);e.textContent=s(t+(o-t)*c),c<1?requestAnimationFrame(r):a()};requestAnimationFrame(r)})}function buildRereadPasses(e){const t=e.map(e=>e.retriggerCount||1),o=[];for(;t.some(e=>e>0);){const e=[];for(let o=0;o<t.length;o++)t[o]>0&&(e.push(o),t[o]--);e.length>0&&o.push(e)}return o}function updateHPBarState(e,t,o){e&&(e.classList.remove("hp-high","hp-mid","hp-low","hp-critical"),o>60?e.classList.add("hp-high"):o>30?e.classList.add("hp-mid"):o>10?e.classList.add("hp-low"):e.classList.add("hp-critical"),t&&o<50&&(t.classList.add("shake"),setTimeout(()=>t.classList.remove("shake"),RHYTHM.HALF)))}function updateHPBarDamageState(e,t,o){e&&(e.classList.remove("hp-high","hp-mid","hp-low","hp-critical"),o<25||o<50?e.classList.add("hp-low"):e.classList.add("hp-critical"),t&&o>40&&(t.classList.add("shake"),setTimeout(()=>t.classList.remove("shake"),RHYTHM.HALF)))}let introDismissPromise=null;function showRoundIntro(){if(!S.hero||!S.enemy)return void(introDismissPromise=Promise.resolve());const e=startDialogueSession();let t,o=document.getElementById("round-intro-overlay");if(o||(o=document.createElement("div"),o.id="round-intro-overlay",document.body.appendChild(o)),1===S.roundIndex&&S.hero.runStartDialogue)t=S.hero.runStartDialogue;else{const e=getHeroEnemyDialogue(S.hero.id,S.enemy.id);t=e||S.hero.dialogue?.[Math.floor(Math.random()*S.hero.dialogue.length)]||"..."}const n=S.enemy.dialogue?.[Math.floor(Math.random()*S.enemy.dialogue.length)]||"...",s=S.enemy.boss||!1,a=S.enemy.isChapterBoss||!1,i=s&&!a;let r=`Round ${S.roundIndex}`;a?r=`CHAPTER BOSS - Round ${S.roundIndex}`:i&&(r=`MINIBOSS - Round ${S.roundIndex}`);let l="";if(a&&S.enemy.ability){const e=S.enemy.ability;let t=e.desc;if(S.chapterBoss&&"red_aktins"===S.chapterBoss.id&&S.blockedSlot){t=`${{adj1:"Prefix 1",adj2:"Prefix 2",adj3:"Suffix 1",adj4:"Suffix 2",noun1:"Gem"}[S.blockedSlot]} slot is [REDACTED]`}l=`\n      <div class="intro-ability">\n        <span class="ability-name">${e.name}:</span>\n        <span class="ability-desc">"${t}"</span>\n      </div>\n    `}else if(s&&S.enemy.modifiers&&S.enemy.modifiers.length>0){l=`<div class="intro-modifiers">${S.enemy.modifiers.map(e=>`<span class="intro-modifier" title="${e.desc}">${e.icon} ${e.name}</span>`).join("")}</div>`}o.innerHTML=`\n    <div class="intro-content">\n      <div class="intro-round-label ${s?"boss":""}">${r}</div>\n      <div class="intro-versus">\n        <div class="intro-combatant intro-hero">\n          <div class="intro-portrait hero-side">\n            <div class="intro-portrait-frame"></div>\n          </div>\n          <div class="intro-name">${S.hero.name}</div>\n          <div class="intro-dialogue" id="intro-hero-dialogue"></div>\n        </div>\n        <div class="intro-vs">VS</div>\n        <div class="intro-combatant intro-enemy">\n          <div class="intro-portrait enemy-side">\n            <div class="intro-portrait-frame"></div>\n          </div>\n          <div class="intro-name">${S.enemy.name}</div>\n          ${l}\n          <div class="intro-dialogue" id="intro-enemy-dialogue"></div>\n        </div>\n      </div>\n      <div class="intro-hint">Click to continue</div>\n    </div>\n  `;const c=(t,o,n)=>{const s=document.getElementById(t);if(!s||!o)return;const a=o.split(" ");let i=0;s.textContent='"';const r=s.closest(".intro-combatant")?.querySelector(".intro-portrait-frame"),l=()=>{e&&!e.canceled&&(i<a.length?(i>0&&(s.textContent+=" "),s.textContent+=a[i],i++,playTalkSound(n),r&&(r.classList.add("speaking"),scheduleDialogueTimeout(e,()=>r.classList.remove("speaking"),120)),scheduleDialogueTimeout(e,l,150)):s.textContent+='"')};l()},d=o.querySelector(".hero-side .intro-portrait-frame"),p=o.querySelector(".enemy-side .intro-portrait-frame");d&&renderPortrait(d,S.hero.id,"#4ade80"),p&&renderPortrait(p,S.enemy.id||S.enemy.baseId,"#f87171"),o.classList.add("show"),a&&setFlameColor("boss-dialogue");const f=musicEngine&&musicEngine.bpm||136,u=Math.round(6e4/f);scheduleDialogueTimeout(e,()=>{o.querySelector(".intro-enemy")?.classList.add("entered");try{playBrassTone(164.81,.15,.08)}catch(e){}},u),scheduleDialogueTimeout(e,()=>{c("intro-enemy-dialogue",n,"enemy")},2*u),scheduleDialogueTimeout(e,()=>{o.querySelector(".intro-vs")?.classList.add("entered");try{playBrassTone(246.94,.1,.06)}catch(e){}},3*u),scheduleDialogueTimeout(e,()=>{o.querySelector(".intro-hero")?.classList.add("entered");try{playBrassTone(329.63,.15,.1)}catch(e){}},4*u),scheduleDialogueTimeout(e,()=>{c("intro-hero-dialogue",t,"hero")},5*u),introDismissPromise=new Promise(t=>{const n=()=>{o.classList.remove("show"),o.removeEventListener("click",n),cancelDialogueSession(),a&&setFlameColor("boss-battle"),t()};o.addEventListener("click",n),scheduleDialogueTimeout(e,n,5*u+5e3)})}function waitForIntroDismiss(){return introDismissPromise||Promise.resolve()}let isTransitioning=!1;async function playSceneTransition(e=null){if(!isTransitioning){isTransitioning=!0;try{playSample("transition.ogg",.5)}catch(e){}e&&await e(),await dly(RHYTHM.QUARTER),isTransitioning=!1}}function setupSmartDrag(e,t,o){}const isShopOpen=()=>document.getElementById("shop-overlay")?.classList.contains("show");function openPauseMenu(e="run"){const t=document.getElementById("pause-menu"),o=$("#pause-continue");o&&(o.textContent="shop"===e?"Return to Shop":"Return to Run"),t&&(t.dataset.context=e,showOverlay(t),playSfxOpen())}function closePauseMenu(e=!1){const t=document.getElementById("pause-menu");t&&(t.classList.remove("show"),t.removeAttribute("data-context"),e||playSfxBack());const o=$("#pause-continue");o&&(o.textContent="Return to Run")}function createFizzySparks(e,t,o={}){const{count:n=20,colors:s=["#f4d03f","#fbbf24","#ff6633","#9966cc","#4d99ff"],shape:a="mixed",size:i=8,velocity:r=1,gravity:l=.3,duration:c=1500,container:d=document.body,blur:p=0,initialOpacity:f=1}=o,u=[],h={circle:"‚óè",star:"‚òÖ",sparkle:"‚ú¶",diamond:"‚óÜ",square:"‚ñ†",line:"‚îÇ"},m=document.createElement("div");m.style.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    z-index: 99999;\n  ",d.appendChild(m);for(let o=0;o<n;o++){const o=document.createElement("div");let n,d=!1;if("mixed"===a){const e=Object.keys(h),t=e[Math.floor(Math.random()*e.length)];n=h[t],d="line"===t}else n=h[a]||h.circle,d="line"===a;const y=s[Math.floor(Math.random()*s.length)],g=i*(.5+1.5*Math.random());o.textContent=n;const w=p>0?`drop-shadow(0 0 3px ${y}) blur(${p}px)`:`drop-shadow(0 0 3px ${y})`;o.style.cssText=`\n      position: absolute;\n      left: ${e}px;\n      top: ${t}px;\n      font-size: ${g}px;\n      color: ${y};\n      pointer-events: none;\n      user-select: none;\n      filter: ${w};\n      will-change: transform, opacity;\n      opacity: ${f};\n    `,m.appendChild(o);const x=Math.random()*Math.PI*2,v=(2+4*Math.random())*r,b={element:o,x:e,y:t,vx:Math.cos(x)*v,vy:Math.sin(x)*v-(2+2*Math.random()),rotation:360*Math.random(),rotationSpeed:10*(Math.random()-.5),life:1,decay:1/(c/16),gravity:l,friction:.98,initialOpacity:f,isLine:d};u.push(b)}const y=performance.now(),g=o=>{o-y>c?m.remove():(u.forEach(o=>{o.vy+=o.gravity,o.vx*=o.friction,o.vy*=o.friction,o.x+=o.vx,o.y+=o.vy,o.life-=o.decay,o.isLine?o.rotation=Math.atan2(o.vy,o.vx)*(180/Math.PI)+90:o.rotation+=o.rotationSpeed;const n=o.life,s=o.isLine?.3:n,a=o.isLine?3*n:n,i=Math.max(0,o.life*o.initialOpacity);o.element.style.transform=`translate(${o.x-e}px, ${o.y-t}px) rotate(${o.rotation}deg) scale(${s}, ${a})`,o.element.style.opacity=i}),requestAnimationFrame(g))};requestAnimationFrame(g)}function createFizzySparksAtElement(e,t={}){const o=e.getBoundingClientRect();createFizzySparks(o.left+o.width/2,o.top+o.height/2,t)}function createGravityVortex(e,t={}){const{count:o=20,colors:n=["#ff6600","#ff9933","#ffcc00"],shape:s="sparkle",size:a=4,duration:i=2e3,orbitRadius:r=80,orbitSpeed:l=.05,spiralIn:c=!0,intensity:d=1}=t;if(0===d||!e)return null;const p=e.getBoundingClientRect(),f=(p.left,p.width,p.top,p.height,[]),u={circle:"‚óè",star:"‚òÖ",sparkle:"‚ú¶",diamond:"‚óÜ",square:"‚ñ†"},h=document.createElement("div");h.style.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    z-index: 99998;\n  ",document.body.appendChild(h);for(let e=0;e<o;e++){const t=document.createElement("div"),c=u[s]||u.sparkle,p=n[Math.floor(Math.random()*n.length)],m=a*(.7+.6*Math.random());t.textContent=c,t.style.cssText=`\n      position: absolute;\n      font-size: ${m}px;\n      color: ${p};\n      pointer-events: none;\n      user-select: none;\n      filter: drop-shadow(0 0 3px ${p}) blur(0.5px);\n      will-change: transform, opacity;\n      opacity: ${1===d?.6:.9};\n    `,h.appendChild(t);const y=2*Math.PI*e/o,g=r*(.8+.4*Math.random()),w={element:t,angle:y,distance:g,initialDistance:g,orbitSpeed:l*(.8+.4*Math.random()),life:1,decay:1/(i/16),rotation:360*Math.random(),rotationSpeed:5*(Math.random()-.5)};f.push(w)}const m=performance.now(),y=t=>{if(t-m>i)return h.remove(),null;const o=e.getBoundingClientRect(),n=o.left+o.width/2,s=o.top+o.height/2;f.forEach(e=>{e.angle+=e.orbitSpeed,c&&(e.distance=e.initialDistance*e.life);const t=n+Math.cos(e.angle)*e.distance,o=s+Math.sin(e.angle)*e.distance;e.rotation+=e.rotationSpeed,e.life-=e.decay;const a=Math.max(0,e.life*(1===d?.6:.9));e.element.style.transform=`translate3d(${t}px, ${o}px, 0) rotate(${e.rotation}deg)`,e.element.style.opacity=a}),requestAnimationFrame(y)};return requestAnimationFrame(y),h}function createParticleSwarm(e,t={}){const{count:o=25,colors:n=["#ff4500","#ff6600","#ff8800"],size:s=3,duration:a=3e3,swarmRadius:i=60,cohesion:r=.01,separation:l=.05,alignment:c=.02}=t;if(!e)return null;const d=e.getBoundingClientRect(),p=d.left+d.width/2,f=d.top+d.height/2,u=[],h=document.createElement("div");h.style.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    z-index: 99997;\n  ",document.body.appendChild(h);for(let e=0;e<o;e++){const e=document.createElement("div"),t=n[Math.floor(Math.random()*n.length)],o=s*(.8+.4*Math.random());e.textContent="‚óè",e.style.cssText=`\n      position: absolute;\n      font-size: ${o}px;\n      color: ${t};\n      pointer-events: none;\n      user-select: none;\n      filter: drop-shadow(0 0 2px ${t}) blur(0.3px);\n      will-change: transform, opacity;\n      opacity: 0.8;\n    `,h.appendChild(e);const r=Math.random()*Math.PI*2,l=Math.random()*i,c={element:e,x:p+Math.cos(r)*l,y:f+Math.sin(r)*l,vx:2*(Math.random()-.5),vy:2*(Math.random()-.5),life:1,decay:1/(a/16)};u.push(c)}const m=performance.now(),y=t=>{if(t-m>a)return h.remove(),null;const o=e.getBoundingClientRect(),n=o.left+o.width/2,s=o.top+o.height/2;u.forEach((e,t)=>{let o=0,a=0,d=0,p=0,f=0,h=0,m=0;u.forEach((n,s)=>{if(t===s)return;const r=n.x-e.x,l=n.y-e.y,c=Math.sqrt(r*r+l*l);c<i&&c>0&&(m++,o+=n.x,a+=n.y,c<20&&(d-=r/c,p-=l/c),f+=n.vx,h+=n.vy)}),m>0&&(o=(o/m-e.x)*r,a=(a/m-e.y)*r,d*=l,p*=l,f=(f/m-e.vx)*c,h=(h/m-e.vy)*c);const y=(n-e.x)*r*2,g=(s-e.y)*r*2;e.vx+=o+d+f+y,e.vy+=a+p+h+g;const w=Math.sqrt(e.vx*e.vx+e.vy*e.vy);w>3&&(e.vx=e.vx/w*3,e.vy=e.vy/w*3),e.x+=e.vx,e.y+=e.vy,e.life-=e.decay;const x=Math.max(0,.8*e.life);e.element.style.transform=`translate3d(${e.x}px, ${e.y}px, 0)`,e.element.style.opacity=x}),requestAnimationFrame(y)};return requestAnimationFrame(y),h}function goldBurst(e,t){createFizzySparks(e,t,{count:30,colors:["#f4d03f","#fbbf24","#ff9933"],shape:"circle",size:6,velocity:1.5,gravity:.5,duration:2e3})}function rarityBurst(e,t,o=0){let n=o;"string"==typeof o&&(n="rare"===o?3:"uncommon"===o?2:0);const s={0:{colors:["#9ca3af","#b0b0b0","#cccccc"],count:8},2:{colors:["#60a5fa","#3b82f6","#93c5fd"],count:12},3:{colors:["#f4d03f","#fbbf24","#fcd34d"],count:16}},a=s[n]||s[0];burstSparks(e,t,a.count,a.colors,n>=2)}function victorySparks(e,t){createFizzySparks(e,t,{count:50,colors:["#f4d03f","#fbbf24","#4ade80","#4d99ff","#ff6633"],shape:"mixed",size:12,velocity:2,gravity:.3,duration:2500})}class FloatingSparkManager{constructor(){this.sparks=[],this.mouseX=-999,this.mouseY=-999,this.maxSparks=60,this.baseAmbientCount=8,this.container=null,this.animationId=null,this.isRunning=!1,this.colorMode="normal",this.init()}setColorMode(e){this.colorMode=e}init(){this.container=document.createElement("div"),this.container.id="spark-overlay",this.container.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: 9999;\n      overflow: hidden;\n    ",document.body.appendChild(this.container),document.addEventListener("mousemove",e=>{this.mouseX=e.clientX,this.mouseY=e.clientY}),this.start()}getIntensity(){if(!S.hero||!S.enemy)return 0;const e=performance.now();if(this._lastIntensityTime&&e-this._lastIntensityTime<500)return this._cachedIntensity||0;this._lastIntensityTime=e;const t=[S.sel.item,S.sel.adj1,S.sel.adj2,S.sel.adj3,S.sel.adj4,S.sel.noun1].filter(e=>e&&!e.isStick).length/6,o=enemyHp(S.roundIndex),n=o>0?1-S.enemy.hp/o:0,s=S.lastCalcDmg||0,a=Math.max(0,s-S.enemy.hp),i=o>0?Math.min(1,a/o):0;return this._cachedIntensity=.3*t+.3*n+.4*i,this._cachedIntensity}createSpark(e,t,o=!1){if(this.sparks.length>=this.maxSparks)return null;let n;switch(this.colorMode){case"shop":n=200+40*Math.random();break;case"boss":n=270+40*Math.random();break;case"victory":n=360*Math.random();break;default:n=50*Math.random()}const s=o?50+50*Math.random():40+30*Math.random(),a=o?4+6*Math.random():2+2.5*Math.random(),i={x:void 0!==e?e:Math.random()*window.innerWidth,y:void 0!==t?t:window.innerHeight+50*Math.random(),vx:(Math.random()-.5)*(o?3:.5),vy:o?3*(Math.random()-.5)-2:-(.5+.6*Math.random()),life:1,maxLife:o?1200+600*Math.random():8e3+4e3*Math.random(),size:a,brightness:s,hue:n,isBurst:o,element:null},r=document.createElement("div");return r.style.cssText=`\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: ${a}px;\n      height: ${a}px;\n      background: hsl(${n}, 90%, ${s}%);\n      border-radius: 50%;\n      box-shadow: 0 0 ${2*a}px hsl(${n}, 90%, ${s}%);\n      pointer-events: none;\n      will-change: transform, opacity;\n      transform: translate3d(${i.x}px, ${i.y}px, 0);\n      opacity: 0.5;\n    `,this.container.appendChild(r),i.element=r,this.sparks.push(i),i}applyMouseRepulsion(e){const t=e.x-this.mouseX,o=e.y-this.mouseY,n=Math.sqrt(t*t+o*o);if(n<150&&n>0){const s=2*(1-n/150);e.vx+=t/n*s,e.vy+=o/n*s}}repulse(e,t,o=200,n=3){this.sparks.forEach(s=>{const a=s.x-e,i=s.y-t,r=Math.sqrt(a*a+i*i);if(r<o&&r>0){const e=(1-r/o)*n;s.vx+=a/r*e,s.vy+=i/r*e}})}update(e){const t=this.getIntensity(),o=Math.floor(this.baseAmbientCount*(1+2*t));this.sparks.filter(e=>!e.isBurst).length<o&&this.createSpark();for(let t=this.sparks.length-1;t>=0;t--){const o=this.sparks[t];this.applyMouseRepulsion(o),o.isBurst||(o.vy-=.05),o.vx*=.98,o.vy*=.98,o.x+=o.vx,o.y+=o.vy;const n=e/o.maxLife;if(o.life-=n,o.life<=0||o.y<-50||o.y>window.innerHeight+50||o.x<-50||o.x>window.innerWidth+50){o.element.remove(),this.sparks.splice(t,1);continue}const s=Math.max(0,.7*o.life),a=.5+.5*o.life;o.element.style.opacity=s,o.element.style.transform=`translate3d(${o.x}px, ${o.y}px, 0) scale(${a})`}}burst(e,t,o=10){for(let n=0;n<o;n++){const o=Math.random()*Math.PI*2,n=20*Math.random(),s=e+Math.cos(o)*n,a=t+Math.sin(o)*n;this.createSpark(s,a,!0)}}start(){if(this.isRunning)return;this.isRunning=!0;let e=performance.now();const t=1e3/30;let o=0;const n=s=>{const a=s-e;e=s,o+=a,o>=t&&(this.update(o),o=0),this.animationId=requestAnimationFrame(n)};this.animationId=requestAnimationFrame(n)}stop(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.isRunning=!1,this.sparks.forEach(e=>{e.element&&e.element.remove()}),this.sparks=[]}destroy(){this.stop(),this.container&&this.container.remove(),this.sparks=[]}}let sparkManager=null;class BlacksmithEmberManager{constructor(){this.embers=[],this.mouseX=-999,this.mouseY=-999,this.container=null,this.animationId=null,this.isRunning=!1,this.lastTime=0,this.maxEmbers=80,this.lastBurstTime=0,this.burstCooldown=50}init(){this.container||(this.container=document.createElement("div"),this.container.id="blacksmith-ember-overlay",this.container.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: 9998;\n      overflow: hidden;\n    ",document.body.appendChild(this.container),document.addEventListener("mousemove",e=>{this.mouseX=e.clientX,this.mouseY=e.clientY}))}createEmber(e,t,o=["#ff9933","#ffcc00","#ffaa44"],n=!1){const s=o[Math.floor(Math.random()*o.length)],a=n?8+8*Math.random():6+6*Math.random(),i=Math.random()*Math.PI*2,r=n?6+8*Math.random():2+3*Math.random(),l={x:e,y:t,vx:Math.cos(i)*r,vy:Math.sin(i)*r-(n?3:1.5),life:1,maxLife:n?800+600*Math.random():2e3+1500*Math.random(),size:a,color:s,rotation:360*Math.random(),element:null,explosive:n},c=document.createElement("div");return c.textContent="‚îÇ",c.style.cssText=`\n      position: absolute;\n      left: 0;\n      top: 0;\n      font-size: ${a}px;\n      color: ${s};\n      pointer-events: none;\n      user-select: none;\n      filter: drop-shadow(0 0 ${n?6:4}px ${s});\n      will-change: transform, opacity;\n      opacity: 0.9;\n      transform-origin: center center;\n      transform: translate3d(${e}px, ${t}px, 0);\n    `,this.container.appendChild(c),l.element=c,this.embers.push(l),l}burst(e,t,o=20,n=["#ff9933","#ffcc00","#ffaa44"],s=!1){this.init();const a=performance.now();a-this.lastBurstTime<this.burstCooldown&&(o=Math.ceil(.5*o)),this.lastBurstTime=a;const i=this.maxEmbers-this.embers.length,r=Math.min(o,Math.max(i,5));for(let o=0;o<r;o++)this.createEmber(e,t,n,s);this.isRunning||this.start()}applyMouseRepulsion(e){const t=e.x-this.mouseX,o=e.y-this.mouseY,n=Math.sqrt(t*t+o*o);if(n<120&&n>0){const s=.8*(1-n/120);e.vx+=t/n*s,e.vy+=o/n*s,e.life-=.15*(1-n/120)}}update(e){for(let t=this.embers.length-1;t>=0;t--){const o=this.embers[t];this.applyMouseRepulsion(o),o.vx*=.94,o.vy*=.94,o.vy+=.04,o.x+=o.vx,o.y+=o.vy;const n=Math.sqrt(o.vx*o.vx+o.vy*o.vy),s=e/o.maxLife,a=n<.5?3:1;o.life-=s*a,o.rotation=Math.atan2(o.vy,o.vx)*(180/Math.PI)+90;const i=.5,r=1.8*o.life,l=Math.max(0,.9*o.life);o.element.style.opacity=l,o.element.style.transform=`translate3d(${o.x}px, ${o.y}px, 0) rotate(${o.rotation}deg) scale(${i}, ${r})`,o.life<=0&&(o.element.remove(),this.embers.splice(t,1))}0===this.embers.length&&this.stop()}start(){if(this.isRunning)return;this.isRunning=!0,this.lastTime=performance.now();const e=t=>{if(!this.isRunning)return;const o=t-this.lastTime;this.lastTime=t,this.update(o),this.animationId=requestAnimationFrame(e)};this.animationId=requestAnimationFrame(e)}stop(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}clear(){this.embers.forEach(e=>{e.element&&e.element.remove()}),this.embers=[],this.stop()}}let blacksmithEmberManager=null;function burstSparks(e,t,o=20,n=["#ff9933","#ffcc00","#ffaa44"],s=!1){blacksmithEmberManager||(blacksmithEmberManager=new BlacksmithEmberManager),blacksmithEmberManager.burst(e,t,o,n,s)}let currentFlameMode="battle";function setFlameColor(e="battle"){const t=document.getElementById("flame-bg");t&&(currentFlameMode=e,t.classList.remove("shop-mode","boss-shop-mode","boss-dialogue-mode","boss-battle-mode"),"shop"===e?(t.classList.add("shop-mode"),t.style.setProperty("--flame-opacity","0.4"),t.style.setProperty("--flame-scale","1.1")):"boss-shop"===e?(t.classList.add("boss-shop-mode"),t.style.setProperty("--flame-opacity","0.5"),t.style.setProperty("--flame-scale","1.2")):"boss-dialogue"===e?(t.classList.add("boss-dialogue-mode"),t.style.setProperty("--flame-opacity","0.5"),t.style.setProperty("--flame-scale","1.2")):"boss-battle"===e?(t.classList.add("boss-battle-mode"),t.style.setProperty("--flame-opacity","0.5"),t.style.setProperty("--flame-scale","1.2")):updateFlameBaseline())}let flameMouseX=.5,flameMouseY=.5,flameTargetX=.5,flameTargetY=.5;function initFlameMouseTracking(){document.addEventListener("mousemove",e=>{flameTargetX=e.clientX/window.innerWidth,flameTargetY=e.clientY/window.innerHeight});let e=null,t=0;!function o(){if(!S.settings?.parallax||gfxSettings.lowFx)return void requestAnimationFrame(o);const n=performance.now();if(n-t<33)requestAnimationFrame(o);else{if(t=n,flameMouseX+=.05*(flameTargetX-flameMouseX),flameMouseY+=.05*(flameTargetY-flameMouseY),e||(e=document.getElementById("flame-bg")),e){const t=-20*(flameMouseX-.5),o=-15*(flameMouseY-.5);e.style.setProperty("--mouse-x",`${t}%`),e.style.setProperty("--mouse-y",`${o}%`)}requestAnimationFrame(o)}}()}function updateFlameBaseline(){const e=document.getElementById("flame-bg");if(!e)return;if(!S.eMaxHp||!S.enemy)return e.style.setProperty("--flame-opacity","0.3"),void e.style.setProperty("--flame-scale","1.0");const t=(calc().heroDmg||0)/S.eMaxHp,o=Math.max(0,t-1),n=Math.min(.95,.5+.25*t+.4*o),s=1+2.2*o;e.style.setProperty("--flame-opacity",n),e.style.setProperty("--flame-scale",s)}function pulseFlame(){const e=document.getElementById("flame-bg");if(!e)return;const t=parseFloat(getComputedStyle(e).getPropertyValue("--flame-opacity"))||.3,o=parseFloat(getComputedStyle(e).getPropertyValue("--flame-blur"))||100;e.style.setProperty("--flame-opacity",Math.min(.8,t+.3)),e.style.setProperty("--flame-blur",o+50+"px"),setTimeout(()=>{e.style.setProperty("--flame-opacity",t),e.style.setProperty("--flame-blur",o+"px")},1e3)}const GFX_SETTINGS_KEY="wordyweapon_gfx";let gfxSettings={lowFx:!1,zoom:95,brightness:100};function loadGfxSettings(){try{const e=localStorage.getItem(GFX_SETTINGS_KEY);e&&(gfxSettings={...gfxSettings,...JSON.parse(e)})}catch(e){console.warn("Failed to load graphics settings",e)}applyGfxSettings()}function saveGfxSettings(){try{localStorage.setItem(GFX_SETTINGS_KEY,JSON.stringify(gfxSettings))}catch(e){console.warn("Failed to save graphics settings",e)}}function applyGfxSettings(){sparkManager&&(gfxSettings.lowFx?sparkManager.stop():sparkManager.start()),gfxSettings.lowFx?document.body.classList.add("low-fx"):document.body.classList.remove("low-fx");const e=gfxSettings.brightness/100;document.body.style.filter=1!==e?`brightness(${e})`:""}function openGraphicsSettings(){const e=document.getElementById("graphics-settings");if(!e)return;const t=document.getElementById("gfx-lowfx");t&&(t.checked=gfxSettings.lowFx),showOverlay(e),playSfxOpen()}function closeGraphicsSettings(){const e=document.getElementById("graphics-settings");e&&(e.classList.remove("show"),playSfxBack())}function initGfxSettingsListeners(){const e=document.getElementById("gfx-close");e&&(e.onclick=closeGraphicsSettings,e.onmouseenter=sfxHover);const t=document.getElementById("gfx-lowfx");t&&(t.onchange=()=>{gfxSettings.lowFx=t.checked,applyGfxSettings(),saveGfxSettings()});const o=document.getElementById("gfx-bug-report");o&&(o.onclick=()=>{closeGraphicsSettings(),openBugReport()},o.onmouseenter=sfxHover)}function formatReelItem(e){const t=TC[e.rarity],o=TN[e.rarity]||"T1";let n="",s="";const a=["elem-phys","elem-poison","elem-fire","elem-water","elem-light","elem-dark","elem-earth","elem-lightning"],i=["elem-wash-phys","elem-wash-poison","elem-wash-fire","elem-wash-water","elem-wash-light","elem-wash-dark","elem-wash-earth","elem-wash-lightning"];if("elemental"===e.type&&void 0!==e.elem)n=`<div class="chip-tab ${a[e.elem]||""}"></div>`,e.rarity===T.T2?s=`tier-wash-2 ${i[e.elem]||""}`:e.rarity===T.T3&&(s=`tier-wash-3 ${i[e.elem]||""}`);else if("rarity"===e.type){s=`rarity-word ${e.rarity===T.T3?"rarity-t3":e.rarity===T.T2?"rarity-t2":"rarity-t1"}`}const r="elemental"===e.type?"":t,l=`<span class="chip-tier tier-${e.rarity}">${o}</span>`;let c="";if(void 0!==e.elem){c=`<span style="color:${EC[e.elem]||"#9ca3af"}">${EN[e.elem]}</span>`}else e.mult&&e.mult>1&&(c=`<span class="reel-mult">√ó${e.mult}</span>`);return`<div class="${s?`reel-content ${s}`:"reel-content"}">${n}${l}<div class="reel-name ${r}">${e.name}</div><div class="reel-detail">${c}</div></div>`}async function showCrateReelAnimation(e){const t=document.getElementById("crate-reel-overlay"),o=document.getElementById("crate-reel-container"),n=document.getElementById("crate-reel-title"),s=document.getElementById("crate-reel-status"),a=document.getElementById("spotlight-tint");if(!t||!o)return[];a&&a.classList.add("show","crate"),n.textContent=e.name.toUpperCase(),o.innerHTML="",s.textContent="Spinning...";const i=S.talents&&S.talents.includes("lucky_find"),r={adj_common:1,adj_uncommon:1,adj_magic:1,adj_rare:1.5,adj_epic:2,adj_legendary:3},l=e=>{const t=[];return e.forEach(e=>{const o=e.rarity||0;let n=0===o?11:2===o?7:2;i&&o>=3&&(n=Math.ceil(1.2*n)),"rarity"===e.type&&r[e.id]&&(n=Math.max(1,Math.round(n/r[e.id]))),S.hero&&"weapon"===e.type&&e.category===S.hero.good&&(n+=3);for(let o=0;o<Math.round(n);o++)t.push(e)}),t},c=l(e.weaponPool),d=l(e.wordPool),p=e.t1RarityPool?l(e.t1RarityPool):[],f=e.t2RarityPool?l(e.t2RarityPool):[],u=e.t3RarityPool?l(e.t3RarityPool):[];let h=!1;const m=[];for(let t=0;t<e.weaponQty;t++)m.push("weapon");for(let t=0;t<e.wordQty;t++)m.push({type:"word",slotTier:t});const y=[],g=[];m.forEach((t,n)=>{const s="string"==typeof t?t:t.type,a="object"==typeof t?t.slotTier:-1,i=document.createElement("div");i.className="crate-reel spinning";const r=document.createElement("div");r.className="crate-reel-window",i.appendChild(r);const l=document.createElement("div");let h;l.className="crate-reel-strip",h="weapon"===s?e.weaponPool:e.wordPool;const m=[];for(let e=0;e<20;e++){const e=h[Math.floor(Math.random()*h.length)];m.push(e)}let g;m.forEach(e=>{const t=document.createElement("div");t.className="crate-reel-item",t.innerHTML=formatReelItem(e),l.appendChild(t)}),i.appendChild(l),o.appendChild(i),g="weapon"===s?c:d;let w=null;"word"===s&&(w=0===a?p:1===a?f:u),y.push({element:i,strip:l,reelType:s,slotTier:a,weightedPool:g,tieredRarityPool:w,visualPool:h,targetPosition:17})}),t.classList.add("show");const w=new Set;let x=!1;const v=y.map((e,t)=>"word"===e.reelType?t:-1).filter(e=>e>=0),b=e=>{if(w.has(e))return;w.add(e);const t=y[e],{element:o,strip:n,weightedPool:a,tieredRarityPool:i,visualPool:r,targetPosition:l}=t;let c=shuf([...a])[0];"word"===t.reelType&&!h&&i&&i.length>0&&Math.random()<.15&&(c=shuf([...i])[0],h=!0);v[v.length-1];const d=v.filter(e=>!w.has(e));if("word"===t.reelType){if((c.rarity||0)>=2&&(x=!0),0===d.length&&!x){const e=r.filter(e=>(e.rarity||0)>=2);e.length>0&&(c=shuf([...e])[0],x=!0)}}g[e]=c;const p=n.querySelectorAll(".crate-reel-item");p[l]&&(p[l].innerHTML=formatReelItem(c)),o.classList.remove("spinning"),o.classList.add("stopping","revealed");const f=-(60*l-60);n.style.transform=`translateY(${f}px)`;const u=o.getBoundingClientRect();rarityBurst(u.left+u.width/2,u.top+u.height/2,c.rarity||"common");const m=c.rarity||0;try{m>=3?(playBrassTone(330,.25,.1),setTimeout(()=>playBrassTone(392,.25,.1),80),setTimeout(()=>playBrassTone(494,.35,.14),160)):m>=2?(playBrassTone(330,.25,.09),setTimeout(()=>playBrassTone(494,.3,.11),100)):playBrassTone(330,.25,.08)}catch(e){}w.size===y.length&&(s.textContent="Words revealed!")};y.forEach((e,t)=>{e.element.style.cursor="pointer",e.clickHandler=async()=>{await waitForNextQuarterBeat(),b(t)},e.element.addEventListener("click",e.clickHandler)});const k=setInterval(()=>{w.size<y.length&&playPageFlipSound()},150);await waitForNextBeat(),await dly(2*RHYTHM.BEAT);for(let e=0;e<y.length;e++){const t=3;for(let o=0;o<t&&!w.has(e)&&w.size!==y.length;o++)await waitForNextBeat(),await dly(RHYTHM.BEAT);w.has(e)||(await waitForNextBeat(),b(e))}return clearInterval(k),s.textContent="Words revealed!",await dly(w.size===y.length?800:1200),y.forEach(e=>{e.element.removeEventListener("click",e.clickHandler),e.element.style.cursor=""}),t.classList.add("closing"),await dly(RHYTHM.BEAT),t.classList.remove("show","closing"),a&&a.classList.remove("show","crate"),g}function closeRunOverlays(){closePauseMenu(),["shop-overlay","combat-overlay"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.remove("show")});const e=document.getElementById("forge");e&&e.classList.remove("shop-hidden")}document.addEventListener("selectstart",e=>{"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()}),document.addEventListener("DOMContentLoaded",async()=>{await loadStatsAsync(),await loadRunAsync();const e=document.getElementById("splash-loading"),t=document.getElementById("splash-enter-btn"),o=e?.querySelector(".loading-text"),n=new Promise(e=>setTimeout(e,800)),s=preloadAllSystems((e,t,n)=>{if(o){const n=Math.round(e/t*100);o.textContent=`Loading... ${n}%`}});Promise.all([s,n]).then(()=>{e&&(e.style.display="none"),t&&(t.style.display="",t.style.opacity="0",t.style.transform="translateY(10px)",requestAnimationFrame(()=>{t.style.transition="opacity 0.4s ease-out, transform 0.4s ease-out",t.style.opacity="1",t.style.transform="translateY(0)"}))});["demo-label","demo-footer","wishlist-btn","pause-wishlist-btn","victory-wishlist-btn","victory-overlay"].forEach(e=>{const t=document.getElementById(e);t&&(t.style.display="none")}),["skill-tree-btn","achievements-btn"].forEach(e=>{const t=document.getElementById(e);t&&(t.disabled=false,t.style.opacity="")}),document.body.classList.add("menu-active"),loadGfxSettings(),gfxSettings.lowFx||(sparkManager=new FloatingSparkManager),initFlameMouseTracking();const a=document.getElementById("flame-bg");a&&(a.style.setProperty("--flame-opacity","0.3"),a.style.setProperty("--flame-scale","1.0")),initGfxSettingsListeners();const i=document.getElementById("splash-screen"),r=document.getElementById("splash-enter-btn");i&&r&&(Promise.all([s,n]).then(()=>{i.classList.add("ready")}),r.addEventListener("click",async()=>{if(!i.classList.contains("ready"))return;r.disabled=!0,initAudio(),playSample("rarity.ogg",.7),await ensureMusicStarted();const e=document.getElementById("main-menu");e.classList.add("crossfade","fading-in","show"),i.classList.add("dissolving"),requestAnimationFrame(()=>{e.classList.remove("fading-in")}),setTimeout(()=>{i.classList.remove("show","dissolving"),e.classList.remove("crossfade")},800)}),r.onmouseenter=sfxHover);const l=document.getElementById("main-menu"),c=document.getElementById("start-game-btn"),d=document.getElementById("continue-btn"),p=document.getElementById("exit-btn"),f=document.getElementById("achievements-btn");updateContinueButtons(),d&&(d.onclick=async()=>{await loadRunAsync()?(l&&l.classList.remove("show"),document.body.classList.remove("menu-active"),await ensureMusicStarted(),clrSel(),"shop"===S.gamePhase?showShop():(newEnc(),render())):console.warn("No valid save found")},d.onmouseenter=sfxHover),c&&(c.onclick=async()=>{isTransitioning||await playSceneTransition(async()=>{l&&l.classList.remove("show"),document.body.classList.remove("menu-active"),await startNewRun()})},c.onmouseenter=sfxHover),p&&(p.onclick=()=>{l&&l.classList.remove("show"),S.hero&&S.roundIndex>0&&document.body.classList.remove("menu-active")},p.onmouseenter=sfxHover),f&&(f.onclick=()=>{showOverlay("#achievements-overlay"),playSfxOpen(),renderStats()},f.onmouseenter=sfxHover);const u=document.getElementById("main-graphics-btn");u&&(u.onclick=()=>{showOverlay("#graphics-settings"),playSfxOpen()},u.onmouseenter=sfxHover);const h=document.getElementById("main-credits-btn");h&&(h.onclick=()=>{showOverlay("#credits-overlay"),playSfxOpen()},h.onmouseenter=sfxHover);const m=document.getElementById("confirm-modal"),y=document.getElementById("confirm-title"),g=document.getElementById("confirm-message"),w=document.getElementById("confirm-cancel"),x=document.getElementById("confirm-yes");let v=null;function b(){if(!S.roundIndex||S.roundIndex<1)return"None";const e=S.roundIndex,t=document.getElementById("shop-overlay")?.classList.contains("show"),o=document.getElementById("combat-overlay")?.classList.contains("show");return t?`Round ${e} Shop`:o?`Round ${e} Battle`:`Round ${e}`}function k(e,t,o){y.textContent=e,g.textContent=t,v=o,showOverlay(m),playSfxOpen()}function E(){hideOverlay(m),v=null}w&&(w.onclick=()=>{E(),sfxClick()},w.onmouseenter=sfxHover),x&&(x.onclick=()=>{if(sfxClick(),"quit"===v)window.electronAudio&&window.electronAudio.isElectron,window.close();else{if("title"===v)return E(),closePauseMenu(),clearRunState(),void showMainMenu();if("reset"===v)localStorage.clear(),location.reload();else if("forfeit"===v)return E(),void executeForfeit()}E()},x.onmouseenter=sfxHover);const L=document.getElementById("forfeit-btn");L&&(L.onclick=()=>{k("Forfeit Run?",`End this run and receive ${S.hero?calcRunXP(S.roundIndex,!1):0} XP.`,"forfeit")},L.onmouseenter=sfxHover);const T=document.getElementById("main-quit-btn");T&&(T.onclick=()=>k("Quit Game?","Are you sure you want to quit?","quit"),T.onmouseenter=sfxHover);const M=document.getElementById("pause-quit-btn");M&&(M.onclick=()=>{if(S.roundIndex&&S.roundIndex>0){k("Quit Game?",`Unsaved progress will be lost.\n\nLast save: ${b()}`,"quit")}else k("Quit Game?","Are you sure you want to quit?","quit")},M.onmouseenter=sfxHover);const A=document.getElementById("pause-wishlist-btn");A&&(A.onclick=()=>{window.open(STEAM_WISHLIST_URL,"_blank")},A.onmouseenter=sfxHover);const P=document.getElementById("gfx-reset-data");P&&(P.onclick=()=>k("Reset Data?","This will erase all progress and unlocks. Are you sure?","reset"),P.onmouseenter=sfxHover);const R=document.getElementById("skill-tree-btn");R&&(R.onclick=()=>{showSkillTree("Graham Moor")},R.onmouseenter=sfxHover),setupSkillTreeListeners();const C=document.getElementById("victory-wishlist-btn"),I=document.getElementById("victory-newrun-btn");C&&(C.onclick=()=>{window.open(STEAM_WISHLIST_URL,"_blank")},C.onmouseenter=sfxHover),I&&(I.onclick=async()=>{isTransitioning||await playSceneTransition(async()=>{const e=document.getElementById("victory-overlay");e&&e.classList.remove("show"),sparkManager&&sparkManager.setColorMode("normal"),await startNewRun()})},I.onmouseenter=sfxHover);const _=document.getElementById("wishlist-btn");_&&(_.onclick=()=>{window.open(STEAM_WISHLIST_URL,"_blank")},_.onmouseenter=sfxHover);const B=document.getElementById("discord-btn");B&&(B.onclick=()=>{window.open(DISCORD_URL,"_blank")},B.onmouseenter=sfxHover,B.addEventListener("mouseenter",()=>{B.style.opacity="1"}),B.addEventListener("mouseleave",()=>{B.style.opacity="0.7"}));const Q=document.getElementById("pause-discord-btn");Q&&(Q.onclick=()=>{window.open(DISCORD_URL,"_blank")},Q.onmouseenter=sfxHover,Q.addEventListener("mouseenter",()=>{Q.style.opacity="1"}),Q.addEventListener("mouseleave",()=>{Q.style.opacity="0.7"}));const G=document.getElementById("pause-btn");G&&(G.onclick=()=>openPauseMenu(isShopOpen()?"shop":"run"),G.onmouseenter=sfxHover);const O=document.getElementById("sound-btn"),H=document.getElementById("shop-sound-btn"),D=document.getElementById("sound-panel"),W=document.getElementById("sound-panel-close"),j=()=>{const e=D.classList.contains("hidden");D.classList.toggle("hidden"),e?playSfxOpen():playSfxBack()};O&&D&&(O.onclick=j),H&&D&&(H.onclick=j,H.onmouseenter=sfxHover),W&&D&&(W.onclick=()=>{D.classList.add("hidden"),playSfxBack()});const F=(e,t)=>{const o=document.getElementById(e);if(!o)return;const n=o.parentElement.querySelector(".vol-value");o.oninput=()=>{const e=parseInt(o.value)/100;n&&(n.textContent=o.value+"%"),t(e)}};F("vol-master",e=>{volMaster=e,masterGain&&(masterGain.gain.value=e),musicEngine&&musicEngine.masterGain&&(musicEngine.masterGain.gain.value=e*volMusic),saveAudioSettings()}),F("vol-music",e=>{volMusic=e,musicEngine&&(musicEngine.masterGain&&(musicEngine.masterGain.gain.value=volMaster*e),e>0&&musicEngine.initialized&&!musicEngine.playing&&S.hero&&musicEngine.start()),saveAudioSettings()}),F("vol-sfx",e=>{volSfx=e,saveAudioSettings()}),applyAudioSettings(),$("#pause-continue").onclick=()=>closePauseMenu(),$("#pause-continue").onmouseenter=sfxHover,$("#pause-new").onclick=async()=>{isTransitioning=!1,isForging=!1,await playSceneTransition(async()=>{const e=document.getElementById("shop-overlay");e&&e.classList.remove("show"),musicEngine&&musicEngine.inShopMode&&musicEngine.exitShopMode();const t=document.getElementById("forge");t&&t.classList.remove("shop-hidden"),clrSel(),closeRunOverlays(),await startNewRun()})},$("#pause-new").onmouseenter=sfxHover,$("#pause-achievements").onclick=()=>{closePauseMenu(!0),showOverlay("#achievements-overlay"),playSfxOpen(),renderStats()},$("#pause-achievements").onmouseenter=sfxHover,$("#pause-graphics").onclick=()=>{closePauseMenu(!0),openGraphicsSettings()},$("#pause-graphics").onmouseenter=sfxHover,$("#pause-credits").onclick=()=>{closePauseMenu(!0),showOverlay("#credits-overlay"),playSfxOpen()},$("#pause-credits").onmouseenter=sfxHover,$("#credits-close").onclick=()=>{document.getElementById("credits-overlay").classList.remove("show"),playSfxBack()},$("#credits-close").onmouseenter=sfxHover,$("#pause-title").onclick=()=>{if(S.roundIndex&&S.roundIndex>0){k("Return to Title?",`Unsaved progress will be lost.\n\nLast save: ${b()}`,"title")}else closePauseMenu(),showMainMenu()},$("#pause-title").onmouseenter=sfxHover;const N=document.getElementById("shop-menu");N&&(N.onclick=()=>openPauseMenu("shop"),N.onmouseenter=sfxHover);const q=document.getElementById("stats-reset");q&&(q.onclick=()=>{PStats={attempts:0,victories:0,weaponsForged:0,bestDamage:0,bestWeaponName:"",heroClears:{},highestRound:0,tutorialComplete:!1,bossDefeats:{},unlockedHeroes:["Graham Moor"]},saveStats(),clearRunSave(),renderStats()},q.onmouseenter=sfxHover),$("#achievements-close").onclick=()=>{document.getElementById("achievements-overlay").classList.remove("show"),playSfxBack()},$("#achievements-close").onmouseenter=sfxHover,$("#view-talents-btn").onclick=()=>{openTalentViewer()},$("#view-talents-btn").onmouseenter=sfxHover,$("#talent-viewer-close").onclick=()=>{document.getElementById("talent-viewer-overlay").classList.remove("show"),playSfxBack()},$("#talent-viewer-close").onmouseenter=sfxHover;const Y=document.getElementById("talent-select-view-btn");Y&&(Y.onclick=()=>openTalentViewer(),Y.onmouseenter=sfxHover),document.addEventListener("keydown",e=>{if("Enter"===e.key){const e=document.getElementById("forge-btn");e&&!e.disabled&&e.click()}});const Z=document.querySelector(".hero-portrait"),z=document.querySelector(".enemy-portrait");let U=null,J=null;function K(e,t,o,n,s){if(!e)return null;const a=t.split(" ");let i=0;return e.textContent="",function t(){return i<a.length?(i>0&&(e.textContent+=" "),e.textContent+=a[i],i++,playTalkSound(n),o.classList.add("speaking"),setTimeout(()=>o.classList.remove("speaking"),RHYTHM.QUARTER),setTimeout(t,RHYTHM.HALF)):(s&&s(),null)}()}Z&&(Z.style.cursor="pointer",Z.onclick=e=>{if(e.target.closest("#view-talents-btn"))return;if(!S.hero||!S.hero.dialogue||0===S.hero.dialogue.length)return;U&&(clearTimeout(U),U=null),void 0===S.heroDialogueIndex&&(S.heroDialogueIndex=0),S.heroDialogueIndex=(S.heroDialogueIndex+1)%S.hero.dialogue.length;const t=S.hero.dialogue[S.heroDialogueIndex],o=document.getElementById("hero-inline-dialogue");U=K(o,t,Z,"hero",()=>{U=null})}),z&&(z.style.cursor="pointer",z.onclick=()=>{if(!S.enemy||!S.enemy.dialogue||0===S.enemy.dialogue.length)return;J&&(clearTimeout(J),J=null),void 0===S.enemyDialogueIndex&&(S.enemyDialogueIndex=0),S.enemyDialogueIndex=(S.enemyDialogueIndex+1)%S.enemy.dialogue.length;const e=S.enemy.dialogue[S.enemyDialogueIndex],t=document.getElementById("enemy-inline-dialogue");J=K(t,e,z,"enemy",()=>{J=null})}),document.querySelectorAll(".logo-img").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),playSample("gem.ogg",.1),e.classList.remove("logo-bounce"),requestAnimationFrame(()=>{requestAnimationFrame(()=>e.classList.add("logo-bounce"))})}),e.addEventListener("dragstart",e=>e.preventDefault())})}),init(),function(){const e=document.getElementById("debug-overlay"),t=document.getElementById("debug-copy-log");if(!e)return;let o=!1,n=0,s=performance.now(),a=performance.now(),i=0,r=1/0,l=0,c=[],d=[],p=[],f=null,u=null;window.logPerfEvent=function(e,t){if(!o)return;const n={time:(new Date).toISOString().substr(11,12),type:e,...t};p.push(n),p.length>100&&p.shift()};const h=document.getElementById("debug-fps"),m=document.getElementById("debug-frame-time"),y=document.getElementById("debug-fps-range"),g=document.getElementById("debug-avg-frame"),w=document.getElementById("debug-memory"),x=document.getElementById("debug-particles"),v=document.getElementById("debug-dom"),b=document.getElementById("debug-scene"),S=document.getElementById("debug-log-status");function k(){return document.querySelector("#splash-screen.show")?"Splash":document.querySelector("#main-menu.show")?"MainMenu":document.querySelector("#hero-select-overlay.show")?"HeroSelect":document.querySelector("#shop-overlay.show")?"Shop":document.querySelector("#combat-overlay.show")?"Combat":document.querySelector("#talent-overlay.show")?"Talents":document.querySelector("#victory-overlay.show")?"Victory":document.querySelector("#loss-overlay.show")?"Loss":document.querySelector("#pause-menu.show")?"Pause":"Gameplay"}function E(){let e=0;return void 0!==sparkManager&&sparkManager&&sparkManager.sparks&&(e+=sparkManager.sparks.length),"undefined"!=typeof emberManager&&emberManager&&emberManager.embers&&(e+=emberManager.embers.length),e+=document.querySelectorAll(".aura-particle, .flame-particle, .health-shard").length,e}function L(){return performance.memory?(performance.memory.usedJSHeapSize/1048576).toFixed(1):"--"}function T(e){if(!o)return;n++;const t=e-s;s=e,e-a>=500&&(i=1e3*n/(e-a),n=0,a=e),function(e){const t=Math.round(i);t>0&&t<1e3&&(r=Math.min(r,t),l=Math.max(l,t)),c.push(e),c.length>60&&c.shift();const o=c.reduce((e,t)=>e+t,0)/c.length;h.textContent=t,h.className=t<30?"debug-bad":t<55?"debug-warn":"",m.textContent=e.toFixed(1)+" ms",m.className=e>33?"debug-bad":e>18?"debug-warn":"",y.textContent=(r===1/0?"--":r)+" - "+(0===l?"--":l),g.textContent=o.toFixed(1)+" ms",w.textContent=L()+" MB",x.textContent=E(),v.textContent=document.querySelectorAll("*").length,b.textContent=k()}(t),u=requestAnimationFrame(T)}function M(){const e={time:(new Date).toISOString().substr(11,8),scene:k(),fps:Math.round(i),minFps:r===1/0?0:r,maxFps:l,avgFrame:(c.length>0?c.reduce((e,t)=>e+t,0)/c.length:0).toFixed(1),memory:L(),particles:E(),dom:document.querySelectorAll("*").length};d.push(e),d.length>60&&d.shift(),S.textContent=`Logging: ${d.length} snapshots`}document.addEventListener("keydown",t=>{"F3"===t.key&&(t.preventDefault(),o=!o,e.classList.toggle("hidden",!o),o?(r=1/0,l=0,c=[],d=[],p=[],s=performance.now(),a=performance.now(),n=0,u=requestAnimationFrame(T),f=setInterval(M,2e3),S.textContent="Logging started..."):(u&&cancelAnimationFrame(u),f&&clearInterval(f),S.textContent=""))}),t.addEventListener("click",()=>{const e=function(){let e="=== WORDY WEAPON PERFORMANCE LOG ===\n";if(e+=`Generated: ${(new Date).toISOString()}\n`,e+=`Platform: ${navigator.platform}\n`,e+=`UserAgent: ${navigator.userAgent.substring(0,100)}\n`,e+=`Screen: ${window.screen.width}x${window.screen.height} @ ${window.devicePixelRatio}x DPR\n`,e+=`Window: ${window.innerWidth}x${window.innerHeight}\n\n`,e+="TIME     | SCENE       | FPS | MIN | MAX | AVG ms | MEM MB | PART | DOM\n",e+="-".repeat(75)+"\n",d.forEach(t=>{e+=`${t.time} | ${t.scene.padEnd(11)} | ${String(t.fps).padStart(3)} | ${String(t.minFps).padStart(3)} | ${String(t.maxFps).padStart(3)} | ${String(t.avgFrame).padStart(6)} | ${String(t.memory).padStart(6)} | ${String(t.particles).padStart(4)} | ${t.dom}\n`}),e+="\n=== SUMMARY ===\n",d.length>0){const t=d.reduce((e,t)=>e+t.fps,0)/d.length,o=Math.min(...d.map(e=>e.minFps).filter(e=>e>0)),n=Math.max(...d.map(e=>e.maxFps)),s=d.reduce((e,t)=>e+parseFloat(t.memory||0),0)/d.length,a=Math.max(...d.map(e=>e.particles));e+=`Avg FPS: ${t.toFixed(1)}\n`,e+=`FPS Range: ${o||0} - ${n}\n`,e+=`Avg Memory: ${s.toFixed(1)} MB\n`,e+=`Max Particles: ${a}\n`,e+=`Samples: ${d.length} (2s intervals)\n`;const i=d.filter(e=>e.fps<30).length,r=d.filter(e=>parseFloat(e.avgFrame)>33).length;i>0&&(e+=`\n‚ö†Ô∏è LOW FPS (<30): ${i} samples\n`),r>0&&(e+=`‚ö†Ô∏è STUTTER (>33ms): ${r} samples\n`)}if(p.length>0){e+="\n=== WORD SLOT EVENTS ===\n",e+="TIME         | EVENT           | DETAILS\n",e+="-".repeat(70)+"\n",p.forEach(t=>{const o=Object.entries(t).filter(([e])=>"time"!==e&&"type"!==e).map(([e,t])=>`${e}=${"number"==typeof t?t.toFixed(2):t}`).join(", ");e+=`${t.time} | ${t.type.padEnd(15)} | ${o}\n`});const t=p.filter(e=>e.totalMs&&e.totalMs>16);t.length>0&&(e+=`\n‚ö†Ô∏è SLOW SLOT EVENTS (>16ms): ${t.length}\n`,t.forEach(t=>{e+=`  - ${t.time}: ${t.totalMs.toFixed(1)}ms (${t.word||"unknown"})\n`}))}return e}();navigator.clipboard.writeText(e).then(()=>{t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy Log"},1500)}).catch(()=>{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy Log"},1500)})})}();