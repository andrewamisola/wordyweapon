<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Wordy Weapon</title>
<link rel="icon" type="image/x-icon" href="icon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">

</head>
<body>
<!-- Visual Filters: Paper Grain + Ink Vignette -->
<svg id="paper-overlay" class="screen-overlay">
  <filter id="rough-paper">
    <feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="3" stitchTiles="stitch" />
    <feColorMatrix type="matrix" values="0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 -1.5 1.5" />
  </filter>
  <rect width="100%" height="100%" filter="url(#rough-paper)" opacity="0.4"/>
</svg>
<div id="ink-vignette"></div>
<div id="dither-overlay"></div>

<!-- Custom Icon Sprite Sheet -->
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  <defs>
    <linearGradient id="icon-gold" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#fbbf24"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/>
    </linearGradient>
    <linearGradient id="icon-gold-dark" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#b45309"/><stop offset="100%" stop-color="#78350f"/>
    </linearGradient>
    <linearGradient id="icon-steel" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#4b5563"/>
    </linearGradient>
    <linearGradient id="icon-steel-dark" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#6b7280"/><stop offset="100%" stop-color="#374151"/>
    </linearGradient>
    <linearGradient id="icon-fire" x1="0%" y1="100%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#dc2626"/><stop offset="50%" stop-color="#f97316"/><stop offset="100%" stop-color="#fbbf24"/>
    </linearGradient>
    <linearGradient id="icon-purple" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#7c3aed"/>
    </linearGradient>
    <linearGradient id="icon-earth" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#84cc16"/><stop offset="50%" stop-color="#22c55e"/><stop offset="100%" stop-color="#0ea5e9"/>
    </linearGradient>
    <!-- Vertical motion blur for crate reels -->
    <filter id="vertical-blur">
      <feGaussianBlur in="SourceGraphic" stdDeviation="0,3"/>
    </filter>
  </defs>
  <symbol id="icon-coin" viewBox="0 0 16 16">
    <!-- Bright gold coin with clear definition -->
    <ellipse cx="8" cy="9" rx="6" ry="5" fill="#b45309"/>
    <ellipse cx="8" cy="7" rx="6" ry="5" fill="#fbbf24"/>
    <ellipse cx="8" cy="7" rx="5.5" ry="4.5" fill="#fcd34d"/>
    <ellipse cx="8" cy="6.5" rx="4" ry="3" fill="#fef08a" opacity="0.5"/>
    <ellipse cx="8" cy="7" rx="6" ry="5" fill="none" stroke="#d97706" stroke-width="0.8"/>
    <circle cx="8" cy="7" r="2.5" fill="none" stroke="#b45309" stroke-width="0.6"/>
  </symbol>
  <symbol id="icon-sword" viewBox="0 0 16 16">
    <path d="M3,13 L6,10 L4,8 L1,11 Z" fill="url(#icon-steel-dark)"/>
    <path d="M6,10 L13,3 L14,4 L7,11 Z" fill="url(#icon-steel)"/>
    <path d="M13,3 L14,2 L15,3 L14,4 Z" fill="#e5e7eb"/>
    <circle cx="5" cy="11" r="1" fill="url(#icon-gold)"/>
  </symbol>
  <symbol id="icon-fire" viewBox="0 0 16 16">
    <path d="M8,2 Q12,6 11,10 Q10,13 8,14 Q6,13 5,10 Q4,6 8,2 Z" fill="url(#icon-fire)"/>
    <path d="M8,6 Q10,8 9.5,11 Q9,13 8,13 Q7,13 6.5,11 Q6,8 8,6 Z" fill="#fef08a" opacity="0.8"/>
  </symbol>
  <symbol id="icon-skull" viewBox="0 0 16 16">
    <ellipse cx="8" cy="7" rx="5" ry="5.5" fill="#e5e7eb"/>
    <ellipse cx="8" cy="7" rx="4.5" ry="5" fill="url(#icon-steel)"/>
    <ellipse cx="6" cy="6" rx="1.2" ry="1.5" fill="#1f2937"/>
    <ellipse cx="10" cy="6" rx="1.2" ry="1.5" fill="#1f2937"/>
    <path d="M6,10 L7,9 L8,10 L9,9 L10,10 L9,11 L7,11 Z" fill="#1f2937"/>
  </symbol>
  <symbol id="icon-sparkle" viewBox="0 0 16 16">
    <path d="M8,1 L9,5 L13,6 L9,7 L8,11 L7,7 L3,6 L7,5 Z" fill="url(#icon-purple)"/>
    <path d="M3,2 L3.5,4 L5.5,4.5 L3.5,5 L3,7 L2.5,5 L0.5,4.5 L2.5,4 Z" fill="#c084fc" opacity="0.7"/>
    <path d="M12,10 L12.5,12 L14.5,12.5 L12.5,13 L12,15 L11.5,13 L9.5,12.5 L11.5,12 Z" fill="#c084fc" opacity="0.7"/>
  </symbol>
  <symbol id="icon-lightning" viewBox="0 0 16 16">
    <path d="M9,1 L4,8 L7,8 L6,15 L12,7 L9,7 Z" fill="#fbbf24"/>
    <path d="M8.5,2 L5,8 L7.5,8 L6.5,13 L11,7.5 L8.5,7.5 Z" fill="#fef08a"/>
  </symbol>
  <symbol id="icon-crate" viewBox="0 0 16 16">
    <path d="M2,5 L8,2 L14,5 L14,12 L8,15 L2,12 Z" fill="url(#icon-steel-dark)"/>
    <path d="M2,5 L8,8 L14,5" fill="none" stroke="#4b5563" stroke-width="0.5"/>
    <path d="M8,8 L8,15" fill="none" stroke="#4b5563" stroke-width="0.5"/>
    <path d="M2,5 L8,2 L14,5 L8,8 Z" fill="url(#icon-steel)" opacity="0.8"/>
  </symbol>
  <symbol id="icon-earth-sky" viewBox="0 0 16 16">
    <circle cx="8" cy="8" r="6" fill="url(#icon-earth)"/>
    <path d="M4,6 Q6,4 8,5 Q10,6 9,8 Q8,10 6,9 Q4,8 4,6 Z" fill="#166534" opacity="0.6"/>
    <circle cx="8" cy="8" r="6" fill="none" stroke="#0ea5e9" stroke-width="0.5" opacity="0.5"/>
  </symbol>
  <symbol id="icon-heart" viewBox="0 0 16 16">
    <path d="M8,14 Q2,9 2,5 Q2,2 5,2 Q7,2 8,4 Q9,2 11,2 Q14,2 14,5 Q14,9 8,14 Z" fill="#22c55e"/>
    <path d="M8,12 Q4,8 4,5.5 Q4,3.5 6,3.5 Q7.5,3.5 8,5 Q8.5,3.5 10,3.5 Q12,3.5 12,5.5 Q12,8 8,12 Z" fill="#4ade80" opacity="0.6"/>
  </symbol>
</svg>

<!-- Fixed viewport elements (always fill screen, never scale) -->
<div id="flame-bg"></div>
<canvas id="fx-canvas"></canvas>

<div id="header">
    <div id="stats-pills">
      <div class="stat-pill gold-pill" id="gold-pill"><svg class="icon"><use href="#icon-coin"/></svg> <span id="gold">30</span><span id="gold-interest" style="opacity:0.6;margin-left:2px"></span></div>
      <div class="stat-pill" id="round-pill">Round <span id="round-num">1</span> ¬∑ Ch. <span id="chapter-num">1</span></div>
      <div class="stat-pill" id="lives-counter" style="display:none"><svg class="icon"><use href="#icon-heart"/></svg> <span id="lives">1</span></div>
    </div>
    <div id="title"><img src="assets/logo-light.png" alt="Wordy Weapon" class="logo-img"></div>
    <div id="header-controls">
      <button id="sound-btn" title="Sound Settings">üîä</button>
      <button id="pause-btn">Menu</button>
    </div>
  </div>

<!-- Game Container: Scalable content area -->
<div id="game-container">

  
<!-- Sound Control Panel - centered modal style -->
<div id="sound-panel" class="hidden">
  <div class="sound-panel-header">
    <span>Sound Settings</span>
    <button id="sound-panel-close">‚úï</button>
  </div>
  <div class="sound-slider-row">
    <label for="vol-master">Master</label>
    <input type="range" id="vol-master" min="0" max="100" value="80">
    <span class="vol-value">80%</span>
  </div>
  <div class="sound-slider-row">
    <label for="vol-music">Music</label>
    <input type="range" id="vol-music" min="0" max="100" value="70">
    <span class="vol-value">70%</span>
  </div>
  <div class="sound-slider-row">
    <label for="vol-sfx">SFX</label>
    <input type="range" id="vol-sfx" min="0" max="100" value="100">
    <span class="vol-value">100%</span>
  </div>
</div>

<!-- Toast Notification Container (stacking support) -->
<div id="toast-container"></div>
<!-- Single game toast for unlock notifications -->
<div id="game-toast" class="hidden"></div>

<div id="battle-view">
  <div class="portrait-container">
    <div class="portrait hero-portrait">
      <div class="portrait-frame"></div>
      <div class="portrait-info">
        <div class="portrait-name hero-c" id="hero-name">Hero</div>
        <!-- Element strengths/weaknesses and weapon proficiency will be inserted here -->
        <div class="portrait-elements" id="hero-elements"></div>
        <!-- Talent button to open talent viewer -->
        <button id="view-talents-btn" style="font-size:10px;padding:6px 16px;margin:6px auto;display:none;background:linear-gradient(135deg,#9966cc,#663399);border:1px solid #cc99ff;border-radius:6px;color:#fff;box-shadow:0 2px 8px rgba(153,102,204,0.3);cursor:pointer;transition:all 0.2s">üåü Talents</button>
        <!-- Random dialogue line displayed below the hero portrait for extra flavour -->
        <div class="portrait-dialogue" id="hero-inline-dialogue"></div>
        <div class="health-bar-container">
          <div class="health-bar hero-bar">
            <div class="health-fill hero-fill" id="hero-health-fill"></div>
            <div class="health-preview damage-preview" id="hero-damage-preview"></div>
          </div>
          <div class="health-text" id="hero-health-text">100 / 100</div>
        </div>
        <div class="portrait-details">
          <!-- Details toggle removed; details now show on hover -->
        </div>
      </div>
    </div>
  </div>

    <div id="vs-center">
      <div id="weapon-display">
        <div id="weapon-aura"></div>
        <div id="weapon-svg" class="weapon-canvas"></div>
        <div id="weapon-name"></div>
      </div>
      <div id="damage-preview-text">
        <div class="damage-number hero-damage" id="preview-hero-dmg">0</div>
        <!-- Calculation shown as muted subtext beneath the primary damage number -->
        <div class="ap-number math-subtext" id="preview-base-ap">0</div>
        <!-- Dynamic bonus badges (AP, W, Multipliers) -->
        <div id="preview-bonus-badges"></div>
      </div>
    </div>

  <div class="portrait-container">
    <div class="portrait enemy-portrait">
      <div class="portrait-frame"></div>
      <div class="portrait-info">
        <div class="portrait-name enemy-c" id="enemy-name">Enemy</div>
        <!-- Enemy elemental weaknesses/resistances will be inserted here -->
        <div class="portrait-elements" id="enemy-elements"></div>
        <!-- Random dialogue line displayed below the enemy portrait -->
        <div class="portrait-dialogue" id="enemy-inline-dialogue"></div>
        <div class="health-bar-container">
          <div class="health-bar enemy-bar">
            <div class="health-fill enemy-fill" id="enemy-health-fill"></div>
            <div class="health-preview damage-preview" id="enemy-damage-preview"></div>
          </div>
          <div class="health-text" id="enemy-health-text">100 / 100</div>
        </div>
        <div class="portrait-details">
          <!-- Details toggle removed; details now show on hover -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Portrait hover detail panels removed - all info now displayed directly on portraits -->

<div id="forge">
  <div id="sentence">
    <div class="slot-container hidden" data-slot="adj1">
      <div class="slot-mult" id="mult-adj1"></div>
      <!-- Show a hint for the type of word expected in this slot -->
      <div class="slot" data-slot="adj1">Adjective</div>
      <div class="slot-calc" id="calc-adj1"></div>
    </div>
    <div class="slot-container hidden" data-slot="adj2">
      <div class="slot-mult" id="mult-adj2"></div>
      <div class="slot" data-slot="adj2">Adjective</div>
      <div class="slot-calc" id="calc-adj2"></div>
    </div>
    <div class="slot-container" data-slot="item">
      <div class="slot-mult" id="mult-item"></div>
      <div class="slot" data-slot="item">Weapon</div>
      <div class="slot-calc" id="calc-item"></div>
    </div>
    <div id="of-label" class="hidden"><em class="connector-phrase">of the</em></div>
    <div class="slot-container hidden" data-slot="adj3">
      <div class="slot-mult" id="mult-adj3"></div>
      <div class="slot" data-slot="adj3">Adjective</div>
      <div class="slot-calc" id="calc-adj3"></div>
    </div>
    <div class="slot-container hidden" data-slot="adj4">
      <div class="slot-mult" id="mult-adj4"></div>
      <div class="slot" data-slot="adj4">Adjective</div>
      <div class="slot-calc" id="calc-adj4"></div>
    </div>
    <div class="slot-container hidden" data-slot="noun1">
      <div class="slot-mult" id="mult-noun1"></div>
      <div class="slot" data-slot="noun1">Gem (2x AP)</div>
      <div class="slot-calc" id="calc-noun1"></div>
    </div>
    <!-- Removed second gem (noun2) slot to enforce only one gem slot -->
  </div>

  <!-- Talent bar displays active run modifiers.  Talents are not interactive but
       their effects apply automatically during damage calculation.  Up to 5
       talents may be held at once. -->
  <div id="talent-bar" style="display:none;flex-wrap:wrap;gap:6px;justify-content:center;margin:6px 0"></div>
  <div id="backup-weapon">‚ö†Ô∏è No weapons! Using backup Stick (√ó0.5 damage)</div>
  <div id="bank-controls">
    <div id="consumables-inline"></div>
    <div class="shop-pill has-tooltip" id="inv-counter" style="cursor:pointer"><span id="inv-counter-text">0/24</span> <span id="sort-indicator" style="opacity:0.6;font-size:9px;margin-left:4px">Type ‚Üì</span><div class="tooltip inv-tooltip" id="inv-breakdown-tooltip"></div></div>
  </div>
  <div id="bank"></div>
  <!-- Display available consumables during forging -->
  <div id="consumables-bar"></div>
  <div id="buttons">
    <button id="forge-btn" disabled>FORGE WEAPON</button>
  </div>
  <button id="forfeit-btn" title="End run early and cash out XP">FORFEIT</button>
  <button id="reset-btn" title="Reset forge selections">RESET</button>
</div>

<!-- Spotlight tint: dark overlay shown behind focused modals like combat results and crate opening -->
<div id="spotlight-tint"></div>

</div><!-- End game-content -->
</div><!-- End game-container -->

<!-- Overlays (outside game-container for proper fixed positioning) -->
<div class="overlay" id="combat-overlay">
  <!-- Combat intro dialogue (enemy then hero) -->
  <div id="combat-intro-dialogue" style="display:none">
    <div class="intro-dialogue-box">
      <div class="intro-dialogue-portrait" id="intro-portrait"></div>
      <div class="intro-dialogue-speaker" id="intro-speaker-name"></div>
      <div class="intro-dialogue-text" id="intro-dialogue-text"></div>
      <div class="intro-dialogue-skip">Click to continue</div>
    </div>
  </div>
  <div class="modal" style="min-width:500px">
    <div id="combat-container">
      <div id="combat-flames"></div>
      <div id="combat-weapon-container">
        <div id="combat-weapon-aura"></div>
        <div id="combat-weapon-svg" class="weapon-canvas"></div>
      </div>
      <div id="combat-words"></div>
      <div id="combat-total" class="gold"></div>
    </div>
    <div id="combat-dmg">
      <div class="combat-block"><div class="combat-label">HERO STRIKES</div><div class="combat-value hero-c" id="cb-hero">0</div></div>
      <div style="font-size:24px" class="dim">‚öî</div>
      <div class="combat-block"><div class="combat-label">ENEMY STRIKES</div><div class="combat-value enemy-c" id="cb-enemy">0</div></div>
    </div>
    <div id="combat-bars">
      <div class="bar-block"><div class="bar-label">Hero HP</div><div class="bar-outer"><div class="bar-inner hero" id="bar-hero"></div></div><div class="bar-text hero-c" id="txt-hero">100/100</div></div>
      <div class="bar-block"><div class="bar-label">Enemy HP</div><div class="bar-outer"><div class="bar-inner enemy" id="bar-enemy"></div><div class="bar-preview" id="bar-enemy-preview"></div></div><div class="bar-text enemy-c" id="txt-enemy">100/100</div></div>
    </div>
    <div id="combat-result"><div id="combat-result-title"></div><div id="combat-result-detail"></div></div>
    <div id="combat-breakdown-row">
      <button id="combat-breakdown-btn" class="breakdown-pill" type="button">Damage Breakdown <span class="info-icon">‚ìò</span></button>
      <div id="combat-breakdown-tooltip" class="tooltip"></div>
    </div>
    <div class="modal-buttons">
      <button id="combat-continue">CONTINUE</button>
    </div>
  </div>
</div>

<div class="overlay" id="shop-overlay">
  <div class="modal shop-modal">
    <div class="modal-topbar shop-topbar">
      <div class="shop-top-left">
        <div class="shop-portrait" id="shop-hero-portrait-container"></div>
        <button id="shop-talents-btn" class="shop-talent-btn">Talents (<span id="shop-talent-count">0</span>)</button>
        <div class="shop-pill gold-pill" id="shop-gold-pill"><svg class="icon"><use href="#icon-coin"/></svg> <span id="shop-gold"></span><span id="shop-gold-interest" style="opacity:0.6;margin-left:2px"></span></div>
        <div class="shop-pill shop-round-pill">Round <span id="shop-round-num"></span> ¬∑ Ch. <span id="shop-chapter-num"></span></div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:center">
        <div class="modal-title gold">WORDSMITH'S SUPPLIES</div>
        <div id="shop-hero-dialogue" style="font-size:12px;color:#9ca3af;font-style:italic;margin-top:-4px;max-width:280px;text-align:center;line-height:1.3;min-height:16px"></div>
      </div>
      <div class="shop-top-right">
        <button id="shop-sound-btn" class="topbar-btn" title="Sound Settings">üîä</button>
        <button id="shop-menu" class="topbar-btn">Menu</button>
      </div>
    </div>

    <div class="shop-content">
      <div class="shop-row shop-row-top">
        <div class="shop-card card-surface">
          <div class="shop-section-title">Hero Info</div>
          <div id="shop-hero-info" class="shop-info-block"></div>
        </div>
        <div class="shop-card card-surface">
          <div class="shop-section-title">Next Enemy</div>
          <div id="next-enemy-preview" class="shop-info-block"></div>
        </div>
      </div>

      <div class="shop-row shop-row-middle">
        <!-- Left Column: Crates -->
        <div class="shop-column">
          <div class="shop-section card-surface">
            <div class="shop-section-title">Crates</div>
            <div id="shop-crates" class="shop-grid"></div>
          </div>
        </div>

        <!-- Middle Column: Word Bank -->
        <div class="shop-column shop-column-inventory">
          <div class="shop-section card-surface">
            <div class="shop-section-header">
              <div class="shop-section-title">Inventory</div>
              <div class="shop-pill has-tooltip" style="margin-left:auto; margin-right:10px;cursor:help"><span id="shop-inventory"></span> <span class="info-icon">‚ìò</span><div class="tooltip inv-tooltip" id="shop-inv-breakdown-tooltip"></div></div>
              <div id="shop-sort-btns" class="shop-sort-btns">
                <button data-sort="type" class="active">Type</button>
                <button data-sort="rarity">Rarity</button>
                <button id="sort-dir-btn">‚Üì</button>
              </div>
            </div>
            <div id="shop-word-bank" class="card-surface shop-word-bank"></div>
          </div>
          <div class="shop-column-actions">
            <button id="sell-word-btn" class="shop-action-btn" disabled>Sell Selected</button>
            <button id="deselect-btn" class="shop-action-btn">Deselect</button>
          </div>
        </div>

        <!-- Right Column: Tools (narrow) -->
        <div class="shop-column shop-column-tools">
          <div class="shop-section card-surface shop-consumables-card">
            <div class="shop-section-header">
              <div class="shop-section-title">Tools</div>
              <div id="shop-consumable-cap" class="dim shop-consumable-cap"></div>
            </div>
            <div class="shop-subtitle">For sale</div>
            <div id="shop-consumables" class="consumable-row card-surface"></div>
            <div class="shop-subtitle">Owned</div>
            <div id="shop-owned-consumables" class="consumable-row card-surface"></div>
          </div>
        </div>
      </div>

      <div class="shop-row shop-row-actions">
        <div class="shop-actions card-surface" style="justify-content:center">
          <button id="exit-shop-btn" class="primary">EXIT SHOP</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Inventory overlay removed -->

<div class="overlay" id="hero-select-overlay">
  <div class="modal" style="min-width:700px;max-width:900px;position:relative">
    <button id="hero-select-close" style="position:absolute;top:12px;right:12px;font-size:20px;background:none;border:none;color:#9ca3af;cursor:pointer;padding:4px 8px">‚úï</button>
    <div class="modal-title gold">SELECT YOUR HERO</div>
    <div style="text-align:center;font-size:12px;color:#9ca3af;margin-bottom:12px">Goal: Defeat the Chapter 3 Boss <span style="color:#f472b6">(Round 27)</span></div>
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <button id="hero-prev" style="font-size:24px;padding:8px 16px">‚óÄ</button>
      <div id="hero-carousel" style="flex:1;overflow:hidden">
        <div id="hero-card-container" style="display:flex;transition:transform 0.3s ease"></div>
      </div>
      <button id="hero-next" style="font-size:24px;padding:8px 16px">‚ñ∂</button>
    </div>
    <div id="difficulty-selector" style="display:flex;justify-content:center;gap:8px;margin-bottom:16px">
      <button class="diff-btn selected" data-diff="0">Apprentice</button>
      <button class="diff-btn" data-diff="1">Adept</button>
      <button class="diff-btn" data-diff="2">Master</button>
    </div>
    <div id="difficulty-desc" style="text-align:center;font-size:11px;color:#9ca3af;margin-bottom:12px;min-height:28px"></div>
    <div style="text-align:center">
      <button id="hero-select-btn" style="padding:12px 32px;font-size:16px">SELECT HERO</button>
    </div>
    <div id="start-menu-buttons" style="display:flex;justify-content:center;gap:12px;margin-top:16px;padding-top:16px;border-top:1px solid #374151">
      <button id="start-hero-skills" style="padding:8px 20px;border-radius:8px;background:#111827;border:1px solid #374151;font-size:12px;position:relative">Hero Skills</button>
    </div>
  </div>
</div>

<div class="overlay" id="talent-overlay">
  <div class="modal" style="min-width:650px">
    <div class="modal-title gold">LEVEL UP</div>
    <div style="text-align:center;margin-bottom:8px;font-size:14px">
      Level <span id="talent-level" class="gold">2</span>
    </div>
    <button id="talent-select-view-btn" class="shop-talent-btn" style="margin:0 auto 12px;display:block">Talents (<span id="talent-select-count">0</span>)</button>
    <div id="talent-choices"></div>
  </div>
</div>

<!-- Click to Enter splash screen - required for audio initialization -->
<div class="overlay show" id="splash-screen">
  <div class="splash-content">
    <img src="assets/logo-light.png" alt="Wordy Weapon" class="logo-img logo-large">
    <div id="demo-label" style="font-size:11px;color:#60a5fa;letter-spacing:0.2em;margin-top:-10px;margin-bottom:15px">DEMO</div>
    <div id="splash-loading" class="splash-loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading...</div>
    </div>
    <button id="splash-enter-btn" class="splash-btn" style="display:none">ENTER</button>
  </div>
</div>

<!-- Main menu overlay displayed on initial load.  Provides a simple title screen with a start button.  -->
<div class="overlay" id="main-menu">
  <div class="modal" style="text-align:center;min-width:400px">
    <img src="assets/logo-light.png" alt="Wordy Weapon" class="logo-img logo-menu">
    <div style="font-size:12px;color:#9ca3af;margin-bottom:20px;letter-spacing:0.15em;text-transform:uppercase">"Mad-libs" Roguelite</div>
    <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
      <button id="continue-btn" style="padding:10px 30px;font-size:16px;border-radius:8px;background:#1f2937;border:1px solid #4ade8055;display:none">CONTINUE RUN</button>
      <button id="start-game-btn" style="padding:10px 30px;font-size:16px;background:linear-gradient(135deg,#22543d,#1a3328);border:1px solid rgba(74,222,128,0.33);border-radius:8px;cursor:pointer;color:#ecfdf3;box-shadow:0 0 6px rgba(52,211,153,0.2),0 4px 12px rgba(22,163,74,0.15)">START NEW RUN</button>
      <button id="skill-tree-btn" style="padding:10px 30px;font-size:14px;border-radius:8px;background:linear-gradient(135deg,#3b2f5c,#2a2145);border:1px solid rgba(168,85,247,0.4);color:#e9d5ff;position:relative">Hero Skills<span id="skill-points-badge" class="skill-badge" style="display:none"></span></button>
      <button id="achievements-btn" style="padding:10px 30px;font-size:14px;border-radius:8px;background:#111827;border:1px solid #374151">Achievements & Stats</button>
      <button id="main-graphics-btn" style="padding:8px 26px;font-size:14px;border-radius:8px;background:#111827;border:1px solid #374151">Settings</button>
      <button id="main-credits-btn" style="padding:8px 26px;font-size:14px;border-radius:8px;background:#111827;border:1px solid #374151">Credits</button>
      <button id="main-quit-btn" style="padding:8px 20px;font-size:12px;border-radius:8px;background:#1f1215;border:1px solid #7f1d1d;color:#fca5a5;margin-top:8px">Quit Game</button>
    </div>
    <!-- Footer -->
    <div style="margin-top:20px;padding-top:16px;border-top:1px solid #374151;display:flex;flex-direction:column;gap:6px;align-items:center">
      <button id="wishlist-btn" style="padding:8px 20px;font-size:12px;border-radius:8px;background:linear-gradient(135deg,#1a4a7a,#0f2d4a);border:1px solid rgba(59,130,246,0.5);color:#dbeafe;box-shadow:0 0 6px rgba(59,130,246,0.3)">‚òÜ Wishlist on Steam</button>
      <button id="discord-btn" style="padding:4px 12px;font-size:10px;border-radius:6px;background:rgba(88,101,242,0.1);border:1px solid rgba(88,101,242,0.2);color:#7289da;opacity:0.7;transition:opacity 0.2s">Join Discord</button>
    </div>
  </div>
</div>

<!-- Skill Tree overlay for hero progression -->
<div class="overlay" id="skill-tree-overlay">
  <div class="modal skill-tree-modal">
    <div class="skill-tree-header">
      <button id="skill-tree-back-btn" class="skill-tree-nav-btn">‚óÄ</button>
      <div class="skill-tree-hero-info">
        <div class="skill-tree-hero-name" id="skill-tree-hero-name">Graham Moor</div>
        <div class="skill-tree-hero-level" id="skill-tree-hero-level">Level 1</div>
      </div>
      <button id="skill-tree-next-btn" class="skill-tree-nav-btn">‚ñ∂</button>
    </div>
    <div class="skill-tree-xp-bar">
      <div class="skill-tree-xp-fill" id="skill-tree-xp-fill"></div>
      <div class="skill-tree-xp-text" id="skill-tree-xp-text">0 / 100 XP</div>
    </div>
    <div class="skill-tree-points" id="skill-tree-points">Skill Points: 0</div>
    <div class="skill-tree-container" id="skill-tree-container">
      <!-- Nodes rendered dynamically -->
    </div>
    <div class="skill-tree-footer">
      <button id="skill-tree-respec-btn" class="skill-tree-btn">RESPEC</button>
      <button id="skill-tree-close-btn" class="skill-tree-btn">CLOSE</button>
    </div>
  </div>
</div>

<!-- Demo Victory screen - shown after Round 18 boss when IS_DEMO=true (hidden by JS when IS_DEMO=false) -->
<div class="overlay" id="victory-overlay">
  <div class="modal victory-modal" style="text-align:center;min-width:500px;max-width:600px; overflow: hidden; position: relative;">
    <div class="god-rays"></div>
    <div style="font-size:36px;font-weight:bold;margin-bottom:20px;position:relative;z-index:2" class="gold">THANK YOU FOR PLAYING!</div>
    <div style="font-size:16px;color:#9ca3af;margin-bottom:10px;position:relative;z-index:2" id="victory-hero-name"></div>
    <div style="font-size:18px;color:#d1d5db;margin-bottom:20px;line-height:1.6;font-style:italic;position:relative;z-index:2" id="victory-dialogue"></div>
    <div style="font-size:13px;color:#9ca3af;margin-bottom:25px;position:relative;z-index:2">
      You've completed the demo! The full game features more heroes, endless mode, and much more.<br>
      <span id="victory-highest-round" style="color:#4ade80;font-weight:bold"></span>
    </div>
    <div style="display:flex;flex-direction:column;gap:10px;align-items:center;position:relative;z-index:2">
      <button id="victory-wishlist-btn" style="padding:12px 40px;font-size:16px;background:linear-gradient(135deg,#1a4a7a,#0f2d4a);border:1px solid rgba(59,130,246,0.5);border-radius:8px;cursor:pointer;color:#dbeafe;box-shadow:0 0 6px rgba(59,130,246,0.3),0 4px 12px rgba(37,99,235,0.2)">WISHLIST ON STEAM</button>
      <button id="victory-newrun-btn" style="padding:10px 36px;font-size:14px;border-radius:8px;background:#111827;border:1px solid #374151">START NEW RUN</button>
    </div>
  </div>
</div>

<!-- Chapter Complete / Demo Victory celebration overlay -->
<div class="overlay" id="chapter-overlay">
  <div class="god-rays" id="chapter-god-rays"></div>
  <div class="chapter-modal">
    <div id="chapter-hero-portrait" class="chapter-portrait"></div>
    <h1 id="chapter-title" class="chapter-title gold">CHAPTER 1 COMPLETE</h1>
    <div id="chapter-hero-name" class="chapter-hero-name"></div>
    <p id="chapter-hero-dialogue" class="chapter-dialogue"></p>
    <div id="chapter-gold-wrapper" class="chapter-rewards">
      <div class="chapter-reward-badge">
        <span class="reward-label">Gold Bonus</span>
        <span class="reward-value" id="chapter-gold-bonus">+40g</span>
      </div>
    </div>
    <div id="chapter-buttons" class="chapter-buttons">
      <button id="chapter-continue-btn" class="btn-chapter-continue">CONTINUE</button>
      <button id="chapter-mainmenu-btn" class="btn-chapter-secondary">BACK TO MAIN MENU</button>
    </div>
  </div>
</div>

<!-- Run End / Loss Screen -->
<div class="overlay" id="loss-overlay">
  <div class="loss-content" style="text-align:center;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center">
    <div style="font-size:28px;font-weight:bold;margin-bottom:12px;color:#f87171;letter-spacing:0.1em">RUN ENDED</div>
    <div style="font-size:14px;color:#9ca3af;margin-bottom:8px">Round <span id="loss-round">1</span></div>
    <div id="loss-defeat-dialogue" style="font-size:14px;color:#d1d5db;font-style:italic;margin-bottom:20px;max-width:320px;line-height:1.4"></div>
    <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:24px">
      <div class="loss-reward-badge" style="background:linear-gradient(135deg,#1e3a5f,#0f2744);border:1px solid rgba(59,130,246,0.4);border-radius:10px;padding:12px 32px;display:flex;flex-direction:column;align-items:center">
        <span style="font-size:11px;color:#9ca3af;text-transform:uppercase;letter-spacing:0.1em" id="loss-hero-name">Hero</span>
        <span style="font-size:22px;font-weight:bold;color:#60a5fa" id="loss-xp-gained">+25 XP</span>
      </div>
      <div id="loss-level-up" style="display:none;font-size:13px;color:#fbbf24;font-weight:bold">LEVEL UP!</div>
    </div>
    <button id="loss-continue-btn" style="padding:12px 40px;font-size:16px;background:linear-gradient(135deg,#374151,#1f2937);border:1px solid rgba(156,163,175,0.33);border-radius:8px;cursor:pointer;color:#e5e7eb;box-shadow:0 4px 12px rgba(0,0,0,0.3)">CONTINUE</button>
  </div>
</div>

<!-- Crate Opening Reel Animation -->
<div class="overlay" id="crate-reel-overlay">
  <div class="modal" style="text-align:center;min-width:600px">
    <div class="modal-title gold" id="crate-reel-title">Opening Crate...</div>
    <div id="crate-reel-container" style="display:flex;justify-content:center;gap:20px;margin:30px 0"></div>
    <div id="crate-reel-status" style="font-size:13px;color:#9ca3af;margin-top:20px"></div>
  </div>
</div>

<!-- Pause / Menu overlay accessible during runs -->
<div class="overlay" id="pause-menu">
  <div class="modal" style="text-align:center;min-width:360px">
    <img src="assets/logo-light.png" alt="Wordy Weapon" class="logo-img logo-pause">
    <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
      <button id="pause-continue" style="padding:8px 24px;border-radius:8px;background:#1f2937;border:1px solid #374151">CONTINUE RUN</button>
      <button id="pause-new" style="padding:8px 24px;border-radius:8px;background:linear-gradient(135deg,#22543d,#1a3328);border:1px solid rgba(74,222,128,0.33);color:#ecfdf3;box-shadow:0 0 6px rgba(52,211,153,0.2),0 4px 12px rgba(22,163,74,0.15)">START NEW RUN</button>
      <button id="pause-title" style="padding:8px 24px;border-radius:8px;background:#1f2937;border:1px solid #374151">Return to Title</button>
      <button id="pause-achievements" style="padding:8px 24px;border-radius:8px;background:#111827;border:1px solid #374151">Achievements & Stats</button>
      <button id="pause-graphics" style="padding:8px 24px;border-radius:8px;background:#111827;border:1px solid #374151">Settings</button>
      <button id="pause-credits" style="padding:8px 24px;border-radius:8px;background:#111827;border:1px solid #374151">Credits</button>
      <button id="pause-quit-btn" style="padding:8px 20px;font-size:12px;border-radius:8px;background:#1f1215;border:1px solid #7f1d1d;color:#fca5a5;margin-top:8px">Quit Game</button>
    </div>
    <!-- Footer -->
    <div style="margin-top:20px;padding-top:16px;border-top:1px solid #374151;display:flex;flex-direction:column;gap:6px;align-items:center">
      <button id="pause-wishlist-btn" style="padding:8px 20px;font-size:12px;border-radius:8px;background:linear-gradient(135deg,#1a4a7a,#0f2d4a);border:1px solid rgba(59,130,246,0.5);color:#dbeafe;box-shadow:0 0 6px rgba(59,130,246,0.3)">‚òÜ Wishlist on Steam</button>
      <button id="pause-discord-btn" style="padding:4px 12px;font-size:10px;border-radius:6px;background:rgba(88,101,242,0.1);border:1px solid rgba(88,101,242,0.2);color:#7289da;opacity:0.7;transition:opacity 0.2s">Join Discord</button>
    </div>
  </div>
</div>

<!-- Confirmation Modal for Quit/Reset -->
<div class="overlay" id="confirm-modal" style="display:none;z-index:9999">
  <div class="modal" style="text-align:center;min-width:300px">
    <div id="confirm-title" style="font-size:18px;font-weight:bold;margin-bottom:12px;color:#fca5a5">Quit Game?</div>
    <div id="confirm-message" style="font-size:14px;color:#9ca3af;margin-bottom:20px">Are you sure you want to quit?</div>
    <div style="display:flex;gap:12px;justify-content:center">
      <button id="confirm-cancel" style="padding:8px 24px;border-radius:8px;background:#1f2937;border:1px solid #374151">Cancel</button>
      <button id="confirm-yes" style="padding:8px 24px;border-radius:8px;background:#7f1d1d;border:1px solid #dc2626;color:#fecaca">Yes</button>
    </div>
  </div>
</div>

<!-- Graphics Settings overlay -->
<div class="overlay" id="graphics-settings">
  <div class="modal graphics-modal" style="text-align:center;min-width:380px;backdrop-filter:none;-webkit-backdrop-filter:none">
    <div style="font-size:18px;font-weight:bold;margin-bottom:16px" class="gold">Settings</div>
    <div style="display:flex;flex-direction:column;gap:12px;text-align:left;padding:0 10px">
      <label style="display:flex;justify-content:space-between;align-items:center;font-size:13px;gap:12px">
        <span style="display:flex;flex-direction:column;gap:2px">
          <span>Low FX mode</span>
          <span style="font-size:10px;color:#9ca3af">Reduces animations and GPU usage</span>
        </span>
        <input type="checkbox" id="gfx-lowfx" style="width:18px;height:18px">
      </label>
      <label style="display:flex;justify-content:space-between;align-items:center;font-size:13px;gap:12px">
        <span style="display:flex;flex-direction:column;gap:2px">
          <span>UI Scale</span>
          <span style="font-size:10px;color:#9ca3af">Adjust interface size (50-200%)</span>
        </span>
        <div style="display:flex;align-items:center;gap:8px">
          <input type="range" id="gfx-scale" min="50" max="200" value="100" style="width:80px;accent-color:#f4d03f">
          <span id="gfx-scale-value" style="font-size:12px;min-width:36px;text-align:right">100%</span>
        </div>
      </label>
      <label id="fullscreen-setting" style="display:none;justify-content:space-between;align-items:center;font-size:13px;gap:12px">
        <span>Fullscreen</span>
        <button id="gfx-fullscreen" style="padding:6px 16px;border-radius:6px;background:#1f2937;border:1px solid #374151;font-size:12px">Windowed</button>
      </label>
    </div>
    <div style="margin-top:20px;padding-top:16px;border-top:1px solid #374151;display:flex;flex-direction:column;gap:8px;align-items:center">
      <button id="gfx-bug-report" style="padding:8px 20px;border-radius:8px;background:#111827;border:1px solid #374151;font-size:12px;width:160px">Report Bug</button>
      <button id="gfx-reset-tutorial" style="padding:8px 20px;border-radius:8px;background:#111827;border:1px solid #374151;font-size:12px;width:160px">Reset Tutorial</button>
      <button id="gfx-reset-data" style="padding:8px 20px;border-radius:8px;background:#1f1215;border:1px solid #7f1d1d;color:#fca5a5;font-size:12px;width:160px">Reset Data</button>
    </div>
    <div style="margin-top:16px">
      <button id="gfx-close" style="padding:8px 24px;border-radius:8px;background:#1f2937;border:1px solid #374151">Close</button>
    </div>
  </div>
</div>

<!-- Credits overlay -->
<div class="overlay" id="credits-overlay">
  <div class="modal" style="text-align:center;min-width:400px;max-width:480px">
    <div style="font-size:22px;font-weight:bold;margin-bottom:16px" class="gold">Credits</div>
    <div style="text-align:left;font-size:13px;line-height:1.7;color:#d1d5db;padding:0 12px">
      <div style="margin-bottom:16px">
        <div style="color:#6b7280;font-size:10px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px">Created By</div>
        <div style="font-size:15px;color:#f3f4f6">Andrew Amisola</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="color:#6b7280;font-size:10px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px">Game Design & Development</div>
        <div>Andrew Amisola</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="color:#6b7280;font-size:10px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px">Art Direction & Visual Design</div>
        <div>Andrew Amisola</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="color:#6b7280;font-size:10px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px">Original Music & Sound Design</div>
        <div>Andrew Amisola</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="color:#6b7280;font-size:10px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px">Writing & Narrative</div>
        <div>Andrew Amisola</div>
      </div>
      <div style="border-top:1px solid #374151;padding-top:12px;margin-top:8px">
        <div style="color:#6b7280;font-size:10px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px">Built With</div>
        <div style="font-size:11px;color:#9ca3af">HTML, CSS & JavaScript ¬∑ Web Audio API ¬∑ Tone.js</div>
      </div>
    </div>
    <div style="margin-top:20px">
      <button id="credits-close" style="padding:8px 24px;border-radius:8px;background:#1f2937;border:1px solid #374151">Close</button>
    </div>
  </div>
</div>

<!-- Achievements overlay shows persistent progress -->
<div class="overlay" id="achievements-overlay">
  <div class="modal stats-modal">
    <div class="modal-title gold" style="text-align:center;letter-spacing:0.2em;margin-bottom:20px">ACHIEVEMENTS & STATS</div>
    <div id="stats-container" class="stats-grid"></div>
    <div style="text-align:center;margin-top:16px;display:flex;justify-content:center;gap:10px">
      <button id="stats-reset" class="btn-danger">Reset Data</button>
      <button id="achievements-close" style="padding:8px 24px;border-radius:8px;background:#1f2937;border:1px solid #374151">Close</button>
    </div>
  </div>
</div>

<!-- Talent Viewer overlay shows acquired talents with full descriptions -->
<div class="overlay" id="talent-viewer-overlay">
  <div class="modal" style="min-width:550px;max-width:850px;width:88vw">
    <div class="modal-title gold" style="text-align:center;letter-spacing:0.12em;margin-bottom:8px;font-size:15px">YOUR TALENTS</div>
    <div id="talent-viewer-content" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:8px;max-height:62vh;overflow-y:auto;padding:6px 16px"></div>
    <div style="text-align:center;margin-top:12px">
      <button id="talent-viewer-close" style="padding:8px 24px;border-radius:6px;background:#1f2937;border:1px solid #374151;font-size:12px">Close</button>
    </div>
  </div>
</div>

<!-- Onboarding Overlay - Full screen dialogue for first-time players -->
<div id="onboarding-overlay">
  <div id="onboarding-box">
    <div id="onboarding-portrait"></div>
    <div id="onboarding-name"></div>
    <div id="onboarding-text"></div>
    <div id="onboarding-example"></div>
    <div id="onboarding-continue">Click to continue</div>
  </div>
</div>

<footer id="demo-footer">
  <span>Wordy Weapon‚Ñ¢ Demo ¬∑ ¬© 2025 Andrew Amisola ¬∑ All Rights Reserved</span>
</footer>

<!-- Debug Performance Overlay (F3 to toggle) -->
<div id="debug-overlay" class="hidden">
  <div id="debug-header">
    <span>PERFORMANCE (F3)</span>
    <button id="debug-copy-log">Copy Log</button>
  </div>
  <div id="debug-stats">
    <div class="debug-row"><span>FPS:</span><span id="debug-fps">--</span></div>
    <div class="debug-row"><span>Frame:</span><span id="debug-frame-time">--</span></div>
    <div class="debug-row"><span>FPS Range:</span><span id="debug-fps-range">--</span></div>
    <div class="debug-row"><span>Avg Frame:</span><span id="debug-avg-frame">--</span></div>
    <div class="debug-row"><span>Memory:</span><span id="debug-memory">--</span></div>
    <div class="debug-row"><span>Particles:</span><span id="debug-particles">--</span></div>
    <div class="debug-row"><span>DOM Nodes:</span><span id="debug-dom">--</span></div>
    <div class="debug-row"><span>Scene:</span><span id="debug-scene">--</span></div>
  </div>
  <div id="debug-log-status"></div>
</div>



<!-- Tone.js for generative music system -->
<script src="Tone.min.js"></script>
<script src="Midi.js"></script>

<script src="script.js"></script>

</body>
</html>
